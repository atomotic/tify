/*!
TIFY v0.28.1
(c) 2017-2023 GÃ¶ttingen State and University Library (https://www.sub.uni-goettingen.de/)
AGPL-3.0
https://tify.rocks/
*/
(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();function _n(t,r){const e=Object.create(null),i=t.split(",");for(let n=0;n<i.length;n++)e[i[n]]=!0;return r?n=>!!e[n.toLowerCase()]:n=>!!e[n]}function xn(t){if(oe(t)){const r={};for(let e=0;e<t.length;e++){const i=t[e],n=Ce(i)?Nr(i):xn(i);if(n)for(const s in n)r[s]=n[s]}return r}else{if(Ce(t))return t;if(Te(t))return t}}const Ar=/;(?![^(]*\))/g,Br=/:([^]+)/,zr=/\/\*.*?\*\//gs;function Nr(t){const r={};return t.replace(zr,"").split(Ar).forEach(e=>{if(e){const i=e.split(Br);i.length>1&&(r[i[0].trim()]=i[1].trim())}}),r}function _e(t){let r="";if(Ce(t))r=t;else if(oe(t))for(let e=0;e<t.length;e++){const i=_e(t[e]);i&&(r+=i+" ")}else if(Te(t))for(const e in t)t[e]&&(r+=e+" ");return r.trim()}const Vr="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Ur=_n(Vr);function Hs(t){return!!t||t===""}const U=t=>Ce(t)?t:t==null?"":oe(t)||Te(t)&&(t.toString===Ms||!ue(t.toString))?JSON.stringify(t,Ls,2):String(t),Ls=(t,r)=>r&&r.__v_isRef?Ls(t,r.value):Gt(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((e,[i,n])=>(e[`${i} =>`]=n,e),{})}:Ds(r)?{[`Set(${r.size})`]:[...r.values()]}:Te(r)&&!oe(r)&&!Os(r)?String(r):r,ye={},jt=[],$e=()=>{},Wr=()=>!1,jr=/^on[^a-z]/,Di=t=>jr.test(t),Tn=t=>t.startsWith("onUpdate:"),ke=Object.assign,bn=(t,r)=>{const e=t.indexOf(r);e>-1&&t.splice(e,1)},Gr=Object.prototype.hasOwnProperty,fe=(t,r)=>Gr.call(t,r),oe=Array.isArray,Gt=t=>Ii(t)==="[object Map]",Ds=t=>Ii(t)==="[object Set]",ue=t=>typeof t=="function",Ce=t=>typeof t=="string",En=t=>typeof t=="symbol",Te=t=>t!==null&&typeof t=="object",Is=t=>Te(t)&&ue(t.then)&&ue(t.catch),Ms=Object.prototype.toString,Ii=t=>Ms.call(t),qr=t=>Ii(t).slice(8,-1),Os=t=>Ii(t)==="[object Object]",Sn=t=>Ce(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,wi=_n(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Mi=t=>{const r=Object.create(null);return e=>r[e]||(r[e]=t(e))},Zr=/-(\w)/g,at=Mi(t=>t.replace(Zr,(r,e)=>e?e.toUpperCase():"")),Kr=/\B([A-Z])/g,Bt=Mi(t=>t.replace(Kr,"-$1").toLowerCase()),Oi=Mi(t=>t.charAt(0).toUpperCase()+t.slice(1)),Wi=Mi(t=>t?`on${Oi(t)}`:""),ri=(t,r)=>!Object.is(t,r),_i=(t,r)=>{for(let e=0;e<t.length;e++)t[e](r)},Si=(t,r,e)=>{Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value:e})},Yi=t=>{const r=parseFloat(t);return isNaN(r)?t:r};let Zn;const Xr=()=>Zn||(Zn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Ye;class Yr{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Ye,!r&&Ye&&(this.index=(Ye.scopes||(Ye.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const e=Ye;try{return Ye=this,r()}finally{Ye=e}}}on(){Ye=this}off(){Ye=this.parent}stop(r){if(this._active){let e,i;for(e=0,i=this.effects.length;e<i;e++)this.effects[e].stop();for(e=0,i=this.cleanups.length;e<i;e++)this.cleanups[e]();if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!r){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0,this._active=!1}}}function Jr(t,r=Ye){r&&r.active&&r.effects.push(t)}function Qr(){return Ye}const Pn=t=>{const r=new Set(t);return r.w=0,r.n=0,r},Fs=t=>(t.w&Et)>0,ks=t=>(t.n&Et)>0,$r=({deps:t})=>{if(t.length)for(let r=0;r<t.length;r++)t[r].w|=Et},eo=t=>{const{deps:r}=t;if(r.length){let e=0;for(let i=0;i<r.length;i++){const n=r[i];Fs(n)&&!ks(n)?n.delete(t):r[e++]=n,n.w&=~Et,n.n&=~Et}r.length=e}},Ji=new WeakMap;let ti=0,Et=1;const Qi=30;let Je;const Ot=Symbol(""),$i=Symbol("");class Cn{constructor(r,e=null,i){this.fn=r,this.scheduler=e,this.active=!0,this.deps=[],this.parent=void 0,Jr(this,i)}run(){if(!this.active)return this.fn();let r=Je,e=Tt;for(;r;){if(r===this)return;r=r.parent}try{return this.parent=Je,Je=this,Tt=!0,Et=1<<++ti,ti<=Qi?$r(this):Kn(this),this.fn()}finally{ti<=Qi&&eo(this),Et=1<<--ti,Je=this.parent,Tt=e,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Je===this?this.deferStop=!0:this.active&&(Kn(this),this.onStop&&this.onStop(),this.active=!1)}}function Kn(t){const{deps:r}=t;if(r.length){for(let e=0;e<r.length;e++)r[e].delete(t);r.length=0}}let Tt=!0;const As=[];function Jt(){As.push(Tt),Tt=!1}function Qt(){const t=As.pop();Tt=t===void 0?!0:t}function Ue(t,r,e){if(Tt&&Je){let i=Ji.get(t);i||Ji.set(t,i=new Map);let n=i.get(e);n||i.set(e,n=Pn()),Bs(n)}}function Bs(t,r){let e=!1;ti<=Qi?ks(t)||(t.n|=Et,e=!Fs(t)):e=!t.has(Je),e&&(t.add(Je),Je.deps.push(t))}function pt(t,r,e,i,n,s){const c=Ji.get(t);if(!c)return;let o=[];if(r==="clear")o=[...c.values()];else if(e==="length"&&oe(t)){const a=Number(i);c.forEach((l,u)=>{(u==="length"||u>=a)&&o.push(l)})}else switch(e!==void 0&&o.push(c.get(e)),r){case"add":oe(t)?Sn(e)&&o.push(c.get("length")):(o.push(c.get(Ot)),Gt(t)&&o.push(c.get($i)));break;case"delete":oe(t)||(o.push(c.get(Ot)),Gt(t)&&o.push(c.get($i)));break;case"set":Gt(t)&&o.push(c.get(Ot));break}if(o.length===1)o[0]&&en(o[0]);else{const a=[];for(const l of o)l&&a.push(...l);en(Pn(a))}}function en(t,r){const e=oe(t)?t:[...t];for(const i of e)i.computed&&Xn(i);for(const i of e)i.computed||Xn(i)}function Xn(t,r){(t!==Je||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const to=_n("__proto__,__v_isRef,__isVue"),zs=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(En)),io=Rn(),no=Rn(!1,!0),so=Rn(!0),Yn=ro();function ro(){const t={};return["includes","indexOf","lastIndexOf"].forEach(r=>{t[r]=function(...e){const i=ge(this);for(let s=0,c=this.length;s<c;s++)Ue(i,"get",s+"");const n=i[r](...e);return n===-1||n===!1?i[r](...e.map(ge)):n}}),["push","pop","shift","unshift","splice"].forEach(r=>{t[r]=function(...e){Jt();const i=ge(this)[r].apply(this,e);return Qt(),i}}),t}function oo(t){const r=ge(this);return Ue(r,"has",t),r.hasOwnProperty(t)}function Rn(t=!1,r=!1){return function(i,n,s){if(n==="__v_isReactive")return!t;if(n==="__v_isReadonly")return t;if(n==="__v_isShallow")return r;if(n==="__v_raw"&&s===(t?r?bo:js:r?Ws:Us).get(i))return i;const c=oe(i);if(!t){if(c&&fe(Yn,n))return Reflect.get(Yn,n,s);if(n==="hasOwnProperty")return oo}const o=Reflect.get(i,n,s);return(En(n)?zs.has(n):to(n))||(t||Ue(i,"get",n),r)?o:Me(o)?c&&Sn(n)?o:o.value:Te(o)?t?Gs(o):ki(o):o}}const ao=Ns(),lo=Ns(!0);function Ns(t=!1){return function(e,i,n,s){let c=e[i];if(Kt(c)&&Me(c)&&!Me(n))return!1;if(!t&&(!Pi(n)&&!Kt(n)&&(c=ge(c),n=ge(n)),!oe(e)&&Me(c)&&!Me(n)))return c.value=n,!0;const o=oe(e)&&Sn(i)?Number(i)<e.length:fe(e,i),a=Reflect.set(e,i,n,s);return e===ge(s)&&(o?ri(n,c)&&pt(e,"set",i,n):pt(e,"add",i,n)),a}}function co(t,r){const e=fe(t,r);t[r];const i=Reflect.deleteProperty(t,r);return i&&e&&pt(t,"delete",r,void 0),i}function uo(t,r){const e=Reflect.has(t,r);return(!En(r)||!zs.has(r))&&Ue(t,"has",r),e}function ho(t){return Ue(t,"iterate",oe(t)?"length":Ot),Reflect.ownKeys(t)}const Vs={get:io,set:ao,deleteProperty:co,has:uo,ownKeys:ho},fo={get:so,set(t,r){return!0},deleteProperty(t,r){return!0}},po=ke({},Vs,{get:no,set:lo}),Hn=t=>t,Fi=t=>Reflect.getPrototypeOf(t);function fi(t,r,e=!1,i=!1){t=t.__v_raw;const n=ge(t),s=ge(r);e||(r!==s&&Ue(n,"get",r),Ue(n,"get",s));const{has:c}=Fi(n),o=i?Hn:e?In:oi;if(c.call(n,r))return o(t.get(r));if(c.call(n,s))return o(t.get(s));t!==n&&t.get(r)}function pi(t,r=!1){const e=this.__v_raw,i=ge(e),n=ge(t);return r||(t!==n&&Ue(i,"has",t),Ue(i,"has",n)),t===n?e.has(t):e.has(t)||e.has(n)}function gi(t,r=!1){return t=t.__v_raw,!r&&Ue(ge(t),"iterate",Ot),Reflect.get(t,"size",t)}function Jn(t){t=ge(t);const r=ge(this);return Fi(r).has.call(r,t)||(r.add(t),pt(r,"add",t,t)),this}function Qn(t,r){r=ge(r);const e=ge(this),{has:i,get:n}=Fi(e);let s=i.call(e,t);s||(t=ge(t),s=i.call(e,t));const c=n.call(e,t);return e.set(t,r),s?ri(r,c)&&pt(e,"set",t,r):pt(e,"add",t,r),this}function $n(t){const r=ge(this),{has:e,get:i}=Fi(r);let n=e.call(r,t);n||(t=ge(t),n=e.call(r,t)),i&&i.call(r,t);const s=r.delete(t);return n&&pt(r,"delete",t,void 0),s}function es(){const t=ge(this),r=t.size!==0,e=t.clear();return r&&pt(t,"clear",void 0,void 0),e}function mi(t,r){return function(i,n){const s=this,c=s.__v_raw,o=ge(c),a=r?Hn:t?In:oi;return!t&&Ue(o,"iterate",Ot),c.forEach((l,u)=>i.call(n,a(l),a(u),s))}}function vi(t,r,e){return function(...i){const n=this.__v_raw,s=ge(n),c=Gt(s),o=t==="entries"||t===Symbol.iterator&&c,a=t==="keys"&&c,l=n[t](...i),u=e?Hn:r?In:oi;return!r&&Ue(s,"iterate",a?$i:Ot),{next(){const{value:d,done:f}=l.next();return f?{value:d,done:f}:{value:o?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}function wt(t){return function(...r){return t==="delete"?!1:this}}function go(){const t={get(s){return fi(this,s)},get size(){return gi(this)},has:pi,add:Jn,set:Qn,delete:$n,clear:es,forEach:mi(!1,!1)},r={get(s){return fi(this,s,!1,!0)},get size(){return gi(this)},has:pi,add:Jn,set:Qn,delete:$n,clear:es,forEach:mi(!1,!0)},e={get(s){return fi(this,s,!0)},get size(){return gi(this,!0)},has(s){return pi.call(this,s,!0)},add:wt("add"),set:wt("set"),delete:wt("delete"),clear:wt("clear"),forEach:mi(!0,!1)},i={get(s){return fi(this,s,!0,!0)},get size(){return gi(this,!0)},has(s){return pi.call(this,s,!0)},add:wt("add"),set:wt("set"),delete:wt("delete"),clear:wt("clear"),forEach:mi(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=vi(s,!1,!1),e[s]=vi(s,!0,!1),r[s]=vi(s,!1,!0),i[s]=vi(s,!0,!0)}),[t,e,r,i]}const[mo,vo,yo,wo]=go();function Ln(t,r){const e=r?t?wo:yo:t?vo:mo;return(i,n,s)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?i:Reflect.get(fe(e,n)&&n in i?e:i,n,s)}const _o={get:Ln(!1,!1)},xo={get:Ln(!1,!0)},To={get:Ln(!0,!1)},Us=new WeakMap,Ws=new WeakMap,js=new WeakMap,bo=new WeakMap;function Eo(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function So(t){return t.__v_skip||!Object.isExtensible(t)?0:Eo(qr(t))}function ki(t){return Kt(t)?t:Dn(t,!1,Vs,_o,Us)}function Po(t){return Dn(t,!1,po,xo,Ws)}function Gs(t){return Dn(t,!0,fo,To,js)}function Dn(t,r,e,i,n){if(!Te(t)||t.__v_raw&&!(r&&t.__v_isReactive))return t;const s=n.get(t);if(s)return s;const c=So(t);if(c===0)return t;const o=new Proxy(t,c===2?i:e);return n.set(t,o),o}function qt(t){return Kt(t)?qt(t.__v_raw):!!(t&&t.__v_isReactive)}function Kt(t){return!!(t&&t.__v_isReadonly)}function Pi(t){return!!(t&&t.__v_isShallow)}function qs(t){return qt(t)||Kt(t)}function ge(t){const r=t&&t.__v_raw;return r?ge(r):t}function Zs(t){return Si(t,"__v_skip",!0),t}const oi=t=>Te(t)?ki(t):t,In=t=>Te(t)?Gs(t):t;function Ks(t){Tt&&Je&&(t=ge(t),Bs(t.dep||(t.dep=Pn())))}function Xs(t,r){t=ge(t);const e=t.dep;e&&en(e)}function Me(t){return!!(t&&t.__v_isRef===!0)}function Ys(t){return Co(t,!1)}function Co(t,r){return Me(t)?t:new Ro(t,r)}class Ro{constructor(r,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?r:ge(r),this._value=e?r:oi(r)}get value(){return Ks(this),this._value}set value(r){const e=this.__v_isShallow||Pi(r)||Kt(r);r=e?r:ge(r),ri(r,this._rawValue)&&(this._rawValue=r,this._value=e?r:oi(r),Xs(this))}}function Ho(t){return Me(t)?t.value:t}const Lo={get:(t,r,e)=>Ho(Reflect.get(t,r,e)),set:(t,r,e,i)=>{const n=t[r];return Me(n)&&!Me(e)?(n.value=e,!0):Reflect.set(t,r,e,i)}};function Js(t){return qt(t)?t:new Proxy(t,Lo)}var Qs;class Do{constructor(r,e,i,n){this._setter=e,this.dep=void 0,this.__v_isRef=!0,this[Qs]=!1,this._dirty=!0,this.effect=new Cn(r,()=>{this._dirty||(this._dirty=!0,Xs(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=i}get value(){const r=ge(this);return Ks(r),(r._dirty||!r._cacheable)&&(r._dirty=!1,r._value=r.effect.run()),r._value}set value(r){this._setter(r)}}Qs="__v_isReadonly";function Io(t,r,e=!1){let i,n;const s=ue(t);return s?(i=t,n=$e):(i=t.get,n=t.set),new Do(i,n,s||!n,e)}function bt(t,r,e,i){let n;try{n=i?t(...i):t()}catch(s){Ai(s,r,e)}return n}function et(t,r,e,i){if(ue(t)){const s=bt(t,r,e,i);return s&&Is(s)&&s.catch(c=>{Ai(c,r,e)}),s}const n=[];for(let s=0;s<t.length;s++)n.push(et(t[s],r,e,i));return n}function Ai(t,r,e,i=!0){const n=r?r.vnode:null;if(r){let s=r.parent;const c=r.proxy,o=e;for(;s;){const l=s.ec;if(l){for(let u=0;u<l.length;u++)if(l[u](t,c,o)===!1)return}s=s.parent}const a=r.appContext.config.errorHandler;if(a){bt(a,null,10,[t,c,o]);return}}Mo(t,e,n,i)}function Mo(t,r,e,i=!0){console.error(t)}let ai=!1,tn=!1;const De=[];let ot=0;const Zt=[];let ft=null,Lt=0;const $s=Promise.resolve();let Mn=null;function er(t){const r=Mn||$s;return t?r.then(this?t.bind(this):t):r}function Oo(t){let r=ot+1,e=De.length;for(;r<e;){const i=r+e>>>1;li(De[i])<t?r=i+1:e=i}return r}function On(t){(!De.length||!De.includes(t,ai&&t.allowRecurse?ot+1:ot))&&(t.id==null?De.push(t):De.splice(Oo(t.id),0,t),tr())}function tr(){!ai&&!tn&&(tn=!0,Mn=$s.then(nr))}function Fo(t){const r=De.indexOf(t);r>ot&&De.splice(r,1)}function ko(t){oe(t)?Zt.push(...t):(!ft||!ft.includes(t,t.allowRecurse?Lt+1:Lt))&&Zt.push(t),tr()}function ts(t,r=ai?ot+1:0){for(;r<De.length;r++){const e=De[r];e&&e.pre&&(De.splice(r,1),r--,e())}}function ir(t){if(Zt.length){const r=[...new Set(Zt)];if(Zt.length=0,ft){ft.push(...r);return}for(ft=r,ft.sort((e,i)=>li(e)-li(i)),Lt=0;Lt<ft.length;Lt++)ft[Lt]();ft=null,Lt=0}}const li=t=>t.id==null?1/0:t.id,Ao=(t,r)=>{const e=li(t)-li(r);if(e===0){if(t.pre&&!r.pre)return-1;if(r.pre&&!t.pre)return 1}return e};function nr(t){tn=!1,ai=!0,De.sort(Ao);const r=$e;try{for(ot=0;ot<De.length;ot++){const e=De[ot];e&&e.active!==!1&&bt(e,null,14)}}finally{ot=0,De.length=0,ir(),ai=!1,Mn=null,(De.length||Zt.length)&&nr()}}function Bo(t,r,...e){if(t.isUnmounted)return;const i=t.vnode.props||ye;let n=e;const s=r.startsWith("update:"),c=s&&r.slice(7);if(c&&c in i){const u=`${c==="modelValue"?"model":c}Modifiers`,{number:d,trim:f}=i[u]||ye;f&&(n=e.map(w=>Ce(w)?w.trim():w)),d&&(n=e.map(Yi))}let o,a=i[o=Wi(r)]||i[o=Wi(at(r))];!a&&s&&(a=i[o=Wi(Bt(r))]),a&&et(a,t,6,n);const l=i[o+"Once"];if(l){if(!t.emitted)t.emitted={};else if(t.emitted[o])return;t.emitted[o]=!0,et(l,t,6,n)}}function sr(t,r,e=!1){const i=r.emitsCache,n=i.get(t);if(n!==void 0)return n;const s=t.emits;let c={},o=!1;if(!ue(t)){const a=l=>{const u=sr(l,r,!0);u&&(o=!0,ke(c,u))};!e&&r.mixins.length&&r.mixins.forEach(a),t.extends&&a(t.extends),t.mixins&&t.mixins.forEach(a)}return!s&&!o?(Te(t)&&i.set(t,null),null):(oe(s)?s.forEach(a=>c[a]=null):ke(c,s),Te(t)&&i.set(t,c),c)}function Bi(t,r){return!t||!Di(r)?!1:(r=r.slice(2).replace(/Once$/,""),fe(t,r[0].toLowerCase()+r.slice(1))||fe(t,Bt(r))||fe(t,r))}let Ze=null,rr=null;function Ci(t){const r=Ze;return Ze=t,rr=t&&t.type.__scopeId||null,r}function zo(t,r=Ze,e){if(!r||t._n)return t;const i=(...n)=>{i._d&&us(-1);const s=Ci(r);let c;try{c=t(...n)}finally{Ci(s),i._d&&us(1)}return c};return i._n=!0,i._c=!0,i._d=!0,i}function ji(t){const{type:r,vnode:e,proxy:i,withProxy:n,props:s,propsOptions:[c],slots:o,attrs:a,emit:l,render:u,renderCache:d,data:f,setupState:w,ctx:y,inheritAttrs:x}=t;let T,S;const L=Ci(t);try{if(e.shapeFlag&4){const j=n||i;T=rt(u.call(j,j,d,s,w,f,y)),S=a}else{const j=r;T=rt(j.length>1?j(s,{attrs:a,slots:o,emit:l}):j(s,null)),S=r.props?a:No(a)}}catch(j){si.length=0,Ai(j,t,1),T=X(At)}let I=T;if(S&&x!==!1){const j=Object.keys(S),{shapeFlag:Y}=I;j.length&&Y&7&&(c&&j.some(Tn)&&(S=Vo(S,c)),I=Xt(I,S))}return e.dirs&&(I=Xt(I),I.dirs=I.dirs?I.dirs.concat(e.dirs):e.dirs),e.transition&&(I.transition=e.transition),T=I,Ci(L),T}const No=t=>{let r;for(const e in t)(e==="class"||e==="style"||Di(e))&&((r||(r={}))[e]=t[e]);return r},Vo=(t,r)=>{const e={};for(const i in t)(!Tn(i)||!(i.slice(9)in r))&&(e[i]=t[i]);return e};function Uo(t,r,e){const{props:i,children:n,component:s}=t,{props:c,children:o,patchFlag:a}=r,l=s.emitsOptions;if(r.dirs||r.transition)return!0;if(e&&a>=0){if(a&1024)return!0;if(a&16)return i?is(i,c,l):!!c;if(a&8){const u=r.dynamicProps;for(let d=0;d<u.length;d++){const f=u[d];if(c[f]!==i[f]&&!Bi(l,f))return!0}}}else return(n||o)&&(!o||!o.$stable)?!0:i===c?!1:i?c?is(i,c,l):!0:!!c;return!1}function is(t,r,e){const i=Object.keys(r);if(i.length!==Object.keys(t).length)return!0;for(let n=0;n<i.length;n++){const s=i[n];if(r[s]!==t[s]&&!Bi(e,s))return!0}return!1}function Wo({vnode:t,parent:r},e){for(;r&&r.subTree===t;)(t=r.vnode).el=e,r=r.parent}const jo=t=>t.__isSuspense;function Go(t,r){r&&r.pendingBranch?oe(t)?r.effects.push(...t):r.effects.push(t):ko(t)}function qo(t,r){if(Ee){let e=Ee.provides;const i=Ee.parent&&Ee.parent.provides;i===e&&(e=Ee.provides=Object.create(i)),e[t]=r}}function xi(t,r,e=!1){const i=Ee||Ze;if(i){const n=i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides;if(n&&t in n)return n[t];if(arguments.length>1)return e&&ue(r)?r.call(i.proxy):r}}const yi={};function Gi(t,r,e){return or(t,r,e)}function or(t,r,{immediate:e,deep:i,flush:n,onTrack:s,onTrigger:c}=ye){const o=Qr()===(Ee==null?void 0:Ee.scope)?Ee:null;let a,l=!1,u=!1;if(Me(t)?(a=()=>t.value,l=Pi(t)):qt(t)?(a=()=>t,i=!0):oe(t)?(u=!0,l=t.some(I=>qt(I)||Pi(I)),a=()=>t.map(I=>{if(Me(I))return I.value;if(qt(I))return It(I);if(ue(I))return bt(I,o,2)})):ue(t)?r?a=()=>bt(t,o,2):a=()=>{if(!(o&&o.isUnmounted))return d&&d(),et(t,o,3,[f])}:a=$e,r&&i){const I=a;a=()=>It(I())}let d,f=I=>{d=S.onStop=()=>{bt(I,o,4)}},w;if(ui)if(f=$e,r?e&&et(r,o,3,[a(),u?[]:void 0,f]):a(),n==="sync"){const I=Na();w=I.__watcherHandles||(I.__watcherHandles=[])}else return $e;let y=u?new Array(t.length).fill(yi):yi;const x=()=>{if(S.active)if(r){const I=S.run();(i||l||(u?I.some((j,Y)=>ri(j,y[Y])):ri(I,y)))&&(d&&d(),et(r,o,3,[I,y===yi?void 0:u&&y[0]===yi?[]:y,f]),y=I)}else S.run()};x.allowRecurse=!!r;let T;n==="sync"?T=x:n==="post"?T=()=>Ne(x,o&&o.suspense):(x.pre=!0,o&&(x.id=o.uid),T=()=>On(x));const S=new Cn(a,T);r?e?x():y=S.run():n==="post"?Ne(S.run.bind(S),o&&o.suspense):S.run();const L=()=>{S.stop(),o&&o.scope&&bn(o.scope.effects,S)};return w&&w.push(L),L}function Zo(t,r,e){const i=this.proxy,n=Ce(t)?t.includes(".")?ar(i,t):()=>i[t]:t.bind(i,i);let s;ue(r)?s=r:(s=r.handler,e=r);const c=Ee;Yt(this);const o=or(n,s.bind(i),e);return c?Yt(c):Ft(),o}function ar(t,r){const e=r.split(".");return()=>{let i=t;for(let n=0;n<e.length&&i;n++)i=i[e[n]];return i}}function It(t,r){if(!Te(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),Me(t))It(t.value,r);else if(oe(t))for(let e=0;e<t.length;e++)It(t[e],r);else if(Ds(t)||Gt(t))t.forEach(e=>{It(e,r)});else if(Os(t))for(const e in t)It(t[e],r);return t}const Ti=t=>!!t.type.__asyncLoader,lr=t=>t.type.__isKeepAlive;function Ko(t,r){cr(t,"a",r)}function Xo(t,r){cr(t,"da",r)}function cr(t,r,e=Ee){const i=t.__wdc||(t.__wdc=()=>{let n=e;for(;n;){if(n.isDeactivated)return;n=n.parent}return t()});if(zi(r,i,e),e){let n=e.parent;for(;n&&n.parent;)lr(n.parent.vnode)&&Yo(i,r,e,n),n=n.parent}}function Yo(t,r,e,i){const n=zi(r,t,i,!0);ur(()=>{bn(i[r],n)},e)}function zi(t,r,e=Ee,i=!1){if(e){const n=e[t]||(e[t]=[]),s=r.__weh||(r.__weh=(...c)=>{if(e.isUnmounted)return;Jt(),Yt(e);const o=et(r,e,t,c);return Ft(),Qt(),o});return i?n.unshift(s):n.push(s),s}}const gt=t=>(r,e=Ee)=>(!ui||t==="sp")&&zi(t,(...i)=>r(...i),e),Jo=gt("bm"),Qo=gt("m"),$o=gt("bu"),ea=gt("u"),ta=gt("bum"),ur=gt("um"),ia=gt("sp"),na=gt("rtg"),sa=gt("rtc");function ra(t,r=Ee){zi("ec",t,r)}function Fe(t,r){const e=Ze;if(e===null)return t;const i=Ui(e)||e.proxy,n=t.dirs||(t.dirs=[]);for(let s=0;s<r.length;s++){let[c,o,a,l=ye]=r[s];c&&(ue(c)&&(c={mounted:c,updated:c}),c.deep&&It(o),n.push({dir:c,instance:i,value:o,oldValue:void 0,arg:a,modifiers:l}))}return t}function Ct(t,r,e,i){const n=t.dirs,s=r&&r.dirs;for(let c=0;c<n.length;c++){const o=n[c];s&&(o.oldValue=s[c].value);let a=o.dir[i];a&&(Jt(),et(a,e,8,[t.el,o,t,r]),Qt())}}const hr="components",oa="directives";function dr(t,r){return fr(hr,t,!0,r)||t}const aa=Symbol();function Fn(t){return fr(oa,t)}function fr(t,r,e=!0,i=!1){const n=Ze||Ee;if(n){const s=n.type;if(t===hr){const o=ka(s,!1);if(o&&(o===r||o===at(r)||o===Oi(at(r))))return s}const c=ns(n[t]||s[t],r)||ns(n.appContext[t],r);return!c&&i?s:c}}function ns(t,r){return t&&(t[r]||t[at(r)]||t[Oi(at(r))])}function Pe(t,r,e,i){let n;const s=e&&e[i];if(oe(t)||Ce(t)){n=new Array(t.length);for(let c=0,o=t.length;c<o;c++)n[c]=r(t[c],c,void 0,s&&s[c])}else if(typeof t=="number"){n=new Array(t);for(let c=0;c<t;c++)n[c]=r(c+1,c,void 0,s&&s[c])}else if(Te(t))if(t[Symbol.iterator])n=Array.from(t,(c,o)=>r(c,o,void 0,s&&s[o]));else{const c=Object.keys(t);n=new Array(c.length);for(let o=0,a=c.length;o<a;o++){const l=c[o];n[o]=r(t[l],l,o,s&&s[o])}}else n=[];return e&&(e[i]=n),n}const nn=t=>t?Er(t)?Ui(t)||t.proxy:nn(t.parent):null,ni=ke(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>nn(t.parent),$root:t=>nn(t.root),$emit:t=>t.emit,$options:t=>kn(t),$forceUpdate:t=>t.f||(t.f=()=>On(t.update)),$nextTick:t=>t.n||(t.n=er.bind(t.proxy)),$watch:t=>Zo.bind(t)}),qi=(t,r)=>t!==ye&&!t.__isScriptSetup&&fe(t,r),la={get({_:t},r){const{ctx:e,setupState:i,data:n,props:s,accessCache:c,type:o,appContext:a}=t;let l;if(r[0]!=="$"){const w=c[r];if(w!==void 0)switch(w){case 1:return i[r];case 2:return n[r];case 4:return e[r];case 3:return s[r]}else{if(qi(i,r))return c[r]=1,i[r];if(n!==ye&&fe(n,r))return c[r]=2,n[r];if((l=t.propsOptions[0])&&fe(l,r))return c[r]=3,s[r];if(e!==ye&&fe(e,r))return c[r]=4,e[r];sn&&(c[r]=0)}}const u=ni[r];let d,f;if(u)return r==="$attrs"&&Ue(t,"get",r),u(t);if((d=o.__cssModules)&&(d=d[r]))return d;if(e!==ye&&fe(e,r))return c[r]=4,e[r];if(f=a.config.globalProperties,fe(f,r))return f[r]},set({_:t},r,e){const{data:i,setupState:n,ctx:s}=t;return qi(n,r)?(n[r]=e,!0):i!==ye&&fe(i,r)?(i[r]=e,!0):fe(t.props,r)||r[0]==="$"&&r.slice(1)in t?!1:(s[r]=e,!0)},has({_:{data:t,setupState:r,accessCache:e,ctx:i,appContext:n,propsOptions:s}},c){let o;return!!e[c]||t!==ye&&fe(t,c)||qi(r,c)||(o=s[0])&&fe(o,c)||fe(i,c)||fe(ni,c)||fe(n.config.globalProperties,c)},defineProperty(t,r,e){return e.get!=null?t._.accessCache[r]=0:fe(e,"value")&&this.set(t,r,e.value,null),Reflect.defineProperty(t,r,e)}};let sn=!0;function ca(t){const r=kn(t),e=t.proxy,i=t.ctx;sn=!1,r.beforeCreate&&ss(r.beforeCreate,t,"bc");const{data:n,computed:s,methods:c,watch:o,provide:a,inject:l,created:u,beforeMount:d,mounted:f,beforeUpdate:w,updated:y,activated:x,deactivated:T,beforeDestroy:S,beforeUnmount:L,destroyed:I,unmounted:j,render:Y,renderTracked:Q,renderTriggered:ie,errorCaptured:J,serverPrefetch:ee,expose:K,inheritAttrs:we,components:ve,directives:Ke,filters:We}=r;if(l&&ua(l,i,null,t.appContext.config.unwrapInjectedRef),c)for(const pe in c){const de=c[pe];ue(de)&&(i[pe]=de.bind(e))}if(n){const pe=n.call(e,e);Te(pe)&&(t.data=ki(pe))}if(sn=!0,s)for(const pe in s){const de=s[pe],Ae=ue(de)?de.bind(e,e):ue(de.get)?de.get.bind(e,e):$e,ne=!ue(de)&&ue(de.set)?de.set.bind(e):$e,Xe=ut({get:Ae,set:ne});Object.defineProperty(i,pe,{enumerable:!0,configurable:!0,get:()=>Xe.value,set:Be=>Xe.value=Be})}if(o)for(const pe in o)pr(o[pe],i,e,pe);if(a){const pe=ue(a)?a.call(e):a;Reflect.ownKeys(pe).forEach(de=>{qo(de,pe[de])})}u&&ss(u,t,"c");function me(pe,de){oe(de)?de.forEach(Ae=>pe(Ae.bind(e))):de&&pe(de.bind(e))}if(me(Jo,d),me(Qo,f),me($o,w),me(ea,y),me(Ko,x),me(Xo,T),me(ra,J),me(sa,Q),me(na,ie),me(ta,L),me(ur,j),me(ia,ee),oe(K))if(K.length){const pe=t.exposed||(t.exposed={});K.forEach(de=>{Object.defineProperty(pe,de,{get:()=>e[de],set:Ae=>e[de]=Ae})})}else t.exposed||(t.exposed={});Y&&t.render===$e&&(t.render=Y),we!=null&&(t.inheritAttrs=we),ve&&(t.components=ve),Ke&&(t.directives=Ke)}function ua(t,r,e=$e,i=!1){oe(t)&&(t=rn(t));for(const n in t){const s=t[n];let c;Te(s)?"default"in s?c=xi(s.from||n,s.default,!0):c=xi(s.from||n):c=xi(s),Me(c)&&i?Object.defineProperty(r,n,{enumerable:!0,configurable:!0,get:()=>c.value,set:o=>c.value=o}):r[n]=c}}function ss(t,r,e){et(oe(t)?t.map(i=>i.bind(r.proxy)):t.bind(r.proxy),r,e)}function pr(t,r,e,i){const n=i.includes(".")?ar(e,i):()=>e[i];if(Ce(t)){const s=r[t];ue(s)&&Gi(n,s)}else if(ue(t))Gi(n,t.bind(e));else if(Te(t))if(oe(t))t.forEach(s=>pr(s,r,e,i));else{const s=ue(t.handler)?t.handler.bind(e):r[t.handler];ue(s)&&Gi(n,s,t)}}function kn(t){const r=t.type,{mixins:e,extends:i}=r,{mixins:n,optionsCache:s,config:{optionMergeStrategies:c}}=t.appContext,o=s.get(r);let a;return o?a=o:!n.length&&!e&&!i?a=r:(a={},n.length&&n.forEach(l=>Ri(a,l,c,!0)),Ri(a,r,c)),Te(r)&&s.set(r,a),a}function Ri(t,r,e,i=!1){const{mixins:n,extends:s}=r;s&&Ri(t,s,e,!0),n&&n.forEach(c=>Ri(t,c,e,!0));for(const c in r)if(!(i&&c==="expose")){const o=ha[c]||e&&e[c];t[c]=o?o(t[c],r[c]):r[c]}return t}const ha={data:rs,props:Ht,emits:Ht,methods:Ht,computed:Ht,beforeCreate:Oe,created:Oe,beforeMount:Oe,mounted:Oe,beforeUpdate:Oe,updated:Oe,beforeDestroy:Oe,beforeUnmount:Oe,destroyed:Oe,unmounted:Oe,activated:Oe,deactivated:Oe,errorCaptured:Oe,serverPrefetch:Oe,components:Ht,directives:Ht,watch:fa,provide:rs,inject:da};function rs(t,r){return r?t?function(){return ke(ue(t)?t.call(this,this):t,ue(r)?r.call(this,this):r)}:r:t}function da(t,r){return Ht(rn(t),rn(r))}function rn(t){if(oe(t)){const r={};for(let e=0;e<t.length;e++)r[t[e]]=t[e];return r}return t}function Oe(t,r){return t?[...new Set([].concat(t,r))]:r}function Ht(t,r){return t?ke(ke(Object.create(null),t),r):r}function fa(t,r){if(!t)return r;if(!r)return t;const e=ke(Object.create(null),t);for(const i in r)e[i]=Oe(t[i],r[i]);return e}function pa(t,r,e,i=!1){const n={},s={};Si(s,Vi,1),t.propsDefaults=Object.create(null),gr(t,r,n,s);for(const c in t.propsOptions[0])c in n||(n[c]=void 0);e?t.props=i?n:Po(n):t.type.props?t.props=n:t.props=s,t.attrs=s}function ga(t,r,e,i){const{props:n,attrs:s,vnode:{patchFlag:c}}=t,o=ge(n),[a]=t.propsOptions;let l=!1;if((i||c>0)&&!(c&16)){if(c&8){const u=t.vnode.dynamicProps;for(let d=0;d<u.length;d++){let f=u[d];if(Bi(t.emitsOptions,f))continue;const w=r[f];if(a)if(fe(s,f))w!==s[f]&&(s[f]=w,l=!0);else{const y=at(f);n[y]=on(a,o,y,w,t,!1)}else w!==s[f]&&(s[f]=w,l=!0)}}}else{gr(t,r,n,s)&&(l=!0);let u;for(const d in o)(!r||!fe(r,d)&&((u=Bt(d))===d||!fe(r,u)))&&(a?e&&(e[d]!==void 0||e[u]!==void 0)&&(n[d]=on(a,o,d,void 0,t,!0)):delete n[d]);if(s!==o)for(const d in s)(!r||!fe(r,d))&&(delete s[d],l=!0)}l&&pt(t,"set","$attrs")}function gr(t,r,e,i){const[n,s]=t.propsOptions;let c=!1,o;if(r)for(let a in r){if(wi(a))continue;const l=r[a];let u;n&&fe(n,u=at(a))?!s||!s.includes(u)?e[u]=l:(o||(o={}))[u]=l:Bi(t.emitsOptions,a)||(!(a in i)||l!==i[a])&&(i[a]=l,c=!0)}if(s){const a=ge(e),l=o||ye;for(let u=0;u<s.length;u++){const d=s[u];e[d]=on(n,a,d,l[d],t,!fe(l,d))}}return c}function on(t,r,e,i,n,s){const c=t[e];if(c!=null){const o=fe(c,"default");if(o&&i===void 0){const a=c.default;if(c.type!==Function&&ue(a)){const{propsDefaults:l}=n;e in l?i=l[e]:(Yt(n),i=l[e]=a.call(null,r),Ft())}else i=a}c[0]&&(s&&!o?i=!1:c[1]&&(i===""||i===Bt(e))&&(i=!0))}return i}function mr(t,r,e=!1){const i=r.propsCache,n=i.get(t);if(n)return n;const s=t.props,c={},o=[];let a=!1;if(!ue(t)){const u=d=>{a=!0;const[f,w]=mr(d,r,!0);ke(c,f),w&&o.push(...w)};!e&&r.mixins.length&&r.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!s&&!a)return Te(t)&&i.set(t,jt),jt;if(oe(s))for(let u=0;u<s.length;u++){const d=at(s[u]);os(d)&&(c[d]=ye)}else if(s)for(const u in s){const d=at(u);if(os(d)){const f=s[u],w=c[d]=oe(f)||ue(f)?{type:f}:Object.assign({},f);if(w){const y=cs(Boolean,w.type),x=cs(String,w.type);w[0]=y>-1,w[1]=x<0||y<x,(y>-1||fe(w,"default"))&&o.push(d)}}}const l=[c,o];return Te(t)&&i.set(t,l),l}function os(t){return t[0]!=="$"}function as(t){const r=t&&t.toString().match(/^\s*(function|class) (\w+)/);return r?r[2]:t===null?"null":""}function ls(t,r){return as(t)===as(r)}function cs(t,r){return oe(r)?r.findIndex(e=>ls(e,t)):ue(r)&&ls(r,t)?0:-1}const vr=t=>t[0]==="_"||t==="$stable",An=t=>oe(t)?t.map(rt):[rt(t)],ma=(t,r,e)=>{if(r._n)return r;const i=zo((...n)=>An(r(...n)),e);return i._c=!1,i},yr=(t,r,e)=>{const i=t._ctx;for(const n in t){if(vr(n))continue;const s=t[n];if(ue(s))r[n]=ma(n,s,i);else if(s!=null){const c=An(s);r[n]=()=>c}}},wr=(t,r)=>{const e=An(r);t.slots.default=()=>e},va=(t,r)=>{if(t.vnode.shapeFlag&32){const e=r._;e?(t.slots=ge(r),Si(r,"_",e)):yr(r,t.slots={})}else t.slots={},r&&wr(t,r);Si(t.slots,Vi,1)},ya=(t,r,e)=>{const{vnode:i,slots:n}=t;let s=!0,c=ye;if(i.shapeFlag&32){const o=r._;o?e&&o===1?s=!1:(ke(n,r),!e&&o===1&&delete n._):(s=!r.$stable,yr(r,n)),c=r}else r&&(wr(t,r),c={default:1});if(s)for(const o in n)!vr(o)&&!(o in c)&&delete n[o]};function _r(){return{app:null,config:{isNativeTag:Wr,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let wa=0;function _a(t,r){return function(i,n=null){ue(i)||(i=Object.assign({},i)),n!=null&&!Te(n)&&(n=null);const s=_r(),c=new Set;let o=!1;const a=s.app={_uid:wa++,_component:i,_props:n,_container:null,_context:s,_instance:null,version:Va,get config(){return s.config},set config(l){},use(l,...u){return c.has(l)||(l&&ue(l.install)?(c.add(l),l.install(a,...u)):ue(l)&&(c.add(l),l(a,...u))),a},mixin(l){return s.mixins.includes(l)||s.mixins.push(l),a},component(l,u){return u?(s.components[l]=u,a):s.components[l]},directive(l,u){return u?(s.directives[l]=u,a):s.directives[l]},mount(l,u,d){if(!o){const f=X(i,n);return f.appContext=s,u&&r?r(f,l):t(f,l,d),o=!0,a._container=l,l.__vue_app__=a,Ui(f.component)||f.component.proxy}},unmount(){o&&(t(null,a._container),delete a._container.__vue_app__)},provide(l,u){return s.provides[l]=u,a}};return a}}function an(t,r,e,i,n=!1){if(oe(t)){t.forEach((f,w)=>an(f,r&&(oe(r)?r[w]:r),e,i,n));return}if(Ti(i)&&!n)return;const s=i.shapeFlag&4?Ui(i.component)||i.component.proxy:i.el,c=n?null:s,{i:o,r:a}=t,l=r&&r.r,u=o.refs===ye?o.refs={}:o.refs,d=o.setupState;if(l!=null&&l!==a&&(Ce(l)?(u[l]=null,fe(d,l)&&(d[l]=null)):Me(l)&&(l.value=null)),ue(a))bt(a,o,12,[c,u]);else{const f=Ce(a),w=Me(a);if(f||w){const y=()=>{if(t.f){const x=f?fe(d,a)?d[a]:u[a]:a.value;n?oe(x)&&bn(x,s):oe(x)?x.includes(s)||x.push(s):f?(u[a]=[s],fe(d,a)&&(d[a]=u[a])):(a.value=[s],t.k&&(u[t.k]=a.value))}else f?(u[a]=c,fe(d,a)&&(d[a]=c)):w&&(a.value=c,t.k&&(u[t.k]=c))};c?(y.id=-1,Ne(y,e)):y()}}}const Ne=Go;function xa(t){return Ta(t)}function Ta(t,r){const e=Xr();e.__VUE__=!0;const{insert:i,remove:n,patchProp:s,createElement:c,createText:o,createComment:a,setText:l,setElementText:u,parentNode:d,nextSibling:f,setScopeId:w=$e,insertStaticContent:y}=t,x=(E,P,h,m=null,b=null,R=null,C=!1,F=null,O=!!P.dynamicChildren)=>{if(E===P)return;E&&!$t(E,P)&&(m=dt(E),Be(E,b,R,!0),E=null),P.patchFlag===-2&&(O=!1,P.dynamicChildren=null);const{type:A,ref:W,shapeFlag:V}=P;switch(A){case Ni:T(E,P,h,m);break;case At:S(E,P,h,m);break;case Zi:E==null&&L(P,h,m,C);break;case ae:ve(E,P,h,m,b,R,C,F,O);break;default:V&1?Y(E,P,h,m,b,R,C,F,O):V&6?Ke(E,P,h,m,b,R,C,F,O):(V&64||V&128)&&A.process(E,P,h,m,b,R,C,F,O,it)}W!=null&&b&&an(W,E&&E.ref,R,P||E,!P)},T=(E,P,h,m)=>{if(E==null)i(P.el=o(P.children),h,m);else{const b=P.el=E.el;P.children!==E.children&&l(b,P.children)}},S=(E,P,h,m)=>{E==null?i(P.el=a(P.children||""),h,m):P.el=E.el},L=(E,P,h,m)=>{[E.el,E.anchor]=y(E.children,P,h,m,E.el,E.anchor)},I=({el:E,anchor:P},h,m)=>{let b;for(;E&&E!==P;)b=f(E),i(E,h,m),E=b;i(P,h,m)},j=({el:E,anchor:P})=>{let h;for(;E&&E!==P;)h=f(E),n(E),E=h;n(P)},Y=(E,P,h,m,b,R,C,F,O)=>{C=C||P.type==="svg",E==null?Q(P,h,m,b,R,C,F,O):ee(E,P,b,R,C,F,O)},Q=(E,P,h,m,b,R,C,F)=>{let O,A;const{type:W,props:V,shapeFlag:z,transition:G,dirs:q}=E;if(O=E.el=c(E.type,R,V&&V.is,V),z&8?u(O,E.children):z&16&&J(E.children,O,null,m,b,R&&W!=="foreignObject",C,F),q&&Ct(E,null,m,"created"),ie(O,E,E.scopeId,C,m),V){for(const he in V)he!=="value"&&!wi(he)&&s(O,he,null,V[he],R,E.children,m,b,ze);"value"in V&&s(O,"value",null,V.value),(A=V.onVnodeBeforeMount)&&nt(A,m,E)}q&&Ct(E,null,m,"beforeMount");const re=(!b||b&&!b.pendingBranch)&&G&&!G.persisted;re&&G.beforeEnter(O),i(O,P,h),((A=V&&V.onVnodeMounted)||re||q)&&Ne(()=>{A&&nt(A,m,E),re&&G.enter(O),q&&Ct(E,null,m,"mounted")},b)},ie=(E,P,h,m,b)=>{if(h&&w(E,h),m)for(let R=0;R<m.length;R++)w(E,m[R]);if(b){let R=b.subTree;if(P===R){const C=b.vnode;ie(E,C,C.scopeId,C.slotScopeIds,b.parent)}}},J=(E,P,h,m,b,R,C,F,O=0)=>{for(let A=O;A<E.length;A++){const W=E[A]=F?_t(E[A]):rt(E[A]);x(null,W,P,h,m,b,R,C,F)}},ee=(E,P,h,m,b,R,C)=>{const F=P.el=E.el;let{patchFlag:O,dynamicChildren:A,dirs:W}=P;O|=E.patchFlag&16;const V=E.props||ye,z=P.props||ye;let G;h&&Rt(h,!1),(G=z.onVnodeBeforeUpdate)&&nt(G,h,P,E),W&&Ct(P,E,h,"beforeUpdate"),h&&Rt(h,!0);const q=b&&P.type!=="foreignObject";if(A?K(E.dynamicChildren,A,F,h,m,q,R):C||de(E,P,F,null,h,m,q,R,!1),O>0){if(O&16)we(F,P,V,z,h,m,b);else if(O&2&&V.class!==z.class&&s(F,"class",null,z.class,b),O&4&&s(F,"style",V.style,z.style,b),O&8){const re=P.dynamicProps;for(let he=0;he<re.length;he++){const g=re[he],p=V[g],v=z[g];(v!==p||g==="value")&&s(F,g,p,v,b,E.children,h,m,ze)}}O&1&&E.children!==P.children&&u(F,P.children)}else!C&&A==null&&we(F,P,V,z,h,m,b);((G=z.onVnodeUpdated)||W)&&Ne(()=>{G&&nt(G,h,P,E),W&&Ct(P,E,h,"updated")},m)},K=(E,P,h,m,b,R,C)=>{for(let F=0;F<P.length;F++){const O=E[F],A=P[F],W=O.el&&(O.type===ae||!$t(O,A)||O.shapeFlag&70)?d(O.el):h;x(O,A,W,null,m,b,R,C,!0)}},we=(E,P,h,m,b,R,C)=>{if(h!==m){if(h!==ye)for(const F in h)!wi(F)&&!(F in m)&&s(E,F,h[F],null,C,P.children,b,R,ze);for(const F in m){if(wi(F))continue;const O=m[F],A=h[F];O!==A&&F!=="value"&&s(E,F,A,O,C,P.children,b,R,ze)}"value"in m&&s(E,"value",h.value,m.value)}},ve=(E,P,h,m,b,R,C,F,O)=>{const A=P.el=E?E.el:o(""),W=P.anchor=E?E.anchor:o("");let{patchFlag:V,dynamicChildren:z,slotScopeIds:G}=P;G&&(F=F?F.concat(G):G),E==null?(i(A,h,m),i(W,h,m),J(P.children,h,W,b,R,C,F,O)):V>0&&V&64&&z&&E.dynamicChildren?(K(E.dynamicChildren,z,h,b,R,C,F),(P.key!=null||b&&P===b.subTree)&&xr(E,P,!0)):de(E,P,h,W,b,R,C,F,O)},Ke=(E,P,h,m,b,R,C,F,O)=>{P.slotScopeIds=F,E==null?P.shapeFlag&512?b.ctx.activate(P,h,m,C,O):We(P,h,m,b,R,C,O):ht(E,P,O)},We=(E,P,h,m,b,R,C)=>{const F=E.component=Da(E,m,b);if(lr(E)&&(F.ctx.renderer=it),Ia(F),F.asyncDep){if(b&&b.registerDep(F,me),!E.el){const O=F.subTree=X(At);S(null,O,P,h)}return}me(F,E,P,h,b,R,C)},ht=(E,P,h)=>{const m=P.component=E.component;if(Uo(E,P,h))if(m.asyncDep&&!m.asyncResolved){pe(m,P,h);return}else m.next=P,Fo(m.update),m.update();else P.el=E.el,m.vnode=P},me=(E,P,h,m,b,R,C)=>{const F=()=>{if(E.isMounted){let{next:W,bu:V,u:z,parent:G,vnode:q}=E,re=W,he;Rt(E,!1),W?(W.el=q.el,pe(E,W,C)):W=q,V&&_i(V),(he=W.props&&W.props.onVnodeBeforeUpdate)&&nt(he,G,W,q),Rt(E,!0);const g=ji(E),p=E.subTree;E.subTree=g,x(p,g,d(p.el),dt(p),E,b,R),W.el=g.el,re===null&&Wo(E,g.el),z&&Ne(z,b),(he=W.props&&W.props.onVnodeUpdated)&&Ne(()=>nt(he,G,W,q),b)}else{let W;const{el:V,props:z}=P,{bm:G,m:q,parent:re}=E,he=Ti(P);if(Rt(E,!1),G&&_i(G),!he&&(W=z&&z.onVnodeBeforeMount)&&nt(W,re,P),Rt(E,!0),V&&yt){const g=()=>{E.subTree=ji(E),yt(V,E.subTree,E,b,null)};he?P.type.__asyncLoader().then(()=>!E.isUnmounted&&g()):g()}else{const g=E.subTree=ji(E);x(null,g,h,m,E,b,R),P.el=g.el}if(q&&Ne(q,b),!he&&(W=z&&z.onVnodeMounted)){const g=P;Ne(()=>nt(W,re,g),b)}(P.shapeFlag&256||re&&Ti(re.vnode)&&re.vnode.shapeFlag&256)&&E.a&&Ne(E.a,b),E.isMounted=!0,P=h=m=null}},O=E.effect=new Cn(F,()=>On(A),E.scope),A=E.update=()=>O.run();A.id=E.uid,Rt(E,!0),A()},pe=(E,P,h)=>{P.component=E;const m=E.vnode.props;E.vnode=P,E.next=null,ga(E,P.props,m,h),ya(E,P.children,h),Jt(),ts(),Qt()},de=(E,P,h,m,b,R,C,F,O=!1)=>{const A=E&&E.children,W=E?E.shapeFlag:0,V=P.children,{patchFlag:z,shapeFlag:G}=P;if(z>0){if(z&128){ne(A,V,h,m,b,R,C,F,O);return}else if(z&256){Ae(A,V,h,m,b,R,C,F,O);return}}G&8?(W&16&&ze(A,b,R),V!==A&&u(h,V)):W&16?G&16?ne(A,V,h,m,b,R,C,F,O):ze(A,b,R,!0):(W&8&&u(h,""),G&16&&J(V,h,m,b,R,C,F,O))},Ae=(E,P,h,m,b,R,C,F,O)=>{E=E||jt,P=P||jt;const A=E.length,W=P.length,V=Math.min(A,W);let z;for(z=0;z<V;z++){const G=P[z]=O?_t(P[z]):rt(P[z]);x(E[z],G,h,null,b,R,C,F,O)}A>W?ze(E,b,R,!0,!1,V):J(P,h,m,b,R,C,F,O,V)},ne=(E,P,h,m,b,R,C,F,O)=>{let A=0;const W=P.length;let V=E.length-1,z=W-1;for(;A<=V&&A<=z;){const G=E[A],q=P[A]=O?_t(P[A]):rt(P[A]);if($t(G,q))x(G,q,h,null,b,R,C,F,O);else break;A++}for(;A<=V&&A<=z;){const G=E[V],q=P[z]=O?_t(P[z]):rt(P[z]);if($t(G,q))x(G,q,h,null,b,R,C,F,O);else break;V--,z--}if(A>V){if(A<=z){const G=z+1,q=G<W?P[G].el:m;for(;A<=z;)x(null,P[A]=O?_t(P[A]):rt(P[A]),h,q,b,R,C,F,O),A++}}else if(A>z)for(;A<=V;)Be(E[A],b,R,!0),A++;else{const G=A,q=A,re=new Map;for(A=q;A<=z;A++){const Z=P[A]=O?_t(P[A]):rt(P[A]);Z.key!=null&&re.set(Z.key,A)}let he,g=0;const p=z-q+1;let v=!1,_=0;const k=new Array(p);for(A=0;A<p;A++)k[A]=0;for(A=G;A<=V;A++){const Z=E[A];if(g>=p){Be(Z,b,R,!0);continue}let le;if(Z.key!=null)le=re.get(Z.key);else for(he=q;he<=z;he++)if(k[he-q]===0&&$t(Z,P[he])){le=he;break}le===void 0?Be(Z,b,R,!0):(k[le-q]=A+1,le>=_?_=le:v=!0,x(Z,P[le],h,null,b,R,C,F,O),g++)}const N=v?ba(k):jt;for(he=N.length-1,A=p-1;A>=0;A--){const Z=q+A,le=P[Z],$=Z+1<W?P[Z+1].el:m;k[A]===0?x(null,le,h,$,b,R,C,F,O):v&&(he<0||A!==N[he]?Xe(le,h,$,2):he--)}}},Xe=(E,P,h,m,b=null)=>{const{el:R,type:C,transition:F,children:O,shapeFlag:A}=E;if(A&6){Xe(E.component.subTree,P,h,m);return}if(A&128){E.suspense.move(P,h,m);return}if(A&64){C.move(E,P,h,it);return}if(C===ae){i(R,P,h);for(let V=0;V<O.length;V++)Xe(O[V],P,h,m);i(E.anchor,P,h);return}if(C===Zi){I(E,P,h);return}if(m!==2&&A&1&&F)if(m===0)F.beforeEnter(R),i(R,P,h),Ne(()=>F.enter(R),b);else{const{leave:V,delayLeave:z,afterLeave:G}=F,q=()=>i(R,P,h),re=()=>{V(R,()=>{q(),G&&G()})};z?z(R,q,re):re()}else i(R,P,h)},Be=(E,P,h,m=!1,b=!1)=>{const{type:R,props:C,ref:F,children:O,dynamicChildren:A,shapeFlag:W,patchFlag:V,dirs:z}=E;if(F!=null&&an(F,null,h,E,!0),W&256){P.ctx.deactivate(E);return}const G=W&1&&z,q=!Ti(E);let re;if(q&&(re=C&&C.onVnodeBeforeUnmount)&&nt(re,P,E),W&6)Vt(E.component,h,m);else{if(W&128){E.suspense.unmount(h,m);return}G&&Ct(E,null,P,"beforeUnmount"),W&64?E.type.remove(E,P,h,b,it,m):A&&(R!==ae||V>0&&V&64)?ze(A,P,h,!1,!0):(R===ae&&V&384||!b&&W&16)&&ze(O,P,h),m&&St(E)}(q&&(re=C&&C.onVnodeUnmounted)||G)&&Ne(()=>{re&&nt(re,P,E),G&&Ct(E,null,P,"unmounted")},h)},St=E=>{const{type:P,el:h,anchor:m,transition:b}=E;if(P===ae){mt(h,m);return}if(P===Zi){j(E);return}const R=()=>{n(h),b&&!b.persisted&&b.afterLeave&&b.afterLeave()};if(E.shapeFlag&1&&b&&!b.persisted){const{leave:C,delayLeave:F}=b,O=()=>C(h,R);F?F(E.el,R,O):O()}else R()},mt=(E,P)=>{let h;for(;E!==P;)h=f(E),n(E),E=h;n(P)},Vt=(E,P,h)=>{const{bum:m,scope:b,update:R,subTree:C,um:F}=E;m&&_i(m),b.stop(),R&&(R.active=!1,Be(C,E,P,h)),F&&Ne(F,P),Ne(()=>{E.isUnmounted=!0},P),P&&P.pendingBranch&&!P.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===P.pendingId&&(P.deps--,P.deps===0&&P.resolve())},ze=(E,P,h,m=!1,b=!1,R=0)=>{for(let C=R;C<E.length;C++)Be(E[C],P,h,m,b)},dt=E=>E.shapeFlag&6?dt(E.component.subTree):E.shapeFlag&128?E.suspense.next():f(E.anchor||E.el),Pt=(E,P,h)=>{E==null?P._vnode&&Be(P._vnode,null,null,!0):x(P._vnode||null,E,P,null,null,null,h),ts(),ir(),P._vnode=E},it={p:x,um:Be,m:Xe,r:St,mt:We,mc:J,pc:de,pbc:K,n:dt,o:t};let vt,yt;return r&&([vt,yt]=r(it)),{render:Pt,hydrate:vt,createApp:_a(Pt,vt)}}function Rt({effect:t,update:r},e){t.allowRecurse=r.allowRecurse=e}function xr(t,r,e=!1){const i=t.children,n=r.children;if(oe(i)&&oe(n))for(let s=0;s<i.length;s++){const c=i[s];let o=n[s];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=n[s]=_t(n[s]),o.el=c.el),e||xr(c,o)),o.type===Ni&&(o.el=c.el)}}function ba(t){const r=t.slice(),e=[0];let i,n,s,c,o;const a=t.length;for(i=0;i<a;i++){const l=t[i];if(l!==0){if(n=e[e.length-1],t[n]<l){r[i]=n,e.push(i);continue}for(s=0,c=e.length-1;s<c;)o=s+c>>1,t[e[o]]<l?s=o+1:c=o;l<t[e[s]]&&(s>0&&(r[i]=e[s-1]),e[s]=i)}}for(s=e.length,c=e[s-1];s-- >0;)e[s]=c,c=r[c];return e}const Ea=t=>t.__isTeleport,ae=Symbol(void 0),Ni=Symbol(void 0),At=Symbol(void 0),Zi=Symbol(void 0),si=[];let Qe=null;function H(t=!1){si.push(Qe=t?null:[])}function Sa(){si.pop(),Qe=si[si.length-1]||null}let ci=1;function us(t){ci+=t}function Tr(t){return t.dynamicChildren=ci>0?Qe||jt:null,Sa(),ci>0&&Qe&&Qe.push(t),t}function D(t,r,e,i,n,s){return Tr(M(t,r,e,i,n,s,!0))}function Ie(t,r,e,i,n){return Tr(X(t,r,e,i,n,!0))}function ln(t){return t?t.__v_isVNode===!0:!1}function $t(t,r){return t.type===r.type&&t.key===r.key}const Vi="__vInternal",br=({key:t})=>t??null,bi=({ref:t,ref_key:r,ref_for:e})=>t!=null?Ce(t)||Me(t)||ue(t)?{i:Ze,r:t,k:r,f:!!e}:t:null;function M(t,r=null,e=null,i=0,n=null,s=t===ae?0:1,c=!1,o=!1){const a={__v_isVNode:!0,__v_skip:!0,type:t,props:r,key:r&&br(r),ref:r&&bi(r),scopeId:rr,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:i,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Ze};return o?(Bn(a,e),s&128&&t.normalize(a)):e&&(a.shapeFlag|=Ce(e)?8:16),ci>0&&!c&&Qe&&(a.patchFlag>0||s&6)&&a.patchFlag!==32&&Qe.push(a),a}const X=Pa;function Pa(t,r=null,e=null,i=0,n=null,s=!1){if((!t||t===aa)&&(t=At),ln(t)){const o=Xt(t,r,!0);return e&&Bn(o,e),ci>0&&!s&&Qe&&(o.shapeFlag&6?Qe[Qe.indexOf(t)]=o:Qe.push(o)),o.patchFlag|=-2,o}if(Aa(t)&&(t=t.__vccOpts),r){r=Ca(r);let{class:o,style:a}=r;o&&!Ce(o)&&(r.class=_e(o)),Te(a)&&(qs(a)&&!oe(a)&&(a=ke({},a)),r.style=xn(a))}const c=Ce(t)?1:jo(t)?128:Ea(t)?64:Te(t)?4:ue(t)?2:0;return M(t,r,e,i,n,c,s,!0)}function Ca(t){return t?qs(t)||Vi in t?ke({},t):t:null}function Xt(t,r,e=!1){const{props:i,ref:n,patchFlag:s,children:c}=t,o=r?Ra(i||{},r):i;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:o,key:o&&br(o),ref:r&&r.ref?e&&n?oe(n)?n.concat(bi(r)):[n,bi(r)]:bi(r):n,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:c,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:r&&t.type!==ae?s===-1?16:s|16:s,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Xt(t.ssContent),ssFallback:t.ssFallback&&Xt(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function xe(t=" ",r=0){return X(Ni,null,t,r)}function te(t="",r=!1){return r?(H(),Ie(At,null,t)):X(At,null,t)}function rt(t){return t==null||typeof t=="boolean"?X(At):oe(t)?X(ae,null,t.slice()):typeof t=="object"?_t(t):X(Ni,null,String(t))}function _t(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Xt(t)}function Bn(t,r){let e=0;const{shapeFlag:i}=t;if(r==null)r=null;else if(oe(r))e=16;else if(typeof r=="object")if(i&65){const n=r.default;n&&(n._c&&(n._d=!1),Bn(t,n()),n._c&&(n._d=!0));return}else{e=32;const n=r._;!n&&!(Vi in r)?r._ctx=Ze:n===3&&Ze&&(Ze.slots._===1?r._=1:(r._=2,t.patchFlag|=1024))}else ue(r)?(r={default:r,_ctx:Ze},e=32):(r=String(r),i&64?(e=16,r=[xe(r)]):e=8);t.children=r,t.shapeFlag|=e}function Ra(...t){const r={};for(let e=0;e<t.length;e++){const i=t[e];for(const n in i)if(n==="class")r.class!==i.class&&(r.class=_e([r.class,i.class]));else if(n==="style")r.style=xn([r.style,i.style]);else if(Di(n)){const s=r[n],c=i[n];c&&s!==c&&!(oe(s)&&s.includes(c))&&(r[n]=s?[].concat(s,c):c)}else n!==""&&(r[n]=i[n])}return r}function nt(t,r,e,i=null){et(t,r,7,[e,i])}const Ha=_r();let La=0;function Da(t,r,e){const i=t.type,n=(r?r.appContext:t.appContext)||Ha,s={uid:La++,vnode:t,type:i,parent:r,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,scope:new Yr(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(n.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:mr(i,n),emitsOptions:sr(i,n),emit:null,emitted:null,propsDefaults:ye,inheritAttrs:i.inheritAttrs,ctx:ye,data:ye,props:ye,attrs:ye,slots:ye,refs:ye,setupState:ye,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=r?r.root:s,s.emit=Bo.bind(null,s),t.ce&&t.ce(s),s}let Ee=null;const Yt=t=>{Ee=t,t.scope.on()},Ft=()=>{Ee&&Ee.scope.off(),Ee=null};function Er(t){return t.vnode.shapeFlag&4}let ui=!1;function Ia(t,r=!1){ui=r;const{props:e,children:i}=t.vnode,n=Er(t);pa(t,e,n,r),va(t,i);const s=n?Ma(t,r):void 0;return ui=!1,s}function Ma(t,r){const e=t.type;t.accessCache=Object.create(null),t.proxy=Zs(new Proxy(t.ctx,la));const{setup:i}=e;if(i){const n=t.setupContext=i.length>1?Fa(t):null;Yt(t),Jt();const s=bt(i,t,0,[t.props,n]);if(Qt(),Ft(),Is(s)){if(s.then(Ft,Ft),r)return s.then(c=>{hs(t,c,r)}).catch(c=>{Ai(c,t,0)});t.asyncDep=s}else hs(t,s,r)}else Sr(t,r)}function hs(t,r,e){ue(r)?t.type.__ssrInlineRender?t.ssrRender=r:t.render=r:Te(r)&&(t.setupState=Js(r)),Sr(t,e)}let ds;function Sr(t,r,e){const i=t.type;if(!t.render){if(!r&&ds&&!i.render){const n=i.template||kn(t).template;if(n){const{isCustomElement:s,compilerOptions:c}=t.appContext.config,{delimiters:o,compilerOptions:a}=i,l=ke(ke({isCustomElement:s,delimiters:o},c),a);i.render=ds(n,l)}}t.render=i.render||$e}Yt(t),Jt(),ca(t),Qt(),Ft()}function Oa(t){return new Proxy(t.attrs,{get(r,e){return Ue(t,"get","$attrs"),r[e]}})}function Fa(t){const r=i=>{t.exposed=i||{}};let e;return{get attrs(){return e||(e=Oa(t))},slots:t.slots,emit:t.emit,expose:r}}function Ui(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(Js(Zs(t.exposed)),{get(r,e){if(e in r)return r[e];if(e in ni)return ni[e](t)},has(r,e){return e in r||e in ni}}))}function ka(t,r=!0){return ue(t)?t.displayName||t.name:t.name||r&&t.__name}function Aa(t){return ue(t)&&"__vccOpts"in t}const ut=(t,r)=>Io(t,r,ui);function Ba(t,r,e){const i=arguments.length;return i===2?Te(r)&&!oe(r)?ln(r)?X(t,null,[r]):X(t,r):X(t,null,r):(i>3?e=Array.prototype.slice.call(arguments,2):i===3&&ln(e)&&(e=[e]),X(t,r,e))}const za=Symbol(""),Na=()=>xi(za),Va="3.2.47",Ua="http://www.w3.org/2000/svg",Dt=typeof document<"u"?document:null,fs=Dt&&Dt.createElement("template"),Wa={insert:(t,r,e)=>{r.insertBefore(t,e||null)},remove:t=>{const r=t.parentNode;r&&r.removeChild(t)},createElement:(t,r,e,i)=>{const n=r?Dt.createElementNS(Ua,t):Dt.createElement(t,e?{is:e}:void 0);return t==="select"&&i&&i.multiple!=null&&n.setAttribute("multiple",i.multiple),n},createText:t=>Dt.createTextNode(t),createComment:t=>Dt.createComment(t),setText:(t,r)=>{t.nodeValue=r},setElementText:(t,r)=>{t.textContent=r},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Dt.querySelector(t),setScopeId(t,r){t.setAttribute(r,"")},insertStaticContent(t,r,e,i,n,s){const c=e?e.previousSibling:r.lastChild;if(n&&(n===s||n.nextSibling))for(;r.insertBefore(n.cloneNode(!0),e),!(n===s||!(n=n.nextSibling)););else{fs.innerHTML=i?`<svg>${t}</svg>`:t;const o=fs.content;if(i){const a=o.firstChild;for(;a.firstChild;)o.appendChild(a.firstChild);o.removeChild(a)}r.insertBefore(o,e)}return[c?c.nextSibling:r.firstChild,e?e.previousSibling:r.lastChild]}};function ja(t,r,e){const i=t._vtc;i&&(r=(r?[r,...i]:[...i]).join(" ")),r==null?t.removeAttribute("class"):e?t.setAttribute("class",r):t.className=r}function Ga(t,r,e){const i=t.style,n=Ce(e);if(e&&!n){if(r&&!Ce(r))for(const s in r)e[s]==null&&cn(i,s,"");for(const s in e)cn(i,s,e[s])}else{const s=i.display;n?r!==e&&(i.cssText=e):r&&t.removeAttribute("style"),"_vod"in t&&(i.display=s)}}const ps=/\s*!important$/;function cn(t,r,e){if(oe(e))e.forEach(i=>cn(t,r,i));else if(e==null&&(e=""),r.startsWith("--"))t.setProperty(r,e);else{const i=qa(t,r);ps.test(e)?t.setProperty(Bt(i),e.replace(ps,""),"important"):t[i]=e}}const gs=["Webkit","Moz","ms"],Ki={};function qa(t,r){const e=Ki[r];if(e)return e;let i=at(r);if(i!=="filter"&&i in t)return Ki[r]=i;i=Oi(i);for(let n=0;n<gs.length;n++){const s=gs[n]+i;if(s in t)return Ki[r]=s}return r}const ms="http://www.w3.org/1999/xlink";function Za(t,r,e,i,n){if(i&&r.startsWith("xlink:"))e==null?t.removeAttributeNS(ms,r.slice(6,r.length)):t.setAttributeNS(ms,r,e);else{const s=Ur(r);e==null||s&&!Hs(e)?t.removeAttribute(r):t.setAttribute(r,s?"":e)}}function Ka(t,r,e,i,n,s,c){if(r==="innerHTML"||r==="textContent"){i&&c(i,n,s),t[r]=e??"";return}if(r==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=e;const a=e??"";(t.value!==a||t.tagName==="OPTION")&&(t.value=a),e==null&&t.removeAttribute(r);return}let o=!1;if(e===""||e==null){const a=typeof t[r];a==="boolean"?e=Hs(e):e==null&&a==="string"?(e="",o=!0):a==="number"&&(e=0,o=!0)}try{t[r]=e}catch{}o&&t.removeAttribute(r)}function Wt(t,r,e,i){t.addEventListener(r,e,i)}function Xa(t,r,e,i){t.removeEventListener(r,e,i)}function Ya(t,r,e,i,n=null){const s=t._vei||(t._vei={}),c=s[r];if(i&&c)c.value=i;else{const[o,a]=Ja(r);if(i){const l=s[r]=el(i,n);Wt(t,o,l,a)}else c&&(Xa(t,o,c,a),s[r]=void 0)}}const vs=/(?:Once|Passive|Capture)$/;function Ja(t){let r;if(vs.test(t)){r={};let i;for(;i=t.match(vs);)t=t.slice(0,t.length-i[0].length),r[i[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Bt(t.slice(2)),r]}let Xi=0;const Qa=Promise.resolve(),$a=()=>Xi||(Qa.then(()=>Xi=0),Xi=Date.now());function el(t,r){const e=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=e.attached)return;et(tl(i,e.value),r,5,[i])};return e.value=t,e.attached=$a(),e}function tl(t,r){if(oe(r)){const e=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{e.call(t),t._stopped=!0},r.map(i=>n=>!n._stopped&&i&&i(n))}else return r}const ys=/^on[a-z]/,il=(t,r,e,i,n=!1,s,c,o,a)=>{r==="class"?ja(t,i,n):r==="style"?Ga(t,e,i):Di(r)?Tn(r)||Ya(t,r,e,i,c):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):nl(t,r,i,n))?Ka(t,r,i,s,c,o,a):(r==="true-value"?t._trueValue=i:r==="false-value"&&(t._falseValue=i),Za(t,r,i,n))};function nl(t,r,e,i){return i?!!(r==="innerHTML"||r==="textContent"||r in t&&ys.test(r)&&ue(e)):r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&t.tagName==="INPUT"||r==="type"&&t.tagName==="TEXTAREA"||ys.test(r)&&Ce(e)?!1:r in t}const ws=t=>{const r=t.props["onUpdate:modelValue"]||!1;return oe(r)?e=>_i(r,e):r};function sl(t){t.target.composing=!0}function _s(t){const r=t.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Pr={created(t,{modifiers:{lazy:r,trim:e,number:i}},n){t._assign=ws(n);const s=i||n.props&&n.props.type==="number";Wt(t,r?"change":"input",c=>{if(c.target.composing)return;let o=t.value;e&&(o=o.trim()),s&&(o=Yi(o)),t._assign(o)}),e&&Wt(t,"change",()=>{t.value=t.value.trim()}),r||(Wt(t,"compositionstart",sl),Wt(t,"compositionend",_s),Wt(t,"change",_s))},mounted(t,{value:r}){t.value=r??""},beforeUpdate(t,{value:r,modifiers:{lazy:e,trim:i,number:n}},s){if(t._assign=ws(s),t.composing||document.activeElement===t&&t.type!=="range"&&(e||i&&t.value.trim()===r||(n||t.type==="number")&&Yi(t.value)===r))return;const c=r??"";t.value!==c&&(t.value=c)}},rl=["ctrl","shift","alt","meta"],ol={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,r)=>rl.some(e=>t[`${e}Key`]&&!r.includes(e))},Mt=(t,r)=>(e,...i)=>{for(let n=0;n<r.length;n++){const s=ol[r[n]];if(s&&s(e,r))return}return t(e,...i)},al={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ii=(t,r)=>e=>{if(!("key"in e))return;const i=Bt(e.key);if(r.some(n=>n===i||al[n]===i))return t(e)},st={beforeMount(t,{value:r},{transition:e}){t._vod=t.style.display==="none"?"":t.style.display,e&&r?e.beforeEnter(t):ei(t,r)},mounted(t,{value:r},{transition:e}){e&&r&&e.enter(t)},updated(t,{value:r,oldValue:e},{transition:i}){!r!=!e&&(i?r?(i.beforeEnter(t),ei(t,!0),i.enter(t)):i.leave(t,()=>{ei(t,!1)}):ei(t,r))},beforeUnmount(t,{value:r}){ei(t,r)}};function ei(t,r){t.style.display=r?t._vod:"none"}const ll=ke({patchProp:il},Wa);let xs;function cl(){return xs||(xs=xa(ll))}const ul=(...t)=>{const r=cl().createApp(...t),{mount:e}=r;return r.mount=i=>{const n=hl(i);if(!n)return;const s=r._component;!ue(s)&&!s.render&&!s.template&&(s.template=n.innerHTML),n.innerHTML="";const c=e(n,!1,n instanceof SVGElement);return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),c},r};function hl(t){return Ce(t)?document.querySelector(t):t}var zn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},un={},dl={get exports(){return un},set exports(t){un=t}};(function(t,r){(function(e,i){t.exports=i()})(zn,function(){var e="__v-click-outside",i=typeof window<"u",n=typeof navigator<"u",s=i&&("ontouchstart"in window||n&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],c=function(u){var d=u.event,f=u.handler;(0,u.middleware)(d)&&f(d)},o=function(u,d){var f=function(L){var I=typeof L=="function";if(!I&&typeof L!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:I?L:L.handler,middleware:L.middleware||function(j){return j},events:L.events||s,isActive:L.isActive!==!1,detectIframe:L.detectIframe!==!1,capture:!!L.capture}}(d.value),w=f.handler,y=f.middleware,x=f.detectIframe,T=f.capture;if(f.isActive){if(u[e]=f.events.map(function(L){return{event:L,srcTarget:document.documentElement,handler:function(I){return function(j){var Y=j.el,Q=j.event,ie=j.handler,J=j.middleware,ee=Q.path||Q.composedPath&&Q.composedPath();(ee?ee.indexOf(Y)<0:!Y.contains(Q.target))&&c({event:Q,handler:ie,middleware:J})}({el:u,event:I,handler:w,middleware:y})},capture:T}}),x){var S={event:"blur",srcTarget:window,handler:function(L){return function(I){var j=I.el,Y=I.event,Q=I.handler,ie=I.middleware;setTimeout(function(){var J=document.activeElement;J&&J.tagName==="IFRAME"&&!j.contains(J)&&c({event:Y,handler:Q,middleware:ie})},0)}({el:u,event:L,handler:w,middleware:y})},capture:T};u[e]=[].concat(u[e],[S])}u[e].forEach(function(L){var I=L.event,j=L.srcTarget,Y=L.handler;return setTimeout(function(){u[e]&&j.addEventListener(I,Y,T)},0)})}},a=function(u){(u[e]||[]).forEach(function(d){return d.srcTarget.removeEventListener(d.event,d.handler,d.capture)}),delete u[e]},l=i?{beforeMount:o,updated:function(u,d){var f=d.value,w=d.oldValue;JSON.stringify(f)!==JSON.stringify(w)&&(a(u),o(u,{value:f}))},unmounted:a}:{};return{install:function(u){u.directive("click-outside",l)},directive:l}})})(dl);const fl=un,se=(t,r)=>{const e=t.__vccOpts||t;for(const[i,n]of r)e[i]=n;return e},pl={},gl={class:"tify-icon",viewBox:"0 0 24 24"},ml=M("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},null,-1),vl=[ml];function yl(t,r){return H(),D("svg",gl,vl)}const Cr=se(pl,[["render",yl]]),Hi=Ys("");function tt(t){Hi.value=t}let hn;const Ge=ki({collection:{},manifest:{},options:{},translation:{}}),{collection:Le,manifest:ce,options:B,translation:dn}=Ge,Ve=ut(()=>Ge.manifest.sequences?Ge.manifest.sequences[0].canvases:[]),lt=ut(()=>Ve.value.length);function fn(){const{startCanvas:t}=Ge.manifest.sequences[0],r=Ve.value.findIndex(e=>e["@id"]===t);return r>=0?r+1:1}function Rr(t){if(!Array.isArray(t)||new Set(t).size!==t.length)return!1;for(let r=0,e=t.length;r<e;r+=1)if(!Number.isInteger(t[r])||r>0&&t[r]>0&&t[r]<=t[r-1]||t[r]<0||t[r]>lt.value)return!1;return!0}function be(t){Object.assign(Ge.options,t),clearTimeout(hn),Ge.options.urlQueryKey&&(hn=setTimeout(()=>{const r={};Ge.options.urlQueryParams.forEach(i=>{const n=Ge.options[i];n===null||i==="pages"&&n.length<2&&n[0]<2||typeof n=="object"&&!Object.keys(n).length?delete r[i]:r[i]=Ge.options[i]});const e=new URL(window.location);e.searchParams.set(Ge.options.urlQueryKey,JSON.stringify(r)),window.history&&(t.pages?(tt(""),window.history.pushState({},"",e)):window.history.replaceState({},"",e))},100))}function wl(t){Object.assign(Ge.collection,t)}function Ts(t){Object.assign(Ge.manifest,t)}function bs(t){Object.assign(Ge.translation,t)}function zt(){return B.root.$el.offsetWidth<B.breakpoints.medium}function Li(t,r,e=120){const i=t,n=e===!0?120:e;if(!n||n<0){i.scrollTop=r;return}const c=(r-t.scrollTop)/n/.1;setTimeout(()=>{i.scrollTop+=c,i.scrollTop!==r&&Li(i,r,n-10)},10)}function pn(t,r,e=!0){const i=r.querySelectorAll(t);if(!i.length)return;let n=i[0];const s=i[i.length-1];Array.prototype.forEach.call(i,l=>{l.dataset.level>n.dataset.level&&(n=l)});const c=r.getBoundingClientRect(),o=n.getBoundingClientRect(),a=s.getBoundingClientRect();if(o.top<c.top){const l=o.top-c.top+r.scrollTop;Li(r,l-50,e)}else if(a.bottom>c.bottom){const l=a.bottom-c.bottom+r.scrollTop;Li(r,l+50,e)}}const qe=Ys(0);async function di(...t){const[r,e]=t;if({}.TEST)return new Promise((s,c)=>{r==="/de.json"?s({}):c(new Error)});qe.value+=1;const n=await(await fetch(r,e).catch(s=>(qe.value=0,Promise.reject(s)))).json().catch(s=>(qe.value=0,Promise.reject(s)));return qe.value>0&&(qe.value-=1),n}async function _l(...t){const[r,e]=t;qe.value+=1;const n=await(await fetch(r,e).catch(s=>(qe.value=0,Promise.reject(s)))).text().catch(s=>(qe.value=0,Promise.reject(s)));return qe.value>0&&(qe.value-=1),n}function gn(t){let r={};try{const e=new URLSearchParams(window.location.search);r=JSON.parse(e.get(B.urlQueryKey))||{}}catch{}r.view===""&&zt()&&(r.view="scan"),r.pages&&!Rr(r.pages)&&(tt("Invalid pages, reset to start page"),r.pages=null),B.childManifestUrl=r.childManifestUrl||B.childManifestUrl,B.filters=r.filters||B.filters,B.pages=t&&t.type==="popstate"?r.pages||[fn()]:r.pages||B.pages||[fn()],B.pan=r.panX||r.panY?{x:r.panX,y:r.panY}:r.pan||B.pan,B.rotation=parseInt(r.rotation,10)||B.rotation,B.view=r.view||r.view===""?r.view:B.view,B.zoom=parseFloat(r.zoom)||B.zoom}function Es(t=1){qe.value=t}B.translationsDirUrl="";function Ss(t){let r,e;const i=new Promise((s,c)=>{r=s,e=c});if(t==="en")return B.language="en",bs(null),r(t),i;B.translationsDirUrl===null&&e(new Error("Could not determine translationsDirUrl"));const n=`${B.translationsDirUrl}/${t}.json`;return di(n).then(s=>{B.language=t,bs(s),r(t)},s=>{const c=s.response?s.response.statusText:s.message;tt(`Error loading translation for "${t}": ${c}`),e(new Error(s))}),i}function Se(t,r){return dn[t]?dn[t]:r||t}const xl={computed:{copyrightHtml(){return Se("$copyright",'Copyright &copy; 2017&ndash;2022 <a href="https://www.uni-goettingen.de/en/">GÃ¶ttingen University</a>&nbsp;/ <a href="https://www.sub.uni-goettingen.de/en/">GÃ¶ttingen State and University Library</a>')},env(){return{version:"0.28.1",license:"AGPL-3.0",bugsUrl:"https://github.com/tify-iiif-viewer/tify/issues",contributorsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.28.1/CONTRIBUTORS.md",docsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.28.1/doc",docsLanguages:["de","en"],repositoryUrl:"https://github.com/tify-iiif-viewer/tify"}},infoHtml(){return Se("$info",'TIFY is a slim and mobile-friendly IIIF document viewer, released under the <a href="https://www.gnu.org/licenses/agpl-3.0.html.en">GNU Affero General Public License 3.0</a>.')},userGuideUrl(){const t=this.env.docsLanguages.includes(B.language)?B.language:"en";return`${this.env.docsUrl}/user-guide.${t}.md`}},methods:{translate:Se}},Tl={class:"tify-help",tabindex:"0"},bl={class:"tify-sr-only"},El=["innerHTML"],Sl=["href"],Pl=["href"],Cl=["href"],Rl=["href"],Hl={class:"tify-help-footer"},Ll=["innerHTML"];function Dl(t,r,e,i,n,s){return H(),D("section",Tl,[M("h2",bl,U(s.translate("Help")),1),M("h3",null,U(s.translate("About TIFY")),1),M("p",{innerHTML:s.infoHtml},null,8,El),M("ul",null,[M("li",null,[M("a",{href:s.userGuideUrl},U(s.translate("User guide")),9,Sl)]),M("li",null,[M("a",{href:s.env.repositoryUrl},U(s.translate("Source code")),9,Pl)]),M("li",null,[M("a",{href:s.env.contributorsUrl},U(s.translate("Contributors")),9,Cl)]),M("li",null,[M("a",{href:s.env.bugsUrl},U(s.translate("Report a bug")),9,Rl)])]),M("footer",Hl,[M("p",null,[xe(U(s.translate("Version"))+" ",1),M("b",null,U(s.env.version),1),xe(" Â· "),M("span",{innerHTML:s.copyrightHtml},null,8,Ll)])])])}const Il=se(xl,[["render",Dl]]),Ml={},Ol={class:"tify-icon",viewBox:"0 0 24 24"},Fl=M("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},null,-1),kl=[Fl];function Al(t,r){return H(),D("svg",Ol,kl)}const Hr=se(Ml,[["render",Al]]),Bl={},zl={class:"tify-icon",viewBox:"0 0 24 24"},Nl=M("path",{d:"M19,13H5V11H19V13Z"},null,-1),Vl=[Nl];function Ul(t,r){return H(),D("svg",zl,Vl)}const Lr=se(Bl,[["render",Ul]]),Wl=`tify-${Math.floor(Math.random()*Date.now())}`;function Nt(t){return Wl+(t?`-${t}`:"")}var mn={},jl={get exports(){return mn},set exports(t){mn=t}};(function(t){(function(r){if(typeof e!="function"){var e=function(y){return y};e.nonNative=!0}const i=e("plaintext"),n=e("html"),s=e("comment"),c=/<(\w*)>/g,o=/<\/?([^\s\/>]+)/;function a(y,x,T){y=y||"",x=x||[],T=T||"";let S=u(x,T);return d(y,S)}function l(y,x){y=y||[],x=x||"";let T=u(y,x);return function(L){return d(L||"",T)}}a.init_streaming_mode=l;function u(y,x){return y=f(y),{allowable_tags:y,tag_replacement:x,state:i,tag_buffer:"",depth:0,in_quote_char:""}}function d(y,x){if(typeof y!="string")throw new TypeError("'html' parameter must be a string");let T=x.allowable_tags,S=x.tag_replacement,L=x.state,I=x.tag_buffer,j=x.depth,Y=x.in_quote_char,Q="";for(let ie=0,J=y.length;ie<J;ie++){let ee=y[ie];if(L===i)switch(ee){case"<":L=n,I+=ee;break;default:Q+=ee;break}else if(L===n)switch(ee){case"<":if(Y)break;j++;break;case">":if(Y)break;if(j){j--;break}Y="",L=i,I+=">",T.has(w(I))?Q+=I:Q+=S,I="";break;case'"':case"'":ee===Y?Y="":Y=Y||ee,I+=ee;break;case"-":I==="<!-"&&(L=s),I+=ee;break;case" ":case`
`:if(I==="<"){L=i,Q+="< ",I="";break}I+=ee;break;default:I+=ee;break}else if(L===s)switch(ee){case">":I.slice(-2)=="--"&&(L=i),I="";break;default:I+=ee;break}}return x.state=L,x.tag_buffer=I,x.depth=j,x.in_quote_char=Y,Q}function f(y){let x=new Set;if(typeof y=="string"){let T;for(;T=c.exec(y);)x.add(T[1])}else!e.nonNative&&typeof y[e.iterator]=="function"?x=new Set(y):typeof y.forEach=="function"&&y.forEach(x.add,x);return x}function w(y){let x=o.exec(y);return x?x[1].toLowerCase():null}t.exports?t.exports=a:r.striptags=a})(zn)})(jl);const Gl=mn;function xt(t){const r=["a","b","br","i","img","p","span"],e={a:["href"],img:["alt","src"]};let i=Gl(t,r);const n=/<(\w+)((\s+.+?(\s*=\s*(?:".*?"|'.*?'|.*?|[\^'">\s]+))?)+\s*|\s*)>/g;return i=i.replace(n,(s,c,o)=>{if(!o)return`<${c}>`;const a=/(?:([^\s]+)=(?:"(.*?)"|'(.*?)'))|([^\s]+)/g,l=[];return o.replace(a,(u,d)=>{u!==d&&e[c]&&e[c].indexOf(d)>-1&&l.push(u)}),l.length>0?`<${c} ${l.join(" ")}>`:`<${c}>`}),i}function He(t){if(!B.language)throw new Error("language not set");if(!(t instanceof Array)){if(typeof t=="object"){if(t["@value"])return[xt(t["@value"])];if(t["@id"]){const n=xt(t["@id"]);return[{"@id":n,label:t.label?xt(t.label):n}]}return["(Invalid value)"]}return[xt(t)]}const r=[],e={};t.forEach(n=>{typeof n=="string"||n["@id"]&&n.label?r.push(n):n&&typeof n!="object"?r.push(xt(n)):n["@language"]&&n["@value"]&&(e.fallback||(e.fallback=n["@value"]),n["@language"].indexOf("en")===0?e.en=n["@value"]:B.language&&n["@language"]===B.language&&(e.preferred=n["@value"]))});const i=e.preferred||e.en||e.fallback||null;return i&&r.push(xt(i)),r}function hi(t,r){return B.pageLabelFormat.replace("P",t).replace("L",r)}function Nn(t,r={}){let e,i;const n=new Promise((s,c)=>{e=s,i=c});return di(t).then(async s=>{if(r.expectedType&&s["@type"]!==r.expectedType)return tt(`Expected manifest of type ${r.expectedType}, but got ${s["@type"]}`),i(Hi),n;if(Ts(null),await er(),s["@type"]==="sc:Manifest")return Ts(s),gn(),window.addEventListener("popstate",gn),r.reset&&be({childManifestUrl:t,pages:[fn()],pan:{},rotation:null,view:zt()?"scan":"collection",zoom:null}),e(),n;if(s["@type"]==="sc:Collection"){wl(s);const c=new URLSearchParams(window.location.search);let o={};try{o=JSON.parse(c.get(B.urlQueryKey))||{}}catch{}let a="";if(B.urlQueryParams.includes("childManifestUrl")&&o.childManifestUrl?a=o.childManifestUrl:Le.manifests&&B.childManifestAutoloaded&&(a=Le.manifests[0]["@id"]),a)await Nn(a,{expectedType:"sc:Manifest"}),be({childManifestUrl:a});else{const l=o.view||B.view;be({view:["collection","help","info"].includes(l)?l:"collection"})}return e(),n}return tt("Please provide a valid IIIF Presentation API 2.x manifest"),i(Hi),n},s=>{const c=s.response&&(s.response.statusText||s.response.data)||s.message;return tt(`Error loading IIIF manifest: ${c}`),i(s),n})}const ql={name:"CollectionNode",props:{item:{type:Object,default:()=>{}}},data(){return{children:null,expanded:!1,id:Nt(`collection-node-${Math.floor(Math.random()*1e12)}`),manifest:ce}},computed:{label(){return this.item.label?He(this.item.label).join(`${String.fromCharCode(160)}Â· `):""}},methods:{loadManifest:Nn,toggleChildren(){if(this.expanded){this.expanded=!1;return}if(this.children){this.expanded=!0;return}if(this.item.children){this.children=this.item.children,this.expanded=!0;return}di(this.item["@id"]).then(t=>{this.children=t.manifests||t.collections||[],this.expanded=!0},t=>{const r=t.response&&(t.response.statusText||t.response.data)||t.message;tt(`Error loading IIIF manifest: ${r}`),this.children=!1})},translate:Se}},Zl=["aria-controls","aria-expanded"],Kl={class:"tify-sr-only"},Xl={class:"tify-sr-only"},Yl=["id"],Jl={key:1,class:"tify-collection-error"};function Ql(t,r,e,i,n,s){const c=Lr,o=Hr,a=dr("collection-node",!0);return H(),D("li",{class:_e(["tify-collection-item",{"-current":n.manifest["@id"]===e.item["@id"]}])},[e.item["@type"]==="sc:Collection"?(H(),D("button",{key:0,type:"button","aria-controls":n.id,"aria-expanded":n.expanded?"true":"false",class:"tify-collection-link -has-children",onClick:r[0]||(r[0]=l=>s.toggleChildren())},[n.expanded?(H(),D(ae,{key:0},[X(c),M("span",Kl,U(s.translate("Collapse")),1)],64)):(H(),D(ae,{key:1},[X(o),M("span",Xl,U(s.translate("Expand")),1)],64)),xe(" "+U(s.label),1)],8,Zl)):(H(),D("a",{key:1,href:"javascript:;",class:"tify-collection-link",onClick:r[1]||(r[1]=l=>s.loadManifest(e.item["@id"],{expectedType:e.item["@type"],reset:!0},this))},U(s.label),1)),n.expanded?(H(),D(ae,{key:2},[n.expanded?(H(),D("ol",{key:0,id:n.id,class:"tify-collection-list"},[(H(!0),D(ae,null,Pe(n.children,l=>(H(),Ie(a,{key:l["@id"],item:l},null,8,["item"]))),128))],8,Yl)):n.children===!1?(H(),D("p",Jl,U(s.translate("Could not load child manifest")),1)):te("",!0)],64)):te("",!0)],2)}const $l=se(ql,[["render",Ql]]),ec={data(){return{filter:""}},computed:{filteredItems(){const t=this.filter.trim().toLowerCase().split(/\s+/);return this.items.filter(r=>{const e=r.label.toLowerCase();return t.every(i=>e.includes(i))})},items(){return Le.manifests&&Le.collections?[{"@id":"tify-collection-manifests","@type":"sc:Collection",label:Se("Documents"),children:Le.manifests},{"@id":"tify-collection-collections","@type":"sc:Collection",label:Se("Collections"),children:Le.collections}]:Le.manifests||Le.collections}},methods:{translate:Se}},tc={class:"tify-collection",tabindex:"0"},ic={class:"tify-sr-only"},nc={key:0,class:"tify-collection-controls"},sc=["aria-label","placeholder"],rc=["disabled"],oc={key:1,class:"tify-collection-list"},ac={key:2,class:"tify-collection-no-results"};function lc(t,r,e,i,n,s){const c=$l;return H(),D("section",tc,[M("h2",ic,U(s.translate("Collection")),1),s.items.length>5?(H(),D("p",nc,[Fe(M("input",{"onUpdate:modelValue":r[0]||(r[0]=o=>n.filter=o),"aria-label":s.translate("Filter collection"),class:"tify-collection-filter",placeholder:s.translate("Filter collection"),type:"text",onKeydown:[r[1]||(r[1]=ii(Mt(o=>n.filter?n.filter="":o.target.blur(),["prevent"]),["esc"])),r[2]||(r[2]=Mt(()=>{},["stop"]))]},null,40,sc),[[Pr,n.filter]]),M("button",{type:"button",class:"tify-collection-reset",disabled:!n.filter,onClick:r[3]||(r[3]=o=>n.filter="")},U(s.translate("Reset")),9,rc)])):te("",!0),s.filteredItems.length?(H(),D("ol",oc,[(H(!0),D(ae,null,Pe(s.filteredItems,o=>(H(),Ie(c,{key:o["@id"],item:o},null,8,["item"]))),128))])):(H(),D("p",ac,U(s.translate("No results")),1))])}const cc=se(ec,[["render",lc]]),uc={},hc={class:"tify-icon",viewBox:"0 0 24 24"},dc=M("path",{d:"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"},null,-1),fc=[dc];function pc(t,r){return H(),D("svg",hc,fc)}const gc=se(uc,[["render",pc]]),mc={},vc={class:"tify-icon",viewBox:"0 0 24 24"},yc=M("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},null,-1),wc=[yc];function _c(t,r){return H(),D("svg",vc,wc)}const xc=se(mc,[["render",_c]]);function Vn(t,r=["https:","http:"]){let e;try{e=new URL(t)}catch{return!1}return r.includes(e.protocol)}const Tc={props:{metadata:{type:Array,default:()=>[]}},data(){return{infoItems:[]}},watch:{metadata(){this.updateInfoItems()}},mounted(){this.updateInfoItems()},methods:{cleanLabel(t){const r=t.replace("_"," ");return r.charAt(0).toUpperCase()+r.substr(1)},convertValueToArray:He,updateInfoItems(){this.$nextTick(()=>{this.$refs.contents&&this.$refs.contents.forEach((t,r)=>{const e=t.offsetHeight;this.infoItems[r]={collapsed:!0,exceedsHeight:!0},this.$nextTick(()=>{const i=t.offsetHeight,n=e>=i;this.infoItems[r]={collapsed:n,exceedsHeight:n}})})})},isValidUrl:Vn,translate:Se}},bc={class:"tify-info-metadata"},Ec={class:"tify-info-value"},Sc=["href"],Pc=["innerHTML"],Cc=["onClick"];function Rc(t,r,e,i,n,s){const c=xc,o=gc;return H(),D("div",bc,[(H(!0),D(ae,null,Pe(e.metadata,(a,l)=>(H(),D("div",{key:l},[M("h4",null,[(H(!0),D(ae,null,Pe(s.convertValueToArray(a.label),(u,d)=>(H(),D("div",{key:d},U(s.cleanLabel(u)),1))),128))]),M("div",{ref_for:!0,ref:"contents",class:_e(["tify-info-content",{"-collapsed":n.infoItems[l]&&n.infoItems[l].collapsed}])},[M("div",Ec,[(H(!0),D(ae,null,Pe(s.convertValueToArray(a.value),u=>(H(),D(ae,null,[s.isValidUrl(u)?(H(),D("div",{key:"url-"+u},[M("a",{href:u},U(u),9,Sc)])):(H(),D("div",{key:"html-"+u,innerHTML:u},null,8,Pc))],64))),256))]),n.infoItems[l]&&n.infoItems[l].exceedsHeight?(H(),D("button",{key:0,type:"button",class:"tify-info-toggle",onClick:u=>n.infoItems[l].collapsed=!n.infoItems[l].collapsed},[n.infoItems[l].collapsed?(H(),D(ae,{key:0},[X(c),xe(" "+U(s.translate("Expand")),1)],64)):(H(),D(ae,{key:1},[X(o),xe(" "+U(s.translate("Collapse")),1)],64))],8,Cc)):te("",!0)],2)]))),128))])}const Hc=se(Tc,[["render",Rc]]),Un=ut(()=>{if(!ce||!Array.isArray(ce.structures))return!1;const t=[];B.pages.forEach(n=>{n&&t.push(ce.sequences[0].canvases[n-1]["@id"])});const{length:r}=ce.structures;let e,i;for(let n=0;n<r;n+=1){const s=ce.structures[n],{canvases:c}=s;if(c&&c.some(o=>t.indexOf(o)>-1)&&s.firstPage&&s.lastPage){const o=s.lastPage-s.firstPage;if((o<i||!i)&&(e=n,i=o,i===0))break}}return typeof e=="number"&&e>=0?ce.structures[e]:!1}),Lc=ut(()=>{const{label:t}=Un.value;return t}),Dc=ut(()=>{const{metadata:t}=Un.value;return t}),Ei=ut(()=>{if(!ce.structures)return[];const t=[],r=[],{canvases:e}=ce.sequences[0],{length:i}=ce.structures;for(let c=0;c<i;c+=1){const o=ce.structures[c];if(o.viewingHint!=="top"){if(o.label?o.label=He(o.label)[0].trim():o.label="â",o.canvases){const a=o.canvases[0];o.firstPage=e.findIndex(d=>d["@id"]===a)+1;const l=o.canvases[o.canvases.length-1];o.lastPage=e.findIndex(d=>d["@id"]===l)+1;const u=e[o.firstPage-1];if(!u)continue;o.pageLabel=u.label}else e[0]&&(o.firstPage=1,o.lastPage=lt.value,o.pageLabel=e[0].label);o.pageCount=o.lastPage-o.firstPage+1,o.within&&r.push(o),t.push(o)}}const n=r.length;for(let c=0;c<i;c+=1){const o=[];for(let a=0;a<n;a+=1){const l=r[a];l.within===t[c]["@id"]&&o.push(l)}o.length&&(t[c].childStructures=o.sort((a,l)=>a.firstPage-l.firstPage))}return t.filter(c=>!c.within).sort((c,o)=>c.firstPage-o.firstPage)}),Ic={data(){return{currentStructure:Un,currentStructureLabel:Lc,currentStructureMetadata:Dc,collectionDataShown:!1,options:B}},computed:{collection(){return Le},license(){return ce.license?He(this.manifest.license):[]},logoId(){return ce.logo["@id"]||ce.logo},manifest(){return this.collectionDataShown?Le:ce||Le},related(){return ce.related?He(ce.related):[]}},methods:{convertValueToArray:He,isValidUrl:Vn,translate:Se}},Mc={class:"tify-info",tabindex:"0"},Oc={class:"tify-sr-only"},Fc={key:0,class:"tify-info-header"},kc={key:1,class:"tify-info-section -title"},Ac={class:"tify-info-heading"},Bc={key:2,class:"tify-info-section -metadata"},zc={key:3,class:"tify-info-section -metadata -structure"},Nc={key:0,class:"tify-info-structure"},Vc={key:4,class:"tify-info-section -description"},Uc=["innerHTML"],Wc={key:5,class:"tify-info-section -license"},jc=["href"],Gc=["href"],qc={key:6,class:"tify-info-section -related"},Zc=["href"],Kc=["href"],Xc={key:7,class:"tify-info-section -attribution"},Yc=["innerHTML"],Jc={key:8,class:"tify-info-section -logo"},Qc=["href"],$c=["src","alt"],eu=["src","alt"];function tu(t,r,e,i,n,s){const c=Hc;return H(),D("section",Mc,[M("h2",Oc,U(s.translate("Info")),1),s.collection["@id"]&&s.manifest["@id"]?(H(),D("div",Fc,[M("button",{type:"button",class:_e(["tify-info-button",{"-active":!n.collectionDataShown}]),onClick:r[0]||(r[0]=o=>n.collectionDataShown=!1)},U(s.translate("Document")),3),M("button",{type:"button",class:_e(["tify-info-button",{"-active":n.collectionDataShown}]),onClick:r[1]||(r[1]=o=>n.collectionDataShown=!0)},U(s.translate("Collection")),3)])):te("",!0),s.manifest.label?(H(),D("div",kc,[M("h3",Ac,U(s.translate("Title")),1),(H(!0),D(ae,null,Pe(s.convertValueToArray(s.manifest.label),o=>(H(),D("div",{key:o},U(o),1))),128))])):te("",!0),s.manifest.metadata&&s.manifest.metadata.length?(H(),D("div",Bc,[M("h3",null,U(s.translate("Metadata")),1),n.options.view==="info"?(H(),Ie(c,{key:0,metadata:s.manifest.metadata},null,8,["metadata"])):te("",!0)])):te("",!0),s.manifest.structures&&(n.currentStructureLabel||n.currentStructureMetadata)?(H(),D("div",zc,[M("h3",null,U(s.translate("Current Element")),1),n.currentStructureLabel?(H(),D("p",Nc,U(n.currentStructureLabel),1)):te("",!0),n.options.view==="info"&&n.currentStructureMetadata?(H(),Ie(c,{key:1,class:"tify-info-section -metadata",metadata:n.currentStructureMetadata},null,8,["metadata"])):te("",!0)])):te("",!0),s.manifest.description?(H(),D("div",Vc,[M("h3",null,U(s.translate("Description")),1),(H(!0),D(ae,null,Pe(s.convertValueToArray(s.manifest.description),(o,a)=>(H(),D("div",{key:a,innerHTML:o},null,8,Uc))),128))])):te("",!0),s.license.length?(H(),D("div",Wc,[M("h3",null,U(s.translate("License")),1),(H(!0),D(ae,null,Pe(s.license,(o,a)=>(H(),D("div",{key:a},[typeof o=="string"?(H(),D(ae,{key:0},[s.isValidUrl(o)?(H(),D("a",{key:0,href:o},U(o),9,jc)):(H(),D(ae,{key:1},[xe(U(o),1)],64))],64)):(H(),D(ae,{key:1},[s.isValidUrl(o["@id"])?(H(),D("a",{key:0,href:o["@id"]},U(o.label||o["@id"]),9,Gc)):(H(),D(ae,{key:1},[xe(U(o.label||o["@id"]),1)],64))],64))]))),128))])):te("",!0),s.related.length?(H(),D("div",qc,[M("h3",null,U(s.translate("Related Resources")),1),(H(!0),D(ae,null,Pe(s.related,(o,a)=>(H(),D("div",{key:a},[typeof o=="string"?(H(),D("a",{key:0,href:o},U(o),9,Zc)):(H(),D("a",{key:1,href:o["@id"]},U(o.label||o["@id"]),9,Kc))]))),128))])):te("",!0),s.manifest.attribution?(H(),D("div",Xc,[M("h3",null,U(s.translate("Provided by")),1),(H(!0),D(ae,null,Pe(s.convertValueToArray(s.manifest.attribution),(o,a)=>(H(),D("div",{key:a,innerHTML:o},null,8,Yc))),128))])):te("",!0),s.manifest.logo?(H(),D("div",Jc,[s.logoId&&s.manifest.logo.service&&s.manifest.logo.service["@id"]?(H(),D("a",{key:0,href:s.manifest.logo.service["@id"]},[M("img",{class:"tify-info-logo",src:s.logoId,alt:s.translate("Logo")},null,8,$c)],8,Qc)):(H(),D("img",{key:1,class:"tify-info-logo",src:s.logoId,alt:s.translate("Logo")},null,8,eu))])):te("",!0)])}const iu=se(Ic,[["render",tu]]),Dr=ut(()=>{if(!B.pages)return!1;const{pages:t}=B;return t.length>2||t.length===2&&(t[0]%2>0||t[1]!==t[0]+1)&&t[1]>0});function ct(t){let r=t;if(Array.isArray(t)||(r=[t]),!Rr(r))throw new RangeError("Invalid pages");if(r.length===1&&B.pages&&B.pages[0]%2<1&&(B.pages[1]===B.pages[0]+1||B.pages[1]===0)){const e=r[0]%2>0?r[0]-1:r[0];r=[e,e===lt.value?0:e+1]}return be({pages:r}),r}const Ir=ut(()=>B.pages[0]<2),Mr=ut(()=>{const{pages:t}=B;return t[0]>=lt.value||t[t.length-1]>=lt.value});function Ps(){ct(1)}function vn(){const{pages:t}=B;let r=t[0]+1;t.length>1&&r%2>0&&r<lt.value&&(r+=1),ct(r)}function Cs(){ct(lt.value)}function yn(){const{pages:t}=B;let r=t[0]-1;t.length>1&&r%2>0&&r>0&&(r-=1),ct(r)}const nu={name:"TocList",props:{level:{type:Number,default:0},structures:{type:Array,default:()=>[]},parentStructure:{type:Object,default:()=>{}},purpose:{type:String,default:""}},data(){return{expandedStructures:[],id:Nt(`toc-list-${Math.floor(Math.random()*1e12)}`)}},methods:{checkIfPagesInStructure(t){const{pages:r}=B;return r.some(e=>e>=t.firstPage&&e<=t.lastPage)},convertValueToArray:He,setPage(t){ct(t),zt()&&be({view:"scan"})},toggleAllChildren(t=null){if(this.$refs.children){for(let r=this.structures.length-1;r>=0;r-=1)this.toggleChildren(r,t);this.$refs.children.forEach(r=>{r.toggleAllChildren(t)})}},toggleChildren(t,r=null){this.structures[t].childStructures&&(this.expandedStructures[t]=r!==null?r:!this.expandedStructures[t])},translate:Se}},su={class:"tify-toc-list"},ru=["data-level"],ou=["title","aria-controls","aria-expanded","onClick"],au=["href"],lu=["onClick"],cu={class:"tify-toc-label"},uu={class:"tify-toc-page"};function hu(t,r,e,i,n,s){const c=Lr,o=Hr,a=dr("toc-list",!0);return H(),D("ul",su,[(H(!0),D(ae,null,Pe(e.structures,(l,u)=>(H(),D("li",{key:u,class:_e(["tify-toc-structure",{"-current":s.checkIfPagesInStructure(l),"-expanded":n.expandedStructures[u]}]),"data-level":e.level},[l.childStructures?(H(),D("button",{key:0,type:"button",class:"tify-toc-toggle",title:s.translate(n.expandedStructures[u]?"Collapse":"Expand"),"aria-controls":`${n.id}-${u}`,"aria-expanded":n.expandedStructures[u]?"true":"false",onClick:d=>s.toggleChildren(u)},[n.expandedStructures[u]?(H(),Ie(c,{key:0})):(H(),Ie(o,{key:1}))],8,ou)):te("",!0),e.purpose==="pdf"?(H(),D("a",{key:1,class:"tify-toc-link",download:"",href:s.convertValueToArray(l.rendering)[0]["@id"]},U(l.label)+" ("+U(l.pageCount)+"Â "+U(s.translate(l.pageCount===1?"page":"pages"))+") ",9,au)):(H(),D("a",{key:2,class:"tify-toc-link -dots",href:"javascript:;",onClick:d=>s.setPage(l.firstPage)},[M("span",cu,U(l.label),1),M("span",uu,U(l.pageLabel),1)],8,lu)),l.childStructures?Fe((H(),Ie(a,{key:3,id:`${n.id}-${u}`,ref_for:!0,ref:"children",level:e.level+1,"parent-structure":l,purpose:e.purpose,structures:l.childStructures},null,8,["id","level","parent-structure","purpose","structures"])),[[st,n.expandedStructures[u]]]):te("",!0)],10,ru))),128))])}const Or=se(nu,[["render",hu]]),du=[{label:"BibTex",profile:"http://www.bibtex.org/Format/",type:"literature"},{label:"EndNote",profile:"http://endnote.com/",type:"literature"},{label:"RIS",profile:"http://referencemanager.com/sites/rm/files/m/direct_export_ris.pdf",type:"literature"},{label:"METS",profile:"http://www.loc.gov/standards/mets/profile_docs/mets.profile.v2-0.xsd",type:"other"},{label:"MODS",format:"application/mods+xml",type:"other"}],fu={data(){return{collection:Le,literatureItems:[],manifest:ce,options:B,otherItems:[],perElementPdfLinksVisible:!1,structures:Ei}},computed:{canvases(){return Ve.value},pages(){return B.pages.filter(t=>t>0)},hasElementPdfLinks(){return!Array.isArray(ce.structures)||!ce.structures[0]||!ce.structures[0].rendering?!1:He(ce.structures[0].rendering).some(r=>r.format&&r.format==="application/pdf")},imageUrls(){const t={};return B.pages.forEach(r=>{if(!r)return;const{resource:e}=this.canvases[r-1].images[0];if(e.service){const i=e.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",n=e.service["@id"];t[r]=`${n}${n.slice(-1)==="/"?"":"/"}full/full/0/${i}.jpg`}else t[r]=e["@id"]}),t},renderings(){return He(ce.rendering)}},created(){const{seeAlso:t}=ce;if(!t)return;JSON.parse(JSON.stringify(Array.isArray(t)?t:[t])).forEach(e=>{const i=typeof e=="object"?e:{"@id":e};let n=!1;du.some(s=>{const c=e.format&&s.format===e.format,o=e.profile&&s.profile===e.profile;return c||o?(i.label=s.label,s.type==="literature"&&(n=!0),!0):!1}),n?this.literatureItems.push(i):this.otherItems.push(i)})},methods:{convertValueToArray:He,getId:Nt,getPageLabel:hi,translate:Se}},pu={class:"tify-export",tabindex:"0"},gu={class:"tify-sr-only"},mu={class:"tify-export-section -links"},vu=["href","download"],yu={key:0,class:"tify-export-section -renderings"},wu=["href"],_u={key:0,class:"tify-export-container"},xu=["aria-controls","aria-expanded"],Tu={class:"tify-sr-only"},bu=["id"],Eu={key:1,class:"tify-export-section -literature"},Su=["href"],Pu={class:"tify-export-section -other"},Cu={key:0},Ru=["href"],Hu=["href"],Lu=["href"];function Du(t,r,e,i,n,s){const c=Cr,o=Or;return H(),D("section",pu,[M("h2",gu,U(s.translate("Export")),1),M("div",mu,[M("h3",null,U(s.translate("Download Individual Images")),1),M("ul",null,[(H(!0),D(ae,null,Pe(s.pages,a=>(H(),D("li",{key:a},[M("a",{href:s.imageUrls[a],download:`${a}.jpg`},U(s.translate("Page"))+" "+U(s.getPageLabel(a,s.convertValueToArray(s.canvases[a-1].label)[0])),9,vu)]))),128))])]),n.manifest.rendering?(H(),D("div",yu,[M("h3",null,U(s.translate("Renderings")),1),M("ul",null,[(H(!0),D(ae,null,Pe(s.renderings,a=>(H(),D("li",{key:a["@id"]},[M("a",{href:a["@id"]},U(a.label),9,wu)]))),128))]),s.hasElementPdfLinks?(H(),D("div",_u,[M("button",{type:"button",class:_e(["tify-export-toggle",{"-close":n.perElementPdfLinksVisible}]),"aria-controls":s.getId("export-pdf-list"),"aria-expanded":n.perElementPdfLinksVisible?"true":"false",onClick:r[0]||(r[0]=a=>n.perElementPdfLinksVisible=!n.perElementPdfLinksVisible)},[n.perElementPdfLinksVisible?(H(),D(ae,{key:1},[X(c),M("span",Tu,U(s.translate("Close PDF list")),1)],64)):(H(),D(ae,{key:0},[xe(U(s.translate("PDFs for each element")),1)],64))],10,xu),n.perElementPdfLinksVisible?(H(),D("div",{key:0,id:s.getId("export-pdf-list"),class:"tify-export-toc"},[M("h4",null,U(s.translate("PDFs for each element")),1),X(o,{ref:"children",purpose:"pdf",level:0,structures:n.structures},null,8,["structures"])],8,bu)):te("",!0)])):te("",!0)])):te("",!0),n.literatureItems.length?(H(),D("div",Eu,[M("h3",null,U(s.translate("Literature Management")),1),M("ul",null,[(H(!0),D(ae,null,Pe(n.literatureItems,a=>(H(),D("li",{key:a["@id"]},[M("a",{href:a["@id"],download:""},U(a.label),9,Su)]))),128))])])):te("",!0),M("div",Pu,[M("h3",null,U(s.translate("Other Formats")),1),M("ul",null,[n.options.childManifestUrl?(H(),D("li",Cu,[M("a",{href:n.options.childManifestUrl,download:"manifest.json"},U(s.translate("IIIF manifest (current document)")),9,Ru)])):te("",!0),M("li",null,[M("a",{href:n.options.manifestUrl,download:"manifest.json"},U(s.translate(n.collection?"IIIF manifest (collection)":"IIIF manifest")),9,Hu)]),(H(!0),D(ae,null,Pe(n.otherItems,a=>(H(),D("li",{key:a["@id"]},[M("a",{href:a["@id"],download:""},U(a.label||a["@id"]),9,Lu)]))),128))])])])}const Iu=se(fu,[["render",Du]]),Rs=".tify-toc-structure.-current",Mu={data(){return{isInited:!1,options:B,structures:Ei}},computed:{hasChildStructures(){return Ei.value&&Ei.value.some(t=>t.childStructures)}},watch:{"options.pages":function(){this.$nextTick(()=>pn(Rs,this.$el))},"options.view":{handler(t){t==="toc"&&this.$nextTick(this.init)},immediate:!0}},methods:{init(){this.isInited=!0,this.$nextTick(()=>pn(Rs,this.$el,!1))},translate:Se}},Ou={class:"tify-toc",tabindex:"0"},Fu={class:"tify-sr-only"},ku={key:0,class:"tify-toc-header"};function Au(t,r,e,i,n,s){const c=Or;return H(),D("section",Ou,[M("h2",Fu,U(s.translate("Table of Contents")),1),s.hasChildStructures?(H(),D("div",ku,[M("button",{type:"button",class:"tify-toc-toggle-all",onClick:r[0]||(r[0]=o=>t.$refs.children.toggleAllChildren(!0))},U(s.translate("Expand all")),1),M("button",{type:"button",class:"tify-toc-toggle-all",onClick:r[1]||(r[1]=o=>t.$refs.children.toggleAllChildren(!1))},U(s.translate("Collapse all")),1)])):te("",!0),n.isInited?(H(),Ie(c,{key:1,ref:"children",level:0,structures:n.structures},null,8,["structures"])):te("",!0)])}const Bu=se(Mu,[["render",Au]]),zu=750,Nu={data(){return{isInited:!1,itemHeight:0,itemVMargin:0,items:[{label:""}],itemsPerRow:0,knownImages:[],lastScrollTop:0,options:B,resizeTimeout:null,style:{},thumbnailWidth:0,touchTimeout:null}},watch:{"options.pages":function(t){this.$nextTick(()=>{const r=".tify-thumbnails-item.-current";t.length>2||t.length>1&&t[1]!==t[0]+1||(this.$refs.container.querySelector(r)?pn(r,this.$el):this.scrollToCurrentPage())})},"options.view":{handler(t){t==="thumbnails"&&this.$nextTick(this.init)},immediate:!0}},mounted(){this.style.flex=this.$el.style.flex},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{getPageLabel:hi,init(){this.updateDimensions(),this.scrollToCurrentPage(!1),this.isInited||(window.addEventListener("resize",this.onResize),this.isInited=!0)},onResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{B.view==="thumbnails"&&this.updateDimensions()},200)},updateDimensions(){const t=this.$refs.container.querySelector(".tify-thumbnails-item"),r=t.currentStyle||window.getComputedStyle(t),e=parseInt(r.marginTop,10)+parseFloat(r.marginBottom,10);this.itemHeight=t.offsetHeight+e,this.itemVerticalMargin=e;const i=parseInt(r.marginLeft,10)+parseFloat(r.marginRight,10),n=t.offsetWidth+i;this.thumbnailWidth=t.offsetWidth,this.itemsPerRow=Math.floor(this.$refs.container.clientWidth/n);const c=Math.ceil(Ve.value.length/this.itemsPerRow)*this.itemHeight;this.$refs.container.style.height=`${c}px`,this.redrawThumbnails(),this.scrollToCurrentPage(!1)},redrawThumbnails(){const t=this.$el.scrollTop,r=Math.floor(t/this.itemHeight)*this.itemsPerRow+1,i=Math.ceil(this.$el.offsetHeight/this.itemHeight)*this.itemsPerRow,n=r+this.itemsPerRow+i,s=Math.min(Ve.value.length,n),c=[];for(let o=r-1;o<s;o+=1){const{resource:a}=Ve.value[o].images[0];if(a.service){const l=a.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",u=a.service["@id"];c.push({label:He(Ve.value[o].label)[0],imgUrl:`${u}${u.slice(-1)==="/"?"":"/"}full/${this.thumbnailWidth},/0/${l}.jpg`,page:o+1})}else c.push({label:He(Ve.value[o].label)[0],imgUrl:a["@id"],page:o+1})}this.items=c,this.$nextTick(()=>{const o=Math.floor(r/this.itemsPerRow);this.$refs.container.style.paddingTop=`${o*this.itemHeight}px`})},scrollToCurrentPage(t=!0){const e=Math.floor((B.pages[0]-1)/this.itemsPerRow)*this.itemHeight+(this.itemVMargin-50);t?Li(this.$el,e):this.$el.scrollTop=e},setPageAndSwitchView(t,r=!1){if(r){const e=B.pages.slice(0),i=e.indexOf(t);i<0?(e.push(t),e.sort((n,s)=>n-s),e[0]===0&&e.shift()):e.length>1&&e.splice(i,1),be({pages:e});return}ct(t),zt()&&be({view:"scan"})},touchStartTogglePage(t){this.lastScrollTop=this.$el.scrollTop,this.touchTimeout=setTimeout(()=>{this.$el.scrollTop===this.lastScrollTop&&this.setPageAndSwitchView(t,!0)},zu)},touchEnd(){clearTimeout(this.touchTimeout)},translate:Se}},Vu={class:"tify-sr-only"},Uu={ref:"container",class:"tify-thumbnails-list"},Wu=["onClick","onTouchstart"],ju=["src"],Gu={class:"tify-thumbnails-page"};function qu(t,r,e,i,n,s){return H(),D("section",{class:"tify-thumbnails",tabindex:"0",onScroll:r[1]||(r[1]=(...c)=>s.redrawThumbnails&&s.redrawThumbnails(...c))},[M("h2",Vu,U(s.translate("Pages")),1),M("div",Uu,[(H(!0),D(ae,null,Pe(n.items,c=>(H(),D("a",{key:c.page,class:_e(["tify-thumbnails-item",{"-current":n.options.pages.indexOf(c.page)>-1}]),href:"javascript:;",onClick:Mt(o=>s.setPageAndSwitchView(c.page,o.ctrlKey),["prevent"]),onTouchstart:o=>s.touchStartTogglePage(c.page),onTouchend:r[0]||(r[0]=(...o)=>s.touchEnd&&s.touchEnd(...o))},[M("img",{alt:"",src:c.imgUrl},null,8,ju),M("span",Gu,U(s.getPageLabel(c.page,c.label)),1)],42,Wu))),128))],512)],32)}const Zu=se(Nu,[["render",qu]]),Ku={data(){return{canvases:Ve,fulltextAvailable:!1,fulltexts:[],options:B}},computed:{pages(){return B.pages.filter(t=>!!t)}},watch:{"options.pages":function(){this.loadFulltexts()}},mounted(){this.loadFulltexts()},methods:{getPageLabel:hi,loadFulltexts(){this.fulltextAvailable=!1,this.fulltexts=[],B.pages.forEach(t=>{if(t<1||this.fulltexts[t])return;const r=ce.sequences[0].canvases[t-1];if(!("otherContent"in r))return;const e=r.otherContent[0]["@id"];di(e).then(i=>{const{resources:n}=i;Array.isArray(n)&&n.forEach((s,c)=>{const o=s.resource;if(o)if(this.fulltexts[t]||(this.fulltexts[t]=[]),o&&o.chars){const a=xt(o.chars);a&&(this.fulltextAvailable=!0),this.fulltexts[t][c]=a}else o["@id"]&&this.loadRemoteFulltext(t,c,o["@id"])})},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load annotations: ${n}`)})})},loadRemoteFulltext(t,r,e){Vn(e)&&_l(e).then(i=>{const n=xt(i);n&&(this.fulltextAvailable=!0),this.fulltexts[t]||(this.fulltexts[t]=[]),this.fulltexts[t][r]=n},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load fulltext: ${n}`)})},translate:Se}},Xu={class:"tify-fulltext",tabindex:"0"},Yu={class:"tify-sr-only"},Ju={key:0,class:"tify-fulltext-texts"},Qu=["innerHTML"],$u={key:1,class:"tify-fulltext-none"};function eh(t,r,e,i,n,s){return H(),D("section",Xu,[M("h2",Yu,U(s.translate("Fulltext")),1),n.fulltextAvailable?(H(),D("div",Ju,[(H(!0),D(ae,null,Pe(s.pages,c=>(H(),D("div",{key:c,class:"tify-fulltext-page"},[M("h3",null,U(s.translate("Page"))+" "+U(s.getPageLabel(c,n.canvases[c-1].label)),1),(H(!0),D(ae,null,Pe(n.fulltexts[c],(o,a)=>(H(),D("div",{key:`${c}-${a}`,class:"tify-fulltext-text",innerHTML:o},null,8,Qu))),128))]))),128))])):(H(),D("div",$u,U(s.translate("Fulltext not available for this page")),1))])}const th=se(Ku,[["render",eh]]),ih={},nh={class:"tify-icon",viewBox:"0 0 24 24"},sh=M("path",{d:"M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z"},null,-1),rh=[sh];function oh(t,r){return H(),D("svg",nh,rh)}const ah=se(ih,[["render",oh]]),lh={},ch={class:"tify-icon",viewBox:"0 0 24 24"},uh=M("path",{d:"M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M14.5,8A1.5,1.5 0 0,1 13,6.5A1.5,1.5 0 0,1 14.5,5A1.5,1.5 0 0,1 16,6.5A1.5,1.5 0 0,1 14.5,8M9.5,8A1.5,1.5 0 0,1 8,6.5A1.5,1.5 0 0,1 9.5,5A1.5,1.5 0 0,1 11,6.5A1.5,1.5 0 0,1 9.5,8M6.5,12A1.5,1.5 0 0,1 5,10.5A1.5,1.5 0 0,1 6.5,9A1.5,1.5 0 0,1 8,10.5A1.5,1.5 0 0,1 6.5,12M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A1.5,1.5 0 0,0 13.5,19.5C13.5,19.11 13.35,18.76 13.11,18.5C12.88,18.23 12.73,17.88 12.73,17.5A1.5,1.5 0 0,1 14.23,16H16A5,5 0 0,0 21,11C21,6.58 16.97,3 12,3Z"},null,-1),hh=[uh];function dh(t,r){return H(),D("svg",ch,hh)}const fh=se(lh,[["render",dh]]),ph={},gh={class:"tify-icon",viewBox:"0 0 24 24"},mh=M("path",{d:"M12,18V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"},null,-1),vh=[mh];function yh(t,r){return H(),D("svg",gh,vh)}const wh=se(ph,[["render",yh]]),_h={},xh={class:"tify-icon",viewBox:"0 0 24 24"},Th=M("path",{d:"M3.55 19.09L4.96 20.5L6.76 18.71L5.34 17.29M12 6C8.69 6 6 8.69 6 12S8.69 18 12 18 18 15.31 18 12C18 8.68 15.31 6 12 6M20 13H23V11H20M17.24 18.71L19.04 20.5L20.45 19.09L18.66 17.29M20.45 5L19.04 3.6L17.24 5.39L18.66 6.81M13 1H11V4H13M6.76 5.39L4.96 3.6L3.55 5L5.34 6.81L6.76 5.39M1 13H4V11H1M13 20H11V23H13"},null,-1),bh=[Th];function Eh(t,r){return H(),D("svg",xh,bh)}const Sh=se(_h,[["render",Eh]]),Ph={},Ch={class:"tify-icon",viewBox:"0 0 24 24"},Rh=M("path",{d:"M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"},null,-1),Hh=[Rh];function Lh(t,r){return H(),D("svg",Ch,Hh)}const Dh=se(Ph,[["render",Lh]]),Ih={},Mh={class:"tify-icon",viewBox:"0 0 24 24"},Oh=M("path",{d:"M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z"},null,-1),Fh=[Oh];function kh(t,r){return H(),D("svg",Mh,Fh)}const Ah=se(Ih,[["render",kh]]),Bh={},zh={class:"tify-icon",viewBox:"0 0 24 24"},Nh=M("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M5,8V10H13V8H5Z"},null,-1),Vh=[Nh];function Uh(t,r){return H(),D("svg",zh,Vh)}const Wh=se(Bh,[["render",Uh]]),jh={},Gh={class:"tify-icon",viewBox:"0 0 24 24"},qh=M("path",{d:"M19,12H17V15H14V17H19V12M7,9H10V7H5V12H7V9M21,3H3A2,2 0 0,0 1,5V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V5A2,2 0 0,0 21,3M21,19H3V5H21V19Z"},null,-1),Zh=[qh];function Kh(t,r){return H(),D("svg",Gh,Zh)}const Xh=se(jh,[["render",Kh]]),Yh={},Jh={class:"tify-icon",viewBox:"0 0 24 24"},Qh=M("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M8,5V8H5V10H8V13H10V10H13V8H10V5H8Z"},null,-1),$h=[Qh];function ed(t,r){return H(),D("svg",Jh,$h)}const td=se(Yh,[["render",ed]]),id={},nd={class:"tify-icon",viewBox:"0 0 24 24"},sd=M("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1),rd=[sd];function od(t,r){return H(),D("svg",nd,rd)}const Fr=se(id,[["render",od]]),ad={},ld={class:"tify-icon",viewBox:"0 0 24 24"},cd=M("path",{d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"},null,-1),ud=[cd];function hd(t,r){return H(),D("svg",ld,ud)}const kr=se(ad,[["render",hd]]);var wn={},dd={get exports(){return wn},set exports(t){wn=t}};(function(t){//! openseadragon 3.1.0
//! Built on 2022-06-07
//! Git commit: v3.1.0-1-c1c380f
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function r(e){return new r.Viewer(e)}(function(e){e.version={versionStr:"3.1.0",major:parseInt("3",10),minor:parseInt("1",10),revision:parseInt("0",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,s=Object.prototype.hasOwnProperty;e.isFunction=function(c){return e.type(c)==="function"},e.isArray=Array.isArray||function(c){return e.type(c)==="array"},e.isWindow=function(c){return c&&typeof c=="object"&&"setInterval"in c},e.type=function(c){return c==null?String(c):i[n.call(c)]||"object"},e.isPlainObject=function(c){if(!c||r.type(c)!=="object"||c.nodeType||e.isWindow(c)||c.constructor&&!s.call(c,"constructor")&&!s.call(c.constructor.prototype,"isPrototypeOf"))return!1;var o;for(var a in c)o=a;return o===void 0||s.call(c,o)},e.isEmptyObject=function(c){for(var o in c)return!1;return!0},e.freezeObject=function(c){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(o){return o},e.freezeObject(c)},e.supportsCanvas=function(){var c=document.createElement("canvas");return!!(e.isFunction(c.getContext)&&c.getContext("2d"))}(),e.isCanvasTainted=function(c){var o=!1;try{c.getContext("2d").getImageData(0,0,1,1)}catch{o=!0}return o},e.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),e.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),e.supportsEventListenerOptions=function(){var c=0;if(e.supportsAddEventListener)try{var o={get capture(){return c++,!1},get once(){return c++,!1},get passive(){return c++,!1}};window.addEventListener("test",null,o),window.removeEventListener("test",null,o)}catch{c=0}return c>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var c=document.createElement("canvas").getContext("2d"),o=window.devicePixelRatio||1,a=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1;return Math.max(o,1)/a}else return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(r),function(e){e.extend=function(){var a,l,u,d,f,w,y=arguments[0]||{},x=arguments.length,T=!1,S=1;for(typeof y=="boolean"&&(T=y,y=arguments[1]||{},S=2),typeof y!="object"&&!r.isFunction(y)&&(y={}),x===S&&(y=this,--S);S<x;S++)if(a=arguments[S],a!==null||a!==void 0)for(l in a)u=y[l],d=a[l],y!==d&&(T&&d&&(r.isPlainObject(d)||(f=r.isArray(d)))?(f?(f=!1,w=u&&r.isArray(u)?u:[]):w=u&&r.isPlainObject(u)?u:{},y[l]=r.extend(T,w,d)):d!==void 0&&(y[l]=d));return y};var i=function(){if(typeof navigator!="object")return!1;var a=navigator.userAgent;return typeof a!="string"?!1:a.indexOf("iPhone")!==-1||a.indexOf("iPad")!==-1||a.indexOf("iPod")!==-1};e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(a,l){return function(){var u=arguments;return u===void 0&&(u=[]),l.apply(a,u)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(a){return e._viewers.get(this.getElement(a))},getElement:function(a){return typeof a=="string"&&(a=document.getElementById(a)),a},getElementPosition:function(a){var l=new e.Point,u,d;for(a=e.getElement(a),u=e.getElementStyle(a).position==="fixed",d=o(a,u);d;)l.x+=a.offsetLeft,l.y+=a.offsetTop,u&&(l=l.plus(e.getPageScroll())),a=d,u=e.getElementStyle(a).position==="fixed",d=o(a,u);return l},getElementOffset:function(a){a=e.getElement(a);var l=a&&a.ownerDocument,u,d,f={top:0,left:0};return l?(u=l.documentElement,typeof a.getBoundingClientRect<"u"&&(f=a.getBoundingClientRect()),d=l===l.window?l:l.nodeType===9?l.defaultView||l.parentWindow:!1,new e.Point(f.left+(d.pageXOffset||u.scrollLeft)-(u.clientLeft||0),f.top+(d.pageYOffset||u.scrollTop)-(u.clientTop||0))):new e.Point},getElementSize:function(a){return a=e.getElement(a),new e.Point(a.clientWidth,a.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(a){return a=e.getElement(a),a.currentStyle}:function(a){return a=e.getElement(a),window.getComputedStyle(a,"")},getCssPropertyWithVendorPrefix:function(a){var l={};return e.getCssPropertyWithVendorPrefix=function(u){if(l[u]!==void 0)return l[u];var d=document.createElement("div").style,f=null;if(d[u]!==void 0)f=u;else for(var w=["Webkit","Moz","MS","O","webkit","moz","ms","o"],y=e.capitalizeFirstLetter(u),x=0;x<w.length;x++){var T=w[x]+y;if(d[T]!==void 0){f=T;break}}return l[u]=f,f},e.getCssPropertyWithVendorPrefix(a)},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},positiveModulo:function(a,l){var u=a%l;return u<0&&(u+=l),u},pointInElement:function(a,l){a=e.getElement(a);var u=e.getElementOffset(a),d=e.getElementSize(a);return l.x>=u.x&&l.x<u.x+d.x&&l.y<u.y+d.y&&l.y>=u.y},getMousePosition:function(a){if(typeof a.pageX=="number")e.getMousePosition=function(l){var u=new e.Point;return u.x=l.pageX,u.y=l.pageY,u};else if(typeof a.clientX=="number")e.getMousePosition=function(l){var u=new e.Point;return u.x=l.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,u.y=l.clientY+document.body.scrollTop+document.documentElement.scrollTop,u};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(a)},getPageScroll:function(){var a=document.documentElement||{},l=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(l.scrollLeft||l.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(a.scrollLeft||a.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(a){if(typeof window.scrollTo<"u")e.setPageScroll=function(d){window.scrollTo(d.x,d.y)};else{var l=e.getPageScroll();if(l.x===a.x&&l.y===a.y)return;document.body.scrollLeft=a.x,document.body.scrollTop=a.y;var u=e.getPageScroll();if(u.x!==l.x&&u.y!==l.y){e.setPageScroll=function(d){document.body.scrollLeft=d.x,document.body.scrollTop=d.y};return}if(document.documentElement.scrollLeft=a.x,document.documentElement.scrollTop=a.y,u=e.getPageScroll(),u.x!==l.x&&u.y!==l.y){e.setPageScroll=function(d){document.documentElement.scrollLeft=d.x,document.documentElement.scrollTop=d.y};return}e.setPageScroll=function(d){}}e.setPageScroll(a)},getWindowSize:function(){var a=document.documentElement||{},l=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(a.clientWidth||a.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(l.clientWidth||l.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(a){a=e.getElement(a);var l=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(l[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(l[1].style,{display:"table-row"}),e.extend(l[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),l[0].appendChild(l[1]),l[1].appendChild(l[2]),l[2].appendChild(a),l[0]},makeNeutralElement:function(a){var l=document.createElement(a),u=l.style;return u.background="transparent none",u.border="none",u.margin="0px",u.padding="0px",u.position="static",l},now:function(){return Date.now?e.now=Date.now:e.now=function(){return new Date().getTime()},e.now()},makeTransparentImage:function(a){var l=e.makeNeutralElement("img");return l.src=a,l},setElementOpacity:function(a,l,u){var d,f;a=e.getElement(a),u&&!e.Browser.alpha&&(l=Math.round(l)),e.Browser.opacity?a.style.opacity=l<1?l:"":l<1?(d=Math.round(100*l),f="alpha(opacity="+d+")",a.style.filter=f):a.style.filter=""},setElementTouchActionNone:function(a){a=e.getElement(a),typeof a.style.touchAction<"u"?a.style.touchAction="none":typeof a.style.msTouchAction<"u"&&(a.style.msTouchAction="none")},setElementPointerEvents:function(a,l){a=e.getElement(a),typeof a.style<"u"&&typeof a.style.pointerEvents<"u"&&(a.style.pointerEvents=l)},setElementPointerEventsNone:function(a){e.setElementPointerEvents(a,"none")},addClass:function(a,l){a=e.getElement(a),a.className?(" "+a.className+" ").indexOf(" "+l+" ")===-1&&(a.className+=" "+l):a.className=l},indexOf:function(a,l,u){return Array.prototype.indexOf?this.indexOf=function(d,f,w){return d.indexOf(f,w)}:this.indexOf=function(d,f,w){var y,x=w||0,T;if(!d)throw new TypeError;if(T=d.length,T===0||x>=T)return-1;for(x<0&&(x=T-Math.abs(x)),y=x;y<T;y++)if(d[y]===f)return y;return-1},this.indexOf(a,l,u)},removeClass:function(a,l){var u,d=[],f;for(a=e.getElement(a),u=a.className.split(/\s+/),f=0;f<u.length;f++)u[f]&&u[f]!==l&&d.push(u[f]);a.className=d.join(" ")},normalizeEventListenerOptions:function(a){var l;return typeof a<"u"?typeof a=="boolean"?l=e.supportsEventListenerOptions?{capture:a}:a:l=e.supportsEventListenerOptions?a:typeof a.capture<"u"?a.capture:!1:l=e.supportsEventListenerOptions?{capture:!1}:!1,l},addEvent:function(){if(e.supportsAddEventListener)return function(a,l,u,d){d=e.normalizeEventListenerOptions(d),a=e.getElement(a),a.addEventListener(l,u,d)};if(document.documentElement.attachEvent&&document.attachEvent)return function(a,l,u){a=e.getElement(a),a.attachEvent("on"+l,u)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(a,l,u,d){d=e.normalizeEventListenerOptions(d),a=e.getElement(a),a.removeEventListener(l,u,d)};if(document.documentElement.detachEvent&&document.detachEvent)return function(a,l,u){a=e.getElement(a),a.detachEvent("on"+l,u)};throw new Error("No known event model.")}(),cancelEvent:function(a){a.preventDefault()},eventIsCanceled:function(a){return a.defaultPrevented},stopEvent:function(a){a.stopPropagation()},createCallback:function(a,l){var u=[],d;for(d=2;d<arguments.length;d++)u.push(arguments[d]);return function(){var f=u.concat([]),w;for(w=0;w<arguments.length;w++)f.push(arguments[w]);return l.apply(a,f)}},getUrlParameter:function(a){var l=c[a];return l||null},getUrlProtocol:function(a){var l=a.match(/^([a-z]+:)\/\//i);return l===null?window.location.protocol:l[1].toLowerCase()},createAjaxRequest:function(a){var l;try{l=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{l=!1}if(l)window.XMLHttpRequest?e.createAjaxRequest=function(u){return u?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:e.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return e.createAjaxRequest(a)},makeAjaxRequest:function(a,l,u){var d,f,w,y;e.isPlainObject(a)&&(l=a.success,u=a.error,d=a.withCredentials,f=a.headers,w=a.responseType||null,y=a.postData||null,a=a.url);var x=e.getUrlProtocol(a),T=e.createAjaxRequest(x==="file:");if(!e.isFunction(l))throw new Error("makeAjaxRequest requires a success callback");T.onreadystatechange=function(){T.readyState===4&&(T.onreadystatechange=function(){},T.status>=200&&T.status<300||T.status===0&&x!=="http:"&&x!=="https:"?l(T):e.isFunction(u)?u(T):e.console.error("AJAX request returned %d: %s",T.status,a))};var S=y?"POST":"GET";try{if(T.open(S,a,!0),w&&(T.responseType=w),f)for(var L in f)Object.prototype.hasOwnProperty.call(f,L)&&f[L]&&T.setRequestHeader(L,f[L]);d&&(T.withCredentials=!0),T.send(y)}catch(I){e.console.error("%s while making AJAX request: %s",I.name,I.message),T.onreadystatechange=function(){},e.isFunction(u)&&u(T,I)}return T},jsonp:function(a){var l,u=a.url,d=document.head||document.getElementsByTagName("head")[0]||document.documentElement,f=a.callbackName||"openseadragon"+e.now(),w=window[f],y="$1"+f+"$2",x=a.param||"callback",T=a.callback;u=u.replace(/(=)\?(&|$)|\?\?/i,y),u+=(/\?/.test(u)?"&":"?")+x+"="+f,window[f]=function(S){if(w)window[f]=w;else try{delete window[f]}catch{}T&&e.isFunction(T)&&T(S)},l=document.createElement("script"),(a.async!==void 0||a.async!==!1)&&(l.async="async"),a.scriptCharset&&(l.charset=a.scriptCharset),l.src=u,l.onload=l.onreadystatechange=function(S,L){(L||!l.readyState||/loaded|complete/.test(l.readyState))&&(l.onload=l.onreadystatechange=null,d&&l.parentNode&&d.removeChild(l),l=void 0)},d.insertBefore(l,d.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(a){if(window.DOMParser)e.parseXml=function(l){var u=null,d;return d=new DOMParser,u=d.parseFromString(l,"text/xml"),u};else if(window.ActiveXObject)e.parseXml=function(l){var u=null;return u=new ActiveXObject("Microsoft.XMLDOM"),u.async=!1,u.loadXML(l),u};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(a)},parseJSON:function(a){return e.parseJSON=window.JSON.parse,e.parseJSON(a)},imageFormatSupported:function(a){return a=a||"",!!s[a.toLowerCase()]},setImageFormatsSupported:function(a){e.extend(s,a)}});var n=function(a){};e.console=window.console||{log:n,debug:n,info:n,warn:n,error:n,assert:n},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var s={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},c={};(function(){var a=navigator.appVersion,l=navigator.userAgent,u;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(l.substring(l.indexOf("MSIE")+5,l.indexOf(";",l.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(l.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(l.substring(l.indexOf("Edge")+5))):l.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(l.substring(l.indexOf("Edg")+4))):l.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(l.substring(l.indexOf("Firefox")+8))):l.indexOf("Safari")>=0?(e.Browser.vendor=l.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(l.substring(l.substring(0,l.indexOf("Safari")).lastIndexOf("/")+1,l.indexOf("Safari")))):(u=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),u.exec(l)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(a);break}var d=window.location.search.substring(1),f=d.split("&"),w,y,x;for(x=0;x<f.length;x++)if(w=f[x],y=w.indexOf("="),y>0){var T=w.substring(0,y),S=w.substring(y+1);try{c[T]=decodeURIComponent(S)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",T,S)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(a){var l=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,u=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame;if(l&&u)e.requestAnimationFrame=function(){return l.apply(a,arguments)},e.cancelAnimationFrame=function(){return u.apply(a,arguments)};else{var d=[],f=[],w=0,y;e.requestAnimationFrame=function(x){return d.push([++w,x]),y||(y=setInterval(function(){if(d.length){var T=e.now(),S=f;for(f=d,d=S;f.length;)f.shift()[1](T)}else clearInterval(y),y=void 0},1e3/50)),w},e.cancelAnimationFrame=function(x){var T,S;for(T=0,S=d.length;T<S;T+=1)if(d[T][0]===x){d.splice(T,1);return}for(T=0,S=f.length;T<S;T+=1)if(f[T][0]===x){f.splice(T,1);return}}}}(window);function o(a,l){return l&&a!==document.body?document.body:a.offsetParent}}(r),function(e,i){t.exports?t.exports=i():e.OpenSeadragon=i()}(zn,function(){return r}),function(e){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(n){return n.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(n){return n.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(n){return n.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},e.extend(e,i)}(r),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(i,n,s,c){var o=this;c=c||1;var a=0,l=function(u){a++,a===c&&o.removeHandler(i,l),n(u)};this.addHandler(i,l,s)},addHandler:function(i,n,s){var c=this.events[i];c||(this.events[i]=c=[]),n&&e.isFunction(n)&&(c[c.length]={handler:n,userData:s||null})},removeHandler:function(i,n){var s=this.events[i],c=[],o;if(s&&e.isArray(s)){for(o=0;o<s.length;o++)s[o].handler!==n&&c.push(s[o]);this.events[i]=c}},numberOfHandlers:function(i){var n=this.events[i];return n?n.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var n in this.events)this.events[n]=[]},getHandler:function(i){var n=this.events[i];return!n||!n.length?null:(n=n.length===1?[n[0]]:Array.apply(null,n),function(s,c){var o,a=n.length;for(o=0;o<a;o++)n[o]&&(c.eventSource=s,c.userData=n[o].userData,n[o].handler(c))})},raiseEvent:function(i,n){var s=this.getHandler(i);s&&(n||(n={}),s(this,n))}}}(r),function(e){var i={};e.MouseTracker=function(g){var p=arguments;e.isPlainObject(g)||(g={element:p[0],clickTimeThreshold:p[1],clickDistThreshold:p[2]}),this.hash=Math.random(),this.element=e.getElement(g.element),this.clickTimeThreshold=g.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=g.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=g.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=g.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=g.userData||null,this.stopDelay=g.stopDelay||50,this.preProcessEventHandler=g.preProcessEventHandler||null,this.contextMenuHandler=g.contextMenuHandler||null,this.enterHandler=g.enterHandler||null,this.leaveHandler=g.leaveHandler||null,this.exitHandler=g.exitHandler||null,this.overHandler=g.overHandler||null,this.outHandler=g.outHandler||null,this.pressHandler=g.pressHandler||null,this.nonPrimaryPressHandler=g.nonPrimaryPressHandler||null,this.releaseHandler=g.releaseHandler||null,this.nonPrimaryReleaseHandler=g.nonPrimaryReleaseHandler||null,this.moveHandler=g.moveHandler||null,this.scrollHandler=g.scrollHandler||null,this.clickHandler=g.clickHandler||null,this.dblClickHandler=g.dblClickHandler||null,this.dragHandler=g.dragHandler||null,this.dragEndHandler=g.dragEndHandler||null,this.pinchHandler=g.pinchHandler||null,this.stopHandler=g.stopHandler||null,this.keyDownHandler=g.keyDownHandler||null,this.keyUpHandler=g.keyUpHandler||null,this.keyHandler=g.keyHandler||null,this.focusHandler=g.focusHandler||null,this.blurHandler=g.blurHandler||null;var v=this;i[this.hash]={click:function(_){I(v,_)},dblclick:function(_){j(v,_)},keydown:function(_){Y(v,_)},keyup:function(_){Q(v,_)},keypress:function(_){ie(v,_)},focus:function(_){J(v,_)},blur:function(_){ee(v,_)},contextmenu:function(_){K(v,_)},wheel:function(_){we(v,_)},mousewheel:function(_){ve(v,_)},DOMMouseScroll:function(_){ve(v,_)},MozMousePixelScroll:function(_){ve(v,_)},losecapture:function(_){We(v,_)},mouseenter:function(_){St(v,_)},mouseleave:function(_){mt(v,_)},mouseover:function(_){Vt(v,_)},mouseout:function(_){ze(v,_)},mousedown:function(_){dt(v,_)},mouseup:function(_){Pt(v,_)},mousemove:function(_){yt(v,_)},touchstart:function(_){ht(v,_)},touchend:function(_){me(v,_)},touchmove:function(_){pe(v,_)},touchcancel:function(_){de(v,_)},gesturestart:function(_){Ae(v,_)},gesturechange:function(_){ne(v,_)},gotpointercapture:function(_){Xe(v,_)},lostpointercapture:function(_){Be(v,_)},pointerenter:function(_){St(v,_)},pointerleave:function(_){mt(v,_)},pointerover:function(_){Vt(v,_)},pointerout:function(_){ze(v,_)},pointerdown:function(_){dt(v,_)},pointerup:function(_){Pt(v,_)},pointermove:function(_){yt(v,_)},pointercancel:function(_){h(v,_)},pointerupcaptured:function(_){it(v,_)},pointermovecaptured:function(_){E(v,_)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),g.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){a(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(g){return g?o(this):a(this),this},getActivePointersListByType:function(g){var p=i[this.hash],v,_=p.activePointersLists.length,k;for(v=0;v<_;v++)if(p.activePointersLists[v].type===g)return p.activePointersLists[v];return k=new e.MouseTracker.GesturePointList(g),p.activePointersLists.push(k),k},getActivePointerCount:function(){var g=i[this.hash],p,v=g.activePointersLists.length,_=0;for(p=0;p<v;p++)_+=g.activePointersLists[p].getLength();return _},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var n=function(){try{return window.self!==window.top}catch{return!0}}();function s(g){try{return g.addEventListener&&g.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=function(){var g=[],p=0,v=0,_=function(le,$){return le.hash.toString()+$.type+$.id.toString()},k=function(){var le,$=g.length,je,Re,Ut=e.now(),jn,Gn,qn;for(jn=Ut-v,v=Ut,le=0;le<$;le++)je=g[le],Re=je.gPoint,Re.direction=Math.atan2(Re.currentPos.y-je.lastPos.y,Re.currentPos.x-je.lastPos.x),Gn=je.lastPos.distanceTo(Re.currentPos),je.lastPos=Re.currentPos,qn=1e3*Gn/(jn+1),Re.speed=.75*qn+.25*Re.speed},N=function(le,$){var je=_(le,$);g.push({guid:je,gPoint:$,lastPos:$.currentPos}),g.length===1&&(v=e.now(),p=window.setInterval(k,50))},Z=function(le,$){var je=_(le,$),Re,Ut=g.length;for(Re=0;Re<Ut;Re++)if(g[Re].guid===je){g.splice(Re,1),Ut--,Ut===0&&window.clearInterval(p);break}};return{addPoint:N,removePoint:Z}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=function(){var g=document.createElement("div");return e.isFunction(g.setPointerCapture)&&e.isFunction(g.releasePointerCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var g=document.createElement("div");return e.isFunction(g.setCapture)&&e.isFunction(g.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(g){this._gPoints=[],this.type=g,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(g){return this._gPoints.push(g)},removeById:function(g){var p,v=this._gPoints.length;for(p=0;p<v;p++)if(this._gPoints[p].id===g){this._gPoints.splice(p,1);break}return this._gPoints.length},getByIndex:function(g){return g<this._gPoints.length?this._gPoints[g]:null},getById:function(g){var p,v=this._gPoints.length;for(p=0;p<v;p++)if(this._gPoints[p].id===g)return this._gPoints[p];return null},getPrimary:function(g){var p,v=this._gPoints.length;for(p=0;p<v;p++)if(this._gPoints[p].isPrimary)return this._gPoints[p];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function c(g){var p=i[g.hash],v,_,k,N,Z,le=p.activePointersLists.length;for(v=0;v<le;v++)if(k=p.activePointersLists[v],k.getLength()>0){for(Z=[],N=k.asArray(),_=0;_<N.length;_++)Z.push(N[_]);for(_=0;_<Z.length;_++)b(g,k,Z[_])}for(v=0;v<le;v++)p.activePointersLists.pop();p.sentDragEvent=!1}function o(g){var p=i[g.hash],v,_;if(!p.tracking){for(_=0;_<e.MouseTracker.subscribeEvents.length;_++)v=e.MouseTracker.subscribeEvents[_],e.addEvent(g.element,v,p[v],v===e.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);c(g),p.tracking=!0}}function a(g){var p=i[g.hash],v,_;if(p.tracking){for(_=0;_<e.MouseTracker.subscribeEvents.length;_++)v=e.MouseTracker.subscribeEvents[_],e.removeEvent(g.element,v,p[v],!1);c(g),p.tracking=!1}}function l(g,p){var v=i[g.hash];if(p==="pointerevent")return{upName:"pointerup",upHandler:v.pointerupcaptured,moveName:"pointermove",moveHandler:v.pointermovecaptured};if(p==="mouse")return{upName:"pointerup",upHandler:v.pointerupcaptured,moveName:"pointermove",moveHandler:v.pointermovecaptured};if(p==="touch")return{upName:"touchend",upHandler:v.touchendcaptured,moveName:"touchmove",moveHandler:v.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function u(g,p){var v;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{g.element.setPointerCapture(p.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else g.element.setCapture(!0);else v=l(g,e.MouseTracker.havePointerEvents?"pointerevent":p.type),n&&s(window.top)&&e.addEvent(window.top,v.upName,v.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,v.upName,v.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,v.moveName,v.moveHandler,!0);F(g,p,!0)}function d(g,p){var v,_,k;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(_=g.getActivePointersListByType(p.type),k=_.getById(p.id),!k||!k.captured)return;try{g.element.releasePointerCapture(p.id)}catch{}}else g.element.releaseCapture();else v=l(g,e.MouseTracker.havePointerEvents?"pointerevent":p.type),n&&s(window.top)&&e.removeEvent(window.top,v.upName,v.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,v.moveName,v.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,v.upName,v.upHandler,!0);F(g,p,!1)}function f(g){return e.MouseTracker.havePointerEvents?g.pointerId:e.MouseTracker.mousePointerId}function w(g){return e.MouseTracker.havePointerEvents?g.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function y(g){return e.MouseTracker.havePointerEvents?g.isPrimary:!0}function x(g){return e.getMousePosition(g)}function T(g,p){return S(x(g),p)}function S(g,p){var v=e.getElementOffset(p);return g.minus(v)}function L(g,p){return new e.Point((g.x+p.x)/2,(g.y+p.y)/2)}function I(g,p){var v={originalEvent:p,eventType:"click",pointerType:"mouse",isEmulated:!1};C(g,v),v.preventDefault&&!v.defaultPrevented&&e.cancelEvent(p),v.stopPropagation&&e.stopEvent(p)}function j(g,p){var v={originalEvent:p,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};C(g,v),v.preventDefault&&!v.defaultPrevented&&e.cancelEvent(p),v.stopPropagation&&e.stopEvent(p)}function Y(g,p){var v=null,_={originalEvent:p,eventType:"keydown",pointerType:"",isEmulated:!1};C(g,_),g.keyDownHandler&&!_.preventGesture&&!_.defaultPrevented&&(v={eventSource:g,keyCode:p.keyCode?p.keyCode:p.charCode,ctrl:p.ctrlKey,shift:p.shiftKey,alt:p.altKey,meta:p.metaKey,originalEvent:p,preventDefault:_.preventDefault||_.defaultPrevented,userData:g.userData},g.keyDownHandler(v)),(v&&v.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p)}function Q(g,p){var v=null,_={originalEvent:p,eventType:"keyup",pointerType:"",isEmulated:!1};C(g,_),g.keyUpHandler&&!_.preventGesture&&!_.defaultPrevented&&(v={eventSource:g,keyCode:p.keyCode?p.keyCode:p.charCode,ctrl:p.ctrlKey,shift:p.shiftKey,alt:p.altKey,meta:p.metaKey,originalEvent:p,preventDefault:_.preventDefault||_.defaultPrevented,userData:g.userData},g.keyUpHandler(v)),(v&&v.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p)}function ie(g,p){var v=null,_={originalEvent:p,eventType:"keypress",pointerType:"",isEmulated:!1};C(g,_),g.keyHandler&&!_.preventGesture&&!_.defaultPrevented&&(v={eventSource:g,keyCode:p.keyCode?p.keyCode:p.charCode,ctrl:p.ctrlKey,shift:p.shiftKey,alt:p.altKey,meta:p.metaKey,originalEvent:p,preventDefault:_.preventDefault||_.defaultPrevented,userData:g.userData},g.keyHandler(v)),(v&&v.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p)}function J(g,p){var v={originalEvent:p,eventType:"focus",pointerType:"",isEmulated:!1};C(g,v),g.focusHandler&&!v.preventGesture&&g.focusHandler({eventSource:g,originalEvent:p,userData:g.userData})}function ee(g,p){var v={originalEvent:p,eventType:"blur",pointerType:"",isEmulated:!1};C(g,v),g.blurHandler&&!v.preventGesture&&g.blurHandler({eventSource:g,originalEvent:p,userData:g.userData})}function K(g,p){var v=null,_={originalEvent:p,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};C(g,_),g.contextMenuHandler&&!_.preventGesture&&!_.defaultPrevented&&(v={eventSource:g,position:S(x(p),g.element),originalEvent:_.originalEvent,preventDefault:_.preventDefault||_.defaultPrevented,userData:g.userData},g.contextMenuHandler(v)),(v&&v.preventDefault||_.preventDefault&&!_.defaultPrevented)&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p)}function we(g,p){Ke(g,p,p)}function ve(g,p){var v={target:p.target||p.srcElement,type:"wheel",shiftKey:p.shiftKey||!1,clientX:p.clientX,clientY:p.clientY,pageX:p.pageX?p.pageX:p.clientX,pageY:p.pageY?p.pageY:p.clientY,deltaMode:p.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?v.deltaY=-p.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:v.deltaY=p.detail,Ke(g,v,p)}function Ke(g,p,v){var _=0,k,N=null;_=p.deltaY<0?1:-1,k={originalEvent:p,eventType:"wheel",pointerType:"mouse",isEmulated:p!==v},C(g,k),g.scrollHandler&&!k.preventGesture&&!k.defaultPrevented&&(N={eventSource:g,pointerType:"mouse",position:T(p,g.element),scroll:_,shift:p.shiftKey,isTouchEvent:!1,originalEvent:v,preventDefault:k.preventDefault||k.defaultPrevented,userData:g.userData},g.scrollHandler(N)),k.stopPropagation&&e.stopEvent(v),(N&&N.preventDefault||k.preventDefault&&!k.defaultPrevented)&&e.cancelEvent(v)}function We(g,p){var v={id:e.MouseTracker.mousePointerId,type:"mouse"},_={originalEvent:p,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};C(g,_),p.target===g.element&&F(g,v,!1),_.stopPropagation&&e.stopEvent(p)}function ht(g,p){var v,_,k=p.changedTouches.length,N,Z=g.getActivePointersListByType("touch");v=e.now(),Z.getLength()>p.touches.length-k&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var le={originalEvent:p,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(C(g,le),_=0;_<k;_++)N={id:p.changedTouches[_].identifier,type:"touch",isPrimary:Z.getLength()===0,currentPos:x(p.changedTouches[_]),currentTime:v},O(g,le,N),z(g,le,N,0),F(g,N,!0);le.preventDefault&&!le.defaultPrevented&&e.cancelEvent(p),le.stopPropagation&&e.stopEvent(p)}function me(g,p){var v,_,k=p.changedTouches.length,N;v=e.now();var Z={originalEvent:p,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(C(g,Z),_=0;_<k;_++)N={id:p.changedTouches[_].identifier,type:"touch",currentPos:x(p.changedTouches[_]),currentTime:v},G(g,Z,N,0),F(g,N,!1),A(g,Z,N);Z.preventDefault&&!Z.defaultPrevented&&e.cancelEvent(p),Z.stopPropagation&&e.stopEvent(p)}function pe(g,p){var v,_,k=p.changedTouches.length,N;v=e.now();var Z={originalEvent:p,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(C(g,Z),_=0;_<k;_++)N={id:p.changedTouches[_].identifier,type:"touch",currentPos:x(p.changedTouches[_]),currentTime:v},q(g,Z,N);Z.preventDefault&&!Z.defaultPrevented&&e.cancelEvent(p),Z.stopPropagation&&e.stopEvent(p)}function de(g,p){var v=p.changedTouches.length,_,k,N={originalEvent:p,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(C(g,N),_=0;_<v;_++)k={id:p.changedTouches[_].identifier,type:"touch"},re(g,N,k);N.stopPropagation&&e.stopEvent(p)}function Ae(g,p){return e.eventIsCanceled(p)||p.preventDefault(),!1}function ne(g,p){return e.eventIsCanceled(p)||p.preventDefault(),!1}function Xe(g,p){var v={originalEvent:p,eventType:"gotpointercapture",pointerType:w(p),isEmulated:!1};C(g,v),p.target===g.element&&F(g,{id:p.pointerId,type:w(p)},!0),v.stopPropagation&&e.stopEvent(p)}function Be(g,p){var v={originalEvent:p,eventType:"lostpointercapture",pointerType:w(p),isEmulated:!1};C(g,v),p.target===g.element&&F(g,{id:p.pointerId,type:w(p)},!1),v.stopPropagation&&e.stopEvent(p)}function St(g,p){var v={id:f(p),type:w(p),isPrimary:y(p),currentPos:x(p),currentTime:e.now()},_={originalEvent:p,eventType:"pointerenter",pointerType:v.type,isEmulated:!1};C(g,_),O(g,_,v)}function mt(g,p){var v={id:f(p),type:w(p),isPrimary:y(p),currentPos:x(p),currentTime:e.now()},_={originalEvent:p,eventType:"pointerleave",pointerType:v.type,isEmulated:!1};C(g,_),A(g,_,v)}function Vt(g,p){var v={id:f(p),type:w(p),isPrimary:y(p),currentPos:x(p),currentTime:e.now()},_={originalEvent:p,eventType:"pointerover",pointerType:v.type,isEmulated:!1};C(g,_),W(g,_,v),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p)}function ze(g,p){var v={id:f(p),type:w(p),isPrimary:y(p),currentPos:x(p),currentTime:e.now()},_={originalEvent:p,eventType:"pointerout",pointerType:v.type,isEmulated:!1};C(g,_),V(g,_,v),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p)}function dt(g,p){var v={id:f(p),type:w(p),isPrimary:y(p),currentPos:x(p),currentTime:e.now()},_=e.MouseTracker.havePointerEvents&&v.type==="touch"&&e.Browser.vendor!==e.BROWSERS.IE,k={originalEvent:p,eventType:"pointerdown",pointerType:v.type,isEmulated:!1};C(g,k),z(g,k,v,p.button),k.preventDefault&&!k.defaultPrevented&&e.cancelEvent(p),k.stopPropagation&&e.stopEvent(p),k.shouldCapture&&(_?F(g,v,!0):u(g,v))}function Pt(g,p){vt(g,p)}function it(g,p){var v=g.getActivePointersListByType(w(p));v.getById(p.pointerId)&&vt(g,p),e.stopEvent(p)}function vt(g,p){var v;v={id:f(p),type:w(p),isPrimary:y(p),currentPos:x(p),currentTime:e.now()};var _={originalEvent:p,eventType:"pointerup",pointerType:v.type,isEmulated:!1};C(g,_),G(g,_,v,p.button),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p),_.shouldReleaseCapture&&(p.target===g.element?d(g,v):F(g,v,!1))}function yt(g,p){P(g,p)}function E(g,p){var v=g.getActivePointersListByType(w(p));v.getById(p.pointerId)&&P(g,p),e.stopEvent(p)}function P(g,p){var v={id:f(p),type:w(p),isPrimary:y(p),currentPos:x(p),currentTime:e.now()},_={originalEvent:p,eventType:"pointermove",pointerType:v.type,isEmulated:!1};C(g,_),q(g,_,v),_.preventDefault&&!_.defaultPrevented&&e.cancelEvent(p),_.stopPropagation&&e.stopEvent(p)}function h(g,p){var v={id:p.pointerId,type:w(p)},_={originalEvent:p,eventType:"pointercancel",pointerType:v.type,isEmulated:!1};C(g,_),re(g,_,v),_.stopPropagation&&e.stopEvent(p)}function m(g,p){return p.speed=0,p.direction=0,p.contactPos=p.currentPos,p.contactTime=p.currentTime,p.lastPos=p.currentPos,p.lastTime=p.currentTime,g.add(p)}function b(g,p,v){var _,k=p.getById(v.id);return k?(k.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),d(g,k)),p.removeContact(),_=p.removeById(v.id)):_=p.getLength(),_}function R(g,p){switch(p.eventType){case"pointermove":p.isStoppable=!0,p.isCancelable=!0,p.preventDefault=!1,p.preventGesture=!g.hasGestureHandlers,p.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":p.isStoppable=!0,p.isCancelable=!0,p.preventDefault=!1,p.preventGesture=!1,p.stopPropagation=!1;break;case"pointerdown":p.isStoppable=!0,p.isCancelable=!0,p.preventDefault=!1,p.preventGesture=!g.hasGestureHandlers,p.stopPropagation=!1;break;case"pointerup":p.isStoppable=!0,p.isCancelable=!0,p.preventDefault=!1,p.preventGesture=!g.hasGestureHandlers,p.stopPropagation=!1;break;case"wheel":p.isStoppable=!0,p.isCancelable=!0,p.preventDefault=!1,p.preventGesture=!g.hasScrollHandler,p.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":p.isStoppable=!0,p.isCancelable=!1,p.preventDefault=!1,p.preventGesture=!1,p.stopPropagation=!1;break;case"click":p.isStoppable=!0,p.isCancelable=!0,p.preventDefault=!!g.clickHandler,p.preventGesture=!1,p.stopPropagation=!1;break;case"dblclick":p.isStoppable=!0,p.isCancelable=!0,p.preventDefault=!!g.dblClickHandler,p.preventGesture=!1,p.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:p.isStoppable=!1,p.isCancelable=!1,p.preventDefault=!1,p.preventGesture=!1,p.stopPropagation=!1;break}}function C(g,p){p.eventSource=g,p.eventPhase=p.originalEvent&&typeof p.originalEvent.eventPhase<"u"?p.originalEvent.eventPhase:0,p.defaultPrevented=e.eventIsCanceled(p.originalEvent),p.shouldCapture=!1,p.shouldReleaseCapture=!1,p.userData=g.userData,R(g,p),g.preProcessEventHandler&&g.preProcessEventHandler(p)}function F(g,p,v){var _=g.getActivePointersListByType(p.type),k=_.getById(p.id);k?v&&!k.captured?(k.captured=!0,_.captureCount++):!v&&k.captured&&(k.captured=!1,_.captureCount--,_.captureCount<0&&(_.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function O(g,p,v){var _=g.getActivePointersListByType(v.type),k;k=_.getById(v.id),k?(k.insideElement=!0,k.lastPos=k.currentPos,k.lastTime=k.currentTime,k.currentPos=v.currentPos,k.currentTime=v.currentTime,v=k):(v.captured=!1,v.insideElementPressed=!1,v.insideElement=!0,m(_,v)),g.enterHandler&&g.enterHandler({eventSource:g,pointerType:v.type,position:S(v.currentPos,g.element),buttons:_.buttons,pointers:g.getActivePointerCount(),insideElementPressed:v.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData})}function A(g,p,v){var _=g.getActivePointersListByType(v.type),k,N;k=_.getById(v.id),k?(k.captured?(k.insideElement=!1,k.lastPos=k.currentPos,k.lastTime=k.currentTime,k.currentPos=v.currentPos,k.currentTime=v.currentTime):b(g,_,k),v=k):(v.captured=!1,v.insideElementPressed=!1),(g.leaveHandler||g.exitHandler)&&(N={eventSource:g,pointerType:v.type,position:v.currentPos&&S(v.currentPos,g.element),buttons:_.buttons,pointers:g.getActivePointerCount(),insideElementPressed:v.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData},g.leaveHandler&&g.leaveHandler(N),g.exitHandler&&g.exitHandler(N))}function W(g,p,v){var _,k;_=g.getActivePointersListByType(v.type),k=_.getById(v.id),k?v=k:(v.captured=!1,v.insideElementPressed=!1),g.overHandler&&g.overHandler({eventSource:g,pointerType:v.type,position:S(v.currentPos,g.element),buttons:_.buttons,pointers:g.getActivePointerCount(),insideElementPressed:v.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData})}function V(g,p,v){var _,k;_=g.getActivePointersListByType(v.type),k=_.getById(v.id),k?v=k:(v.captured=!1,v.insideElementPressed=!1),g.outHandler&&g.outHandler({eventSource:g,pointerType:v.type,position:v.currentPos&&S(v.currentPos,g.element),buttons:_.buttons,pointers:g.getActivePointerCount(),insideElementPressed:v.insideElementPressed,buttonDownAny:_.buttons!==0,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData})}function z(g,p,v,_){var k=i[g.hash],N=g.getActivePointersListByType(v.type),Z;if(typeof p.originalEvent.buttons<"u"?N.buttons=p.originalEvent.buttons:_===0?N.buttons|=1:_===1?N.buttons|=4:_===2?N.buttons|=2:_===3?N.buttons|=8:_===4?N.buttons|=16:_===5&&(N.buttons|=32),_!==0){p.shouldCapture=!1,p.shouldReleaseCapture=!1,g.nonPrimaryPressHandler&&!p.preventGesture&&!p.defaultPrevented&&(p.preventDefault=!0,g.nonPrimaryPressHandler({eventSource:g,pointerType:v.type,position:S(v.currentPos,g.element),button:_,buttons:N.buttons,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData}));return}Z=N.getById(v.id),Z?(Z.insideElementPressed=!0,Z.insideElement=!0,Z.originalTarget=p.originalEvent.target,Z.contactPos=v.currentPos,Z.contactTime=v.currentTime,Z.lastPos=Z.currentPos,Z.lastTime=Z.currentTime,Z.currentPos=v.currentPos,Z.currentTime=v.currentTime,v=Z):(v.captured=!1,v.insideElementPressed=!0,v.insideElement=!0,v.originalTarget=p.originalEvent.target,m(N,v)),N.addContact(),!p.preventGesture&&!p.defaultPrevented?(p.shouldCapture=!0,p.shouldReleaseCapture=!1,p.preventDefault=!0,(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(g,v),N.contacts===1?g.pressHandler&&!p.preventGesture&&g.pressHandler({eventSource:g,pointerType:v.type,position:S(v.contactPos,g.element),buttons:N.buttons,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData}):N.contacts===2&&g.pinchHandler&&v.type==="touch"&&(k.pinchGPoints=N.asArray(),k.lastPinchDist=k.currentPinchDist=k.pinchGPoints[0].currentPos.distanceTo(k.pinchGPoints[1].currentPos),k.lastPinchCenter=k.currentPinchCenter=L(k.pinchGPoints[0].currentPos,k.pinchGPoints[1].currentPos))):(p.shouldCapture=!1,p.shouldReleaseCapture=!1)}function G(g,p,v,_){var k=i[g.hash],N=g.getActivePointersListByType(v.type),Z,le,$,je=!1,Re;if(typeof p.originalEvent.buttons<"u"?N.buttons=p.originalEvent.buttons:_===0?N.buttons^=-2:_===1?N.buttons^=-5:_===2?N.buttons^=-3:_===3?N.buttons^=-9:_===4?N.buttons^=-17:_===5&&(N.buttons^=-33),p.shouldCapture=!1,_!==0){p.shouldReleaseCapture=!1,g.nonPrimaryReleaseHandler&&!p.preventGesture&&!p.defaultPrevented&&(p.preventDefault=!0,g.nonPrimaryReleaseHandler({eventSource:g,pointerType:v.type,position:S(v.currentPos,g.element),button:_,buttons:N.buttons,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData}));return}$=N.getById(v.id),$?(N.removeContact(),$.captured&&(je=!0),$.lastPos=$.currentPos,$.lastTime=$.currentTime,$.currentPos=v.currentPos,$.currentTime=v.currentTime,$.insideElement||b(g,N,$),Z=$.currentPos,le=$.currentTime):(v.captured=!1,v.insideElementPressed=!1,v.insideElement=!0,m(N,v),$=v),!p.preventGesture&&!p.defaultPrevented&&(je?(p.shouldReleaseCapture=!0,p.preventDefault=!0,(g.dragHandler||g.dragEndHandler||g.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(g,$),N.contacts===0?(g.releaseHandler&&Z&&g.releaseHandler({eventSource:g,pointerType:$.type,position:S(Z,g.element),buttons:N.buttons,insideElementPressed:$.insideElementPressed,insideElementReleased:$.insideElement,isTouchEvent:$.type==="touch",originalEvent:p.originalEvent,userData:g.userData}),g.dragEndHandler&&k.sentDragEvent&&g.dragEndHandler({eventSource:g,pointerType:$.type,position:S($.currentPos,g.element),speed:$.speed,direction:$.direction,shift:p.originalEvent.shiftKey,isTouchEvent:$.type==="touch",originalEvent:p.originalEvent,userData:g.userData}),k.sentDragEvent=!1,(g.clickHandler||g.dblClickHandler)&&$.insideElement&&(Re=le-$.contactTime<=g.clickTimeThreshold&&$.contactPos.distanceTo(Z)<=g.clickDistThreshold,g.clickHandler&&g.clickHandler({eventSource:g,pointerType:$.type,position:S($.currentPos,g.element),quick:Re,shift:p.originalEvent.shiftKey,isTouchEvent:$.type==="touch",originalEvent:p.originalEvent,originalTarget:$.originalTarget,userData:g.userData}),g.dblClickHandler&&Re&&(N.clicks++,N.clicks===1?(k.lastClickPos=Z,k.dblClickTimeOut=setTimeout(function(){N.clicks=0},g.dblClickTimeThreshold)):N.clicks===2&&(clearTimeout(k.dblClickTimeOut),N.clicks=0,k.lastClickPos.distanceTo(Z)<=g.dblClickDistThreshold&&g.dblClickHandler({eventSource:g,pointerType:$.type,position:S($.currentPos,g.element),shift:p.originalEvent.shiftKey,isTouchEvent:$.type==="touch",originalEvent:p.originalEvent,userData:g.userData}),k.lastClickPos=null)))):N.contacts===2&&g.pinchHandler&&$.type==="touch"&&(k.pinchGPoints=N.asArray(),k.lastPinchDist=k.currentPinchDist=k.pinchGPoints[0].currentPos.distanceTo(k.pinchGPoints[1].currentPos),k.lastPinchCenter=k.currentPinchCenter=L(k.pinchGPoints[0].currentPos,k.pinchGPoints[1].currentPos))):(p.shouldReleaseCapture=!1,g.releaseHandler&&Z&&(g.releaseHandler({eventSource:g,pointerType:$.type,position:S(Z,g.element),buttons:N.buttons,insideElementPressed:$.insideElementPressed,insideElementReleased:$.insideElement,isTouchEvent:$.type==="touch",originalEvent:p.originalEvent,userData:g.userData}),p.preventDefault=!0)))}function q(g,p,v){var _=i[g.hash],k=g.getActivePointersListByType(v.type),N,Z,le;if(typeof p.originalEvent.buttons<"u"&&(k.buttons=p.originalEvent.buttons),N=k.getById(v.id),N)N.lastPos=N.currentPos,N.lastTime=N.currentTime,N.currentPos=v.currentPos,N.currentTime=v.currentTime;else return;p.shouldCapture=!1,p.shouldReleaseCapture=!1,g.stopHandler&&v.type==="mouse"&&(clearTimeout(g.stopTimeOut),g.stopTimeOut=setTimeout(function(){he(g,p.originalEvent,v.type)},g.stopDelay)),k.contacts===0?g.moveHandler&&g.moveHandler({eventSource:g,pointerType:v.type,position:S(v.currentPos,g.element),buttons:k.buttons,isTouchEvent:v.type==="touch",originalEvent:p.originalEvent,userData:g.userData}):k.contacts===1?(g.moveHandler&&(N=k.asArray()[0],g.moveHandler({eventSource:g,pointerType:N.type,position:S(N.currentPos,g.element),buttons:k.buttons,isTouchEvent:N.type==="touch",originalEvent:p.originalEvent,userData:g.userData})),g.dragHandler&&!p.preventGesture&&!p.defaultPrevented&&(N=k.asArray()[0],le=N.currentPos.minus(N.lastPos),g.dragHandler({eventSource:g,pointerType:N.type,position:S(N.currentPos,g.element),buttons:k.buttons,delta:le,speed:N.speed,direction:N.direction,shift:p.originalEvent.shiftKey,isTouchEvent:N.type==="touch",originalEvent:p.originalEvent,userData:g.userData}),p.preventDefault=!0,_.sentDragEvent=!0)):k.contacts===2&&(g.moveHandler&&(Z=k.asArray(),g.moveHandler({eventSource:g,pointerType:Z[0].type,position:S(L(Z[0].currentPos,Z[1].currentPos),g.element),buttons:k.buttons,isTouchEvent:Z[0].type==="touch",originalEvent:p.originalEvent,userData:g.userData})),g.pinchHandler&&v.type==="touch"&&!p.preventGesture&&!p.defaultPrevented&&(le=_.pinchGPoints[0].currentPos.distanceTo(_.pinchGPoints[1].currentPos),le!==_.currentPinchDist&&(_.lastPinchDist=_.currentPinchDist,_.currentPinchDist=le,_.lastPinchCenter=_.currentPinchCenter,_.currentPinchCenter=L(_.pinchGPoints[0].currentPos,_.pinchGPoints[1].currentPos),g.pinchHandler({eventSource:g,pointerType:"touch",gesturePoints:_.pinchGPoints,lastCenter:S(_.lastPinchCenter,g.element),center:S(_.currentPinchCenter,g.element),lastDistance:_.lastPinchDist,distance:_.currentPinchDist,shift:p.originalEvent.shiftKey,originalEvent:p.originalEvent,userData:g.userData}),p.preventDefault=!0)))}function re(g,p,v){var _=g.getActivePointersListByType(v.type),k;k=_.getById(v.id),k&&b(g,_,k)}function he(g,p,v){g.stopHandler&&g.stopHandler({eventSource:g,pointerType:v,position:T(p,g.element),buttons:g.getActivePointersListByType(v).buttons,isTouchEvent:v==="touch",originalEvent:p,userData:g.userData})}}(r),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(i,n,s){var c=i.parentNode;typeof n=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=typeof n.attachToViewer>"u"?!0:n.attachToViewer,this.autoFade=typeof n.autoFade>"u"?!0:n.autoFade,this.element=i,this.anchor=n.anchor,this.container=s,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof n.top=="number"?n.top+"px":n.top,this.wrapper.style.left=typeof n.left=="number"?n.left+"px":n.left,this.wrapper.style.height=typeof n.height=="number"?n.height+"px":n.height,this.wrapper.style.width=typeof n.width=="number"?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):c.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?e.setElementOpacity(this.element,i,!0):e.setElementOpacity(this.wrapper,i,!0)}}}(r),function(e){e.ControlDock=function(n){var s=["topleft","topright","bottomright","bottomleft"],c,o;for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},n),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),o=0;o<s.length;o++)c=s[o],this.controls[c]=e.makeNeutralElement("div"),this.controls[c].style.position="absolute",c.match("left")&&(this.controls[c].style.left="0px"),c.match("right")&&(this.controls[c].style.right="0px"),c.match("top")&&(this.controls[c].style.top="0px"),c.match("bottom")&&(this.controls[c].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,s){n=e.getElement(n);var c=null;if(!(i(this,n)>=0)){switch(s.anchor){case e.ControlAnchor.TOP_RIGHT:c=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:c=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:c=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:c=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:c=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case e.ControlAnchor.NONE:c=this.container,n.style.margin="0px",n.style.padding="0px";break}this.controls.push(new e.Control(n,s,c)),n.style.display="inline-block"}},removeControl:function(n){n=e.getElement(n);var s=i(this,n);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var n;for(n=this.controls.length-1;n>=0;n--)if(this.controls[n].isVisible())return!0;return!1},setControlsEnabled:function(n){var s;for(s=this.controls.length-1;s>=0;s--)this.controls[s].setVisible(n);return this}};function i(n,s){var c=n.controls,o;for(o=c.length-1;o>=0;o--)if(c[o].element===s)return o;return-1}}(r),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(r),function(e){var i={},n=1;e.Viewer=function(h){var m=arguments,b=this,R;if(e.isPlainObject(h)||(h={id:m[0],xmlPath:m.length>1?m[1]:void 0,prefixUrl:m.length>2?m[2]:void 0,controls:m.length>3?m[3]:void 0,overlays:m.length>4?m[4]:void 0}),h.config&&(e.extend(!0,h,h.config),delete h.config),e.extend(!0,this,{id:h.id,hash:h.hash||n++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,h),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&e.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(C){var F=e.getString("Errors.OpenFailed",C.eventSource,C.message);b._showMessage(F)}),e.ControlDock.call(this,h),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(C){C.width="100%",C.height="100%",C.overflow="hidden",C.position="absolute",C.top="0px",C.left="0px"}(this.canvas.style),e.setElementTouchActionNone(this.canvas),h.tabIndex!==""&&(this.canvas.tabIndex=h.tabIndex===void 0?0:h.tabIndex),this.container.className="openseadragon-container",function(C){C.width="100%",C.height="100%",C.position="relative",C.overflow="hidden",C.left="0px",C.top="0px",C.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,T),keyDownHandler:e.delegate(this,S),keyHandler:e.delegate(this,L),clickHandler:e.delegate(this,I),dblClickHandler:e.delegate(this,j),dragHandler:e.delegate(this,Y),dragEndHandler:e.delegate(this,Q),enterHandler:e.delegate(this,ie),leaveHandler:e.delegate(this,J),pressHandler:e.delegate(this,ee),releaseHandler:e.delegate(this,K),nonPrimaryPressHandler:e.delegate(this,we),nonPrimaryReleaseHandler:e.delegate(this,ve),scrollHandler:e.delegate(this,We),pinchHandler:e.delegate(this,Ke)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,ht),leaveHandler:e.delegate(this,me)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=s(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(C){b.source=b.world.getItemAt(0).source,i[b.hash].forceRedraw=!0,b._updateRequestId||(b._updateRequestId=l(b,pe))}),this.world.addHandler("remove-item",function(C){b.world.getItemCount()?b.source=b.world.getItemAt(0).source:b.source=null,i[b.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(C){b.viewport&&b.viewport._setContentBounds(b.world.getHomeBounds(),b.world.getContentFactor())}),this.world.addHandler("item-index-change",function(C){b.source=b.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:h.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(R=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(R,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(R=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(R,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),R=0;R<this.customControls.length;R++)this.addControl(this.customControls[R].id,{anchor:this.customControls[R].anchor});e.requestAnimationFrame(function(){d(b)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(h){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(h)},openTileSource:function(h){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(h)},get buttons(){return e.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(h,m){var b=this;if(this.close(),!h)return this;if(this.sequenceMode&&e.isArray(h))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof m<"u"&&!isNaN(m)&&(this.initialPage=m),this.tileSources=h,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(h)||(h=[h]),!h.length)return this;this._opening=!0;for(var R=h.length,C=0,F=0,O,A=function(){if(C+F===R)if(C){(b._firstOpen||!b.preserveViewport)&&(b.viewport.goHome(!0),b.viewport.update()),b._firstOpen=!1;var z=h[0];if(z.tileSource&&(z=z.tileSource),b.overlays&&!b.preserveOverlays)for(var G=0;G<b.overlays.length;G++)b.currentOverlays[G]=o(b,b.overlays[G]);b._drawOverlays(),b._opening=!1,b.raiseEvent("open",{source:z})}else b._opening=!1,b.raiseEvent("open-failed",O)},W=function(z){(!e.isPlainObject(z)||!z.tileSource)&&(z={tileSource:z}),z.index!==void 0&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete z.index),z.collectionImmediately===void 0&&(z.collectionImmediately=!0);var G=z.success;z.success=function(re){if(C++,z.tileSource.overlays)for(var he=0;he<z.tileSource.overlays.length;he++)b.addOverlay(z.tileSource.overlays[he]);G&&G(re),A()};var q=z.error;z.error=function(re){F++,O||(O=re),q&&q(re),A()},b.addTiledImage(z)},V=0;V<h.length;V++)W(h[V]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(h){return this.innerTracker.setTracking(h),this.outerTracker.setTracking(h),this.raiseEvent("mouse-enabled",{enabled:h}),this},areControlsEnabled:function(){var h=this.controls.length,m;for(m=0;m<this.controls.length;m++)h=h&&this.controls[m].isVisible();return h},setControlsEnabled:function(h){return h?w(this):d(this),this.raiseEvent("controls-enabled",{enabled:h}),this},setDebugMode:function(h){for(var m=0;m<this.world.getItemCount();m++)this.world.getItemAt(m).debugMode=h;this.debugMode=h,this.forceRedraw()},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(h){var m=document.body,b=m.style,R=document.documentElement.style,C=this,F,O;if(h===this.isFullPage())return this;var A={fullPage:h,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",A),A.preventDefaultAction)return this;if(h){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=b.margin,this.docMargin=R.margin,b.margin="0",R.margin="0",this.bodyPadding=b.padding,this.docPadding=R.padding,b.padding="0",R.padding="0",this.bodyWidth=b.width,this.docWidth=R.width,b.width="100%",R.width="100%",this.bodyHeight=b.height,this.docHeight=R.height,b.height="100%",R.height="100%",this.bodyDisplay=b.display,b.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,F=m.childNodes.length,O=0;O<F;O++)this.previousBody.push(m.childNodes[0]),m.removeChild(m.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,m.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),m.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,e.delegate(this,ht)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,b.margin=this.bodyMargin,R.margin=this.docMargin,b.padding=this.bodyPadding,R.padding=this.docPadding,b.width=this.bodyWidth,R.width=this.docWidth,b.height=this.bodyHeight,R.height=this.docHeight,b.display=this.bodyDisplay,m.removeChild(this.element),F=this.previousBody.length,O=0;O<F;O++)m.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(m.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var W=0,V=function(){e.setPageScroll(C.pageScroll);var z=e.getPageScroll();W++,W<10&&(z.x!==C.pageScroll.x||z.y!==C.pageScroll.y)&&e.requestAnimationFrame(V)};e.requestAnimationFrame(V),i[this.hash].fullPage=!1,e.delegate(this,me)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:h}),this},setFullScreen:function(h){var m=this;if(!e.supportsFullScreen)return this.setFullPage(h);if(e.isFullScreen()===h)return this;var b={fullScreen:h,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",b),b.preventDefaultAction)return this;if(h){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var R=function(){var C=e.isFullScreen();C||(e.removeEvent(document,e.fullScreenEventName,R),e.removeEvent(document,e.fullScreenErrorEventName,R),m.setFullPage(!1),m.isFullPage()&&(m.element.style.width=m.fullPageStyleWidth,m.element.style.height=m.fullPageStyleHeight)),m.navigator&&m.viewport&&setTimeout(function(){m.navigator.update(m.viewport)}),m.raiseEvent("full-screen",{fullScreen:C})};e.addEvent(document,e.fullScreenEventName,R),e.addEvent(document,e.fullScreenErrorEventName,R),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return e.isFullScreen()&&this.isFullPage()},setVisible:function(h){return this.container.style.visibility=h?"":"hidden",this.raiseEvent("visible",{visible:h}),this},addTiledImage:function(h){e.console.assert(h,"[Viewer.addTiledImage] options is required"),e.console.assert(h.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!h.replace||h.index>-1&&h.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var m=this;h.replace&&(h.replaceItem=m.world.getItemAt(h.index)),this._hideMessage(),h.placeholderFillStyle===void 0&&(h.placeholderFillStyle=this.placeholderFillStyle),h.opacity===void 0&&(h.opacity=this.opacity),h.preload===void 0&&(h.preload=this.preload),h.compositeOperation===void 0&&(h.compositeOperation=this.compositeOperation),h.crossOriginPolicy===void 0&&(h.crossOriginPolicy=h.tileSource.crossOriginPolicy!==void 0?h.tileSource.crossOriginPolicy:this.crossOriginPolicy),h.ajaxWithCredentials===void 0&&(h.ajaxWithCredentials=this.ajaxWithCredentials),h.loadTilesWithAjax===void 0&&(h.loadTilesWithAjax=this.loadTilesWithAjax),h.ajaxHeaders===void 0||h.ajaxHeaders===null?h.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(h.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(h.ajaxHeaders=e.extend({},this.ajaxHeaders,h.ajaxHeaders));var b={options:h};function R(O){for(var A=0;A<m._loadQueue.length;A++)if(m._loadQueue[A]===b){m._loadQueue.splice(A,1);break}m._loadQueue.length===0&&C(b),m.raiseEvent("add-item-failed",O),h.error&&h.error(O)}function C(O){m.collectionMode&&(m.world.arrange({immediately:O.options.collectionImmediately,rows:m.collectionRows,columns:m.collectionColumns,layout:m.collectionLayout,tileSize:m.collectionTileSize,tileMargin:m.collectionTileMargin}),m.world.setAutoRefigureSizes(!0))}if(e.isArray(h.tileSource)){setTimeout(function(){R({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:h.tileSource,options:h})});return}this._loadQueue.push(b);function F(){for(var O,A,W;m._loadQueue.length&&(O=m._loadQueue[0],!!O.tileSource);){if(m._loadQueue.splice(0,1),O.options.replace){var V=m.world.getIndexOfItem(O.options.replaceItem);V!==-1&&(O.options.index=V),m.world.removeItem(O.options.replaceItem)}A=new e.TiledImage({viewer:m,source:O.tileSource,viewport:m.viewport,drawer:m.drawer,tileCache:m.tileCache,imageLoader:m.imageLoader,x:O.options.x,y:O.options.y,width:O.options.width,height:O.options.height,fitBounds:O.options.fitBounds,fitBoundsPlacement:O.options.fitBoundsPlacement,clip:O.options.clip,placeholderFillStyle:O.options.placeholderFillStyle,opacity:O.options.opacity,preload:O.options.preload,degrees:O.options.degrees,flipped:O.options.flipped,compositeOperation:O.options.compositeOperation,springStiffness:m.springStiffness,animationTime:m.animationTime,minZoomImageRatio:m.minZoomImageRatio,wrapHorizontal:m.wrapHorizontal,wrapVertical:m.wrapVertical,immediateRender:m.immediateRender,blendTime:m.blendTime,alwaysBlend:m.alwaysBlend,minPixelRatio:m.minPixelRatio,smoothTileEdgesMinZoom:m.smoothTileEdgesMinZoom,iOSDevice:m.iOSDevice,crossOriginPolicy:O.options.crossOriginPolicy,ajaxWithCredentials:O.options.ajaxWithCredentials,loadTilesWithAjax:O.options.loadTilesWithAjax,ajaxHeaders:O.options.ajaxHeaders,debugMode:m.debugMode,subPixelRoundingForTransparency:m.subPixelRoundingForTransparency}),m.collectionMode&&m.world.setAutoRefigureSizes(!1),m.navigator&&(W=e.extend({},O.options,{replace:!1,originalTiledImage:A,tileSource:O.tileSource}),m.navigator.addTiledImage(W)),m.world.addItem(A,{index:O.options.index}),m._loadQueue.length===0&&C(O),m.world.getItemCount()===1&&!m.preserveViewport&&m.viewport.goHome(!0),O.options.success&&O.options.success({item:A})}}c(this,h.tileSource,h,function(O){b.tileSource=O,F()},function(O){O.options=h,R(O),F()})},addSimpleImage:function(h){e.console.assert(h,"[Viewer.addSimpleImage] options is required"),e.console.assert(h.url,"[Viewer.addSimpleImage] options.url is required");var m=e.extend({},h,{tileSource:{type:"image",url:h.url}});delete m.url,this.addTiledImage(m)},addLayer:function(h){var m=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var b=e.extend({},h,{success:function(R){m.raiseEvent("add-layer",{options:h,drawer:R.item})},error:function(R){m.raiseEvent("add-layer-failed",R)}});return this.addTiledImage(b),this},getLayerAtLevel:function(h){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(h)},getLevelOfLayer:function(h){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(h)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(h,m){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(h,m)},removeLayer:function(h){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(h)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var h=e.delegate(this,y),m=e.delegate(this,x),b=e.delegate(this,this.goToNextPage),R=e.delegate(this,this.goToPreviousPage),C=this.navImages,F=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(F=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:ne(this.prefixUrl,C.previous.REST),srcGroup:ne(this.prefixUrl,C.previous.GROUP),srcHover:ne(this.prefixUrl,C.previous.HOVER),srcDown:ne(this.prefixUrl,C.previous.DOWN),onRelease:R,onFocus:h,onBlur:m}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:ne(this.prefixUrl,C.next.REST),srcGroup:ne(this.prefixUrl,C.next.GROUP),srcHover:ne(this.prefixUrl,C.next.HOVER),srcDown:ne(this.prefixUrl,C.next.DOWN),onRelease:b,onFocus:h,onBlur:m}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),F&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var h=e.delegate(this,Xe),m=e.delegate(this,St),b=e.delegate(this,ze),R=e.delegate(this,Be),C=e.delegate(this,dt),F=e.delegate(this,it),O=e.delegate(this,vt),A=e.delegate(this,yt),W=e.delegate(this,E),V=e.delegate(this,P),z=e.delegate(this,y),G=e.delegate(this,x),q=this.navImages,re=[],he=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(he=!1),this.showZoomControl&&(re.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:ne(this.prefixUrl,q.zoomIn.REST),srcGroup:ne(this.prefixUrl,q.zoomIn.GROUP),srcHover:ne(this.prefixUrl,q.zoomIn.HOVER),srcDown:ne(this.prefixUrl,q.zoomIn.DOWN),onPress:h,onRelease:m,onClick:b,onEnter:h,onExit:m,onFocus:z,onBlur:G})),re.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:ne(this.prefixUrl,q.zoomOut.REST),srcGroup:ne(this.prefixUrl,q.zoomOut.GROUP),srcHover:ne(this.prefixUrl,q.zoomOut.HOVER),srcDown:ne(this.prefixUrl,q.zoomOut.DOWN),onPress:R,onRelease:m,onClick:C,onEnter:R,onExit:m,onFocus:z,onBlur:G}))),this.showHomeControl&&re.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:ne(this.prefixUrl,q.home.REST),srcGroup:ne(this.prefixUrl,q.home.GROUP),srcHover:ne(this.prefixUrl,q.home.HOVER),srcDown:ne(this.prefixUrl,q.home.DOWN),onRelease:F,onFocus:z,onBlur:G})),this.showFullPageControl&&re.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:ne(this.prefixUrl,q.fullpage.REST),srcGroup:ne(this.prefixUrl,q.fullpage.GROUP),srcHover:ne(this.prefixUrl,q.fullpage.HOVER),srcDown:ne(this.prefixUrl,q.fullpage.DOWN),onRelease:O,onFocus:z,onBlur:G})),this.showRotationControl&&(re.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:ne(this.prefixUrl,q.rotateleft.REST),srcGroup:ne(this.prefixUrl,q.rotateleft.GROUP),srcHover:ne(this.prefixUrl,q.rotateleft.HOVER),srcDown:ne(this.prefixUrl,q.rotateleft.DOWN),onRelease:A,onFocus:z,onBlur:G})),re.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:ne(this.prefixUrl,q.rotateright.REST),srcGroup:ne(this.prefixUrl,q.rotateright.GROUP),srcHover:ne(this.prefixUrl,q.rotateright.HOVER),srcDown:ne(this.prefixUrl,q.rotateright.DOWN),onRelease:W,onFocus:z,onBlur:G}))),this.showFlipControl&&re.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:ne(this.prefixUrl,q.flip.REST),srcGroup:ne(this.prefixUrl,q.flip.GROUP),srcHover:ne(this.prefixUrl,q.flip.HOVER),srcDown:ne(this.prefixUrl,q.flip.DOWN),onRelease:V,onFocus:z,onBlur:G})),he?(this.buttonGroup=new e.ButtonGroup({buttons:re,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,Pt)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=re),this},currentPage:function(){return this._sequenceIndex},goToPage:function(h){return this.tileSources&&h>=0&&h<this.tileSources.length&&(this._sequenceIndex=h,this._updateSequenceButtons(h),this.open(this.tileSources[h]),this.referenceStrip&&this.referenceStrip.setFocus(h),this.raiseEvent("page",{page:h})),this},addOverlay:function(h,m,b,R){var C;if(e.isPlainObject(h)?C=h:C={element:h,location:m,placement:b,onDraw:R},h=e.getElement(C.element),a(this.currentOverlays,h)>=0)return this;var F=o(this,C);return this.currentOverlays.push(F),F.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:h,location:C.location,placement:C.placement}),this},updateOverlay:function(h,m,b){var R;return h=e.getElement(h),R=a(this.currentOverlays,h),R>=0&&(this.currentOverlays[R].update(m,b),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:h,location:m,placement:b})),this},removeOverlay:function(h){var m;return h=e.getElement(h),m=a(this.currentOverlays,h),m>=0&&(this.currentOverlays[m].destroy(),this.currentOverlays.splice(m,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:h})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(h){var m;return h=e.getElement(h),m=a(this.currentOverlays,h),m>=0?this.currentOverlays[m]:null},_updateSequenceButtons:function(h){this.nextButton&&(!this.tileSources||this.tileSources.length-1===h?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(h>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(h){this._hideMessage();var m=e.makeNeutralElement("div");m.appendChild(document.createTextNode(h)),this.messageDiv=e.makeCenteredNode(m),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var h=this.messageDiv;h&&(h.parentNode.removeChild(h),delete this.messageDiv)},gestureSettingsByDeviceType:function(h){switch(h){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var h,m=this.currentOverlays.length;for(h=0;h<m;h++)this.currentOverlays[h].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var h=e.pixelDensityRatio,m=e.getCurrentPixelDensityRatio();h!==m&&(e.pixelDensityRatio=m,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var h=this._sequenceIndex-1;this.navPrevNextWrap&&h<0&&(h+=this.tileSources.length),this.goToPage(h)},goToNextPage:function(){var h=this._sequenceIndex+1;this.navPrevNextWrap&&h>=this.tileSources.length&&(h=0),this.goToPage(h)},isAnimating:function(){return i[this.hash].animating}});function s(h){return h=e.getElement(h),new e.Point(h.clientWidth===0?1:h.clientWidth,h.clientHeight===0?1:h.clientHeight)}function c(h,m,b,R,C){var F=h;if(e.type(m)==="string"){if(m.match(/^\s*<.*>\s*$/))m=e.parseXml(m);else if(m.match(/^\s*[{[].*[}\]]\s*$/))try{var O=e.parseJSON(m);m=O}catch{}}function A(W,V){W.ready?R(W):(W.addHandler("ready",function(){R(W)}),W.addHandler("open-failed",function(z){C({message:z.message,source:V})}))}setTimeout(function(){if(e.type(m)==="string")m=new e.TileSource({url:m,crossOriginPolicy:b.crossOriginPolicy!==void 0?b.crossOriginPolicy:h.crossOriginPolicy,ajaxWithCredentials:h.ajaxWithCredentials,ajaxHeaders:b.ajaxHeaders?b.ajaxHeaders:h.ajaxHeaders,splitHashDataForPost:h.splitHashDataForPost,useCanvas:h.useCanvas,success:function(G){R(G.tileSource)}}),m.addHandler("open-failed",function(G){C(G)});else if(e.isPlainObject(m)||m.nodeType)if(m.crossOriginPolicy===void 0&&(b.crossOriginPolicy!==void 0||h.crossOriginPolicy!==void 0)&&(m.crossOriginPolicy=b.crossOriginPolicy!==void 0?b.crossOriginPolicy:h.crossOriginPolicy),m.ajaxWithCredentials===void 0&&(m.ajaxWithCredentials=h.ajaxWithCredentials),m.useCanvas===void 0&&(m.useCanvas=h.useCanvas),e.isFunction(m.getTileUrl)){var W=new e.TileSource(m);W.getTileUrl=m.getTileUrl,R(W)}else{var V=e.TileSource.determineType(F,m);if(!V){C({message:"Unable to load TileSource",source:m});return}var z=V.prototype.configure.apply(F,[m]);A(new V(z),m)}else A(m,m)})}function o(h,m){if(m instanceof e.Overlay)return m;var b=null;if(m.element)b=e.getElement(m.element);else{var R=m.id?m.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);b=e.getElement(m.id),b||(b=document.createElement("a"),b.href="#/overlay/"+R),b.id=R,e.addClass(b,m.className?m.className:"openseadragon-overlay")}var C=m.location,F=m.width,O=m.height;if(!C){var A=m.x,W=m.y;if(m.px!==void 0){var V=h.viewport.imageToViewportRectangle(new e.Rect(m.px,m.py,F||0,O||0));A=V.x,W=V.y,F=F!==void 0?V.width:void 0,O=O!==void 0?V.height:void 0}C=new e.Point(A,W)}var z=m.placement;return z&&e.type(z)==="string"&&(z=e.Placement[m.placement.toUpperCase()]),new e.Overlay({element:b,location:C,placement:z,onDraw:m.onDraw,checkResize:m.checkResize,width:F,height:O,rotationMode:m.rotationMode})}function a(h,m){var b;for(b=h.length-1;b>=0;b--)if(h[b].element===m)return b;return-1}function l(h,m){return e.requestAnimationFrame(function(){m(h)})}function u(h){e.requestAnimationFrame(function(){f(h)})}function d(h){h.autoHideControls&&(h.controlsShouldFade=!0,h.controlsFadeBeginTime=e.now()+h.controlsFadeDelay,window.setTimeout(function(){u(h)},h.controlsFadeDelay))}function f(h){var m,b,R,C;if(h.controlsShouldFade){for(m=e.now(),b=m-h.controlsFadeBeginTime,R=1-b/h.controlsFadeLength,R=Math.min(1,R),R=Math.max(0,R),C=h.controls.length-1;C>=0;C--)h.controls[C].autoFade&&h.controls[C].setOpacity(R);R>0&&u(h)}}function w(h){var m;for(h.controlsShouldFade=!1,m=h.controls.length-1;m>=0;m--)h.controls[m].setOpacity(1)}function y(){w(this)}function x(){d(this)}function T(h){var m={tracker:h.eventSource,position:h.position,originalEvent:h.originalEvent,preventDefault:h.preventDefault};this.raiseEvent("canvas-contextmenu",m),h.preventDefault=m.preventDefault}function S(h){var m={originalEvent:h.originalEvent,preventDefaultAction:!1,preventVerticalPan:h.preventVerticalPan||!this.panVertical,preventHorizontalPan:h.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",m),!m.preventDefaultAction&&!h.ctrl&&!h.alt&&!h.meta)switch(h.keyCode){case 38:m.preventVerticalPan||(h.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),h.preventDefault=!0;break;case 40:m.preventVerticalPan||(h.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),h.preventDefault=!0;break;case 37:m.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),h.preventDefault=!0;break;case 39:m.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),h.preventDefault=!0;break;default:h.preventDefault=!1;break}else h.preventDefault=!1}function L(h){var m={originalEvent:h.originalEvent,preventDefaultAction:!1,preventVerticalPan:h.preventVerticalPan||!this.panVertical,preventHorizontalPan:h.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",m),!m.preventDefaultAction&&!h.ctrl&&!h.alt&&!h.meta)switch(h.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),h.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),h.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),h.preventDefault=!0;break;case 119:case 87:m.preventVerticalPan||(h.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),h.preventDefault=!0;break;case 115:case 83:m.preventVerticalPan||(h.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),h.preventDefault=!0;break;case 97:m.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),h.preventDefault=!0;break;case 100:m.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),h.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),h.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),h.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),h.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:h.preventDefault=!1;break}else h.preventDefault=!1}function I(h){var m,b=document.activeElement===this.canvas;b||this.canvas.focus(),this.viewport.flipped&&(h.position.x=this.viewport.getContainerSize().x-h.position.x);var R={tracker:h.eventSource,position:h.position,quick:h.quick,shift:h.shift,originalEvent:h.originalEvent,originalTarget:h.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",R),!R.preventDefaultAction&&this.viewport&&h.quick&&(m=this.gestureSettingsByDeviceType(h.pointerType),m.clickToZoom&&(this.viewport.zoomBy(h.shift?1/this.zoomPerClick:this.zoomPerClick,m.zoomToRefPoint?this.viewport.pointFromPixel(h.position,!0):null),this.viewport.applyConstraints()))}function j(h){var m,b={tracker:h.eventSource,position:h.position,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",b),!b.preventDefaultAction&&this.viewport&&(m=this.gestureSettingsByDeviceType(h.pointerType),m.dblClickToZoom&&(this.viewport.zoomBy(h.shift?1/this.zoomPerClick:this.zoomPerClick,m.zoomToRefPoint?this.viewport.pointFromPixel(h.position,!0):null),this.viewport.applyConstraints()))}function Y(h){var m,b={tracker:h.eventSource,pointerType:h.pointerType,position:h.position,delta:h.delta,speed:h.speed,direction:h.direction,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",b),m=this.gestureSettingsByDeviceType(h.pointerType),m.dragToPan&&!b.preventDefaultAction&&this.viewport){if(this.panHorizontal||(h.delta.x=0),this.panVertical||(h.delta.y=0),this.viewport.flipped&&(h.delta.x=-h.delta.x),this.constrainDuringPan){var R=this.viewport.deltaPointsFromPixels(h.delta.negate());this.viewport.centerSpringX.target.value+=R.x,this.viewport.centerSpringY.target.value+=R.y;var C=this.viewport.getBounds(),F=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=R.x,this.viewport.centerSpringY.target.value-=R.y,C.x!==F.x&&(h.delta.x=0),C.y!==F.y&&(h.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(h.delta.negate()),m.flickEnabled&&!this.constrainDuringPan)}}function Q(h){var m={tracker:h.eventSource,pointerType:h.pointerType,position:h.position,speed:h.speed,direction:h.direction,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",m),!m.preventDefaultAction&&this.viewport){var b=this.gestureSettingsByDeviceType(h.pointerType);if(b.flickEnabled&&h.speed>=b.flickMinSpeed){var R=0;this.panHorizontal&&(R=b.flickMomentum*h.speed*Math.cos(h.direction));var C=0;this.panVertical&&(C=b.flickMomentum*h.speed*Math.sin(h.direction));var F=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),O=this.viewport.pointFromPixel(new e.Point(F.x-R,F.y-C));this.viewport.panTo(O,!1)}this.viewport.applyConstraints()}}function ie(h){this.raiseEvent("canvas-enter",{tracker:h.eventSource,pointerType:h.pointerType,position:h.position,buttons:h.buttons,pointers:h.pointers,insideElementPressed:h.insideElementPressed,buttonDownAny:h.buttonDownAny,originalEvent:h.originalEvent})}function J(h){this.raiseEvent("canvas-exit",{tracker:h.eventSource,pointerType:h.pointerType,position:h.position,buttons:h.buttons,pointers:h.pointers,insideElementPressed:h.insideElementPressed,buttonDownAny:h.buttonDownAny,originalEvent:h.originalEvent})}function ee(h){this.raiseEvent("canvas-press",{tracker:h.eventSource,pointerType:h.pointerType,position:h.position,insideElementPressed:h.insideElementPressed,insideElementReleased:h.insideElementReleased,originalEvent:h.originalEvent})}function K(h){this.raiseEvent("canvas-release",{tracker:h.eventSource,pointerType:h.pointerType,position:h.position,insideElementPressed:h.insideElementPressed,insideElementReleased:h.insideElementReleased,originalEvent:h.originalEvent})}function we(h){this.raiseEvent("canvas-nonprimary-press",{tracker:h.eventSource,position:h.position,pointerType:h.pointerType,button:h.button,buttons:h.buttons,originalEvent:h.originalEvent})}function ve(h){this.raiseEvent("canvas-nonprimary-release",{tracker:h.eventSource,position:h.position,pointerType:h.pointerType,button:h.button,buttons:h.buttons,originalEvent:h.originalEvent})}function Ke(h){var m,b,R,C,F={tracker:h.eventSource,pointerType:h.pointerType,gesturePoints:h.gesturePoints,lastCenter:h.lastCenter,center:h.center,lastDistance:h.lastDistance,distance:h.distance,shift:h.shift,originalEvent:h.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",F),this.viewport&&(m=this.gestureSettingsByDeviceType(h.pointerType),m.pinchToZoom&&(!F.preventDefaultPanAction||!F.preventDefaultZoomAction)&&(b=this.viewport.pointFromPixel(h.center,!0),m.zoomToRefPoint&&!F.preventDefaultPanAction&&(R=this.viewport.pointFromPixel(h.lastCenter,!0),C=R.minus(b),this.panHorizontal||(C.x=0),this.panVertical||(C.y=0),this.viewport.panBy(C,!0)),F.preventDefaultZoomAction||this.viewport.zoomBy(h.distance/h.lastDistance,b,!0),this.viewport.applyConstraints()),m.pinchRotate&&!F.preventDefaultRotateAction)){var O=Math.atan2(h.gesturePoints[0].currentPos.y-h.gesturePoints[1].currentPos.y,h.gesturePoints[0].currentPos.x-h.gesturePoints[1].currentPos.x),A=Math.atan2(h.gesturePoints[0].lastPos.y-h.gesturePoints[1].lastPos.y,h.gesturePoints[0].lastPos.x-h.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(O-A)*(180/Math.PI))}}function We(h){var m,b,R,C,F;C=e.now(),F=C-this._lastScrollTime,F>this.minScrollDeltaTime?(this._lastScrollTime=C,m={tracker:h.eventSource,position:h.position,scroll:h.scroll,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",m),!m.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(h.position.x=this.viewport.getContainerSize().x-h.position.x),b=this.gestureSettingsByDeviceType(h.pointerType),b.scrollToZoom&&(R=Math.pow(this.zoomPerScroll,h.scroll),this.viewport.zoomBy(R,b.zoomToRefPoint?this.viewport.pointFromPixel(h.position,!0):null),this.viewport.applyConstraints())),h.preventDefault=m.preventDefault):h.preventDefault=!0}function ht(h){i[this.hash].mouseInside=!0,w(this),this.raiseEvent("container-enter",{tracker:h.eventSource,pointerType:h.pointerType,position:h.position,buttons:h.buttons,pointers:h.pointers,insideElementPressed:h.insideElementPressed,buttonDownAny:h.buttonDownAny,originalEvent:h.originalEvent})}function me(h){h.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||d(this)),this.raiseEvent("container-exit",{tracker:h.eventSource,pointerType:h.pointerType,position:h.position,buttons:h.buttons,pointers:h.pointers,insideElementPressed:h.insideElementPressed,buttonDownAny:h.buttonDownAny,originalEvent:h.originalEvent})}function pe(h){de(h),h.isOpen()?h._updateRequestId=l(h,pe):h._updateRequestId=!1}function de(h){if(!(h._opening||!i[h.hash])){if(h.autoResize){var m=s(h.container),b=i[h.hash].prevContainerSize;if(!m.equals(b)){var R=h.viewport;if(h.preserveImageSizeOnResize){var C=b.x/m.x,F=R.getZoom()*C,O=R.getCenter();R.resize(m,!1),R.zoomTo(F,null,!0),R.panTo(O,!0)}else{var A=R.getBounds();R.resize(m,!0),R.fitBoundsWithConstraints(A,!0)}i[h.hash].prevContainerSize=m,i[h.hash].forceRedraw=!0}}var W=h.viewport.update(),V=h.world.update()||W;W&&h.raiseEvent("viewport-change"),h.referenceStrip&&(V=h.referenceStrip.update(h.viewport)||V);var z=i[h.hash].animating;!z&&V&&(h.raiseEvent("animation-start"),w(h));var G=z&&!V;G&&(i[h.hash].animating=!1),(V||G||i[h.hash].forceRedraw||h.world.needsDraw())&&(Ae(h),h._drawOverlays(),h.navigator&&h.navigator.update(h.viewport),i[h.hash].forceRedraw=!1,V&&h.raiseEvent("animation")),G&&(h.raiseEvent("animation-finish"),i[h.hash].mouseInside||d(h)),i[h.hash].animating=V}}function Ae(h){h.imageLoader.clear(),h.drawer.clear(),h.world.draw(),h.raiseEvent("update-viewport",{})}function ne(h,m){return h?h+m:m}function Xe(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,mt(this)}function Be(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,mt(this)}function St(){i[this.hash].zooming=!1}function mt(h){e.requestAnimationFrame(e.delegate(h,Vt))}function Vt(){var h,m,b;i[this.hash].zooming&&this.viewport&&(h=e.now(),m=h-i[this.hash].lastZoomTime,b=Math.pow(i[this.hash].zoomFactor,m/1e3),this.viewport.zoomBy(b),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=h,mt(this))}function ze(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function dt(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Pt(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function it(){this.viewport&&this.viewport.goHome()}function vt(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function yt(){if(this.viewport){var h=this.viewport.getRotation();this.viewport.flipped?h=e.positiveModulo(h+this.rotationIncrement,360):h=e.positiveModulo(h-this.rotationIncrement,360),this.viewport.setRotation(h)}}function E(){if(this.viewport){var h=this.viewport.getRotation();this.viewport.flipped?h=e.positiveModulo(h-this.rotationIncrement,360):h=e.positiveModulo(h+this.rotationIncrement,360),this.viewport.setRotation(h)}}function P(){this.viewport.toggleFlip()}}(r),function(e){e.Navigator=function(l){var u=l.viewer,d=this,f,w;l.id?(this.element=document.getElementById(l.id),l.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(l.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),l.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:l.autoFade},l.position&&(l.position==="BOTTOM_RIGHT"?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:l.position==="BOTTOM_LEFT"?l.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:l.position==="TOP_RIGHT"?l.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:l.position==="TOP_LEFT"?l.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:l.position==="ABSOLUTE"&&(l.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,l.controlOptions.top=l.top,l.controlOptions.left=l.left,l.controlOptions.height=l.height,l.controlOptions.width=l.width))),this.element.id=l.id,this.element.className+=" navigator",l=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},l,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:l.autoResize,minZoomImageRatio:1,background:l.background,opacity:l.opacity,borderColor:l.borderColor,displayRegionColor:l.displayRegionColor}),l.minPixelRatio=this.minPixelRatio=u.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),l.controlOptions.anchor!==e.ControlAnchor.NONE&&function(T,S){T.margin="0px",T.border=S+"px solid "+l.borderColor,T.padding="0px",T.background=l.background,T.opacity=l.opacity,T.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(T,S){T.position="relative",T.top="0px",T.left="0px",T.fontSize="0px",T.overflow="hidden",T.border=S+"px solid "+l.displayRegionColor,T.margin="0px",T.padding="0px",T.background="transparent",T.float="left",T.cssFloat="left",T.styleFloat="left",T.zIndex=999999999,T.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),u.addControl(this.element,l.controlOptions),this._resizeWithViewer=l.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&l.controlOptions.anchor!==e.ControlAnchor.NONE,l.width&&l.height?(this.setWidth(l.width),this.setHeight(l.height)):this._resizeWithViewer&&(f=e.getElementSize(u.element),this.element.style.height=Math.round(f.y*l.sizeRatio)+"px",this.element.style.width=Math.round(f.x*l.sizeRatio)+"px",this.oldViewerSize=f,w=e.getElementSize(this.element),this.elementArea=w.x*w.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[l]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function y(T){o(d.displayRegionContainer,T),o(d.displayRegion,-T),d.viewport.setRotation(T)}if(l.navigatorRotate){var x=l.viewer.viewport?l.viewer.viewport.getRotation():l.viewer.degrees||0;y(x),l.viewer.addHandler("rotate",function(T){y(T.degrees)})}this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,n),clickHandler:e.delegate(this,i),releaseHandler:e.delegate(this,s),scrollHandler:e.delegate(this,c),preProcessEventHandler:function(T){T.eventType==="wheel"&&(T.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),u.world.addHandler("item-index-change",function(T){window.setTimeout(function(){var S=d.world.getItemAt(T.previousIndex);d.world.setItemIndex(S,T.newIndex)},1)}),u.world.addHandler("remove-item",function(T){var S=T.item,L=d._getMatchingItem(S);L&&d.world.removeItem(L)}),this.update(u.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var l=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);l.equals(this.oldContainerSize)||(this.viewport.resize(l,!0),this.viewport.goHome(!0),this.oldContainerSize=l,this.drawer.clear(),this.world.draw())}},setWidth:function(l){this.width=l,this.element.style.width=typeof l=="number"?l+"px":l,this._resizeWithViewer=!1},setHeight:function(l){this.height=l,this.element.style.height=typeof l=="number"?l+"px":l,this._resizeWithViewer=!1},setFlip:function(l){return this.viewport.setFlip(l),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(l){a(this.displayRegion,l),a(this.canvas,l),a(this.element,l)},update:function(l){var u,d,f,w,y,x;if(u=e.getElementSize(this.viewer.element),this._resizeWithViewer&&u.x&&u.y&&!u.equals(this.oldViewerSize)&&(this.oldViewerSize=u,this.maintainSizeRatio||!this.elementArea?(d=u.x*this.sizeRatio,f=u.y*this.sizeRatio):(d=Math.sqrt(this.elementArea*(u.x/u.y)),f=this.elementArea/d),this.element.style.width=Math.round(d)+"px",this.element.style.height=Math.round(f)+"px",this.elementArea||(this.elementArea=d*f),this.updateSize()),l&&this.viewport){w=l.getBoundsNoRotate(!0),y=this.viewport.pixelFromPointNoRotate(w.getTopLeft(),!1),x=this.viewport.pixelFromPointNoRotate(w.getBottomRight(),!1).minus(this.totalBorderWidths);var T=this.displayRegion.style;T.display=this.world.getItemCount()?"block":"none",T.top=Math.round(y.y)+"px",T.left=Math.round(y.x)+"px";var S=Math.abs(y.x-x.x),L=Math.abs(y.y-x.y);T.width=Math.round(Math.max(S,0))+"px",T.height=Math.round(Math.max(L,0))+"px"}},addTiledImage:function(l){var u=this,d=l.originalTiledImage;delete l.original;var f=e.extend({},l,{success:function(w){var y=w.item;y._originalForNavigator=d,u._matchBounds(y,d,!0),u._matchOpacity(y,d),u._matchCompositeOperation(y,d);function x(){u._matchBounds(y,d)}function T(){u._matchOpacity(y,d)}function S(){u._matchCompositeOperation(y,d)}d.addHandler("bounds-change",x),d.addHandler("clip-change",x),d.addHandler("opacity-change",T),d.addHandler("composite-operation-change",S)}});return e.Viewer.prototype.addTiledImage.apply(this,[f])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(l){for(var u=this.world.getItemCount(),d,f=0;f<u;f++)if(d=this.world.getItemAt(f),d._originalForNavigator===l)return d;return null},_matchBounds:function(l,u,d){var f=u.getBoundsNoRotate();l.setPosition(f.getTopLeft(),d),l.setWidth(f.width,d),l.setRotation(u.getRotation(),d),l.setClip(u.getClip()),l.setFlip(u.getFlip())},_matchOpacity:function(l,u){l.setOpacity(u.opacity)},_matchCompositeOperation:function(l,u){l.setCompositeOperation(u.compositeOperation)}});function i(l){var u={tracker:l.eventSource,position:l.position,quick:l.quick,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",u),!u.preventDefaultAction&&l.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(l.position.x=this.viewport.getContainerSize().x-l.position.x);var d=this.viewport.pointFromPixel(l.position);this.panVertical?this.panHorizontal||(d.x=this.viewer.viewport.getCenter(!0).x):d.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(d),this.viewer.viewport.applyConstraints()}}function n(l){var u={tracker:l.eventSource,position:l.position,delta:l.delta,speed:l.speed,direction:l.direction,shift:l.shift,originalEvent:l.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",u),!u.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(l.delta.x=0),this.panVertical||(l.delta.y=0),this.viewer.viewport.flipped&&(l.delta.x=-l.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(l.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(l){l.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function c(l){var u={tracker:l.eventSource,position:l.position,scroll:l.scroll,shift:l.shift,originalEvent:l.originalEvent,preventDefault:l.preventDefault};this.viewer.raiseEvent("navigator-scroll",u),l.preventDefault=u.preventDefault}function o(l,u){a(l,"rotate("+u+"deg)")}function a(l,u){l.style.webkitTransform=u,l.style.mozTransform=u,l.style.msTransform=u,l.style.oTransform=u,l.style.transform=u}}(r),function(e){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var s=n.split("."),c=null,o=arguments,a=i,l;for(l=0;l<s.length-1;l++)a=a[s[l]]||{};return c=a[s[l]],typeof c!="string"&&(e.console.error("Untranslated source string:",n),c=""),c.replace(/\{\d+\}/g,function(u){var d=parseInt(u.match(/\d+/),10)+1;return d<o.length?o[d]:""})},setString:function(n,s){var c=n.split("."),o=i,a;for(a=0;a<c.length-1;a++)o[c[a]]||(o[c[a]]={}),o=o[c[a]];o[c[a]]=s}})}(r),function(e){e.Point=function(i,n){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(i){return new e.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new e.Point(this.x-i.x,this.y-i.y)},times:function(i){return new e.Point(this.x*i,this.y*i)},divide:function(i){return new e.Point(this.x/i,this.y/i)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new e.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof e.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,n){n=n||new e.Point(0,0);var s,c;if(i%90===0){var o=e.positiveModulo(i,360);switch(o){case 0:s=1,c=0;break;case 90:s=0,c=1;break;case 180:s=-1,c=0;break;case 270:s=0,c=-1;break}}else{var a=i*Math.PI/180;s=Math.cos(a),c=Math.sin(a)}var l=s*(this.x-n.x)-c*(this.y-n.y)+n.x,u=c*(this.x-n.x)+s*(this.y-n.y)+n.y;return new e.Point(l,u)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(r),function(e){e.TileSource=function(n,s,c,o,a,l){var u=this,d=arguments,f,w;if(e.isPlainObject(n)?f=n:f={width:d[0],height:d[1],tileSize:d[2],tileOverlap:d[3],minLevel:d[4],maxLevel:d[5]},e.EventSource.call(this),e.extend(!0,this,f),!this.success){for(w=0;w<arguments.length;w++)if(e.isFunction(arguments[w])){this.success=arguments[w];break}}this.success&&this.addHandler("ready",function(y){u.success(y)}),e.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=f.width&&f.height?f.width/f.height:1,this.dimensions=new e.Point(f.width,f.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=f.tileOverlap?f.tileOverlap:0,this.minLevel=f.minLevel?f.minLevel:0,this.maxLevel=f.maxLevel!==void 0&&f.maxLevel!==null?f.maxLevel:f.width&&f.height?Math.ceil(Math.log(Math.max(f.width,f.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(n){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(n){return this._tileWidth?this._tileWidth:this.getTileSize(n)},getTileHeight:function(n){return this._tileHeight?this._tileHeight:this.getTileSize(n)},setMaxLevel:function(n){this.maxLevel=n,this._memoizeLevelScale()},getLevelScale:function(n){return this._memoizeLevelScale(),this.getLevelScale(n)},_memoizeLevelScale:function(){var n={},s;for(s=0;s<=this.maxLevel;s++)n[s]=1/Math.pow(2,this.maxLevel-s);this.getLevelScale=function(c){return n[c]}},getNumTiles:function(n){var s=this.getLevelScale(n),c=Math.ceil(s*this.dimensions.x/this.getTileWidth(n)),o=Math.ceil(s*this.dimensions.y/this.getTileHeight(n));return new e.Point(c,o)},getPixelRatio:function(n){var s=this.dimensions.times(this.getLevelScale(n)),c=1/s.x*e.pixelDensityRatio,o=1/s.y*e.pixelDensityRatio;return new e.Point(c,o)},getClosestLevel:function(){var n,s;for(n=this.minLevel+1;n<=this.maxLevel&&(s=this.getNumTiles(n),!(s.x>1||s.y>1));n++);return n-1},getTileAtPoint:function(n,s){var c=s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/this.aspectRatio;e.console.assert(c,"[TileSource.getTileAtPoint] must be called with a valid point.");var o=this.dimensions.x*this.getLevelScale(n),a=s.x*o,l=s.y*o,u=Math.floor(a/this.getTileWidth(n)),d=Math.floor(l/this.getTileHeight(n));s.x>=1&&(u=this.getNumTiles(n).x-1);var f=1e-15;return s.y>=1/this.aspectRatio-f&&(d=this.getNumTiles(n).y-1),new e.Point(u,d)},getTileBounds:function(n,s,c,o){var a=this.dimensions.times(this.getLevelScale(n)),l=this.getTileWidth(n),u=this.getTileHeight(n),d=s===0?0:l*s-this.tileOverlap,f=c===0?0:u*c-this.tileOverlap,w=l+(s===0?1:2)*this.tileOverlap,y=u+(c===0?1:2)*this.tileOverlap,x=1/a.x;return w=Math.min(w,a.x-d),y=Math.min(y,a.y-f),o?new e.Rect(0,0,w,y):new e.Rect(d*x,f*x,w*x,y*x)},getImageInfo:function(n){var s=this,c,o,a,l,u,d,f;n&&(u=n.split("/"),d=u[u.length-1],f=d.lastIndexOf("."),f>-1&&(u[u.length-1]=d.slice(0,f)));var w=null;if(this.splitHashDataForPost){var y=n.indexOf("#");y!==-1&&(w=n.substring(y+1),n=n.substr(0,y))}o=function(x){typeof x=="string"&&(x=e.parseXml(x));var T=e.TileSource.determineType(s,x,n);if(!T){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n});return}l=T.prototype.configure.apply(s,[x,n,w]),l.ajaxWithCredentials===void 0&&(l.ajaxWithCredentials=s.ajaxWithCredentials),a=new T(l),s.ready=!0,s.raiseEvent("ready",{tileSource:a})},n.match(/\.js$/)?(c=n.split("/").pop().replace(".js",""),e.jsonp({url:n,async:!1,callbackName:c,callback:o})):e.makeAjaxRequest({url:n,postData:w,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(x){var T=i(x);o(T)},error:function(x,T){var S;try{S="HTTP "+x.status+" attempting to load TileSource: "+n}catch{var L;typeof T>"u"||!T.toString?L="Unknown error":L=T.toString(),S=L+" attempting to load TileSource: "+n}e.console.error(S),s.raiseEvent("open-failed",{message:S,source:n,postData:w})}})},supports:function(n,s){return!1},configure:function(n,s,c){throw new Error("Method not implemented.")},getTileUrl:function(n,s,c){throw new Error("Method not implemented.")},getTilePostData:function(n,s,c){return null},getTileAjaxHeaders:function(n,s,c){return{}},getTileHashKey:function(n,s,c,o,a,l){return a?o+"+"+JSON.stringify(a):o},tileExists:function(n,s,c){var o=this.getNumTiles(n);return n>=this.minLevel&&n<=this.maxLevel&&s>=0&&c>=0&&s<o.x&&c<o.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function i(n){var s=n.responseText,c=n.status,o,a;if(n){if(n.status!==200&&n.status!==0)throw c=n.status,o=c===404?"Not Found":n.statusText,new Error(e.getString("Errors.Status",c,o))}else throw new Error(e.getString("Errors.Security"));if(s.match(/\s*<.*/))try{a=n.responseXML&&n.responseXML.documentElement?n.responseXML:e.parseXml(s)}catch{a=n.responseText}else if(s.match(/\s*[{[].*/))try{a=e.parseJSON(s)}catch{a=s}else a=s;return a}e.TileSource.determineType=function(n,s,c){var o;for(o in r)if(o.match(/.+TileSource$/)&&e.isFunction(r[o])&&e.isFunction(r[o].prototype.supports)&&r[o].prototype.supports.call(n,s,c))return r[o];return e.console.error("No TileSource was able to open %s %s",c,s),null}}(r),function(e){e.DziTileSource=function(s,c,o,a,l,u,d,f,w){var y,x,T,S;if(e.isPlainObject(s)?S=s:S={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=S.tilesUrl,this.fileFormat=S.fileFormat,this.displayRects=S.displayRects,this.displayRects)for(y=this.displayRects.length-1;y>=0;y--)for(x=this.displayRects[y],T=x.minLevel;T<=x.maxLevel;T++)this._levelRects[T]||(this._levelRects[T]=[]),this._levelRects[T].push(x);e.TileSource.apply(this,[S])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(s,c){var o;return s.Image?o=s.Image.xmlns:s.documentElement&&(s.documentElement.localName==="Image"||s.documentElement.tagName==="Image")&&(o=s.documentElement.namespaceURI),o=(o||"").toLowerCase(),o.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||o.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,c,o){var a;return e.isPlainObject(s)?a=n(this,s):a=i(this,s),c&&!a.tilesUrl&&(a.tilesUrl=c.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),c.search(/\.(dzi|xml|js)\?/)!==-1?a.queryParams=c.match(/\?.*/):a.queryParams=""),a},getTileUrl:function(s,c,o){return[this.tilesUrl,s,"/",c,"_",o,".",this.fileFormat,this.queryParams].join("")},tileExists:function(s,c,o){var a=this._levelRects[s],l,u,d,f,w,y,x;if(this.minLevel&&s<this.minLevel||this.maxLevel&&s>this.maxLevel)return!1;if(!a||!a.length)return!0;for(x=a.length-1;x>=0;x--)if(l=a[x],!(s<l.minLevel||s>l.maxLevel)&&(u=this.getLevelScale(s),d=l.x*u,f=l.y*u,w=d+l.width*u,y=f+l.height*u,d=Math.floor(d/this._tileWidth),f=Math.floor(f/this._tileWidth),w=Math.ceil(w/this._tileWidth),y=Math.ceil(y/this._tileWidth),d<=c&&c<w&&f<=o&&o<y))return!0;return!1}});function i(s,c){if(!c||!c.documentElement)throw new Error(e.getString("Errors.Xml"));var o=c.documentElement,a=o.localName||o.tagName,l=c.documentElement.namespaceURI,u=null,d=[],f,w,y,x,T;if(a==="Image")try{if(x=o.getElementsByTagName("Size")[0],x===void 0&&(x=o.getElementsByTagNameNS(l,"Size")[0]),u={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(x.getAttribute("Height"),10),Width:parseInt(x.getAttribute("Width"),10)}}},!e.imageFormatSupported(u.Image.Format))throw new Error(e.getString("Errors.ImageFormat",u.Image.Format.toUpperCase()));for(f=o.getElementsByTagName("DisplayRect"),f===void 0&&(f=o.getElementsByTagNameNS(l,"DisplayRect")[0]),T=0;T<f.length;T++)w=f[T],y=w.getElementsByTagName("Rect")[0],y===void 0&&(y=w.getElementsByTagNameNS(l,"Rect")[0]),d.push({Rect:{X:parseInt(y.getAttribute("X"),10),Y:parseInt(y.getAttribute("Y"),10),Width:parseInt(y.getAttribute("Width"),10),Height:parseInt(y.getAttribute("Height"),10),MinLevel:parseInt(w.getAttribute("MinLevel"),10),MaxLevel:parseInt(w.getAttribute("MaxLevel"),10)}});return d.length&&(u.Image.DisplayRect=d),n(s,u)}catch(I){throw I instanceof Error?I:new Error(e.getString("Errors.Dzi"))}else{if(a==="Collection")throw new Error(e.getString("Errors.Dzc"));if(a==="Error"){var S=o.getElementsByTagName("Message")[0],L=S.firstChild.nodeValue;throw new Error(L)}}throw new Error(e.getString("Errors.Dzi"))}function n(s,c){var o=c.Image,a=o.Url,l=o.Format,u=o.Size,d=o.DisplayRect||[],f=parseInt(u.Width,10),w=parseInt(u.Height,10),y=parseInt(o.TileSize,10),x=parseInt(o.Overlap,10),T=[],S,L;for(L=0;L<d.length;L++)S=d[L].Rect,T.push(new e.DisplayRect(parseInt(S.X,10),parseInt(S.Y,10),parseInt(S.Width,10),parseInt(S.Height,10),parseInt(S.MinLevel,10),parseInt(S.MaxLevel,10)));return e.extend(!0,{width:f,height:w,tileSize:y,tileOverlap:x,minLevel:null,maxLevel:null,tilesUrl:a,fileFormat:l,displayRects:T},c)}}(r),function(e){e.IIIFTileSource=function(o){if(e.extend(!0,this,o),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var a=0;a<this.tiles.length;a++)for(var l=0;l<this.tiles[a].scaleFactors.length;l++){var u=this.tiles[a].scaleFactors[l];this.scale_factors.push(u),o.tileSizePerScaleFactor[u]={width:this.tiles[a].width,height:this.tiles[a].height||this.tiles[a].width}}}else if(i(o)){for(var d=Math.min(this.height,this.width),f=[256,512,1024],w=[],y=0;y<f.length;y++)f[y]<=d&&w.push(f[y]);w.length>0?o.tileSize=Math.max.apply(null,w):o.tileSize=d}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=n(this),e.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)o.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var x=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(x)*Math.LOG2E)}e.TileSource.apply(this,[o])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(o,a){return o.protocol&&o.protocol==="http://iiif.io/api/image"||o["@context"]&&(o["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||o["@context"]==="http://iiif.io/api/image/1/context.json")||o.profile&&o.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||o.identifier&&o.width&&o.height?!0:!!(o.documentElement&&o.documentElement.tagName==="info"&&o.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(o,a,l){if(e.isPlainObject(o)){if(!o["@context"])o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=a.replace("/info.json",""),o.version=1;else{var d=o["@context"];if(Array.isArray(d)){for(var f=0;f<d.length;f++)if(typeof d[f]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(d[f])||d[f]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){d=d[f];break}}switch(d){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":o.version=1;break;case"http://iiif.io/api/image/2/context.json":o.version=2;break;case"http://iiif.io/api/image/3/context.json":o.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!o["@id"]&&o.id&&(o["@id"]=o.id),o.preferredFormats){for(var w=0;w<o.preferredFormats.length;w++)if(r.imageFormatSupported(o.preferredFormats[w])){o.tileFormat=o.preferredFormats[w];break}}return o}else{var u=s(o);return u["@context"]="http://iiif.io/api/image/1.0/context.json",u["@id"]=a.replace("/info.xml",""),u.version=1,u}},getTileWidth:function(o){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].width:this._tileWidth},getTileHeight:function(o){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,o);var a=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[a]?this.tileSizePerScaleFactor[a].height:this._tileHeight},getLevelScale:function(o){if(this.emulateLegacyImagePyramid){var a=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(a=this.levels[o].width/this.levels[this.maxLevel].width),a}return e.TileSource.prototype.getLevelScale.call(this,o)},getNumTiles:function(o){if(this.emulateLegacyImagePyramid){var a=this.getLevelScale(o);return a?new e.Point(1,1):new e.Point(0,0)}return e.TileSource.prototype.getNumTiles.call(this,o)},getTileAtPoint:function(o,a){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,o,a)},getTileUrl:function(o,a,l){if(this.emulateLegacyImagePyramid){var u=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(u=this.levels[o].url),u}var d="0",f=Math.pow(.5,this.maxLevel-o),w=Math.ceil(this.width*f),y=Math.ceil(this.height*f),x,T,S,L,I,j,Y,Q,ie,J,ee,K,we,ve;return x=this.getTileWidth(o),T=this.getTileHeight(o),S=Math.ceil(x/f),L=Math.ceil(T/f),this.version===1?we="native."+this.tileFormat:we="default."+this.tileFormat,w<x&&y<T?(this.version===2&&w===this.width?J="full":this.version===3&&w===this.width&&y===this.height?J="max":this.version===3?J=w+","+y:J=w+",",I="full"):(j=a*S,Y=l*L,Q=Math.min(S,this.width-j),ie=Math.min(L,this.height-Y),a===0&&l===0&&Q===this.width&&ie===this.height?I="full":I=[j,Y,Q,ie].join(","),ee=Math.ceil(Q*f),K=Math.ceil(ie*f),this.version===2&&ee===this.width?J="full":this.version===3&&ee===this.width&&K===this.height?J="max":this.version===3?J=ee+","+K:J=ee+","),ve=[this["@id"],I,J,d,we].join("/"),ve},__testonly__:{canBeTiled:i,constructLevels:n}});function i(o){var a=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],l=Array.isArray(o.profile)?o.profile[0]:o.profile,u=a.indexOf(l)!==-1,d=!1;return o.version===2&&o.profile.length>1&&o.profile[1].supports&&(d=o.profile[1].supports.indexOf("sizeByW")!==-1),o.version===3&&o.extraFeatures&&(d=o.extraFeatures.indexOf("sizeByWh")!==-1),!u||d}function n(o){for(var a=[],l=0;l<o.sizes.length;l++)a.push({url:o["@id"]+"/full/"+o.sizes[l].width+","+(o.version===3?o.sizes[l].height:"")+"/0/default."+o.tileFormat,width:o.sizes[l].width,height:o.sizes[l].height});return a.sort(function(u,d){return u.width-d.width})}function s(o){if(!o||!o.documentElement)throw new Error(e.getString("Errors.Xml"));var a=o.documentElement,l=a.tagName,u=null;if(l==="info")try{return u={},c(a,u),u}catch(d){throw d instanceof Error?d:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function c(o,a,l){var u,d;if(o.nodeType===3&&l)d=o.nodeValue.trim(),d.match(/^\d*$/)&&(d=Number(d)),a[l]?(e.isArray(a[l])||(a[l]=[a[l]]),a[l].push(d)):a[l]=d;else if(o.nodeType===1)for(u=0;u<o.childNodes.length;u++)c(o.childNodes[u],a,o.nodeName)}}(r),function(e){e.OsmTileSource=function(i,n,s,c,o){var a;e.isPlainObject(i)?a=i:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!a.width||!a.height)&&(a.width=65572864,a.height=65572864),a.tileSize||(a.tileSize=256,a.tileOverlap=0),a.tilesUrl||(a.tilesUrl="http://tile.openstreetmap.org/"),a.minLevel=8,e.TileSource.apply(this,[a])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="openstreetmaps"},configure:function(i,n,s){return i},getTileUrl:function(i,n,s){return this.tilesUrl+(i-8)+"/"+n+"/"+s+".png"}})}(r),function(e){e.TmsTileSource=function(i,n,s,c,o){var a;e.isPlainObject(i)?a=i:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var l=Math.ceil(a.width/256)*256,u=Math.ceil(a.height/256)*256,d;l>u?d=l/256:d=u/256,a.maxLevel=Math.ceil(Math.log(d)/Math.log(2))-1,a.tileSize=256,a.width=l,a.height=u,e.TileSource.apply(this,[a])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="tiledmapservice"},configure:function(i,n,s){return i},getTileUrl:function(i,n,s){var c=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+n+"/"+(c-s)+".png"}})}(r),function(e){e.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var n={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(n.x,10)>i.tileSize||parseInt(n.y,10)>i.tileSize;)n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2),i.imageSizes.push({x:n.x,y:n.y}),i.gridSize.push(this._getGridSize(n.x,n.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,r.TileSource.apply(this,[i])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(i,n,s){return{x:Math.ceil(i/s),y:Math.ceil(n/s)}},_calculateAbsoluteTileNumber:function(i,n,s){for(var c=0,o={},a=0;a<i;a++)o=this.gridSize[a],c+=o.x*o.y;return o=this.gridSize[i],c+=o.x*s+n,c},supports:function(i,n){return i.type&&i.type==="zoomifytileservice"},configure:function(i,n,s){return i},getTileUrl:function(i,n,s){var c=0,o=this._calculateAbsoluteTileNumber(i,n,s);return c=Math.floor(o/256),this.tilesUrl+"TileGroup"+c+"/"+i+"-"+n+"-"+s+"."+this.fileFormat}})}(r),function(e){e.LegacyTileSource=function(c){var o,a,l;e.isArray(c)&&(o={type:"legacy-image-pyramid",levels:c}),o.levels=i(o.levels),o.levels.length>0?(a=o.levels[o.levels.length-1].width,l=o.levels[o.levels.length-1].height):(a=0,l=0,e.console.error("No supported image formats found")),e.extend(!0,o,{width:a,height:l,tileSize:Math.max(l,a),tileOverlap:0,minLevel:0,maxLevel:o.levels.length>0?o.levels.length-1:0}),e.TileSource.apply(this,[o]),this.levels=o.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(c,o){return c.type&&c.type==="legacy-image-pyramid"||c.documentElement&&c.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(c,o,a){var l;return e.isPlainObject(c)?l=s(this,c):l=n(this,c),l},getLevelScale:function(c){var o=NaN;return this.levels.length>0&&c>=this.minLevel&&c<=this.maxLevel&&(o=this.levels[c].width/this.levels[this.maxLevel].width),o},getNumTiles:function(c){var o=this.getLevelScale(c);return o?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(c,o,a){var l=null;return this.levels.length>0&&c>=this.minLevel&&c<=this.maxLevel&&(l=this.levels[c].url),l}});function i(c){var o=[],a,l;for(l=0;l<c.length;l++)a=c[l],a.height&&a.width&&a.url?o.push({url:a.url,width:Number(a.width),height:Number(a.height)}):e.console.error("Unsupported image format: %s",a.url?a.url:"<no URL>");return o.sort(function(u,d){return u.height-d.height})}function n(c,o){if(!o||!o.documentElement)throw new Error(e.getString("Errors.Xml"));var a=o.documentElement,l=a.tagName,u=null,d=[],f,w;if(l==="image")try{for(u={type:a.getAttribute("type"),levels:[]},d=a.getElementsByTagName("level"),w=0;w<d.length;w++)f=d[w],u.levels.push({url:f.getAttribute("url"),width:parseInt(f.getAttribute("width"),10),height:parseInt(f.getAttribute("height"),10)});return s(c,u)}catch(y){throw y instanceof Error?y:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(l==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(l==="error")throw new Error("Error: "+o)}throw new Error("Unknown element "+l)}function s(c,o){return o.levels}}(r),function(e){e.ImageTileSource=function(i){i=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),e.TileSource.apply(this,[i])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="image"},configure:function(i,n,s){return i},getImageInfo:function(i){var n=this._image=new Image,s=this;this.crossOriginPolicy&&(n.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(n.useCredentials=this.ajaxWithCredentials),e.addEvent(n,"load",function(){s.width=n.naturalWidth,s.height=n.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new e.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),e.addEvent(n,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),n.src=i},getLevelScale:function(i){var n=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(n=this.levels[i].width/this.levels[this.maxLevel].width),n},getNumTiles:function(i){var n=this.getLevelScale(i);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(i,n,s){var c=null;return i>=this.minLevel&&i<=this.maxLevel&&(c=this.levels[i].url),c},getContext2D:function(i,n,s){var c=null;return i>=this.minLevel&&i<=this.maxLevel&&(c=this.levels[i].context2D),c},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,i;var n=this._image.naturalWidth,s=this._image.naturalHeight,c=document.createElement("canvas"),o=c.getContext("2d");if(c.width=n,c.height=s,o.drawImage(this._image,0,0,n,s),i[0].context2D=o,delete this._image,e.isCanvasTainted(c))return i;for(;n>=2&&s>=2;){n=Math.floor(n/2),s=Math.floor(s/2);var a=document.createElement("canvas"),l=a.getContext("2d");a.width=n,a.height=s,l.drawImage(c,0,0,n,s),i.splice(0,0,{context2D:l,width:n,height:s}),c=a,o=l}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D&&(this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0)}})}(r),function(e){e.TileSourceCollection=function(i,n,s,c){e.console.error("TileSourceCollection is deprecated; use World instead")}}(r),function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(l){var u=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},l),this.element=l.element||e.makeNeutralElement("div"),l.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(d){d.insideElementPressed?(o(u,e.ButtonState.DOWN),u.raiseEvent("enter",{originalEvent:d.originalEvent})):d.buttonDownAny||o(u,e.ButtonState.HOVER)},focusHandler:function(d){u.tracker.enterHandler(d),u.raiseEvent("focus",{originalEvent:d.originalEvent})},leaveHandler:function(d){a(u,e.ButtonState.GROUP),d.insideElementPressed&&u.raiseEvent("exit",{originalEvent:d.originalEvent})},blurHandler:function(d){u.tracker.leaveHandler(d),u.raiseEvent("blur",{originalEvent:d.originalEvent})},pressHandler:function(d){o(u,e.ButtonState.DOWN),u.raiseEvent("press",{originalEvent:d.originalEvent})},releaseHandler:function(d){d.insideElementPressed&&d.insideElementReleased?(a(u,e.ButtonState.HOVER),u.raiseEvent("release",{originalEvent:d.originalEvent})):d.insideElementPressed?a(u,e.ButtonState.GROUP):o(u,e.ButtonState.HOVER)},clickHandler:function(d){d.quick&&u.raiseEvent("click",{originalEvent:d.originalEvent})},keyHandler:function(d){d.keyCode===13?(u.raiseEvent("click",{originalEvent:d.originalEvent}),u.raiseEvent("release",{originalEvent:d.originalEvent}),d.preventDefault=!0):d.preventDefault=!1}}),a(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){o(this,e.ButtonState.GROUP)},notifyGroupExit:function(){a(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(l){e.requestAnimationFrame(function(){n(l)})}function n(l){var u,d,f;l.shouldFade&&(u=e.now(),d=u-l.fadeBeginTime,f=1-d/l.fadeLength,f=Math.min(1,f),f=Math.max(0,f),l.imgGroup&&e.setElementOpacity(l.imgGroup,f,!0),f>0&&i(l))}function s(l){l.shouldFade=!0,l.fadeBeginTime=e.now()+l.fadeDelay,window.setTimeout(function(){i(l)},l.fadeDelay)}function c(l){l.shouldFade=!1,l.imgGroup&&e.setElementOpacity(l.imgGroup,1,!0)}function o(l,u){l.element.disabled||(u>=e.ButtonState.GROUP&&l.currentState===e.ButtonState.REST&&(c(l),l.currentState=e.ButtonState.GROUP),u>=e.ButtonState.HOVER&&l.currentState===e.ButtonState.GROUP&&(l.imgHover&&(l.imgHover.style.visibility=""),l.currentState=e.ButtonState.HOVER),u>=e.ButtonState.DOWN&&l.currentState===e.ButtonState.HOVER&&(l.imgDown&&(l.imgDown.style.visibility=""),l.currentState=e.ButtonState.DOWN))}function a(l,u){l.element.disabled||(u<=e.ButtonState.HOVER&&l.currentState===e.ButtonState.DOWN&&(l.imgDown&&(l.imgDown.style.visibility="hidden"),l.currentState=e.ButtonState.HOVER),u<=e.ButtonState.GROUP&&l.currentState===e.ButtonState.HOVER&&(l.imgHover&&(l.imgHover.style.visibility="hidden"),l.currentState=e.ButtonState.GROUP),u<=e.ButtonState.REST&&l.currentState===e.ButtonState.GROUP&&(s(l),l.currentState=e.ButtonState.REST))}}(r),function(e){e.ButtonGroup=function(i){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var n=this.buttons.concat([]),s=this,c;if(this.element=i.element||e.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",c=0;c<n.length;c++)this.element.appendChild(n[c].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){var a;for(a=0;a<s.buttons.length;a++)s.buttons[a].notifyGroupEnter()},leaveHandler:function(o){var a;if(!o.insideElementPressed)for(a=0;a<s.buttons.length;a++)s.buttons[a].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(r),function(e){e.Rect=function(i,n,s,c,o){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0,this.width=typeof s=="number"?s:0,this.height=typeof c=="number"?c:0,this.degrees=typeof o=="number"?o:0,this.degrees=e.positiveModulo(this.degrees,360);var a,l;this.degrees>=270?(a=this.getTopRight(),this.x=a.x,this.y=a.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=270):this.degrees>=180?(a=this.getBottomRight(),this.x=a.x,this.y=a.y,this.degrees-=180):this.degrees>=90&&(a=this.getBottomLeft(),this.x=a.x,this.y=a.y,l=this.height,this.height=this.width,this.width=l,this.degrees-=90)},e.Rect.fromSummits=function(i,n,s){var c=i.distanceTo(n),o=i.distanceTo(s),a=n.minus(i),l=Math.atan(a.y/a.x);return a.x<0?l+=Math.PI:a.y<0&&(l+=2*Math.PI),new e.Rect(i.x,i.y,c,o,l/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(i){return i instanceof e.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new e.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new e.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var n=this.getBoundingBox(),s=i.getBoundingBox(),c=Math.min(n.x,s.x),o=Math.min(n.y,s.y),a=Math.max(n.x+n.width,s.x+s.width),l=Math.max(n.y+n.height,s.y+s.height);return new e.Rect(c,o,a-c,l-o)},intersection:function(i){var n=1e-10,s=[],c=this.getTopLeft();i.containsPoint(c,n)&&s.push(c);var o=this.getTopRight();i.containsPoint(o,n)&&s.push(o);var a=this.getBottomLeft();i.containsPoint(a,n)&&s.push(a);var l=this.getBottomRight();i.containsPoint(l,n)&&s.push(l);var u=i.getTopLeft();this.containsPoint(u,n)&&s.push(u);var d=i.getTopRight();this.containsPoint(d,n)&&s.push(d);var f=i.getBottomLeft();this.containsPoint(f,n)&&s.push(f);var w=i.getBottomRight();this.containsPoint(w,n)&&s.push(w);for(var y=this._getSegments(),x=i._getSegments(),T=0;T<y.length;T++)for(var S=y[T],L=0;L<x.length;L++){var I=x[L],j=Y(S[0],S[1],I[0],I[1]);j&&s.push(j)}function Y(ve,Ke,We,ht){var me=Ke.minus(ve),pe=ht.minus(We),de=-pe.x*me.y+me.x*pe.y;if(de===0)return null;var Ae=(me.x*(ve.y-We.y)-me.y*(ve.x-We.x))/de,ne=(pe.x*(ve.y-We.y)-pe.y*(ve.x-We.x))/de;return-n<=Ae&&Ae<=1-n&&-n<=ne&&ne<=1-n?new e.Point(ve.x+ne*me.x,ve.y+ne*me.y):null}if(s.length===0)return null;for(var Q=s[0].x,ie=s[0].x,J=s[0].y,ee=s[0].y,K=1;K<s.length;K++){var we=s[K];we.x<Q&&(Q=we.x),we.x>ie&&(ie=we.x),we.y<J&&(J=we.y),we.y>ee&&(ee=we.y)}return new e.Rect(Q,J,ie-Q,ee-J)},_getSegments:function(){var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),c=this.getBottomRight();return[[i,n],[n,c],[c,s],[s,i]]},rotate:function(i,n){if(i=e.positiveModulo(i,360),i===0)return this.clone();n=n||this.getCenter();var s=this.getTopLeft().rotate(i,n),c=this.getTopRight().rotate(i,n),o=c.minus(s);o=o.apply(function(l){var u=1e-15;return Math.abs(l)<u?0:l});var a=Math.atan(o.y/o.x);return o.x<0?a+=Math.PI:o.y<0&&(a+=2*Math.PI),new e.Rect(s.x,s.y,this.width,this.height,a/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),c=this.getBottomRight(),o=Math.min(i.x,n.x,s.x,c.x),a=Math.max(i.x,n.x,s.x,c.x),l=Math.min(i.y,n.y,s.y,c.y),u=Math.max(i.y,n.y,s.y,c.y);return new e.Rect(o,l,a-o,u-l)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),n=Math.floor(i.x),s=Math.floor(i.y),c=Math.ceil(i.width+i.x-n),o=Math.ceil(i.height+i.y-s);return new e.Rect(n,s,c,o)},containsPoint:function(i,n){n=n||0;var s=this.getTopLeft(),c=this.getTopRight(),o=this.getBottomLeft(),a=c.minus(s),l=o.minus(s);return(i.x-s.x)*a.x+(i.y-s.y)*a.y>=-n&&(i.x-c.x)*a.x+(i.y-c.y)*a.y<=n&&(i.x-s.x)*l.x+(i.y-s.y)*l.y>=-n&&(i.x-o.x)*l.x+(i.y-o.y)*l.y<=n},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(r),function(e){var i={};e.ReferenceStrip=function(f){var w=this,y=f.viewer,x=e.getElementSize(y.element),T,S,L;for(f.id||(f.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=f.id,this.element.className="referencestrip"),f=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},f,{element:this.element}),e.extend(this,f),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,S=this.element.style,S.marginTop="0px",S.marginRight="0px",S.marginBottom="0px",S.marginLeft="0px",S.left="0px",S.bottom="0px",S.border="0px",S.background="#000",S.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=y,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,n),dragHandler:e.delegate(this,s),scrollHandler:e.delegate(this,c),enterHandler:e.delegate(this,a),leaveHandler:e.delegate(this,l),keyDownHandler:e.delegate(this,u),keyHandler:e.delegate(this,d),preProcessEventHandler:function(I){I.eventType==="wheel"&&(I.preventDefault=!0)}}),f.width&&f.height?(this.element.style.width=f.width+"px",this.element.style.height=f.height+"px",y.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):f.scroll==="horizontal"?(this.element.style.width=x.x*f.sizeRatio*y.tileSources.length+12*y.tileSources.length+"px",this.element.style.height=x.y*f.sizeRatio+"px",y.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=x.y*f.sizeRatio*y.tileSources.length+12*y.tileSources.length+"px",this.element.style.width=x.x*f.sizeRatio+"px",y.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=x.x*this.sizeRatio+8,this.panelHeight=x.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},L=0;L<y.tileSources.length;L++)T=e.makeNeutralElement("div"),T.id=this.element.id+"-"+L,T.style.width=w.panelWidth+"px",T.style.height=w.panelHeight+"px",T.style.display="inline",T.style.float="left",T.style.cssFloat="left",T.style.styleFloat="left",T.style.padding="2px",e.setElementTouchActionNone(T),e.setElementPointerEventsNone(T),this.element.appendChild(T),T.activePanel=!1,this.panels.push(T);o(this,this.scroll==="vertical"?x.y:x.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(f){var w=this.element.querySelector("#"+this.element.id+"-"+f),y=e.getElementSize(this.viewer.canvas),x=Number(this.element.style.width.replace("px","")),T=Number(this.element.style.height.replace("px","")),S=-Number(this.element.style.marginLeft.replace("px","")),L=-Number(this.element.style.marginTop.replace("px","")),I;this.currentSelected!==w&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=w,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(I=Number(f)*(this.panelWidth+3),I>S+y.x-this.panelWidth?(I=Math.min(I,x-y.x),this.element.style.marginLeft=-I+"px",o(this,y.x,-I)):I<S&&(I=Math.max(0,I-y.x/2),this.element.style.marginLeft=-I+"px",o(this,y.x,-I))):(I=Number(f)*(this.panelHeight+3),I>L+y.y-this.panelHeight?(I=Math.min(I,T-y.y),this.element.style.marginTop=-I+"px",o(this,y.y,-I)):I<L&&(I=Math.max(0,I-y.y/2),this.element.style.marginTop=-I+"px",o(this,y.y,-I))),this.currentPage=f,a.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var f in this.miniViewers)this.miniViewers[f].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function n(f){if(f.quick){var w;this.scroll==="horizontal"?w=Math.floor(f.position.x/this.panelWidth):w=Math.floor(f.position.y/this.panelHeight),this.viewer.goToPage(w)}this.element.focus()}function s(f){if(this.dragging=!0,this.element){var w=Number(this.element.style.marginLeft.replace("px","")),y=Number(this.element.style.marginTop.replace("px","")),x=Number(this.element.style.width.replace("px","")),T=Number(this.element.style.height.replace("px","")),S=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-f.delta.x>0?w>-(x-S.x)&&(this.element.style.marginLeft=w+f.delta.x*2+"px",o(this,S.x,w+f.delta.x*2)):-f.delta.x<0&&w<0&&(this.element.style.marginLeft=w+f.delta.x*2+"px",o(this,S.x,w+f.delta.x*2)):-f.delta.y>0?y>-(T-S.y)&&(this.element.style.marginTop=y+f.delta.y*2+"px",o(this,S.y,y+f.delta.y*2)):-f.delta.y<0&&y<0&&(this.element.style.marginTop=y+f.delta.y*2+"px",o(this,S.y,y+f.delta.y*2))}}function c(f){if(this.element){var w=Number(this.element.style.marginLeft.replace("px","")),y=Number(this.element.style.marginTop.replace("px","")),x=Number(this.element.style.width.replace("px","")),T=Number(this.element.style.height.replace("px","")),S=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?f.scroll>0?w>-(x-S.x)&&(this.element.style.marginLeft=w-f.scroll*60+"px",o(this,S.x,w-f.scroll*60)):f.scroll<0&&w<0&&(this.element.style.marginLeft=w-f.scroll*60+"px",o(this,S.x,w-f.scroll*60)):f.scroll<0?y>S.y-T&&(this.element.style.marginTop=y+f.scroll*60+"px",o(this,S.y,y+f.scroll*60)):f.scroll>0&&y<0&&(this.element.style.marginTop=y+f.scroll*60+"px",o(this,S.y,y+f.scroll*60)),f.preventDefault=!0}}function o(f,w,y){var x,T,S,L,I,j;for(f.scroll==="horizontal"?x=f.panelWidth:x=f.panelHeight,T=Math.ceil(w/x)+5,S=Math.ceil((Math.abs(y)+w)/x)+1,T=S-T,T=T<0?0:T,I=T;I<S&&I<f.panels.length;I++)if(j=f.panels[I],!j.activePanel){var Y,Q=f.viewer.tileSources[I];Q.referenceStripThumbnailUrl?Y={type:"image",url:Q.referenceStripThumbnailUrl}:Y=Q,L=new e.Viewer({id:j.id,tileSources:[Y],element:j,navigatorSizeRatio:f.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:f.viewer.loadTilesWithAjax,ajaxHeaders:f.viewer.ajaxHeaders,useCanvas:f.useCanvas}),e.setElementPointerEventsNone(L.canvas),e.setElementPointerEventsNone(L.container),L.innerTracker.setTracking(!1),L.outerTracker.setTracking(!1),f.miniViewers[j.id]=L,j.activePanel=!0}}function a(f){var w=f.eventSource.element;this.scroll==="horizontal"?w.style.marginBottom="0px":w.style.marginLeft="0px"}function l(f){var w=f.eventSource.element;this.scroll==="horizontal"?w.style.marginBottom="-"+e.getElementSize(w).y/2+"px":w.style.marginLeft="-"+e.getElementSize(w).x/2+"px"}function u(f){if(!f.ctrl&&!f.alt&&!f.meta)switch(f.keyCode){case 38:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;case 40:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 37:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 39:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;default:f.preventDefault=!1;break}else f.preventDefault=!1}function d(f){if(!f.ctrl&&!f.alt&&!f.meta)switch(f.keyCode){case 61:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;case 45:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 48:case 119:case 87:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;case 115:case 83:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 97:c.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),f.preventDefault=!0;break;case 100:c.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),f.preventDefault=!0;break;default:f.preventDefault=!1;break}else f.preventDefault=!1}}(r),function(e){e.DisplayRect=function(i,n,s,c,o,a){e.Rect.apply(this,[i,n,s,c]),this.minLevel=o,this.maxLevel=a},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(r),function(e){e.Spring=function(n){var s=arguments;typeof n!="object"&&(n={initial:s.length&&typeof s[0]=="number"?s[0]:void 0,springStiffness:s.length>1?s[1].springStiffness:5,animationTime:s.length>1?s[1].animationTime:1.5}),e.console.assert(typeof n.springStiffness=="number"&&n.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof n.animationTime=="number"&&n.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),n.exponential&&(this._exponential=!0,delete n.exponential),e.extend(!0,this,n),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=n,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=n,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(n){this.start.value+=n,this.target.value+=n,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(n){this._exponential=n,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();var n,s;this._exponential?(n=this.start._logValue,s=this.target._logValue):(n=this.start.value,s=this.target.value);var c=this.current.time>=this.target.time?s:n+(s-n)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(c):this.current.value=c,o!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(n,s){return(1-Math.exp(n*-s))/(1-Math.exp(-n))}}(r),function(e){function i(s){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},s),this.image=null}i.prototype={errorMsg:null,start:function(){var s=this,c=this.abort;this.image=new Image,this.image.onload=function(){s.finish(!0)},this.image.onabort=this.image.onerror=function(){s.errorMsg="Image load aborted",s.finish(!1)},this.jobId=window.setTimeout(function(){s.errorMsg="Image load exceeded timeout ("+s.timeout+" ms)",s.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",postData:this.postData,success:function(o){var a;try{a=new window.Blob([o.response])}catch(f){var l=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(f.name==="TypeError"&&l){var u=new l;u.append(o.response),a=u.getBlob()}}a.size===0&&(s.errorMsg="Empty image response.",s.finish(!1));var d=(window.URL||window.webkitURL).createObjectURL(a);s.image.src=d},error:function(o){s.errorMsg="Image load aborted - XHR error: Ajax returned "+o.status,s.finish(!1)}}),this.abort=function(){s.request.abort(),typeof c=="function"&&c()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(s){this.image.onload=this.image.onerror=this.image.onabort=null,s||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(s){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},s)},e.ImageLoader.prototype={addJob:function(s){var c=this,o=function(u){n(c,u,s.callback)},a={src:s.src,loadWithAjax:s.loadWithAjax,ajaxHeaders:s.loadWithAjax?s.ajaxHeaders:null,crossOriginPolicy:s.crossOriginPolicy,ajaxWithCredentials:s.ajaxWithCredentials,postData:s.postData,callback:o,abort:s.abort,timeout:this.timeout},l=new i(a);!this.jobLimit||this.jobsInProgress<this.jobLimit?(l.start(),this.jobsInProgress++):this.jobQueue.push(l)},clear:function(){for(var s=0;s<this.jobQueue.length;s++){var c=this.jobQueue[s];typeof c.abort=="function"&&c.abort()}this.jobQueue=[]}};function n(s,c,o){var a;s.jobsInProgress--,(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&s.jobQueue.length>0&&(a=s.jobQueue.shift(),a.start(),s.jobsInProgress++),o(c.image,c.errorMsg,c.request)}}(r),function(e){e.Tile=function(i,n,s,c,o,a,l,u,d,f,w,y){this.level=i,this.x=n,this.y=s,this.bounds=c,this.sourceBounds=f,this.exists=o,this.url=a,this.postData=w,this.context2D=l,this.loadWithAjax=u,this.ajaxHeaders=d,y===void 0&&(e.console.error("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),y=e.TileSource.prototype.getTileHashKey(i,n,s,a,d,w)),this.cacheKey=y,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)},drawCanvas:function(i,n,s,c,o){var a=this.position.times(e.pixelDensityRatio),l=this.size.times(e.pixelDensityRatio),u;if(!this.context2D&&!this.cacheImageRecord){e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(u=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!u){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof s=="number"&&s!==1&&(a=a.times(s),l=l.times(s)),c instanceof e.Point&&(a=a.plus(c)),i.globalAlpha===1&&this._hasTransparencyChannel()&&(o&&(a.x=Math.round(a.x),a.y=Math.round(a.y),l.x=Math.round(l.x),l.y=Math.round(l.y)),i.clearRect(a.x,a.y,l.x,l.y)),n({context:i,tile:this,rendered:u});var d,f;this.sourceBounds?(d=Math.min(this.sourceBounds.width,u.canvas.width),f=Math.min(this.sourceBounds.height,u.canvas.height)):(d=u.canvas.width,f=u.canvas.height),i.translate(a.x+l.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(u.canvas,0,0,d,f,-l.x/2,a.y,l.x,l.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,n,s){var c=Math.max(1,Math.ceil((s.x-n.x)/2)),o=Math.max(1,Math.ceil((s.y-n.y)/2));return new e.Point(c,o).minus(this.position.times(e.pixelDensityRatio).times(i||1).apply(function(a){return a%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(r),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(i,n,s){var c;e.isPlainObject(i)?c=i:c={element:i,location:n,placement:s},this.element=c.element,this.style=c.element.style,this._init(c)},e.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?e.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,n){var s=e.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?i.x-=n.x/2:s.isRight&&(i.x-=n.x),s.isVerticallyCentered?i.y-=n.y/2:s.isBottom&&(i.y-=n.y))},destroy:function(){var i=this.element,n=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(n.display="none",document.body.appendChild(i))),this.onDraw=null,n.top="",n.left="",n.position="",this.width!==null&&(n.width=""),this.height!==null&&(n.height="");var s=e.getCssPropertyWithVendorPrefix("transformOrigin"),c=e.getCssPropertyWithVendorPrefix("transform");s&&c&&(n[s]="",n[c]="")},drawHTML:function(i,n){var s=this.element;s.parentNode!==i&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,i.appendChild(s),this.style.position="absolute",this.size=e.getElementSize(s));var c=this._getOverlayPositionAndSize(n),o=c.position,a=this.size=c.size,l=c.rotate;if(this.onDraw)this.onDraw(o,a,this.element);else{var u=this.style;u.left=o.x+"px",u.top=o.y+"px",this.width!==null&&(u.width=a.x+"px"),this.height!==null&&(u.height=a.y+"px");var d=e.getCssPropertyWithVendorPrefix("transformOrigin"),f=e.getCssPropertyWithVendorPrefix("transform");d&&f&&(l?(u[d]=this._getTransformOrigin(),u[f]="rotate("+l+"deg)"):(u[d]="",u[f]="")),u.display="block"}},_getOverlayPositionAndSize:function(i){var n=i.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(i);this.adjust(n,s);var c=0;if(i.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var o=new e.Rect(n.x,n.y,s.x,s.y),a=this._getBoundingBox(o,i.degrees);n=a.getTopLeft(),s=a.getSize()}else c=i.degrees;return{position:n,size:s,rotate:c}},_getSizeInPixels:function(i){var n=this.size.x,s=this.size.y;if(this.width!==null||this.height!==null){var c=i.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);this.width!==null&&(n=c.x),this.height!==null&&(s=c.y)}if(this.checkResize&&(this.width===null||this.height===null)){var o=this.size=e.getElementSize(this.element);this.width===null&&(n=o.x),this.height===null&&(s=o.y)}return new e.Point(n,s)},_getBoundingBox:function(i,n){var s=this._getPlacementPoint(i);return i.rotate(n,s).getBoundingBox()},_getPlacementPoint:function(i){var n=new e.Point(i.x,i.y),s=e.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?n.x+=i.width/2:s.isRight&&(n.x+=i.width),s.isVerticallyCentered?n.y+=i.height/2:s.isBottom&&(n.y+=i.height)),n},_getTransformOrigin:function(){var i="",n=e.Placement.properties[this.placement];return n&&(n.isLeft?i="left":n.isRight&&(i="right"),n.isTop?i+=" top":n.isBottom&&(i+=" bottom")),i},update:function(i,n){var s=e.isPlainObject(i)?i:{location:i,placement:n};this._init({location:s.location||this.location,placement:s.placement!==void 0?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==void 0?s.width:this.width,height:s.height!==void 0?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(i){e.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,s=this.height;if(n===null||s===null){var c=i.deltaPointsFromPixelsNoRotate(this.size,!0);n===null&&(n=c.x),s===null&&(s=c.y)}var o=this.location.clone();return this.adjust(o,new e.Point(n,s)),this._adjustBoundsForRotation(i,new e.Rect(o.x,o.y,n,s))},_adjustBoundsForRotation:function(i,n){if(!i||i.degrees===0||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return n;var s=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new e.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return n.rotate(-i.degrees,this._getPlacementPoint(n))}}}(r),function(e){e.Drawer=function(i){e.console.assert(i.viewer,"[Drawer] options.viewer is required");var n=arguments;if(e.isPlainObject(i)||(i={source:n[0],viewport:n[1],element:n[2]}),e.console.assert(i.viewport,"[Drawer] options.viewport is required"),e.console.assert(i.element,"[Drawer] options.element is required"),i.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,i.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(i.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var s=this._calculateCanvasSize();this.canvas.width=s.x,this.canvas.height=s.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(i,n,s,c){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,n,s,c),this},updateOverlay:function(i,n,s){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,n,s),this},removeOverlay:function(i){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var n=this.viewport.pixelFromPointNoRotate(i,!0);return new e.Point(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},clipWithPolygons:function(i,n){if(this.useCanvas){var s=this._getContext(n);s.beginPath(),i.forEach(function(c){c.forEach(function(o,a){s[a===0?"moveTo":"lineTo"](o.x,o.y)})}),s.clip()}},setOpacity:function(i){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var n=this.viewer.world,s=0;s<n.getItemCount();s++)n.getItemAt(s).setOpacity(i);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,n=0,s=0;s<i.getItemCount();s++){var c=i.getItemAt(s).getOpacity();c>n&&(n=c)}return n},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var n=this._calculateSketchCanvasSize();this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,n){if(this.useCanvas){var s=this._getContext(i);if(n)s.clearRect(n.x,n.y,n.width,n.height);else{var c=s.canvas;s.clearRect(0,0,c.width,c.height)}}},viewportToDrawerRectangle:function(i){var n=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,s.x*e.pixelDensityRatio,s.y*e.pixelDensityRatio)},drawTile:function(i,n,s,c,o,a){if(e.console.assert(i,"[Drawer.drawTile] tile is required"),e.console.assert(n,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var l=this._getContext(s);c=c||1,i.drawCanvas(l,n,c,o,a)}else i.drawHTML(this.canvas)},_getContext:function(i){var n=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var s=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var c=this;this.viewer.addHandler("rotate",function o(){if(c.viewport.getRotation()!==0){c.viewer.removeHandler("rotate",o);var a=c._calculateSketchCanvasSize();c.sketchCanvas.width=a.x,c.sketchCanvas.height=a.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}n=this.sketchContext}return n},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,n){if(this.useCanvas){var s=this._getContext(n);s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip()}},drawRectangle:function(i,n,s){if(this.useCanvas){var c=this._getContext(s);c.save(),c.fillStyle=n,c.fillRect(i.x,i.y,i.width,i.height),c.restore()}},blendSketch:function(i,n,s,c){var o=i;if(e.isPlainObject(o)||(o={opacity:i,scale:n,translate:s,compositeOperation:c}),!(!this.useCanvas||!this.sketchCanvas)){i=o.opacity,c=o.compositeOperation;var a=o.bounds;if(this.context.save(),this.context.globalAlpha=i,c&&(this.context.globalCompositeOperation=c),a)a.x<0&&(a.width+=a.x,a.x=0),a.x+a.width>this.canvas.width&&(a.width=this.canvas.width-a.x),a.y<0&&(a.height+=a.y,a.y=0),a.y+a.height>this.canvas.height&&(a.height=this.canvas.height-a.y),this.context.drawImage(this.sketchCanvas,a.x,a.y,a.width,a.height,a.x,a.y,a.width,a.height);else{n=o.scale||1,s=o.translate;var l=s instanceof e.Point?s:new e.Point(0,0),u=0,d=0;if(s){var f=this.sketchCanvas.width-this.canvas.width,w=this.sketchCanvas.height-this.canvas.height;u=Math.round(f/2),d=Math.round(w/2)}this.context.drawImage(this.sketchCanvas,l.x-u*n,l.y-d*n,(this.canvas.width+2*u)*n,(this.canvas.height+2*d)*n,-u,-d,this.canvas.width+2*u,this.canvas.height+2*d)}this.context.restore()}},drawDebugInfo:function(i,n,s,c){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(c)%this.debugGridColor.length,a=this.context;a.save(),a.lineWidth=2*e.pixelDensityRatio,a.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor[o],a.fillStyle=this.debugGridColor[o],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),c.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:c.getRotation(!0),point:c.viewport.pixelFromPointNoRotate(c._getRotationPoint(!0),!0)}),c.viewport.degrees===0&&c.getRotation(!0)%360===0&&c._drawer.viewer.viewport.getFlip()&&c._drawer._flip(),a.strokeRect(i.position.x*e.pixelDensityRatio,i.position.y*e.pixelDensityRatio,i.size.x*e.pixelDensityRatio,i.size.y*e.pixelDensityRatio);var l=(i.position.x+i.size.x/2)*e.pixelDensityRatio,u=(i.position.y+i.size.y/2)*e.pixelDensityRatio;a.translate(l,u),a.rotate(Math.PI/180*-this.viewport.degrees),a.translate(-l,-u),i.x===0&&i.y===0&&(a.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*e.pixelDensityRatio,(i.position.y-30)*e.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*e.pixelDensityRatio,(i.position.y-20)*e.pixelDensityRatio)),a.fillText("Level: "+i.level,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+20)*e.pixelDensityRatio),a.fillText("Column: "+i.x,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+30)*e.pixelDensityRatio),a.fillText("Row: "+i.y,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+40)*e.pixelDensityRatio),a.fillText("Order: "+s+" of "+n,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+50)*e.pixelDensityRatio),a.fillText("Size: "+i.size.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+60)*e.pixelDensityRatio),a.fillText("Position: "+i.position.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+70)*e.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),c.getRotation(!0)%360!==0&&this._restoreRotationChanges(),c.viewport.degrees===0&&c.getRotation(!0)%360===0&&c._drawer.viewer.viewport.getFlip()&&c._drawer._flip(),a.restore()}},debugRect:function(i){if(this.useCanvas){var n=this.context;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,i.width*e.pixelDensityRatio,i.height*e.pixelDensityRatio),n.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var n=this._getContext(i).canvas;return new e.Point(n.width,n.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.save(),s.translate(n.x,n.y),this.viewer.viewport.flipped?(s.rotate(Math.PI/180*-i.degrees),s.scale(-1,1)):s.rotate(Math.PI/180*i.degrees),s.translate(-n.x,-n.y)},_flip:function(i){i=i||{};var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.translate(n.x,0),s.scale(-1,1),s.translate(-n.x,0)},_restoreRotationChanges:function(i){var n=this._getContext(i);n.restore()},_calculateCanvasSize:function(){var i=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*i),y:Math.round(n.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var n=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:n,y:n}}}}(r),function(e){e.Viewport=function(i){var n=arguments;n.length&&n[0]instanceof e.Point&&(i={containerSize:n[0],contentSize:n[1],config:n[2]}),i.config&&(e.extend(!0,i,i.config),delete i.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:e.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(i){return e.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(i instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,n)},_setContentBounds:function(i,n){e.console.assert(i,"[Viewport._setContentBounds] bounds is required"),e.console.assert(i instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=i.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),n;return this.homeFillsViewer?n=i>=1?i:1:n=i>=1?1:i,n/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),n=1/this.getHomeZoom(),s=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-s/2,n,s)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),n=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return n},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(i){e.console.assert(e.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation())},getBoundsNoRotate:function(i){var n=this.getCenter(i),s=1/this.getZoom(i),c=s/this.getAspectRatio();return new e.Rect(n.x-s/2,n.y-c/2,s,c)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var n=this.getBoundsNoRotate(i),s=this._containerInnerSize.x*this.getZoom(i);return n.x-=this._margins.left/s,n.y-=this._margins.top/s,n.width+=(this._margins.left+this._margins.right)/s,n.height+=(this._margins.top+this._margins.bottom)/s,n},getCenter:function(i){var n=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),c,o,a,l,u,d,f,w;return i?n:this.zoomPoint?(c=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),a=1/o,l=a/this.getAspectRatio(),u=new e.Rect(n.x-a/2,n.y-l/2,a,l),d=this._pixelFromPoint(this.zoomPoint,u),f=d.minus(c),w=f.divide(this._containerInnerSize.x*o),s.plus(w)):s},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var n=new e.Rect(i.x,i.y,i.width,i.height);if(!this.wrapHorizontal){var s=this.visibilityRatio*n.width,c=n.x+n.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,a=this._contentBoundsNoRotate.x-c+s,l=o-n.x-s;s>this._contentBoundsNoRotate.width?n.x+=(a+l)/2:l<0?n.x+=l:a>0&&(n.x+=a)}if(!this.wrapVertical){var u=this.visibilityRatio*n.height,d=n.y+n.height,f=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,w=this._contentBoundsNoRotate.y-d+u,y=f-n.y-u;u>this._contentBoundsNoRotate.height?n.y+=(w+y)/2:y<0?n.y+=y:w>0&&(n.y+=w)}return n},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var n=this.getZoom(),s=this._applyZoomConstraints(n);n!==s&&this.zoomTo(s,this.zoomPoint,i);var c=this.getBoundsNoRotate(),o=this._applyBoundaryConstraints(c);return this._raiseConstraintsEvent(i),(c.x!==o.x||c.y!==o.y||i)&&this.fitBounds(o.rotate(-this.getRotation()),i),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,n){n=n||{};var s=n.immediately||!1,c=n.constraints||!1,o=this.getAspectRatio(),a=i.getCenter(),l=new e.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();l.getAspectRatio()>=o?l.height=l.width/o:l.width=l.height*o,l.x=a.x-l.width/2,l.y=a.y-l.height/2;var u=1/l.width;if(c){var d=l.getAspectRatio(),f=this._applyZoomConstraints(u);u!==f&&(u=f,l.width=1/u,l.x=a.x-l.width/2,l.height=l.width/d,l.y=a.y-l.height/2),l=this._applyBoundaryConstraints(l),a=l.getCenter(),this._raiseConstraintsEvent(s)}if(s)return this.panTo(a,!0),this.zoomTo(u,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var w=this.getBounds(),y=this.getZoom();if(y===0||Math.abs(u/y-1)<1e-8)return this.zoomTo(u,!0),this.panTo(a,s);l=l.rotate(-this.getRotation());var x=l.getTopLeft().times(u).minus(w.getTopLeft().times(y)).divide(u-y);return this.zoomTo(u,x,s)},fitBounds:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!1})},fitBoundsWithConstraints:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!0})},fitVertically:function(i){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,i)},fitHorizontally:function(i){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,i)},getConstrainedBounds:function(i){var n,s;return n=this.getBounds(i),s=this._applyBoundaryConstraints(n),s},panBy:function(i,n){var s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(i),n)},panTo:function(i,n){return n?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:n}),this},zoomBy:function(i,n,s){return this.zoomTo(this.zoomSpring.target.value*i,n,s)},zoomTo:function(i,n,s){var c=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s?this._adjustCenterSpringsForZoomPoint(function(){c.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:n,immediately:s}),this},setRotation:function(i){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=e.positiveModulo(i,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i}),this)},getRotation:function(){return this.degrees},resize:function(i,n){var s=this.getBoundsNoRotate(),c=s,o;return this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),n&&(o=i.x/this.containerSize.x,c.width=s.width*o,c.height=c.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:n}),this.fitBounds(c,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var n=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,n},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var n=this.pixelFromPoint(this.zoomPoint,!0);i();var s=this.pixelFromPoint(this.zoomPoint,!0),c=s.minus(n),o=this.deltaPointsFromPixels(c,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,n){return i.times(this._containerInnerSize.x*this.getZoom(n))},deltaPixelsFromPoints:function(i,n){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation()),n)},deltaPointsFromPixelsNoRotate:function(i,n){return i.divide(this._containerInnerSize.x*this.getZoom(n))},deltaPointsFromPixels:function(i,n){return this.deltaPointsFromPixelsNoRotate(i,n).rotate(-this.getRotation())},pixelFromPointNoRotate:function(i,n){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(n))},pixelFromPoint:function(i,n){return this._pixelFromPoint(i,this.getBoundsNoRotate(n))},_pixelFromPointNoRotate:function(i,n){return i.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,n){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(),this.getCenter(!0)),n)},pointFromPixelNoRotate:function(i,n){var s=this.getBoundsNoRotate(n);return i.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(i,n){return this.pointFromPixelNoRotate(i,n).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new e.Point(i*this._contentSizeNoRotate.x/s,n*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(i,n){if(i instanceof e.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageCoordinates(i,n,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new e.Point(i/this._contentSizeNoRotate.x*s,n/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(i,n){if(i instanceof e.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(s===1){var c=this.viewer.world.getItemAt(0);return c.imageToViewportCoordinates(i,n,!0)}}var o=this._imageToViewportDelta(i,n);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(i,n,s,c){var o=i;if(o instanceof e.Rect||(o=new e.Rect(i,n,s,c)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(a===1){var l=this.viewer.world.getItemAt(0);return l.imageToViewportRectangle(i,n,s,c,!0)}}var u=this.imageToViewportCoordinates(o.x,o.y),d=this._imageToViewportDelta(o.width,o.height);return new e.Rect(u.x,u.y,d.x,d.y,o.degrees)},viewportToImageRectangle:function(i,n,s,c){var o=i;if(o instanceof e.Rect||(o=new e.Rect(i,n,s,c)),this.viewer){var a=this.viewer.world.getItemCount();if(a>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(a===1){var l=this.viewer.world.getItemAt(0);return l.viewportToImageRectangle(i,n,s,c,!0)}}var u=this.viewportToImageCoordinates(o.x,o.y),d=this._viewportToImageDelta(o.width,o.height);return new e.Rect(u.x,u.y,d.x,d.y,o.degrees)},viewerElementToImageCoordinates:function(i){var n=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(i){var n=this.imageToViewportCoordinates(i);return this.pixelFromPoint(n,!0)},windowToImageCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var n=this.imageToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return e.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return e.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var n=this.viewportToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageZoom(i)}}var c=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,l=o/c*a;return i*l},imageToViewportZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportZoom(i)}}var c=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,l=c/o/a;return i*l},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}}(r),function(e){e.TiledImage=function(o){var a=this;e.console.assert(o.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(o.drawer,"[TiledImage] options.drawer is required"),e.console.assert(o.viewer,"[TiledImage] options.viewer is required"),e.console.assert(o.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(o.source,"[TiledImage] options.source is required"),e.console.assert(!o.clip||o.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=o.tileCache,delete o.tileCache,this._drawer=o.drawer,delete o.drawer,this._imageLoader=o.imageLoader,delete o.imageLoader,o.clip instanceof e.Rect&&(this._clip=o.clip.clone()),delete o.clip;var l=o.x||0;delete o.x;var u=o.y||0;delete o.y,this.normHeight=o.source.dimensions.y/o.source.dimensions.x,this.contentAspectX=o.source.dimensions.x/o.source.dimensions.y;var d=1;o.width?(d=o.width,delete o.width,o.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete o.height)):o.height&&(d=o.height/this.normHeight,delete o.height);var f=o.fitBounds;delete o.fitBounds;var w=o.fitBoundsPlacement||r.Placement.CENTER;delete o.fitBoundsPlacement;var y=o.degrees||0;delete o.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:e.DEFAULT_SETTINGS.subPixelRoundingForTransparency},o),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:d,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),f&&this.fitBounds(f,w,!0),this._drawingHandler=function(x){a.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:a},x))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(o){o!==this._fullyLoaded&&(this._fullyLoaded=o,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var o=this._xSpring.update(),a=this._ySpring.update(),l=this._scaleSpring.update(),u=this._degreesSpring.update();return o||a||l||u?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(o){return this.getBoundsNoRotate(o).rotate(this.getRotation(o),this._getRotationPoint(o))},getBoundsNoRotate:function(o){return o?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(o){var a=this.getBoundsNoRotate(o);if(this._clip){var l=o?this._worldWidthCurrent:this._worldWidthTarget,u=l/this.source.dimensions.x,d=this._clip.times(u);a=new e.Rect(a.x+d.x,a.y+d.y,d.width,d.height)}return a.rotate(this.getRotation(o),this._getRotationPoint(o))},getTileBounds:function(o,a,l){var u=this.source.getNumTiles(o),d=(u.x+a%u.x)%u.x,f=(u.y+l%u.y)%u.y,w=this.source.getTileBounds(o,d,f);return this.getFlip()&&(w.x=1-w.x-w.width),w.x+=(a-d)/u.x,w.y+=this._worldHeightCurrent/this._worldWidthCurrent*((l-f)/u.y),w},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var o=this.imageToWindowCoordinates(new e.Point(0,0)),a=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(a.x-o.x,a.y-o.y)},_viewportToImageDelta:function(o,a,l){var u=l?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(o*(this.source.dimensions.x/u),a*(this.source.dimensions.y*this.contentAspectX/u))},viewportToImageCoordinates:function(o,a,l){var u;return o instanceof e.Point?(l=a,u=o):u=new e.Point(o,a),u=u.rotate(-this.getRotation(l),this._getRotationPoint(l)),l?this._viewportToImageDelta(u.x-this._xSpring.current.value,u.y-this._ySpring.current.value):this._viewportToImageDelta(u.x-this._xSpring.target.value,u.y-this._ySpring.target.value)},_imageToViewportDelta:function(o,a,l){var u=l?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(o/this.source.dimensions.x*u,a/this.source.dimensions.y/this.contentAspectX*u)},imageToViewportCoordinates:function(o,a,l){o instanceof e.Point&&(l=a,a=o.y,o=o.x);var u=this._imageToViewportDelta(o,a);return l?(u.x+=this._xSpring.current.value,u.y+=this._ySpring.current.value):(u.x+=this._xSpring.target.value,u.y+=this._ySpring.target.value),u.rotate(this.getRotation(l),this._getRotationPoint(l))},imageToViewportRectangle:function(o,a,l,u,d){var f=o;f instanceof e.Rect?d=a:f=new e.Rect(o,a,l,u);var w=this.imageToViewportCoordinates(f.getTopLeft(),d),y=this._imageToViewportDelta(f.width,f.height,d);return new e.Rect(w.x,w.y,y.x,y.y,f.degrees+this.getRotation(d))},viewportToImageRectangle:function(o,a,l,u,d){var f=o;o instanceof e.Rect?d=a:f=new e.Rect(o,a,l,u);var w=this.viewportToImageCoordinates(f.getTopLeft(),d),y=this._viewportToImageDelta(f.width,f.height,d);return new e.Rect(w.x,w.y,y.x,y.y,f.degrees-this.getRotation(d))},viewerElementToImageCoordinates:function(o){var a=this.viewport.pointFromPixel(o,!0);return this.viewportToImageCoordinates(a)},imageToViewerElementCoordinates:function(o){var a=this.imageToViewportCoordinates(o);return this.viewport.pixelFromPoint(a,!0)},windowToImageCoordinates:function(o){var a=o.minus(r.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(a)},imageToWindowCoordinates:function(o){var a=this.imageToViewerElementCoordinates(o);return a.plus(r.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(o){var a=this._scaleSpring.current.value;return o=o.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((o.x-this._xSpring.current.value)/a,(o.y-this._ySpring.current.value)/a,o.width/a,o.height/a,o.degrees)},viewportToImageZoom:function(o){var a=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return a*o},imageToViewportZoom:function(o){var a=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return o/a},setPosition:function(o,a){var l=this._xSpring.target.value===o.x&&this._ySpring.target.value===o.y;if(a){if(l&&this._xSpring.current.value===o.x&&this._ySpring.current.value===o.y)return;this._xSpring.resetTo(o.x),this._ySpring.resetTo(o.y),this._needsDraw=!0}else{if(l)return;this._xSpring.springTo(o.x),this._ySpring.springTo(o.y),this._needsDraw=!0}l||this._raiseBoundsChange()},setWidth:function(o,a){this._setScale(o,a)},setHeight:function(o,a){this._setScale(o/this.normHeight,a)},setCroppingPolygons:function(o){var a=function(u){return u instanceof e.Point||typeof u.x=="number"&&typeof u.y=="number"},l=function(u){return u.map(function(d){try{if(a(d))return{x:d.x,y:d.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(o))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=o.map(function(u){return l(u)})}catch(u){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(u),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(o,a,l){a=a||e.Placement.CENTER;var u=e.Placement.properties[a],d=this.contentAspectX,f=0,w=0,y=1,x=1;if(this._clip&&(d=this._clip.getAspectRatio(),y=this._clip.width/this.source.dimensions.x,x=this._clip.height/this.source.dimensions.y,o.getAspectRatio()>d?(f=this._clip.x/this._clip.height*o.height,w=this._clip.y/this._clip.height*o.height):(f=this._clip.x/this._clip.width*o.width,w=this._clip.y/this._clip.width*o.width)),o.getAspectRatio()>d){var T=o.height/x,S=0;u.isHorizontallyCentered?S=(o.width-o.height*d)/2:u.isRight&&(S=o.width-o.height*d),this.setPosition(new e.Point(o.x-f+S,o.y-w),l),this.setHeight(T,l)}else{var L=o.width/y,I=0;u.isVerticallyCentered?I=(o.height-o.width/d)/2:u.isBottom&&(I=o.height-o.width/d),this.setPosition(new e.Point(o.x-f,o.y-w+I),l),this.setWidth(L,l)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(o){e.console.assert(!o||o instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),o instanceof e.Rect?this._clip=o.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(o){this.flipped=!!o,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(o){o!==this.opacity&&(this.opacity=o,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(o){this._preload=!!o,this._needsDraw=!0},getRotation:function(o){return o?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(o,a){this._degreesSpring.target.value===o&&this._degreesSpring.isAtTargetValue()||(a?this._degreesSpring.resetTo(o):this._degreesSpring.springTo(o),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(o){return this.getBoundsNoRotate(o).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(o){o!==this.compositeOperation&&(this.compositeOperation=o,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(o,a){var l=this._scaleSpring.target.value===o;if(a){if(l&&this._scaleSpring.current.value===o)return;this._scaleSpring.resetTo(o),this._updateForScale(),this._needsDraw=!0}else{if(l)return;this._scaleSpring.springTo(o),this._updateForScale(),this._needsDraw=!0}l||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var o=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),a=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,l=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(a/this.minPixelRatio)/Math.log(2))));return l=Math.max(l,this.source.minLevel||0),o=Math.min(o,l),{lowestLevel:o,highestLevel:l}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var o=this.lastDrawn.pop();o.beingDrawn=!1}var a=this.viewport,l=this._viewportToTiledImageRectangle(a.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var u=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(l=l.intersection(u),l===null)return}for(var d=this._getLevelsInterval(),f=d.lowestLevel,w=d.highestLevel,y=null,x=!1,T=e.now(),S=w;S>=f;S--){var L=!1,I=a.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(S),!0).x*this._scaleSpring.current.value;if(S===f||!x&&I>=this.minPixelRatio)L=!0,x=!0;else if(!x)continue;var j=a.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(S),!1).x*this._scaleSpring.current.value,Y=a.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,Q=this.immediateRender?1:Y,ie=Math.min(1,(I-.5)/.5),J=Q/Math.abs(Q-j);if(y=this._updateLevel(x,L,S,ie,J,l,T,y),this._providesCoverage(this.coverage,S))break}this._drawTiles(this.lastDrawn),y&&!y.context2D?(this._loadTile(y,T),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(o,a,l){var u,d;this.wrapHorizontal?(u=e.positiveModulo(a.x,1),d=e.positiveModulo(l.x,1)):(u=Math.max(0,a.x),d=Math.min(1,l.x));var f,w,y=1/this.source.aspectRatio;this.wrapVertical?(f=e.positiveModulo(a.y,y),w=e.positiveModulo(l.y,y)):(f=Math.max(0,a.y),w=Math.min(y,l.y));var x=this.source.getTileAtPoint(o,new e.Point(u,f)),T=this.source.getTileAtPoint(o,new e.Point(d,w)),S=this.source.getNumTiles(o);return this.wrapHorizontal&&(x.x+=S.x*Math.floor(a.x),T.x+=S.x*Math.floor(l.x)),this.wrapVertical&&(x.y+=S.y*Math.floor(a.y/y),T.y+=S.y*Math.floor(l.y/y)),{topLeft:x,bottomRight:T}},_updateLevel:function(o,a,l,u,d,f,w,y){var x=f.getBoundingBox().getTopLeft(),T=f.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:o,level:l,opacity:u,visibility:d,drawArea:f,topleft:x,bottomright:T,currenttime:w,best:y}),this._resetCoverage(this.coverage,l),this._resetCoverage(this.loadingCoverage,l);var S=this._getCornerTiles(l,x,T),L=S.topLeft,I=S.bottomRight,j=this.source.getNumTiles(l),Y=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(I.x+=1,this.wrapHorizontal||(I.x=Math.min(I.x,j.x-1)));for(var Q=L.x;Q<=I.x;Q++)for(var ie=L.y;ie<=I.y;ie++){var J;if(this.getFlip()){var ee=(j.x+Q%j.x)%j.x;J=Q+j.x-ee-ee-1}else J=Q;f.intersection(this.getTileBounds(l,J,ie))!==null&&(y=this._updateTile(a,o,J,ie,l,u,d,Y,j,w,y))}return y},_updateTile:function(o,a,l,u,d,f,w,y,x,T,S){var L=this._getTile(l,u,d,T,x,this._worldWidthCurrent,this._worldHeightCurrent),I=a;this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:L}),this._setCoverage(this.coverage,d,l,u,!1);var j=L.loaded||L.loading||this._isCovered(this.loadingCoverage,d,l,u);if(this._setCoverage(this.loadingCoverage,d,l,u,j),!L.exists||(o&&!I&&(this._isCovered(this.coverage,d,l,u)?this._setCoverage(this.coverage,d,l,u,!0):I=!0),!I))return S;if(this._positionTile(L,this.source.tileOverlap,this.viewport,y,w),!L.loaded)if(L.context2D)this._setTileLoaded(L);else{var Y=this._tileCache.getImageRecord(L.cacheKey);if(Y){var Q=Y.getImage();this._setTileLoaded(L,Q)}}if(L.loaded){var ie=this._blendTile(L,l,u,d,f,T);ie&&(this._needsDraw=!0)}else L.loading?this._tilesLoading++:j||(S=this._compareTiles(S,L));return S},_getTile:function(o,a,l,u,d,f,w){var y,x,T,S,L,I,j,Y,Q,ie,J=this.tilesMatrix,ee=this.source;return J[l]||(J[l]={}),J[l][o]||(J[l][o]={}),(!J[l][o][a]||!J[l][o][a].flipped!=!this.flipped)&&(y=(d.x+o%d.x)%d.x,x=(d.y+a%d.y)%d.y,T=this.getTileBounds(l,o,a),S=ee.getTileBounds(l,y,x,!0),L=ee.tileExists(l,y,x),I=ee.getTileUrl(l,y,x),j=ee.getTilePostData(l,y,x),this.loadTilesWithAjax?(Y=ee.getTileAjaxHeaders(l,y,x),e.isPlainObject(this.ajaxHeaders)&&(Y=e.extend({},this.ajaxHeaders,Y))):Y=null,Q=ee.getContext2D?ee.getContext2D(l,y,x):void 0,ie=new e.Tile(l,o,a,T,L,I,Q,this.loadTilesWithAjax,Y,S,j,ee.getTileHashKey(l,y,x,I,Y,j)),this.getFlip()?y===0&&(ie.isRightMost=!0):y===d.x-1&&(ie.isRightMost=!0),x===d.y-1&&(ie.isBottomMost=!0),ie.flipped=this.flipped,J[l][o][a]=ie),ie=J[l][o][a],ie.lastTouchTime=u,ie},_loadTile:function(o,a){var l=this;o.loading=!0,this._imageLoader.addJob({src:o.url,postData:o.postData,loadWithAjax:o.loadWithAjax,ajaxHeaders:o.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(u,d,f){l._onTileLoad(o,a,u,d,f)},abort:function(){o.loading=!1}})},_onTileLoad:function(o,a,l,u,d){if(!l){e.console.error("Tile %s failed to load: %s - error: %s",o,o.url,u),this.viewer.raiseEvent("tile-load-failed",{tile:o,tiledImage:this,time:a,message:u,tileRequest:d}),o.loading=!1,o.exists=!1;return}if(a<this.lastResetTime){e.console.warn("Ignoring tile %s loaded before reset: %s",o,o.url),o.loading=!1;return}var f=this,w=function(){var y=f.source,x=y.getClosestLevel();f._setTileLoaded(o,l,x,d)};this._midDraw?window.setTimeout(w,1):w()},_setTileLoaded:function(o,a,l,u){var d=0,f=this;function w(){return d++,y}function y(){d--,d===0&&(o.loading=!1,o.loaded=!0,o.context2D||f._tileCache.cacheTile({image:a,tile:o,cutoff:l,tiledImage:f}),f._needsDraw=!0)}this.viewer.raiseEvent("tile-loaded",{tile:o,tiledImage:this,tileRequest:u,image:a,getCompletionCallback:w}),w()()},_positionTile:function(o,a,l,u,d){var f=o.bounds.getTopLeft();f.x*=this._scaleSpring.current.value,f.y*=this._scaleSpring.current.value,f.x+=this._xSpring.current.value,f.y+=this._ySpring.current.value;var w=o.bounds.getSize();w.x*=this._scaleSpring.current.value,w.y*=this._scaleSpring.current.value;var y=l.pixelFromPointNoRotate(f,!0),x=l.pixelFromPointNoRotate(f,!1),T=l.deltaPixelsFromPointsNoRotate(w,!0),S=l.deltaPixelsFromPointsNoRotate(w,!1),L=x.plus(S.divide(2)),I=u.squaredDistanceTo(L);a||(T=T.plus(new e.Point(1,1))),o.isRightMost&&this.wrapHorizontal&&(T.x+=.75),o.isBottomMost&&this.wrapVertical&&(T.y+=.75),o.position=y,o.size=T,o.squaredDistance=I,o.visibility=d},_blendTile:function(o,a,l,u,d,f){var w=1e3*this.blendTime,y,x;if(o.blendStart||(o.blendStart=f),y=f-o.blendStart,x=w?Math.min(1,y/w):1,this.alwaysBlend&&(x*=d),o.opacity=x,this.lastDrawn.push(o),x===1)this._setCoverage(this.coverage,u,a,l,!0),this._hasOpaqueTile=!0;else if(y<w)return!0;return!1},_compareTiles:function(o,a){return!o||a.visibility>o.visibility||a.visibility===o.visibility&&a.squaredDistance<o.squaredDistance?a:o},_drawTiles:function(o){if(!(this.opacity===0||o.length===0&&!this.placeholderFillStyle)){var a=o[0],l;a&&(l=this.opacity<1||this.compositeOperation&&this.compositeOperation!=="source-over"||!this._isBottomItem()&&a._hasTransparencyChannel());var u,d,f=this.viewport.getZoom(!0),w=this.viewportToImageZoom(f);o.length>1&&w>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360===0&&e.supportsCanvas&&this.viewer.useCanvas&&(l=!0,u=a.getScaleForEdgeSmoothing(),d=a.getTranslationForEdgeSmoothing(u,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0)));var y;l&&(u||(y=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(this.viewport.degrees!==0||this.getRotation(!0)%360!==0)&&(y.x=this._drawer.viewer.container.clientWidth-(y.x+y.width)),y=y.times(e.pixelDensityRatio)),this._drawer._clear(!0,y)),u||(this.viewport.degrees!==0&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:l}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:l}),this.viewport.degrees===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip());var x=!1;if(this._clip){this._drawer.saveContext(l);var T=this.imageToViewportRectangle(this._clip,!0);T=T.rotate(-this.getRotation(!0),this._getRotationPoint(!0));var S=this._drawer.viewportToDrawerRectangle(T);u&&(S=S.times(u)),d&&(S=S.translate(d)),this._drawer.setClip(S,l),x=!0}if(this._croppingPolygons){this._drawer.saveContext(l);try{var L=this._croppingPolygons.map(function(ee){return ee.map(function(K){var we=this.imageToViewportCoordinates(K.x,K.y,!0).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),ve=this._drawer.viewportCoordToDrawerCoord(we);return u&&(ve=ve.times(u)),ve})});this._drawer.clipWithPolygons(L,l)}catch(ee){e.console.error(ee)}x=!0}if(this.placeholderFillStyle&&this._hasOpaqueTile===!1){var I=this._drawer.viewportToDrawerRectangle(this.getBounds(!0));u&&(I=I.times(u)),d&&(I=I.translate(d));var j=null;typeof this.placeholderFillStyle=="function"?j=this.placeholderFillStyle(this,this._drawer.context):j=this.placeholderFillStyle,this._drawer.drawRectangle(I,j,l)}var Y=c(this.subPixelRoundingForTransparency),Q=!1;if(Y===e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)Q=!0;else if(Y===e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var ie=this.viewer&&this.viewer.isAnimating();Q=!ie}for(var J=o.length-1;J>=0;J--)a=o[J],this._drawer.drawTile(a,this._drawingHandler,l,u,d,Q),a.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:a});x&&this._drawer.restoreContext(l),u||(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(l),this.viewport.degrees!==0&&this._drawer._restoreRotationChanges(l)),l&&(u&&(this.viewport.degrees!==0&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:!1}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:u,translate:d,compositeOperation:this.compositeOperation,bounds:y}),u&&(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1),this.viewport.degrees!==0&&this._drawer._restoreRotationChanges(!1))),u||this.viewport.degrees===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(o)}},_drawDebugInfo:function(o){if(this.debugMode)for(var a=o.length-1;a>=0;a--){var l=o[a];try{this._drawer.drawDebugInfo(l,o.length,a,this)}catch(u){e.console.error(u)}}},_providesCoverage:function(o,a,l,u){var d,f,w,y;if(!o[a])return!1;if(l===void 0||u===void 0){d=o[a];for(w in d)if(Object.prototype.hasOwnProperty.call(d,w)){f=d[w];for(y in f)if(Object.prototype.hasOwnProperty.call(f,y)&&!f[y])return!1}return!0}return o[a][l]===void 0||o[a][l][u]===void 0||o[a][l][u]===!0},_isCovered:function(o,a,l,u){return l===void 0||u===void 0?this._providesCoverage(o,a+1):this._providesCoverage(o,a+1,2*l,2*u)&&this._providesCoverage(o,a+1,2*l,2*u+1)&&this._providesCoverage(o,a+1,2*l+1,2*u)&&this._providesCoverage(o,a+1,2*l+1,2*u+1)},_setCoverage:function(o,a,l,u,d){if(!o[a]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",a);return}o[a][l]||(o[a][l]={}),o[a][l][u]=d},_resetCoverage:function(o,a){o[a]={}}});var i=e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function n(o){return o!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&o!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&o!==e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function s(o){return n(o)?i:o}function c(o){if(typeof o=="number")return s(o);if(!o||!e.Browser)return i;var a=o[e.Browser.vendor];return n(a)&&(a=o["*"]),s(a)}}(r),function(e){var i=function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage},n=function(s){e.console.assert(s,"[ImageRecord] options is required"),e.console.assert(s.image,"[ImageRecord] options.image is required"),this._image=s.image,this._tiles=[]};n.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var s=document.createElement("canvas");s.width=this._image.width,s.height=this._image.height,this._renderedContext=s.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(s){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=s},addTile:function(s){e.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var c=0;c<this._tiles.length;c++)if(this._tiles[c]===s){this._tiles.splice(c,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(s){s=s||{},this._maxImageCacheCount=s.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var c=s.cutoff||0,o=this._tilesLoaded.length,a=this._imagesLoaded[s.tile.cacheKey];if(a||(e.console.assert(s.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),a=this._imagesLoaded[s.tile.cacheKey]=new n({image:s.image}),this._imagesLoadedCount++),a.addTile(s.tile),s.tile.cacheImageRecord=a,this._imagesLoadedCount>this._maxImageCacheCount){for(var l=null,u=-1,d=null,f,w,y,x,T,S,L=this._tilesLoaded.length-1;L>=0;L--)if(S=this._tilesLoaded[L],f=S.tile,!(f.level<=c||f.beingDrawn)){if(!l){l=f,u=L,d=S;continue}x=f.lastTouchTime,w=l.lastTouchTime,T=f.level,y=l.level,(x<w||x===w&&T>y)&&(l=f,u=L,d=S)}l&&u>=0&&(this._unloadTile(d),o=u)}this._tilesLoaded[o]=new i({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){e.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var c,o=0;o<this._tilesLoaded.length;++o)c=this._tilesLoaded[o],c.tiledImage===s&&(this._unloadTile(c),this._tilesLoaded.splice(o,1),o--)},getImageRecord:function(s){return e.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){e.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var c=s.tile,o=s.tiledImage;c.unload(),c.cacheImageRecord=null;var a=this._imagesLoaded[c.cacheKey];a.removeTile(c),a.getTileCount()||(a.destroy(),delete this._imagesLoaded[c.cacheKey],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:c,tiledImage:o})}}}(r),function(e){e.World=function(i){var n=this;e.console.assert(i.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(i,n){if(e.console.assert(i,"[World.addItem] item is required"),e.console.assert(i instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),n=n||{},n.index!==void 0){var s=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(s,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return e.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return e.console.assert(i,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,n){e.console.assert(i,"[World.setItemIndex] item is required"),e.console.assert(n!==void 0,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(i);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n===s||s===-1||(this._items.splice(s,1),this._items.splice(n,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:s,newIndex:n}))},removeItem:function(i){e.console.assert(i,"[World.removeItem] item is required");var n=e.indexOf(this._items,i);n!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,n;for(n=0;n<this._items.length;n++)i=this._items[n],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,n=0;n<s.length;n++)i=s[n],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,n=0;n<this._items.length;n++)i=this._items[n].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var n=i.immediately||!1,s=i.layout||e.DEFAULT_SETTINGS.collectionLayout,c=i.rows||e.DEFAULT_SETTINGS.collectionRows,o=i.columns||e.DEFAULT_SETTINGS.collectionColumns,a=i.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=i.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,u=a+l,d;!i.rows&&o?d=o:d=Math.ceil(this._items.length/c);var f=0,w=0,y,x,T,S,L;this.setAutoRefigureSizes(!1);for(var I=0;I<this._items.length;I++)I&&I%d===0&&(s==="horizontal"?(w+=u,f=0):(f+=u,w=0)),y=this._items[I],x=y.getBounds(),x.width>x.height?T=a:T=a*(x.width/x.height),S=T*(x.height/x.width),L=new e.Point(f+(a-T)/2,w+(a-S)/2),y.setPosition(L,n),y.setWidth(T,n),s==="horizontal"?f+=u:w+=u;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,n=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(!this._items.length)this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;else{var c=this._items[0],o=c.getBounds();this._contentFactor=c.getContentSize().x/o.width;for(var a=c.getClippedBounds().getBoundingBox(),l=a.x,u=a.y,d=a.x+a.width,f=a.y+a.height,w=1;w<this._items.length;w++)c=this._items[w],o=c.getBounds(),this._contentFactor=Math.max(this._contentFactor,c.getContentSize().x/o.width),a=c.getClippedBounds().getBoundingBox(),l=Math.min(l,a.x),u=Math.min(u,a.y),d=Math.max(d,a.x+a.width),f=Math.max(f,a.y+a.height);this._homeBounds=new e.Rect(l,u,d-l,f-u),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==s||!this._homeBounds.equals(i)||!this._contentSize.equals(n))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(r)})(dd);const fd=wn;function kt(t,r){B.root[r||t.name.replace("bound ","")]=t}function Wn(t){return!!(t.altKey||t.ctrlKey||t.metaKey||["INPUT","SELECT","TEXTAREA"].includes(t.target.nodeName)&&t.target.type!=="range")}const pd=.01,gd={data(){return{filtersVisible:!1,loadingTimeout:null,options:B,tileSources:{},viewer:null,viewerState:{},zoomFactor:1.5,isLastPage:Mr,customPageViewActive:Dr,isFirstPage:Ir}},computed:{filtersActive(){return Object.keys(B.filters).length>0},saturation(){const t=B.filters.saturate;return typeof t=="number"?t:1}},watch:{"options.pages":function(t,r){const e=t.length!==r.length;this.loadImageInfo(e)}},mounted(){this.loadImageInfo(),this.updateFilterStyle(),B.root.$el.addEventListener("keydown",this.onKeydown),B.root.$el.addEventListener("keypress",this.onKeypress)},beforeUnmount(){this.viewer&&this.viewer.destroy(),B.root.$el.removeEventListener("keydown",this.onKeydown),B.root.$el.removeEventListener("keypress",this.onKeypress)},methods:{closeFilters(){this.filtersVisible=!1},getId:Nt,goToNextPage:vn,goToPreviousPage:yn,initViewer(t){const r=[];let e=0,i,n=0;if(B.pages.forEach((s,c)=>{let o=1;s<1?(o=0,i=c>0?lt.value:1):i=s;const a=this.tileSources[i];if(!a)return;e||(e=a.width);const l=a.width/e;r.push({opacity:o,tileSource:a,width:l,x:n}),n+=l+pd}),this.viewer){this.viewer.addOnceHandler("open",()=>{if(this.viewerState.isReset||t)this.resetScan();else{if(this.viewer.viewport.applyConstraints(!0),!B.optionsResetOnPageChange)return;B.optionsResetOnPageChange.forEach(s=>{if(s==="filters")this.resetFilters();else if(s==="pan"){const c=this.viewer.viewport.getBounds();if(c.x<=0&&c.y<=0)return;const o=B.pages[0]?0:1;this.viewer.viewport.panTo({x:c.x>0?c.width/2+o:B.pan.x,y:c.y>0?c.height/2:B.pan.y}),be({pan:{}})}else s==="rotation"?(this.viewer.viewport.setRotation(0),be({rotation:null})):s==="zoom"&&(this.viewer.viewport.goHome(),be({zoom:null}))})}}),this.viewer.open(r);return}this.viewer=fd({animationTime:.4,element:this.$refs.image,immediateRender:!0,preload:!zt(),preserveImageSizeOnResize:!0,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,tileSources:r,visibilityRatio:.2,...B.viewer}),this.viewer.innerTracker.keyHandler=null,this.viewer.gestureSettingsMouse.clickToZoom=!1,this.viewer.addHandler("animation-finish",()=>{if(this.viewerState.isReset){this.removeScanOptions();return}const s=this.viewer.viewport.getCenter();be({pan:{x:Math.round(s.x*1e3)/1e3,y:Math.round(s.y*1e3)/1e3},zoom:Math.round(this.viewer.viewport.getZoom()*1e3)/1e3})}),this.viewer.addHandler("canvas-click",()=>{document.body.click()}),this.viewer.addHandler("open",()=>{this.startLoadingWatch(),B.pan.x!==void 0||B.pan.y!==void 0||B.zoom?((B.pan.x!==void 0||B.pan.y!==void 0)&&this.viewer.viewport.panTo({x:B.pan.x,y:B.pan.y},!0),B.zoom&&this.viewer.viewport.zoomTo(B.zoom,null,!0)):this.viewer.viewport.goHome(),B.rotation!==null&&this.viewer.viewport.setRotation(B.rotation)}),this.viewer.addHandler("pan",this.updateViewerState),this.viewer.addHandler("resize",this.updateViewerState),this.viewer.addHandler("zoom",this.updateViewerState),this.viewer.addHandler("tile-load-failed",s=>{tt(`Error loading image: ${s.message}`)}),kt(this.resetScan),kt(this.viewer,"viewer")},loadImageInfo(t=!1){this.stopLoadingWatch();const r=[];B.pages.forEach(e=>{if(e<1||this.tileSources[e])return;const{resource:i}=Ve.value[e-1].images[0];if(i.service){const n=i.service["@id"],s=`${n}${n.slice(-1)==="/"?"":"/"}info.json`;r.push(di(s).then(c=>({...c,page:e}),c=>{let o;c.response&&c.response.statusText?o=c.response.statusText:c.message&&(o=c.message),tt(`Error loading info file for page ${e}${o?`: ${o}`:""}`)}))}else this.tileSources[e]={type:"image",url:i["@id"],width:i.width,height:i.height}}),r.length?Promise.all(r).then(e=>{e.forEach(i=>{i&&(this.tileSources[i.page]=i)}),this.initViewer(t)}):this.initViewer(t)},onKeydown(t){t.key==="Escape"&&(this.filtersVisible=!1),[45,48,96].indexOf(t.keyCode)>-1&&(t.shiftKey?this.resetScan(t):this.viewer.viewport.goHome())},onKeypress(t){if(!Wn(t))switch(t.key){case"r":case"R":this.rotateRight(t);break;case"i":this.filtersVisible=!this.filtersVisible,this.filtersVisible&&this.$nextTick(()=>{this.$refs.firstSlider.focus()});break;case"I":this.resetFilters();break;case"+":case"=":case"W":this.viewer.viewport.zoomBy(1.1),this.viewer.viewport.applyConstraints();break;case"-":case"_":case"S":this.viewer.viewport.zoomBy(.9),this.viewer.viewport.applyConstraints();break;case"w":this.viewer.innerTracker.keyDownHandler({keyCode:38});break;case"s":this.viewer.innerTracker.keyDownHandler({keyCode:40});break;case"a":this.viewer.innerTracker.keyDownHandler({keyCode:37});break;case"d":this.viewer.innerTracker.keyDownHandler({keyCode:39});break}},removeScanOptions(){be({pan:{},zoom:null})},resetFilters(){this.$refs.image.style.cssText="",be({filters:{}})},resetScan(t){t&&(this.viewer.viewport.setRotation(0),be({rotation:null}),this.filtersActive&&this.resetFilters()),this.viewer.viewport.goHome(),this.removeScanOptions()},rotateRight(t){const{viewport:r}=this.viewer,e=t&&t.shiftKey?0:(r.getRotation()+90)%360;r.setRotation(e),be({rotation:e||null})},setFilter(t,r){const e=r.target.valueAsNumber;e===1?delete B.filters[t]:B.filters[t]=e,be({filters:B.filters}),this.updateFilterStyle()},startLoadingWatch(){Es(0);for(let t=this.viewer.world.getItemCount()-1;t>=0;t-=1){const r=this.viewer.world.getItemAt(t);if(r&&r._tilesLoading){Es(1);break}}this.loadingTimeout=setTimeout(this.startLoadingWatch,200)},stopLoadingWatch(){clearTimeout(this.loadingTimeout)},updateFilterStyle(){if(!this.filtersActive)return;const t=[];Object.keys(B.filters).forEach(i=>{t.push(`${i}(${B.filters[i]})`)});const{image:r}=this.$refs,e=t.join(" ");r.style.cssText=`filter: ${e}`},updateViewerState(){const t=this.viewer.viewport.getZoom();this.viewerState.isMaxZoom=t>=this.viewer.viewport.getMaxZoom(),this.viewerState.isMinZoom=t<=this.viewer.viewport.getMinZoom();const r=this.viewer.viewport.getHomeBounds(),e=this.viewer.viewport.getBounds();this.viewerState.isReset=Math.abs(r.height-e.height)<1e-9&&Math.abs(r.width-e.width)<1e-9&&Math.abs(r.x-e.x)<1e-9&&Math.abs(r.y-e.y)<1e-9},translate:Se,zoomIn(){this.viewer.viewport.zoomBy(this.zoomFactor)},zoomOut(){this.viewer.viewport.zoomBy(1/this.zoomFactor)}}},md={class:"tify-scan"},vd={class:"tify-sr-only"},yd=["title"],wd=["title"],_d={key:2,class:"tify-scan-buttons"},xd=["disabled","title"],Td=["disabled","title"],bd=["disabled","title"],Ed=["title"],Sd=["title","aria-controls","aria-expanded"],Pd=["id"],Cd={class:"tify-sr-only"},Rd=["value"],Hd=["value"],Ld=["value"],Dd=["disabled"],Id={ref:"image",class:"tify-scan-image"};function Md(t,r,e,i,n,s){const c=kr,o=Fr,a=td,l=Xh,u=Wh,d=Ah,f=Dh,w=Sh,y=wh,x=fh,T=ah,S=Fn("click-outside");return H(),D("section",md,[M("h2",vd,U(s.translate("Scan")),1),!n.customPageViewActive&&!n.isFirstPage?(H(),D("button",{key:0,type:"button",class:"tify-scan-page-button -previous",title:s.translate("Previous page"),onClick:r[0]||(r[0]=(...L)=>s.goToPreviousPage&&s.goToPreviousPage(...L))},[X(c)],8,yd)):te("",!0),!n.customPageViewActive&&!n.isLastPage?(H(),D("button",{key:1,type:"button",class:"tify-scan-page-button -next",title:s.translate("Next page"),onClick:r[1]||(r[1]=(...L)=>s.goToNextPage&&s.goToNextPage(...L))},[X(o)],8,wd)):te("",!0),n.viewer?(H(),D("div",_d,[M("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMaxZoom,title:s.translate("Zoom in"),onClick:r[2]||(r[2]=(...L)=>s.zoomIn&&s.zoomIn(...L))},[X(a)],8,xd),M("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isReset,title:s.translate("Reset"),onClick:r[3]||(r[3]=L=>s.resetScan(!!L.shiftKey))},[X(l)],8,Td),M("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMinZoom,title:s.translate("Zoom out"),onClick:r[4]||(r[4]=(...L)=>s.zoomOut&&s.zoomOut(...L))},[X(u)],8,bd),M("button",{type:"button",class:_e(["tify-scan-button",{"-active":n.options.rotation}]),title:s.translate("Rotate"),onClick:r[5]||(r[5]=L=>s.rotateRight(L))},[X(d)],10,Ed),Fe((H(),D("div",{class:_e(["tify-scan-filters",{"-open":n.filtersVisible}])},[M("button",{type:"button",class:_e(["tify-scan-button",{"-active":s.filtersActive}]),title:s.translate("Toggle image filters"),"aria-controls":s.getId("filters"),"aria-expanded":n.filtersVisible?"true":"false",onClick:r[6]||(r[6]=L=>n.filtersVisible=!n.filtersVisible)},[X(f)],10,Sd),Fe(M("div",{id:s.getId("filters"),class:"tify-scan-filters-popup"},[M("h3",Cd,U(s.translate("Image filters")),1),M("p",null,[M("label",null,[X(w),xe(" "+U(s.translate("Brightness"))+" ",1),M("b",null,U(Math.round((n.options.filters.brightness||1)*100))+"Â %",1),M("input",{ref:"firstSlider",class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:n.options.filters.brightness||1,onInput:r[7]||(r[7]=L=>s.setFilter("brightness",L))},null,40,Rd)])]),M("p",null,[M("label",null,[X(y),xe(" "+U(s.translate("Contrast"))+" ",1),M("b",null,U(Math.round((n.options.filters.contrast||1)*100))+"Â %",1),M("input",{class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:n.options.filters.contrast||1,onInput:r[8]||(r[8]=L=>s.setFilter("contrast",L))},null,40,Hd)])]),M("p",null,[M("label",null,[X(x),xe(" "+U(s.translate("Saturation"))+" ",1),M("b",null,U(Math.round(s.saturation*100))+"Â %",1),M("input",{class:"tify-scan-range",max:"3",min:"0",step:".01",type:"range",value:s.saturation,onInput:r[9]||(r[9]=L=>s.setFilter("saturate",L))},null,40,Ld)])]),M("p",null,[M("button",{type:"button",class:"tify-scan-reset",disabled:!s.filtersActive,onClick:r[10]||(r[10]=(...L)=>s.resetFilters&&s.resetFilters(...L))},[X(T),xe(" "+U(s.translate("Reset")),1)],8,Dd)])],8,Pd),[[st,n.filtersVisible]])],2)),[[S,s.closeFilters]])])):te("",!0),M("div",Id,null,512)])}const Od=se(gd,[["render",Md]]),Fd={},kd={class:"tify-icon",viewBox:"0 0 24 24"},Ad=M("path",{d:"M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z"},null,-1),Bd=[Ad];function zd(t,r){return H(),D("svg",kd,Bd)}const Nd=se(Fd,[["render",zd]]),Vd={},Ud={class:"tify-icon",viewBox:"0 0 24 24"},Wd=M("path",{d:"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"},null,-1),jd=[Wd];function Gd(t,r){return H(),D("svg",Ud,jd)}const qd=se(Vd,[["render",Gd]]),Zd={},Kd={class:"tify-icon",viewBox:"0 0 24 24"},Xd=M("path",{d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"},null,-1),Yd=[Xd];function Jd(t,r){return H(),D("svg",Kd,Yd)}const Qd=se(Zd,[["render",Jd]]),$d={},ef={class:"tify-icon",viewBox:"0 0 24 24"},tf=M("path",{d:"M11 15H17V17H11V15M9 7H7V9H9V7M11 13H17V11H11V13M11 9H17V7H11V9M9 11H7V13H9V11M21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5M19 5H5V19H19V5M9 15H7V17H9V15Z"},null,-1),nf=[tf];function sf(t,r){return H(),D("svg",ef,nf)}const rf=se($d,[["render",sf]]),of={},af={class:"tify-icon",viewBox:"0 0 24 24"},lf=M("path",{d:"M13,5V11H14.17L12,13.17L9.83,11H11V5H13M15,3H9V9H5L12,16L19,9H15V3M19,18H5V20H19V18Z"},null,-1),cf=[lf];function uf(t,r){return H(),D("svg",af,cf)}const hf=se(of,[["render",uf]]),df={},ff={class:"tify-icon",viewBox:"0 0 24 24"},pf=M("path",{d:"M13.5,4A1.5,1.5 0 0,0 12,5.5A1.5,1.5 0 0,0 13.5,7A1.5,1.5 0 0,0 15,5.5A1.5,1.5 0 0,0 13.5,4M13.14,8.77C11.95,8.87 8.7,11.46 8.7,11.46C8.5,11.61 8.56,11.6 8.72,11.88C8.88,12.15 8.86,12.17 9.05,12.04C9.25,11.91 9.58,11.7 10.13,11.36C12.25,10 10.47,13.14 9.56,18.43C9.2,21.05 11.56,19.7 12.17,19.3C12.77,18.91 14.38,17.8 14.54,17.69C14.76,17.54 14.6,17.42 14.43,17.17C14.31,17 14.19,17.12 14.19,17.12C13.54,17.55 12.35,18.45 12.19,17.88C12,17.31 13.22,13.4 13.89,10.71C14,10.07 14.3,8.67 13.14,8.77Z"},null,-1),gf=[pf];function mf(t,r){return H(),D("svg",ff,gf)}const vf=se(df,[["render",mf]]),yf={},wf={class:"tify-icon",viewBox:"0 0 24 24"},_f=M("path",{d:"M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z"},null,-1),xf=[_f];function Tf(t,r){return H(),D("svg",wf,xf)}const bf=se(yf,[["render",Tf]]),Ef={},Sf={class:"tify-icon",viewBox:"0 0 24 24"},Pf=M("path",{d:"M4,5H20V7H4V5M4,9H20V11H4V9M4,13H20V15H4V13M4,17H14V19H4V17Z"},null,-1),Cf=[Pf];function Rf(t,r){return H(),D("svg",Sf,Cf)}const Hf=se(Ef,[["render",Rf]]),Lf={},Df={class:"tify-icon",viewBox:"0 0 24 24"},If=M("path",{d:"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"},null,-1),Mf=[If];function Of(t,r){return H(),D("svg",Df,Mf)}const Ff=se(Lf,[["render",Of]]),kf={},Af={class:"tify-icon",viewBox:"0 0 24 24"},Bf=M("path",{d:"M12 16C13.1 16 14 16.9 14 18S13.1 20 12 20 10 19.1 10 18 10.9 16 12 16M12 10C13.1 10 14 10.9 14 12S13.1 14 12 14 10 13.1 10 12 10.9 10 12 10M12 4C13.1 4 14 4.9 14 6S13.1 8 12 8 10 7.1 10 6 10.9 4 12 4M6 16C7.1 16 8 16.9 8 18S7.1 20 6 20 4 19.1 4 18 4.9 16 6 16M6 10C7.1 10 8 10.9 8 12S7.1 14 6 14 4 13.1 4 12 4.9 10 6 10M6 4C7.1 4 8 4.9 8 6S7.1 8 6 8 4 7.1 4 6 4.9 4 6 4M18 16C19.1 16 20 16.9 20 18S19.1 20 18 20 16 19.1 16 18 16.9 16 18 16M18 10C19.1 10 20 10.9 20 12S19.1 14 18 14 16 13.1 16 12 16.9 10 18 10M18 4C19.1 4 20 4.9 20 6S19.1 8 18 8 16 7.1 16 6 16.9 4 18 4Z"},null,-1),zf=[Bf];function Nf(t,r){return H(),D("svg",Af,zf)}const Vf=se(kf,[["render",Nf]]),Uf={},Wf={class:"tify-icon",viewBox:"0 0 24 24"},jf=M("path",{d:"M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M16,6H18V18H16V6Z"},null,-1),Gf=[jf];function qf(t,r){return H(),D("svg",Wf,Gf)}const Zf=se(Uf,[["render",qf]]),Kf={},Xf={class:"tify-icon",viewBox:"0 0 24 24"},Yf=M("path",{d:"M16,18H18V6H16M6,18L14.5,12L6,6V18Z"},null,-1),Jf=[Yf];function Qf(t,r){return H(),D("svg",Xf,Jf)}const $f=se(Kf,[["render",Qf]]),ep={},tp={class:"tify-icon",viewBox:"0 0 24 24"},ip=M("path",{d:"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"},null,-1),np=[ip];function sp(t,r){return H(),D("svg",tp,np)}const rp=se(ep,[["render",sp]]),op={},ap={class:"tify-icon",viewBox:"0 0 24 24"},lp=M("path",{d:"M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z"},null,-1),cp=[lp];function up(t,r){return H(),D("svg",ap,cp)}const hp=se(op,[["render",up]]),dp={},fp={class:"tify-icon",viewBox:"0 0 24 24"},pp=M("path",{d:"M21,5C19.89,4.65 18.67,4.5 17.5,4.5C15.55,4.5 13.45,4.9 12,6C10.55,4.9 8.45,4.5 6.5,4.5C4.55,4.5 2.45,4.9 1,6V20.65C1,20.9 1.25,21.15 1.5,21.15C1.6,21.15 1.65,21.1 1.75,21.1C3.1,20.45 5.05,20 6.5,20C8.45,20 10.55,20.4 12,21.5C13.35,20.65 15.8,20 17.5,20C19.15,20 20.85,20.3 22.25,21.05C22.35,21.1 22.4,21.1 22.5,21.1C22.75,21.1 23,20.85 23,20.6V6C22.4,5.55 21.75,5.25 21,5M21,18.5C19.9,18.15 18.7,18 17.5,18C15.8,18 13.35,18.65 12,19.5V8C13.35,7.15 15.8,6.5 17.5,6.5C18.7,6.5 19.9,6.65 21,7V18.5Z"},null,-1),gp=[pp];function mp(t,r){return H(),D("svg",fp,gp)}const vp=se(dp,[["render",mp]]),yp={},wp={class:"tify-icon",viewBox:"0 0 24 24"},_p=M("path",{d:"M16,5V11H21V5M10,11H15V5H10M16,18H21V12H16M10,18H15V12H10M4,18H9V12H4M4,11H9V5H4V11Z"},null,-1),xp=[_p];function Tp(t,r){return H(),D("svg",wp,xp)}const bp=se(yp,[["render",Tp]]),Ep={data(){return{filter:"",filteredCanvases:[],highlightIndex:0,isOpen:!1,options:B}},computed:{canvases(){return ce.sequences[0].canvases||[]},currentPageLabel(){const t=B.pages[0]||1,r=B.pages[0]?B.pages[0]-1:0,e=He(this.canvases[r].label)[0];return hi(t,e)},currentPageTitleAttr(){const{pages:t}=B,r=t[0]===0&&t.length>1?1:t[0],e=Se("Physical page"),i=Se("Logical page");return`${e}: ${r}
${i}: ${He(this.canvases[r-1].label)[0]}`}},watch:{filter(){this.updateFilteredCanvases(),this.$nextTick(()=>this.updateScroll())},isOpen(){this.isOpen&&(this.filter="",this.highlightIndex=B.pages[0]-1)}},mounted(){this.updateFilteredCanvases(),B.root.$el.addEventListener("keydown",this.onKeydown)},beforeUnmount(){B.root.$el.removeEventListener("keydown",this.onKeydown)},methods:{closeDropdown(){this.isOpen=!1},convertValueToArray:He,getId:Nt,getPageLabel:hi,onKeydown(t){if(!Wn(t)){if(t.key==="Escape"){this.closeDropdown();return}t.key==="x"&&(this.toggleDropdown(),t.preventDefault())}},onKeyDownArrow(){this.highlightIndex<this.filteredCanvases.length-1&&(this.highlightIndex+=1,this.updateScroll())},onKeyUpArrow(){this.highlightIndex>0&&(this.highlightIndex-=1,this.updateScroll())},setPage(t){this.closeDropdown(),ct(t),zt()&&be({view:"scan"})},toggleDropdown(){this.isOpen=!this.isOpen,this.isOpen&&this.$nextTick(()=>{this.$refs.search.focus(),this.updateScroll()})},updateFilteredCanvases(){const t=[],r=this.filter.toLowerCase();let e=-1;this.canvases.forEach((i,n)=>{const c=He(i.label)[0].toLowerCase().indexOf(r)>-1,o=(n+1).toFixed().indexOf(r)>-1;if(c||o){const a=i;a.page=n+1,a.page===B.pages[0]&&(e=t.length),t.push(a)}}),this.highlightIndex=e<0?0:e,this.filteredCanvases=t},updateScroll(){const{list:t}=this.$refs;if(t&&t.children[this.highlightIndex]){const{offsetTop:r}=t.children[this.highlightIndex];t.scrollTop=r-(t.offsetHeight/2-t.children[0].offsetHeight)}},translate:Se}},Sp={class:"tify-page-select"},Pp=["title","aria-label","aria-controls","aria-expanded"],Cp=["id"],Rp={class:"tify-page-select-filter"},Hp=["aria-label"],Lp={ref:"list",class:"tify-page-select-list"},Dp=["onClick"];function Ip(t,r,e,i,n,s){const c=Fn("click-outside");return H(),D("div",Sp,[Fe((H(),D("button",{type:"button",class:"tify-page-select-button",title:s.currentPageTitleAttr,"aria-label":s.translate("Current page"),"aria-controls":s.getId("dropdown"),"aria-expanded":n.isOpen?"true":"false",onClick:r[0]||(r[0]=(...o)=>s.toggleDropdown&&s.toggleDropdown(...o))},[xe(U(s.currentPageLabel),1)],8,Pp)),[[c,s.closeDropdown]]),Fe(M("div",{id:s.getId("dropdown"),key:"dropdown",class:"tify-page-select-dropdown",onClick:r[6]||(r[6]=Mt(()=>{},["stop"]))},[M("div",Rp,[Fe(M("input",{ref:"search","onUpdate:modelValue":r[1]||(r[1]=o=>n.filter=o),"aria-label":s.translate("Filter pages"),type:"text",class:"tify-page-select-input",onKeyup:r[2]||(r[2]=ii(o=>n.filteredCanvases[n.highlightIndex]&&s.setPage(n.filteredCanvases[n.highlightIndex].page),["enter"])),onKeydown:[r[3]||(r[3]=ii(Mt(o=>n.filter?n.filter="":s.closeDropdown(),["prevent"]),["esc"])),r[4]||(r[4]=ii(Mt(o=>s.onKeyUpArrow(),["prevent"]),["up"])),r[5]||(r[5]=ii(Mt(o=>s.onKeyDownArrow(),["prevent"]),["down"]))]},null,40,Hp),[[Pr,n.filter]])]),M("ol",Lp,[(H(!0),D(ae,null,Pe(n.filteredCanvases,(o,a)=>(H(),D("li",{key:a,class:_e({"-current":n.options.pages.indexOf(o.page)>-1,"-highlighted":n.highlightIndex===a})},[M("a",{href:"javascript:;",onClick:l=>s.setPage(o.page)},U(s.getPageLabel(o.page,s.convertValueToArray(o.label)[0])),9,Dp)],2))),128))],512)],8,Cp),[[st,n.isOpen]])])}const Mp=se(Ep,[["render",Ip]]),Op={props:{fulltextEnabled:Boolean,tocEnabled:Boolean},data(){return{collection:Le,controlsVisible:!1,customPageViewActive:Dr,fullscreenActive:!1,isFirstPage:Ir,isLastPage:Mr,manifest:ce,options:B,screen:B.root.$el.parentNode}},computed:{fullscreenSupported(){return document.fullscreenElement===null||document.webkitFullscreenElement===null},isLastSection(){const{pages:t}=B,r=t.length-1;return(t[r]?t[r]:t[r-1])>=this.sections[this.sections.length-1].firstPage},sections(){const t=[];return this.structures&&this.structures.forEach(r=>{if(!r.canvases){t.push({firstPage:1,lastPage:lt.value});return}const e=r.canvases[0],i=Ve.value.findIndex(c=>c["@id"]===e)+1,n=r.canvases[r.canvases.length-1],s=Ve.value.findIndex(c=>c["@id"]===n)+1;t.push({firstPage:i,lastPage:s})}),t},structures(){return ce?ce.structures:[]},title(){return He((ce||Le||{}).label).join(`${String.fromCharCode(160)}Â· `).trim().replace(/(\S{1,10})\s+(\S{1,10})$/,`$1${String.fromCharCode(160)}$2`)}},created(){kt(this.setView),kt(this.toggleDoublePage),kt(this.toggleFullscreen)},mounted(){B.root.$el.addEventListener("keydown",this.onKeyDown),["","moz","webkit"].forEach(r=>{document.addEventListener(`${r}fullscreenchange`,this.toggleFullscreenActive)})},beforeUnmount(){B.root.$el.removeEventListener("keydown",this.onKeyDown)},methods:{closeControlsPopup(){this.controlsVisible=!1},detectFullscreen(){let t;switch(null){case document.fullscreenElement:t=document.fullscreenElement;break;case document.webkitFullscreenElement:t=document.webkitFullscreenElement;break;default:t=!1}return t},getId:Nt,goToFirstPage:Ps,goToLastPage:Cs,goToNextPage:vn,goToPreviousPage:yn,goToNextSection(){const{pages:t}=B,r=t.length-1,e=t[r]?t[r]:t[r-1];let i=0;for(;e>=this.sections[i].firstPage||e&&e>=this.sections[i].firstPage;)i+=1;ct(this.sections[i].firstPage)},goToPreviousSection(){const{pages:t}=B,r=t[0]?t[0]:t[1];let e=this.sections.length-1;for(;r<=this.sections[e].firstPage||r&&r<=this.sections[e].firstPage;)e-=1;ct(this.sections[e].firstPage)},onKeyDown(t){if(Wn(t))return;if(t.key==="Escape"){this.controlsVisible=!1;return}switch(t.key){case"Backspace":this.$refs.switchViewSmall.offsetParent&&this.toggleView("scan");break;case"1":ce&&this.fulltextEnabled&&this.toggleView("fulltext");break;case"2":ce&&this.toggleView("thumbnails");break;case"3":ce&&this.tocEnabled&&this.toggleView("toc");break;case"4":this.toggleView("info");break;case"5":ce&&this.toggleView("export");break;case"6":Le&&this.toggleView("collection");break;case"7":this.toggleView("help");break;case"b":ce&&this.toggleDoublePage();break;case"f":this.toggleFullscreen();break}if(!ce||this.customPageViewActive)return;const{pages:r}=B;switch(t.key){case"q":case",":r[0]>1&&yn();break;case"e":case".":this.isLastPage||vn();break;case"Q":r[0]>1&&Ps();break;case"E":this.isLastPage||Cs();break}},setView(t){be({view:t})},toggleControlsPopup(){this.controlsVisible=!this.controlsVisible},toggleDoublePage(t){const{pages:r}=B;let e;if(r.length>1&&t!==!0||t===!1)e=[r[0]<1?1:r[0]];else if(r[0]<2)e=[0,1];else if(r[0]%2>0)e=[r[0]-1,r[0]];else{const i=r[0]<lt.value?r[0]+1:0;e=[r[0],i]}return be({pages:e}),e},toggleFullscreen(t){return this.fullscreenActive&&t!==!0||t===!1?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),!1):(this.screen.requestFullscreen?this.screen.requestFullscreen():this.screen.mozRequestFullScreen?this.screen.mozRequestFullScreen():this.screen.webkitRequestFullscreen&&this.screen.webkitRequestFullscreen(),!0)},toggleFullscreenActive(){this.fullscreenActive=!this.fullscreenActive},toggleView(t){const r=t===B.view&&ce&&!zt()?"":t;return be({view:r}),r},translate:Se}},Fp={class:"tify-header"},kp={class:"tify-header-column -title"},Ap=["title"],Bp={key:0,class:"tify-header-column -pagination"},zp={class:"tify-header-button-group -page-select"},Np=["title"],Vp={class:"tify-header-button-group -pagination"},Up=["disabled","title"],Wp=["disabled","title"],jp=["disabled","title"],Gp=["disabled","title"],qp=["disabled","title"],Zp=["disabled","title"],Kp={class:"tify-header-column -toggle"},Xp={ref:"switchViewSmall",class:"tify-header-button-group -toggle"},Yp=["aria-controls","aria-expanded","aria-label","title"],Jp=["id"],Qp={class:"tify-header-button-group -view"},$p=["aria-controls","aria-expanded"],eg=["aria-controls","aria-expanded"],tg=["aria-controls","aria-expanded"],ig=["aria-controls","aria-expanded"],ng=["aria-controls","aria-expanded"],sg=["aria-controls","aria-expanded"],rg=["aria-controls","aria-expanded"],og={key:0,class:"tify-header-button-group -view"},ag=["aria-controls","aria-expanded","title"],lg=["title"],cg=["title"],ug={key:1,class:"tify-header-button-group -popup"},hg=["disabled","title"],dg=["disabled","title"],fg=["disabled","title"],pg=["disabled","title"],gg=["disabled","title"],mg=["disabled","title"];function vg(t,r,e,i,n,s){const c=Mp,o=bp,a=vp,l=hp,u=rp,d=kr,f=Fr,w=$f,y=Zf,x=Vf,T=Ff,S=Hf,L=bf,I=vf,j=hf,Y=rf,Q=Qd,ie=qd,J=Nd,ee=Fn("click-outside");return H(),D("header",Fp,[M("div",kp,[M("h1",{class:"tify-header-title",title:s.title},U(s.title),9,Ap)]),n.manifest["@id"]?(H(),D("div",Bp,[M("div",zp,[X(c),M("button",{type:"button",class:_e(["tify-header-button",{"-active":n.options.pages.length>1}]),title:s.translate("Toggle double-page"),onClick:r[0]||(r[0]=(...K)=>s.toggleDoublePage&&s.toggleDoublePage(...K))},[n.customPageViewActive?(H(),Ie(o,{key:0})):(H(),Ie(a,{key:1}))],10,Np)]),M("div",Vp,[M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("First page"),onClick:r[1]||(r[1]=(...K)=>s.goToFirstPage&&s.goToFirstPage(...K))},[X(l)],8,Up),s.structures&&s.structures.length?(H(),D("button",{key:0,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous section"),onClick:r[2]||(r[2]=(...K)=>s.goToPreviousSection&&s.goToPreviousSection(...K))},[X(u)],8,Wp)):te("",!0),M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous page"),onClick:r[3]||(r[3]=(...K)=>s.goToPreviousPage&&s.goToPreviousPage(...K))},[X(d)],8,jp),M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Next page"),onClick:r[4]||(r[4]=(...K)=>s.goToNextPage&&s.goToNextPage(...K))},[X(f)],8,Gp),s.structures&&s.structures.length?(H(),D("button",{key:1,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||s.isLastSection,title:s.translate("Next section"),onClick:r[5]||(r[5]=(...K)=>s.goToNextSection&&s.goToNextSection(...K))},[X(w)],8,qp)):te("",!0),M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Last page"),onClick:r[6]||(r[6]=(...K)=>s.goToLastPage&&s.goToLastPage(...K))},[X(y)],8,Zp)])])):te("",!0),M("div",Kp,[M("div",Xp,[Fe((H(),D("button",{type:"button","aria-controls":s.getId("controls"),"aria-expanded":n.controlsVisible?"true":"false","aria-label":s.translate("View"),class:"tify-header-button",title:s.translate("View"),onClick:r[7]||(r[7]=(...K)=>s.toggleControlsPopup&&s.toggleControlsPopup(...K))},[X(x)],8,Yp)),[[ee,s.closeControlsPopup]])],512)]),M("div",{id:s.getId("controls"),class:_e(["tify-header-column -controls",{"-visible":n.controlsVisible}])},[M("div",Qp,[n.manifest["@id"]?(H(),D("button",{key:0,type:"button",class:_e(["tify-header-button -scan",{"-active":n.options.view==="scan"}]),"aria-controls":s.getId("scan"),"aria-expanded":n.options.view==="scan"?"true":"false",onClick:r[8]||(r[8]=K=>s.toggleView("scan"))},[X(T),xe(" "+U(s.translate("Scan")),1)],10,$p)):te("",!0),e.fulltextEnabled?(H(),D("button",{key:1,type:"button",class:_e(["tify-header-button",{"-active":n.options.view==="fulltext"}]),"aria-controls":s.getId("fulltext"),"aria-expanded":n.options.view==="fulltext"?"true":"false",onClick:r[9]||(r[9]=K=>s.toggleView("fulltext"))},[X(S),xe(" "+U(s.translate("Fulltext")),1)],10,eg)):te("",!0),n.manifest["@id"]?(H(),D("button",{key:2,type:"button",class:_e(["tify-header-button",{"-active":n.options.view==="thumbnails"}]),"aria-controls":s.getId("thumbnails"),"aria-expanded":n.options.view==="thumbnails"?"true":"false",onClick:r[10]||(r[10]=K=>s.toggleView("thumbnails"))},[X(o),xe(" "+U(s.translate("Pages")),1)],10,tg)):te("",!0),e.tocEnabled?(H(),D("button",{key:3,type:"button",class:_e(["tify-header-button",{"-active":n.options.view==="toc"}]),"aria-controls":s.getId("toc"),"aria-expanded":n.options.view==="toc"?"true":"false",onClick:r[11]||(r[11]=K=>s.toggleView("toc"))},[X(L),xe(" "+U(s.translate("Contents")),1)],10,ig)):te("",!0),M("button",{type:"button",class:_e(["tify-header-button",{"-active":n.options.view==="info"}]),"aria-controls":s.getId("info"),"aria-expanded":n.options.view==="info"?"true":"false",onClick:r[12]||(r[12]=K=>s.toggleView("info"))},[X(I),xe(" "+U(s.translate("Info")),1)],10,ng),n.manifest["@id"]?(H(),D("button",{key:4,type:"button",class:_e(["tify-header-button",{"-active":n.options.view==="export"}]),"aria-controls":s.getId("export"),"aria-expanded":n.options.view==="export"?"true":"false",onClick:r[13]||(r[13]=K=>s.toggleView("export"))},[X(j),xe(" "+U(s.translate("Export")),1)],10,sg)):te("",!0),n.collection["@id"]?(H(),D("button",{key:5,type:"button",class:_e(["tify-header-button",{"-active":n.options.view==="collection"}]),"aria-controls":s.getId("collection"),"aria-expanded":n.options==="collection"?"true":"false",onClick:r[14]||(r[14]=K=>s.toggleView("collection"))},[X(Y),xe(" "+U(s.translate("Collection")),1)],10,rg)):te("",!0)]),s.fullscreenSupported?(H(),D("div",og,[M("button",{type:"button",class:_e(["tify-header-button -icon-only",{"-active":n.options.view==="help"}]),"aria-controls":s.getId("help"),"aria-expanded":n.options.view==="help"?"true":"false",title:s.translate("Help"),onClick:r[15]||(r[15]=K=>s.toggleView("help"))},[X(Q),xe(" "+U(s.translate("Help")),1)],10,ag),n.fullscreenActive?(H(),D("button",{key:1,type:"button",class:"tify-header-button -icon-only",title:s.translate("Exit fullscreen"),onClick:r[17]||(r[17]=(...K)=>s.toggleFullscreen&&s.toggleFullscreen(...K))},[X(J),xe(" "+U(s.translate("Exit fullscreen")),1)],8,cg)):(H(),D("button",{key:0,type:"button",class:"tify-header-button -icon-only",title:s.translate("Fullscreen"),onClick:r[16]||(r[16]=(...K)=>s.toggleFullscreen&&s.toggleFullscreen(...K))},[X(ie),xe(" "+U(s.translate("Fullscreen")),1)],8,lg))])):te("",!0),n.manifest["@id"]?(H(),D("div",ug,[M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("First page"),onClick:r[18]||(r[18]=(...K)=>s.goToFirstPage&&s.goToFirstPage(...K))},[X(l)],8,hg),s.structures&&s.structures.length?(H(),D("button",{key:0,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous section"),onClick:r[19]||(r[19]=(...K)=>s.goToPreviousSection&&s.goToPreviousSection(...K))},[X(u)],8,dg)):te("",!0),M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous page"),onClick:r[20]||(r[20]=(...K)=>s.goToPreviousPage&&s.goToPreviousPage(...K))},[X(d)],8,fg),M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Next page"),onClick:r[21]||(r[21]=(...K)=>s.goToNextPage&&s.goToNextPage(...K))},[X(f)],8,pg),s.structures&&s.structures.length?(H(),D("button",{key:1,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||s.isLastSection,title:s.translate("Next section"),onClick:r[22]||(r[22]=(...K)=>s.goToNextSection&&s.goToNextSection(...K))},[X(w)],8,gg)):te("",!0),M("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Last page"),onClick:r[23]||(r[23]=(...K)=>s.goToLastPage&&s.goToLastPage(...K))},[X(y)],8,mg)])):te("",!0)],10,Jp)])}const yg=se(Op,[["render",vg]]);const wg={props:{ready:Boolean},data(){return{canvases:Ve,collection:Le,manifest:ce,error:Hi,loading:qe,options:B,translationLoaded:!!dn}},computed:{hasOtherContent(){return Ve.value.some(t=>"otherContent"in t)},hasToc(){return ce.structures&&ce.structures.length>0}},methods:{getId:Nt,setError:tt,translate:Se}},_g={class:"tify",tabindex:"-1"},xg={key:1,class:"tify-main"},Tg=["aria-label"],bg={key:3,class:"tify-error"};function Eg(t,r,e,i,n,s){const c=yg,o=Od,a=th,l=Zu,u=Bu,d=Iu,f=iu,w=cc,y=Il,x=Cr;return H(),D("article",_g,[e.ready&&(n.collection["@id"]||n.manifest["@id"])?(H(),Ie(c,{key:0,"fulltext-enabled":s.hasOtherContent,"toc-enabled":s.hasToc},null,8,["fulltext-enabled","toc-enabled"])):te("",!0),e.ready?(H(),D("div",xg,[n.manifest["@id"]?(H(),D(ae,{key:0},[X(o,{id:s.getId("scan")},null,8,["id"]),s.hasOtherContent?Fe((H(),Ie(a,{key:0,id:s.getId("fulltext")},null,8,["id"])),[[st,n.options.view==="fulltext"]]):te("",!0),Fe(X(l,{id:s.getId("thumbnails")},null,8,["id"]),[[st,n.options.view==="thumbnails"]]),s.hasToc?Fe((H(),Ie(u,{key:1,id:s.getId("toc")},null,8,["id"])),[[st,n.options.view==="toc"]]):te("",!0),Fe(X(d,{id:s.getId("export")},null,8,["id"]),[[st,n.options.view==="export"]])],64)):te("",!0),n.collection["@id"]||n.manifest["@id"]?Fe((H(),Ie(f,{key:1,id:s.getId("info")},null,8,["id"])),[[st,n.options.view==="info"]]):te("",!0),n.collection["@id"]?Fe((H(),Ie(w,{key:2,id:s.getId("collection")},null,8,["id"])),[[st,n.options.view==="collection"]]):te("",!0),Fe(X(y,{id:s.getId("help")},null,8,["id"]),[[st,n.options.view==="help"]])])):te("",!0),n.loading?(H(),D("div",{key:2,class:"tify-loading","aria-label":n.translationLoaded?s.translate("Loading"):"Loading"},null,8,Tg)):te("",!0),n.error?(H(),D("div",bg,[M("button",{type:"button",class:"tify-error-close",onClick:r[0]||(r[0]=T=>s.setError(""))},[X(x)]),M("span",null,U(n.error),1)])):te("",!0)])}const Sg=se(wg,[["render",Eg]]);window.Tify=function(r={}){const e={breakpoints:{tiny:359,small:719,medium:959,large:1199},childManifestAutoloaded:!0,childManifestUrl:null,container:null,filters:{},language:"en",manifestUrl:null,optionsResetOnPageChange:["pan"],pageLabelFormat:"P : L",pages:null,pan:{},rotation:null,translationsDirUrl:null,urlQueryKey:null,urlQueryParams:["childManifestUrl","filters","pages","pan","rotation","view","zoom"],view:"",viewer:{},zoom:null};if(this.options={...e,...r},!this.options.translationsDirUrl){const o=[...document.getElementsByTagName("script")].find(a=>a.src.includes("/tify"));if(o){const{src:a}=o;this.options.translationsDirUrl=`${a.substring(0,a.lastIndexOf("/"))}/translations`}}let i=null;this.ready=new Promise((c,o)=>{i={resolve:c,reject:o}});const n=this;this.app=ul({data(){return{collection:null,error:"",manifest:null,options:n.options,ready:!1,readyPromise:i,translation:null}},created(){this.options.root=this,be(n.options),kt(Ss),kt(ct)},mounted(){if(this.updateBreakpoint(),window.addEventListener("resize",this.updateBreakpoint),!this.options.manifestUrl){tt('Missing option "manifestUrl"');return}Promise.all([Nn(this.options.manifestUrl,{}),Ss(this.options.language)]).then(()=>{this.$nextTick(()=>{this.ready=!0,this.readyPromise.resolve()})},c=>{this.readyPromise.reject(c)})},beforeUnmount(){clearTimeout(hn),window.removeEventListener("resize",this.updateBreakpoint),window.removeEventListener("popstate",gn)},methods:{updateBreakpoint(){Object.keys(this.options.breakpoints).forEach(c=>{this.$el.clientWidth<=this.options.breakpoints[c]?this.$el.classList.add(`-${c}`):this.$el.classList.remove(`-${c}`)}),this.$el.clientHeight<520?this.$el.classList.add("-short"):this.$el.classList.remove("-short")}},render(){return Ba(Sg,{ready:this.ready})}}),this.app.use(fl);let s=!1;this.mount=c=>{if(s)throw new Error("TIFY is already mounted");const o=typeof c=="string"?document.querySelector(c):c;if(!o)throw new Error("Container element not found");window.getComputedStyle(o).position==="static"&&(o.style.position="relative"),this.app.mount(o),s=!0},this.destroy=()=>{this.app.unmount()},this.options.container&&this.mount(this.options.container)};
