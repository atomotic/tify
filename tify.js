/*!
TIFY v0.29.2
(c) 2017-2024 GÃ¶ttingen State and University Library (https://www.sub.uni-goettingen.de/)
AGPL-3.0
https://tify.rocks/
*/
(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();/**
* @vue/shared v3.4.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Xi(t,s){const e=new Set(t.split(","));return s?i=>e.has(i.toLowerCase()):i=>e.has(i)}const _e={},Ht=[],Ve=()=>{},fr=()=>!1,ui=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Yi=t=>t.startsWith("onUpdate:"),Me=Object.assign,Ji=(t,s)=>{const e=t.indexOf(s);e>-1&&t.splice(e,1)},pr=Object.prototype.hasOwnProperty,me=(t,s)=>pr.call(t,s),ce=Array.isArray,Lt=t=>ci(t)==="[object Map]",rs=t=>ci(t)==="[object Set]",pe=t=>typeof t=="function",Se=t=>typeof t=="string",kt=t=>typeof t=="symbol",xe=t=>t!==null&&typeof t=="object",os=t=>(xe(t)||pe(t))&&pe(t.then)&&pe(t.catch),as=Object.prototype.toString,ci=t=>as.call(t),gr=t=>ci(t).slice(8,-1),ls=t=>ci(t)==="[object Object]",Qi=t=>Se(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Qt=Xi(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),hi=t=>{const s=Object.create(null);return e=>s[e]||(s[e]=t(e))},mr=/-(\w)/g,Je=hi(t=>t.replace(mr,(s,e)=>e?e.toUpperCase():"")),vr=/\B([A-Z])/g,xt=hi(t=>t.replace(vr,"-$1").toLowerCase()),di=hi(t=>t.charAt(0).toUpperCase()+t.slice(1)),xi=hi(t=>t?`on${di(t)}`:""),_t=(t,s)=>!Object.is(t,s),$t=(t,s)=>{for(let e=0;e<t.length;e++)t[e](s)},ni=(t,s,e)=>{Object.defineProperty(t,s,{configurable:!0,enumerable:!1,value:e})},Di=t=>{const s=parseFloat(t);return isNaN(s)?t:s};let En;const us=()=>En||(En=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function $i(t){if(ce(t)){const s={};for(let e=0;e<t.length;e++){const i=t[e],n=Se(i)?Tr(i):$i(i);if(n)for(const r in n)s[r]=n[r]}return s}else if(Se(t)||xe(t))return t}const yr=/;(?![^(]*\))/g,wr=/:([^]+)/,_r=/\/\*[^]*?\*\//g;function Tr(t){const s={};return t.replace(_r,"").split(yr).forEach(e=>{if(e){const i=e.split(wr);i.length>1&&(s[i[0].trim()]=i[1].trim())}}),s}function Te(t){let s="";if(Se(t))s=t;else if(ce(t))for(let e=0;e<t.length;e++){const i=Te(t[e]);i&&(s+=i+" ")}else if(xe(t))for(const e in t)t[e]&&(s+=e+" ");return s.trim()}const xr="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",br=Xi(xr);function cs(t){return!!t||t===""}const q=t=>Se(t)?t:t==null?"":ce(t)||xe(t)&&(t.toString===as||!pe(t.toString))?JSON.stringify(t,hs,2):String(t),hs=(t,s)=>s&&s.__v_isRef?hs(t,s.value):Lt(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((e,[i,n],r)=>(e[bi(i,r)+" =>"]=n,e),{})}:rs(s)?{[`Set(${s.size})`]:[...s.values()].map(e=>bi(e))}:kt(s)?bi(s):xe(s)&&!ce(s)&&!ls(s)?String(s):s,bi=(t,s="")=>{var e;return kt(t)?`Symbol(${(e=t.description)!=null?e:s})`:t};/**
* @vue/reactivity v3.4.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let We;class Er{constructor(s=!1){this.detached=s,this._active=!0,this.effects=[],this.cleanups=[],this.parent=We,!s&&We&&(this.index=(We.scopes||(We.scopes=[])).push(this)-1)}get active(){return this._active}run(s){if(this._active){const e=We;try{return We=this,s()}finally{We=e}}}on(){We=this}off(){We=this.parent}stop(s){if(this._active){let e,i;for(e=0,i=this.effects.length;e<i;e++)this.effects[e].stop();for(e=0,i=this.cleanups.length;e<i;e++)this.cleanups[e]();if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!s){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0,this._active=!1}}}function Sr(t,s=We){s&&s.active&&s.effects.push(t)}function Pr(){return We}let yt;class en{constructor(s,e,i,n){this.fn=s,this.trigger=e,this.scheduler=i,this.active=!0,this.deps=[],this._dirtyLevel=2,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,Sr(this,n)}get dirty(){if(this._dirtyLevel===1){bt();for(let s=0;s<this._depsLength;s++){const e=this.deps[s];if(e.computed&&(Cr(e.computed),this._dirtyLevel>=2))break}this._dirtyLevel<2&&(this._dirtyLevel=0),Et()}return this._dirtyLevel>=2}set dirty(s){this._dirtyLevel=s?2:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let s=ut,e=yt;try{return ut=!0,yt=this,this._runnings++,Sn(this),this.fn()}finally{Pn(this),this._runnings--,yt=e,ut=s}}stop(){var s;this.active&&(Sn(this),Pn(this),(s=this.onStop)==null||s.call(this),this.active=!1)}}function Cr(t){return t.value}function Sn(t){t._trackId++,t._depsLength=0}function Pn(t){if(t.deps&&t.deps.length>t._depsLength){for(let s=t._depsLength;s<t.deps.length;s++)ds(t.deps[s],t);t.deps.length=t._depsLength}}function ds(t,s){const e=t.get(s);e!==void 0&&s._trackId!==e&&(t.delete(s),t.size===0&&t.cleanup())}let ut=!0,ki=0;const fs=[];function bt(){fs.push(ut),ut=!1}function Et(){const t=fs.pop();ut=t===void 0?!0:t}function tn(){ki++}function nn(){for(ki--;!ki&&Fi.length;)Fi.shift()()}function ps(t,s,e){if(s.get(t)!==t._trackId){s.set(t,t._trackId);const i=t.deps[t._depsLength];i!==s?(i&&ds(i,t),t.deps[t._depsLength++]=s):t._depsLength++}}const Fi=[];function gs(t,s,e){tn();for(const i of t.keys())if(i._dirtyLevel<s&&t.get(i)===i._trackId){const n=i._dirtyLevel;i._dirtyLevel=s,n===0&&(i._shouldSchedule=!0,i.trigger())}ms(t),nn()}function ms(t){for(const s of t.keys())s.scheduler&&s._shouldSchedule&&(!s._runnings||s.allowRecurse)&&t.get(s)===s._trackId&&(s._shouldSchedule=!1,Fi.push(s.scheduler))}const vs=(t,s)=>{const e=new Map;return e.cleanup=t,e.computed=s,e},Ai=new WeakMap,wt=Symbol(""),Bi=Symbol("");function ze(t,s,e){if(ut&&yt){let i=Ai.get(t);i||Ai.set(t,i=new Map);let n=i.get(e);n||i.set(e,n=vs(()=>i.delete(e))),ps(yt,n)}}function $e(t,s,e,i,n,r){const l=Ai.get(t);if(!l)return;let a=[];if(s==="clear")a=[...l.values()];else if(e==="length"&&ce(t)){const o=Number(i);l.forEach((u,h)=>{(h==="length"||!kt(h)&&h>=o)&&a.push(u)})}else switch(e!==void 0&&a.push(l.get(e)),s){case"add":ce(t)?Qi(e)&&a.push(l.get("length")):(a.push(l.get(wt)),Lt(t)&&a.push(l.get(Bi)));break;case"delete":ce(t)||(a.push(l.get(wt)),Lt(t)&&a.push(l.get(Bi)));break;case"set":Lt(t)&&a.push(l.get(wt));break}tn();for(const o of a)o&&gs(o,2);nn()}const Rr=Xi("__proto__,__v_isRef,__isVue"),ys=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(kt)),Cn=Hr();function Hr(){const t={};return["includes","indexOf","lastIndexOf"].forEach(s=>{t[s]=function(...e){const i=we(this);for(let r=0,l=this.length;r<l;r++)ze(i,"get",r+"");const n=i[s](...e);return n===-1||n===!1?i[s](...e.map(we)):n}}),["push","pop","shift","unshift","splice"].forEach(s=>{t[s]=function(...e){bt(),tn();const i=we(this)[s].apply(this,e);return nn(),Et(),i}}),t}function Lr(t){const s=we(this);return ze(s,"has",t),s.hasOwnProperty(t)}class ws{constructor(s=!1,e=!1){this._isReadonly=s,this._shallow=e}get(s,e,i){const n=this._isReadonly,r=this._shallow;if(e==="__v_isReactive")return!n;if(e==="__v_isReadonly")return n;if(e==="__v_isShallow")return r;if(e==="__v_raw")return i===(n?r?Wr:bs:r?xs:Ts).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(i)?s:void 0;const l=ce(s);if(!n){if(l&&me(Cn,e))return Reflect.get(Cn,e,i);if(e==="hasOwnProperty")return Lr}const a=Reflect.get(s,e,i);return(kt(e)?ys.has(e):Rr(e))||(n||ze(s,"get",e),r)?a:Ne(a)?l&&Qi(e)?a:a.value:xe(a)?n?Es(a):pi(a):a}}class _s extends ws{constructor(s=!1){super(!1,s)}set(s,e,i,n){let r=s[e];if(!this._shallow){const o=Nt(r);if(!Ii(i)&&!Nt(i)&&(r=we(r),i=we(i)),!ce(s)&&Ne(r)&&!Ne(i))return o?!1:(r.value=i,!0)}const l=ce(s)&&Qi(e)?Number(e)<s.length:me(s,e),a=Reflect.set(s,e,i,n);return s===we(n)&&(l?_t(i,r)&&$e(s,"set",e,i):$e(s,"add",e,i)),a}deleteProperty(s,e){const i=me(s,e);s[e];const n=Reflect.deleteProperty(s,e);return n&&i&&$e(s,"delete",e,void 0),n}has(s,e){const i=Reflect.has(s,e);return(!kt(e)||!ys.has(e))&&ze(s,"has",e),i}ownKeys(s){return ze(s,"iterate",ce(s)?"length":wt),Reflect.ownKeys(s)}}class Or extends ws{constructor(s=!1){super(!0,s)}set(s,e){return!0}deleteProperty(s,e){return!0}}const Mr=new _s,Dr=new Or,kr=new _s(!0),sn=t=>t,fi=t=>Reflect.getPrototypeOf(t);function qt(t,s,e=!1,i=!1){t=t.__v_raw;const n=we(t),r=we(s);e||(_t(s,r)&&ze(n,"get",s),ze(n,"get",r));const{has:l}=fi(n),a=i?sn:e?ln:an;if(l.call(n,s))return a(t.get(s));if(l.call(n,r))return a(t.get(r));t!==n&&t.get(s)}function Zt(t,s=!1){const e=this.__v_raw,i=we(e),n=we(t);return s||(_t(t,n)&&ze(i,"has",t),ze(i,"has",n)),t===n?e.has(t):e.has(t)||e.has(n)}function Kt(t,s=!1){return t=t.__v_raw,!s&&ze(we(t),"iterate",wt),Reflect.get(t,"size",t)}function Rn(t){t=we(t);const s=we(this);return fi(s).has.call(s,t)||(s.add(t),$e(s,"add",t,t)),this}function Hn(t,s){s=we(s);const e=we(this),{has:i,get:n}=fi(e);let r=i.call(e,t);r||(t=we(t),r=i.call(e,t));const l=n.call(e,t);return e.set(t,s),r?_t(s,l)&&$e(e,"set",t,s):$e(e,"add",t,s),this}function Ln(t){const s=we(this),{has:e,get:i}=fi(s);let n=e.call(s,t);n||(t=we(t),n=e.call(s,t)),i&&i.call(s,t);const r=s.delete(t);return n&&$e(s,"delete",t,void 0),r}function On(){const t=we(this),s=t.size!==0,e=t.clear();return s&&$e(t,"clear",void 0,void 0),e}function Xt(t,s){return function(i,n){const r=this,l=r.__v_raw,a=we(l),o=s?sn:t?ln:an;return!t&&ze(a,"iterate",wt),l.forEach((u,h)=>i.call(n,o(u),o(h),r))}}function Yt(t,s,e){return function(...i){const n=this.__v_raw,r=we(n),l=Lt(r),a=t==="entries"||t===Symbol.iterator&&l,o=t==="keys"&&l,u=n[t](...i),h=e?sn:s?ln:an;return!s&&ze(r,"iterate",o?Bi:wt),{next(){const{value:g,done:m}=u.next();return m?{value:g,done:m}:{value:a?[h(g[0]),h(g[1])]:h(g),done:m}},[Symbol.iterator](){return this}}}}function st(t){return function(...s){return t==="delete"?!1:t==="clear"?void 0:this}}function Fr(){const t={get(r){return qt(this,r)},get size(){return Kt(this)},has:Zt,add:Rn,set:Hn,delete:Ln,clear:On,forEach:Xt(!1,!1)},s={get(r){return qt(this,r,!1,!0)},get size(){return Kt(this)},has:Zt,add:Rn,set:Hn,delete:Ln,clear:On,forEach:Xt(!1,!0)},e={get(r){return qt(this,r,!0)},get size(){return Kt(this,!0)},has(r){return Zt.call(this,r,!0)},add:st("add"),set:st("set"),delete:st("delete"),clear:st("clear"),forEach:Xt(!0,!1)},i={get(r){return qt(this,r,!0,!0)},get size(){return Kt(this,!0)},has(r){return Zt.call(this,r,!0)},add:st("add"),set:st("set"),delete:st("delete"),clear:st("clear"),forEach:Xt(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=Yt(r,!1,!1),e[r]=Yt(r,!0,!1),s[r]=Yt(r,!1,!0),i[r]=Yt(r,!0,!0)}),[t,e,s,i]}const[Ar,Br,Ir,zr]=Fr();function rn(t,s){const e=s?t?zr:Ir:t?Br:Ar;return(i,n,r)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?i:Reflect.get(me(e,n)&&n in i?e:i,n,r)}const Vr={get:rn(!1,!1)},Nr={get:rn(!1,!0)},Ur={get:rn(!0,!1)},Ts=new WeakMap,xs=new WeakMap,bs=new WeakMap,Wr=new WeakMap;function jr(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Gr(t){return t.__v_skip||!Object.isExtensible(t)?0:jr(gr(t))}function pi(t){return Nt(t)?t:on(t,!1,Mr,Vr,Ts)}function qr(t){return on(t,!1,kr,Nr,xs)}function Es(t){return on(t,!0,Dr,Ur,bs)}function on(t,s,e,i,n){if(!xe(t)||t.__v_raw&&!(s&&t.__v_isReactive))return t;const r=n.get(t);if(r)return r;const l=Gr(t);if(l===0)return t;const a=new Proxy(t,l===2?i:e);return n.set(t,a),a}function Ot(t){return Nt(t)?Ot(t.__v_raw):!!(t&&t.__v_isReactive)}function Nt(t){return!!(t&&t.__v_isReadonly)}function Ii(t){return!!(t&&t.__v_isShallow)}function Ss(t){return Ot(t)||Nt(t)}function we(t){const s=t&&t.__v_raw;return s?we(s):t}function Ps(t){return ni(t,"__v_skip",!0),t}const an=t=>xe(t)?pi(t):t,ln=t=>xe(t)?Es(t):t;class Cs{constructor(s,e,i,n){this._setter=e,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new en(()=>s(this._value),()=>Ei(this,1),()=>this.dep&&ms(this.dep)),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=i}get value(){const s=we(this);return(!s._cacheable||s.effect.dirty)&&_t(s._value,s._value=s.effect.run())&&Ei(s,2),Kr(s),s.effect._dirtyLevel>=1&&Ei(s,1),s._value}set value(s){this._setter(s)}get _dirty(){return this.effect.dirty}set _dirty(s){this.effect.dirty=s}}function Zr(t,s,e=!1){let i,n;const r=pe(t);return r?(i=t,n=Ve):(i=t.get,n=t.set),new Cs(i,n,r||!n,e)}function Kr(t){ut&&yt&&(t=we(t),ps(yt,t.dep||(t.dep=vs(()=>t.dep=void 0,t instanceof Cs?t:void 0))))}function Ei(t,s=2,e){t=we(t);const i=t.dep;i&&gs(i,s)}function Ne(t){return!!(t&&t.__v_isRef===!0)}function Xr(t){return Ne(t)?t.value:t}const Yr={get:(t,s,e)=>Xr(Reflect.get(t,s,e)),set:(t,s,e,i)=>{const n=t[s];return Ne(n)&&!Ne(e)?(n.value=e,!0):Reflect.set(t,s,e,i)}};function Rs(t){return Ot(t)?t:new Proxy(t,Yr)}/**
* @vue/runtime-core v3.4.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ct(t,s,e,i){let n;try{n=i?t(...i):t()}catch(r){gi(r,s,e)}return n}function Ge(t,s,e,i){if(pe(t)){const r=ct(t,s,e,i);return r&&os(r)&&r.catch(l=>{gi(l,s,e)}),r}const n=[];for(let r=0;r<t.length;r++)n.push(Ge(t[r],s,e,i));return n}function gi(t,s,e,i=!0){const n=s?s.vnode:null;if(s){let r=s.parent;const l=s.proxy,a=`https://vuejs.org/error-reference/#runtime-${e}`;for(;r;){const u=r.ec;if(u){for(let h=0;h<u.length;h++)if(u[h](t,l,a)===!1)return}r=r.parent}const o=s.appContext.config.errorHandler;if(o){ct(o,null,10,[t,l,a]);return}}Jr(t,e,n,i)}function Jr(t,s,e,i=!0){console.error(t)}let Ut=!1,zi=!1;const Le=[];let Ye=0;const Mt=[];let rt=null,gt=0;const Hs=Promise.resolve();let un=null;function Ls(t){const s=un||Hs;return t?s.then(this?t.bind(this):t):s}function Qr(t){let s=Ye+1,e=Le.length;for(;s<e;){const i=s+e>>>1,n=Le[i],r=Wt(n);r<t||r===t&&n.pre?s=i+1:e=i}return s}function cn(t){(!Le.length||!Le.includes(t,Ut&&t.allowRecurse?Ye+1:Ye))&&(t.id==null?Le.push(t):Le.splice(Qr(t.id),0,t),Os())}function Os(){!Ut&&!zi&&(zi=!0,un=Hs.then(Ds))}function $r(t){const s=Le.indexOf(t);s>Ye&&Le.splice(s,1)}function eo(t){ce(t)?Mt.push(...t):(!rt||!rt.includes(t,t.allowRecurse?gt+1:gt))&&Mt.push(t),Os()}function Mn(t,s,e=Ut?Ye+1:0){for(;e<Le.length;e++){const i=Le[e];if(i&&i.pre){if(t&&i.id!==t.uid)continue;Le.splice(e,1),e--,i()}}}function Ms(t){if(Mt.length){const s=[...new Set(Mt)].sort((e,i)=>Wt(e)-Wt(i));if(Mt.length=0,rt){rt.push(...s);return}for(rt=s,gt=0;gt<rt.length;gt++)rt[gt]();rt=null,gt=0}}const Wt=t=>t.id==null?1/0:t.id,to=(t,s)=>{const e=Wt(t)-Wt(s);if(e===0){if(t.pre&&!s.pre)return-1;if(s.pre&&!t.pre)return 1}return e};function Ds(t){zi=!1,Ut=!0,Le.sort(to);const s=Ve;try{for(Ye=0;Ye<Le.length;Ye++){const e=Le[Ye];e&&e.active!==!1&&ct(e,null,14)}}finally{Ye=0,Le.length=0,Ms(),Ut=!1,un=null,(Le.length||Mt.length)&&Ds()}}function io(t,s,...e){if(t.isUnmounted)return;const i=t.vnode.props||_e;let n=e;const r=s.startsWith("update:"),l=r&&s.slice(7);if(l&&l in i){const h=`${l==="modelValue"?"model":l}Modifiers`,{number:g,trim:m}=i[h]||_e;m&&(n=e.map(T=>Se(T)?T.trim():T)),g&&(n=e.map(Di))}let a,o=i[a=xi(s)]||i[a=xi(Je(s))];!o&&r&&(o=i[a=xi(xt(s))]),o&&Ge(o,t,6,n);const u=i[a+"Once"];if(u){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,Ge(u,t,6,n)}}function ks(t,s,e=!1){const i=s.emitsCache,n=i.get(t);if(n!==void 0)return n;const r=t.emits;let l={},a=!1;if(!pe(t)){const o=u=>{const h=ks(u,s,!0);h&&(a=!0,Me(l,h))};!e&&s.mixins.length&&s.mixins.forEach(o),t.extends&&o(t.extends),t.mixins&&t.mixins.forEach(o)}return!r&&!a?(xe(t)&&i.set(t,null),null):(ce(r)?r.forEach(o=>l[o]=null):Me(l,r),xe(t)&&i.set(t,l),l)}function mi(t,s){return!t||!ui(s)?!1:(s=s.slice(2).replace(/Once$/,""),me(t,s[0].toLowerCase()+s.slice(1))||me(t,xt(s))||me(t,s))}let Ie=null,Fs=null;function si(t){const s=Ie;return Ie=t,Fs=t&&t.type.__scopeId||null,s}function no(t,s=Ie,e){if(!s||t._n)return t;const i=(...n)=>{i._d&&Wn(-1);const r=si(s);let l;try{l=t(...n)}finally{si(r),i._d&&Wn(1)}return l};return i._n=!0,i._c=!0,i._d=!0,i}function Si(t){const{type:s,vnode:e,proxy:i,withProxy:n,props:r,propsOptions:[l],slots:a,attrs:o,emit:u,render:h,renderCache:g,data:m,setupState:T,ctx:x,inheritAttrs:S}=t;let P,D;const d=si(t);try{if(e.shapeFlag&4){const L=n||i,H=L;P=Xe(h.call(H,L,g,r,T,m,x)),D=o}else{const L=s;P=Xe(L.length>1?L(r,{attrs:o,slots:a,emit:u}):L(r,null)),D=s.props?o:so(o)}}catch(L){Vt.length=0,gi(L,t,1),P=ie(Tt)}let _=P;if(D&&S!==!1){const L=Object.keys(D),{shapeFlag:H}=_;L.length&&H&7&&(l&&L.some(Yi)&&(D=ro(D,l)),_=Dt(_,D))}return e.dirs&&(_=Dt(_),_.dirs=_.dirs?_.dirs.concat(e.dirs):e.dirs),e.transition&&(_.transition=e.transition),P=_,si(d),P}const so=t=>{let s;for(const e in t)(e==="class"||e==="style"||ui(e))&&((s||(s={}))[e]=t[e]);return s},ro=(t,s)=>{const e={};for(const i in t)(!Yi(i)||!(i.slice(9)in s))&&(e[i]=t[i]);return e};function oo(t,s,e){const{props:i,children:n,component:r}=t,{props:l,children:a,patchFlag:o}=s,u=r.emitsOptions;if(s.dirs||s.transition)return!0;if(e&&o>=0){if(o&1024)return!0;if(o&16)return i?Dn(i,l,u):!!l;if(o&8){const h=s.dynamicProps;for(let g=0;g<h.length;g++){const m=h[g];if(l[m]!==i[m]&&!mi(u,m))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:i===l?!1:i?l?Dn(i,l,u):!0:!!l;return!1}function Dn(t,s,e){const i=Object.keys(s);if(i.length!==Object.keys(t).length)return!0;for(let n=0;n<i.length;n++){const r=i[n];if(s[r]!==t[r]&&!mi(e,r))return!0}return!1}function ao({vnode:t,parent:s},e){for(;s;){const i=s.subTree;if(i.suspense&&i.suspense.activeBranch===t&&(i.el=t.el),i===t)(t=s.vnode).el=e,s=s.parent;else break}}const As="components",lo="directives";function Bs(t,s){return Is(As,t,!0,s)||t}const uo=Symbol.for("v-ndc");function hn(t){return Is(lo,t)}function Is(t,s,e=!0,i=!1){const n=Ie||Oe;if(n){const r=n.type;if(t===As){const a=sa(r,!1);if(a&&(a===s||a===Je(s)||a===di(Je(s))))return r}const l=kn(n[t]||r[t],s)||kn(n.appContext[t],s);return!l&&i?r:l}}function kn(t,s){return t&&(t[s]||t[Je(s)]||t[di(Je(s))])}const co=t=>t.__isSuspense;function ho(t,s){s&&s.pendingBranch?ce(t)?s.effects.push(...t):s.effects.push(t):eo(t)}const fo=Symbol.for("v-scx"),po=()=>ti(fo),Jt={};function Pi(t,s,e){return zs(t,s,e)}function zs(t,s,{immediate:e,deep:i,flush:n,once:r,onTrack:l,onTrigger:a}=_e){if(s&&r){const M=s;s=(...V)=>{M(...V),H()}}const o=Oe,u=M=>i===!0?M:mt(M,i===!1?1:void 0);let h,g=!1,m=!1;if(Ne(t)?(h=()=>t.value,g=Ii(t)):Ot(t)?(h=()=>u(t),g=!0):ce(t)?(m=!0,g=t.some(M=>Ot(M)||Ii(M)),h=()=>t.map(M=>{if(Ne(M))return M.value;if(Ot(M))return u(M);if(pe(M))return ct(M,o,2)})):pe(t)?s?h=()=>ct(t,o,2):h=()=>(T&&T(),Ge(t,o,3,[x])):h=Ve,s&&i){const M=h;h=()=>mt(M())}let T,x=M=>{T=_.onStop=()=>{ct(M,o,4),T=_.onStop=void 0}},S;if(_i)if(x=Ve,s?e&&Ge(s,o,3,[h(),m?[]:void 0,x]):h(),n==="sync"){const M=po();S=M.__watcherHandles||(M.__watcherHandles=[])}else return Ve;let P=m?new Array(t.length).fill(Jt):Jt;const D=()=>{if(!(!_.active||!_.dirty))if(s){const M=_.run();(i||g||(m?M.some((V,G)=>_t(V,P[G])):_t(M,P)))&&(T&&T(),Ge(s,o,3,[M,P===Jt?void 0:m&&P[0]===Jt?[]:P,x]),P=M)}else _.run()};D.allowRecurse=!!s;let d;n==="sync"?d=D:n==="post"?d=()=>Be(D,o&&o.suspense):(D.pre=!0,o&&(D.id=o.uid),d=()=>cn(D));const _=new en(h,Ve,d),L=Pr(),H=()=>{_.stop(),L&&Ji(L.effects,_)};return s?e?D():P=_.run():n==="post"?Be(_.run.bind(_),o&&o.suspense):_.run(),S&&S.push(H),H}function go(t,s,e){const i=this.proxy,n=Se(t)?t.includes(".")?Vs(i,t):()=>i[t]:t.bind(i,i);let r;pe(s)?r=s:(r=s.handler,e=s);const l=Gt(this),a=zs(n,r.bind(i),e);return l(),a}function Vs(t,s){const e=s.split(".");return()=>{let i=t;for(let n=0;n<e.length&&i;n++)i=i[e[n]];return i}}function mt(t,s,e=0,i){if(!xe(t)||t.__v_skip)return t;if(s&&s>0){if(e>=s)return t;e++}if(i=i||new Set,i.has(t))return t;if(i.add(t),Ne(t))mt(t.value,s,e,i);else if(ce(t))for(let n=0;n<t.length;n++)mt(t[n],s,e,i);else if(rs(t)||Lt(t))t.forEach(n=>{mt(n,s,e,i)});else if(ls(t))for(const n in t)mt(t[n],s,e,i);return t}function ke(t,s){if(Ie===null)return t;const e=Ti(Ie)||Ie.proxy,i=t.dirs||(t.dirs=[]);for(let n=0;n<s.length;n++){let[r,l,a,o=_e]=s[n];r&&(pe(r)&&(r={mounted:r,updated:r}),r.deep&&mt(l),i.push({dir:r,instance:e,value:l,oldValue:void 0,arg:a,modifiers:o}))}return t}function ft(t,s,e,i){const n=t.dirs,r=s&&s.dirs;for(let l=0;l<n.length;l++){const a=n[l];r&&(a.oldValue=r[l].value);let o=a.dir[i];o&&(bt(),Ge(o,e,8,[t.el,a,t,s]),Et())}}const ei=t=>!!t.type.__asyncLoader,Ns=t=>t.type.__isKeepAlive;function mo(t,s){Us(t,"a",s)}function vo(t,s){Us(t,"da",s)}function Us(t,s,e=Oe){const i=t.__wdc||(t.__wdc=()=>{let n=e;for(;n;){if(n.isDeactivated)return;n=n.parent}return t()});if(vi(s,i,e),e){let n=e.parent;for(;n&&n.parent;)Ns(n.parent.vnode)&&yo(i,s,e,n),n=n.parent}}function yo(t,s,e,i){const n=vi(s,t,i,!0);Ws(()=>{Ji(i[s],n)},e)}function vi(t,s,e=Oe,i=!1){if(e){const n=e[t]||(e[t]=[]),r=s.__weh||(s.__weh=(...l)=>{if(e.isUnmounted)return;bt();const a=Gt(e),o=Ge(s,e,t,l);return a(),Et(),o});return i?n.unshift(r):n.push(r),r}}const et=t=>(s,e=Oe)=>(!_i||t==="sp")&&vi(t,(...i)=>s(...i),e),wo=et("bm"),_o=et("m"),To=et("bu"),xo=et("u"),bo=et("bum"),Ws=et("um"),Eo=et("sp"),So=et("rtg"),Po=et("rtc");function Co(t,s=Oe){vi("ec",t,s)}function Ee(t,s,e,i){let n;const r=e&&e[i];if(ce(t)||Se(t)){n=new Array(t.length);for(let l=0,a=t.length;l<a;l++)n[l]=s(t[l],l,void 0,r&&r[l])}else if(typeof t=="number"){n=new Array(t);for(let l=0;l<t;l++)n[l]=s(l+1,l,void 0,r&&r[l])}else if(xe(t))if(t[Symbol.iterator])n=Array.from(t,(l,a)=>s(l,a,void 0,r&&r[a]));else{const l=Object.keys(t);n=new Array(l.length);for(let a=0,o=l.length;a<o;a++){const u=l[a];n[a]=s(t[u],u,a,r&&r[a])}}else n=[];return e&&(e[i]=n),n}const Vi=t=>t?tr(t)?Ti(t)||t.proxy:Vi(t.parent):null,zt=Me(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Vi(t.parent),$root:t=>Vi(t.root),$emit:t=>t.emit,$options:t=>dn(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,cn(t.update)}),$nextTick:t=>t.n||(t.n=Ls.bind(t.proxy)),$watch:t=>go.bind(t)}),Ci=(t,s)=>t!==_e&&!t.__isScriptSetup&&me(t,s),Ro={get({_:t},s){const{ctx:e,setupState:i,data:n,props:r,accessCache:l,type:a,appContext:o}=t;let u;if(s[0]!=="$"){const T=l[s];if(T!==void 0)switch(T){case 1:return i[s];case 2:return n[s];case 4:return e[s];case 3:return r[s]}else{if(Ci(i,s))return l[s]=1,i[s];if(n!==_e&&me(n,s))return l[s]=2,n[s];if((u=t.propsOptions[0])&&me(u,s))return l[s]=3,r[s];if(e!==_e&&me(e,s))return l[s]=4,e[s];Ni&&(l[s]=0)}}const h=zt[s];let g,m;if(h)return s==="$attrs"&&ze(t,"get",s),h(t);if((g=a.__cssModules)&&(g=g[s]))return g;if(e!==_e&&me(e,s))return l[s]=4,e[s];if(m=o.config.globalProperties,me(m,s))return m[s]},set({_:t},s,e){const{data:i,setupState:n,ctx:r}=t;return Ci(n,s)?(n[s]=e,!0):i!==_e&&me(i,s)?(i[s]=e,!0):me(t.props,s)||s[0]==="$"&&s.slice(1)in t?!1:(r[s]=e,!0)},has({_:{data:t,setupState:s,accessCache:e,ctx:i,appContext:n,propsOptions:r}},l){let a;return!!e[l]||t!==_e&&me(t,l)||Ci(s,l)||(a=r[0])&&me(a,l)||me(i,l)||me(zt,l)||me(n.config.globalProperties,l)},defineProperty(t,s,e){return e.get!=null?t._.accessCache[s]=0:me(e,"value")&&this.set(t,s,e.value,null),Reflect.defineProperty(t,s,e)}};function Fn(t){return ce(t)?t.reduce((s,e)=>(s[e]=null,s),{}):t}let Ni=!0;function Ho(t){const s=dn(t),e=t.proxy,i=t.ctx;Ni=!1,s.beforeCreate&&An(s.beforeCreate,t,"bc");const{data:n,computed:r,methods:l,watch:a,provide:o,inject:u,created:h,beforeMount:g,mounted:m,beforeUpdate:T,updated:x,activated:S,deactivated:P,beforeDestroy:D,beforeUnmount:d,destroyed:_,unmounted:L,render:H,renderTracked:M,renderTriggered:V,errorCaptured:G,serverPrefetch:Z,expose:$,inheritAttrs:se,components:J,directives:fe,filters:ue}=s;if(u&&Lo(u,i,null),l)for(const re in l){const ee=l[re];pe(ee)&&(i[re]=ee.bind(e))}if(n){const re=n.call(e,e);xe(re)&&(t.data=pi(re))}if(Ni=!0,r)for(const re in r){const ee=r[re],ye=pe(ee)?ee.bind(e,e):pe(ee.get)?ee.get.bind(e,e):Ve,Y=!pe(ee)&&pe(ee.set)?ee.set.bind(e):Ve,Pe=Ze({get:ye,set:Y});Object.defineProperty(i,re,{enumerable:!0,configurable:!0,get:()=>Pe.value,set:Fe=>Pe.value=Fe})}if(a)for(const re in a)js(a[re],i,e,re);if(o){const re=pe(o)?o.call(e):o;Reflect.ownKeys(re).forEach(ee=>{Ao(ee,re[ee])})}h&&An(h,t,"c");function le(re,ee){ce(ee)?ee.forEach(ye=>re(ye.bind(e))):ee&&re(ee.bind(e))}if(le(wo,g),le(_o,m),le(To,T),le(xo,x),le(mo,S),le(vo,P),le(Co,G),le(Po,M),le(So,V),le(bo,d),le(Ws,L),le(Eo,Z),ce($))if($.length){const re=t.exposed||(t.exposed={});$.forEach(ee=>{Object.defineProperty(re,ee,{get:()=>e[ee],set:ye=>e[ee]=ye})})}else t.exposed||(t.exposed={});H&&t.render===Ve&&(t.render=H),se!=null&&(t.inheritAttrs=se),J&&(t.components=J),fe&&(t.directives=fe)}function Lo(t,s,e=Ve){ce(t)&&(t=Ui(t));for(const i in t){const n=t[i];let r;xe(n)?"default"in n?r=ti(n.from||i,n.default,!0):r=ti(n.from||i):r=ti(n),Ne(r)?Object.defineProperty(s,i,{enumerable:!0,configurable:!0,get:()=>r.value,set:l=>r.value=l}):s[i]=r}}function An(t,s,e){Ge(ce(t)?t.map(i=>i.bind(s.proxy)):t.bind(s.proxy),s,e)}function js(t,s,e,i){const n=i.includes(".")?Vs(e,i):()=>e[i];if(Se(t)){const r=s[t];pe(r)&&Pi(n,r)}else if(pe(t))Pi(n,t.bind(e));else if(xe(t))if(ce(t))t.forEach(r=>js(r,s,e,i));else{const r=pe(t.handler)?t.handler.bind(e):s[t.handler];pe(r)&&Pi(n,r,t)}}function dn(t){const s=t.type,{mixins:e,extends:i}=s,{mixins:n,optionsCache:r,config:{optionMergeStrategies:l}}=t.appContext,a=r.get(s);let o;return a?o=a:!n.length&&!e&&!i?o=s:(o={},n.length&&n.forEach(u=>ri(o,u,l,!0)),ri(o,s,l)),xe(s)&&r.set(s,o),o}function ri(t,s,e,i=!1){const{mixins:n,extends:r}=s;r&&ri(t,r,e,!0),n&&n.forEach(l=>ri(t,l,e,!0));for(const l in s)if(!(i&&l==="expose")){const a=Oo[l]||e&&e[l];t[l]=a?a(t[l],s[l]):s[l]}return t}const Oo={data:Bn,props:In,emits:In,methods:Bt,computed:Bt,beforeCreate:De,created:De,beforeMount:De,mounted:De,beforeUpdate:De,updated:De,beforeDestroy:De,beforeUnmount:De,destroyed:De,unmounted:De,activated:De,deactivated:De,errorCaptured:De,serverPrefetch:De,components:Bt,directives:Bt,watch:Do,provide:Bn,inject:Mo};function Bn(t,s){return s?t?function(){return Me(pe(t)?t.call(this,this):t,pe(s)?s.call(this,this):s)}:s:t}function Mo(t,s){return Bt(Ui(t),Ui(s))}function Ui(t){if(ce(t)){const s={};for(let e=0;e<t.length;e++)s[t[e]]=t[e];return s}return t}function De(t,s){return t?[...new Set([].concat(t,s))]:s}function Bt(t,s){return t?Me(Object.create(null),t,s):s}function In(t,s){return t?ce(t)&&ce(s)?[...new Set([...t,...s])]:Me(Object.create(null),Fn(t),Fn(s??{})):s}function Do(t,s){if(!t)return s;if(!s)return t;const e=Me(Object.create(null),t);for(const i in s)e[i]=De(t[i],s[i]);return e}function Gs(){return{app:null,config:{isNativeTag:fr,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ko=0;function Fo(t,s){return function(i,n=null){pe(i)||(i=Me({},i)),n!=null&&!xe(n)&&(n=null);const r=Gs(),l=new WeakSet;let a=!1;const o=r.app={_uid:ko++,_component:i,_props:n,_container:null,_context:r,_instance:null,version:aa,get config(){return r.config},set config(u){},use(u,...h){return l.has(u)||(u&&pe(u.install)?(l.add(u),u.install(o,...h)):pe(u)&&(l.add(u),u(o,...h))),o},mixin(u){return r.mixins.includes(u)||r.mixins.push(u),o},component(u,h){return h?(r.components[u]=h,o):r.components[u]},directive(u,h){return h?(r.directives[u]=h,o):r.directives[u]},mount(u,h,g){if(!a){const m=ie(i,n);return m.appContext=r,g===!0?g="svg":g===!1&&(g=void 0),h&&s?s(m,u):t(m,u,g),a=!0,o._container=u,u.__vue_app__=o,Ti(m.component)||m.component.proxy}},unmount(){a&&(t(null,o._container),delete o._container.__vue_app__)},provide(u,h){return r.provides[u]=h,o},runWithContext(u){oi=o;try{return u()}finally{oi=null}}};return o}}let oi=null;function Ao(t,s){if(Oe){let e=Oe.provides;const i=Oe.parent&&Oe.parent.provides;i===e&&(e=Oe.provides=Object.create(i)),e[t]=s}}function ti(t,s,e=!1){const i=Oe||Ie;if(i||oi){const n=i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:oi._context.provides;if(n&&t in n)return n[t];if(arguments.length>1)return e&&pe(s)?s.call(i&&i.proxy):s}}function Bo(t,s,e,i=!1){const n={},r={};ni(r,wi,1),t.propsDefaults=Object.create(null),qs(t,s,n,r);for(const l in t.propsOptions[0])l in n||(n[l]=void 0);e?t.props=i?n:qr(n):t.type.props?t.props=n:t.props=r,t.attrs=r}function Io(t,s,e,i){const{props:n,attrs:r,vnode:{patchFlag:l}}=t,a=we(n),[o]=t.propsOptions;let u=!1;if((i||l>0)&&!(l&16)){if(l&8){const h=t.vnode.dynamicProps;for(let g=0;g<h.length;g++){let m=h[g];if(mi(t.emitsOptions,m))continue;const T=s[m];if(o)if(me(r,m))T!==r[m]&&(r[m]=T,u=!0);else{const x=Je(m);n[x]=Wi(o,a,x,T,t,!1)}else T!==r[m]&&(r[m]=T,u=!0)}}}else{qs(t,s,n,r)&&(u=!0);let h;for(const g in a)(!s||!me(s,g)&&((h=xt(g))===g||!me(s,h)))&&(o?e&&(e[g]!==void 0||e[h]!==void 0)&&(n[g]=Wi(o,a,g,void 0,t,!0)):delete n[g]);if(r!==a)for(const g in r)(!s||!me(s,g))&&(delete r[g],u=!0)}u&&$e(t,"set","$attrs")}function qs(t,s,e,i){const[n,r]=t.propsOptions;let l=!1,a;if(s)for(let o in s){if(Qt(o))continue;const u=s[o];let h;n&&me(n,h=Je(o))?!r||!r.includes(h)?e[h]=u:(a||(a={}))[h]=u:mi(t.emitsOptions,o)||(!(o in i)||u!==i[o])&&(i[o]=u,l=!0)}if(r){const o=we(e),u=a||_e;for(let h=0;h<r.length;h++){const g=r[h];e[g]=Wi(n,o,g,u[g],t,!me(u,g))}}return l}function Wi(t,s,e,i,n,r){const l=t[e];if(l!=null){const a=me(l,"default");if(a&&i===void 0){const o=l.default;if(l.type!==Function&&!l.skipFactory&&pe(o)){const{propsDefaults:u}=n;if(e in u)i=u[e];else{const h=Gt(n);i=u[e]=o.call(null,s),h()}}else i=o}l[0]&&(r&&!a?i=!1:l[1]&&(i===""||i===xt(e))&&(i=!0))}return i}function Zs(t,s,e=!1){const i=s.propsCache,n=i.get(t);if(n)return n;const r=t.props,l={},a=[];let o=!1;if(!pe(t)){const h=g=>{o=!0;const[m,T]=Zs(g,s,!0);Me(l,m),T&&a.push(...T)};!e&&s.mixins.length&&s.mixins.forEach(h),t.extends&&h(t.extends),t.mixins&&t.mixins.forEach(h)}if(!r&&!o)return xe(t)&&i.set(t,Ht),Ht;if(ce(r))for(let h=0;h<r.length;h++){const g=Je(r[h]);zn(g)&&(l[g]=_e)}else if(r)for(const h in r){const g=Je(h);if(zn(g)){const m=r[h],T=l[g]=ce(m)||pe(m)?{type:m}:Me({},m);if(T){const x=Un(Boolean,T.type),S=Un(String,T.type);T[0]=x>-1,T[1]=S<0||x<S,(x>-1||me(T,"default"))&&a.push(g)}}}const u=[l,a];return xe(t)&&i.set(t,u),u}function zn(t){return t[0]!=="$"}function Vn(t){const s=t&&t.toString().match(/^\s*(function|class) (\w+)/);return s?s[2]:t===null?"null":""}function Nn(t,s){return Vn(t)===Vn(s)}function Un(t,s){return ce(s)?s.findIndex(e=>Nn(e,t)):pe(s)&&Nn(s,t)?0:-1}const Ks=t=>t[0]==="_"||t==="$stable",fn=t=>ce(t)?t.map(Xe):[Xe(t)],zo=(t,s,e)=>{if(s._n)return s;const i=no((...n)=>fn(s(...n)),e);return i._c=!1,i},Xs=(t,s,e)=>{const i=t._ctx;for(const n in t){if(Ks(n))continue;const r=t[n];if(pe(r))s[n]=zo(n,r,i);else if(r!=null){const l=fn(r);s[n]=()=>l}}},Ys=(t,s)=>{const e=fn(s);t.slots.default=()=>e},Vo=(t,s)=>{if(t.vnode.shapeFlag&32){const e=s._;e?(t.slots=we(s),ni(s,"_",e)):Xs(s,t.slots={})}else t.slots={},s&&Ys(t,s);ni(t.slots,wi,1)},No=(t,s,e)=>{const{vnode:i,slots:n}=t;let r=!0,l=_e;if(i.shapeFlag&32){const a=s._;a?e&&a===1?r=!1:(Me(n,s),!e&&a===1&&delete n._):(r=!s.$stable,Xs(s,n)),l=s}else s&&(Ys(t,s),l={default:1});if(r)for(const a in n)!Ks(a)&&l[a]==null&&delete n[a]};function ji(t,s,e,i,n=!1){if(ce(t)){t.forEach((m,T)=>ji(m,s&&(ce(s)?s[T]:s),e,i,n));return}if(ei(i)&&!n)return;const r=i.shapeFlag&4?Ti(i.component)||i.component.proxy:i.el,l=n?null:r,{i:a,r:o}=t,u=s&&s.r,h=a.refs===_e?a.refs={}:a.refs,g=a.setupState;if(u!=null&&u!==o&&(Se(u)?(h[u]=null,me(g,u)&&(g[u]=null)):Ne(u)&&(u.value=null)),pe(o))ct(o,a,12,[l,h]);else{const m=Se(o),T=Ne(o),x=t.f;if(m||T){const S=()=>{if(x){const P=m?me(g,o)?g[o]:h[o]:o.value;n?ce(P)&&Ji(P,r):ce(P)?P.includes(r)||P.push(r):m?(h[o]=[r],me(g,o)&&(g[o]=h[o])):(o.value=[r],t.k&&(h[t.k]=o.value))}else m?(h[o]=l,me(g,o)&&(g[o]=l)):T&&(o.value=l,t.k&&(h[t.k]=l))};n||x?S():(S.id=-1,Be(S,e))}}}const Be=ho;function Uo(t){return Wo(t)}function Wo(t,s){const e=us();e.__VUE__=!0;const{insert:i,remove:n,patchProp:r,createElement:l,createText:a,createComment:o,setText:u,setElementText:h,parentNode:g,nextSibling:m,setScopeId:T=Ve,insertStaticContent:x}=t,S=(E,c,v,b=null,R=null,C=null,I=void 0,k=null,N=!!c.dynamicChildren)=>{if(E===c)return;E&&!Ft(E,c)&&(b=Qe(E),Fe(E,R,C,!0),E=null),c.patchFlag===-2&&(N=!1,c.dynamicChildren=null);const{type:z,ref:U,shapeFlag:j}=c;switch(z){case yi:P(E,c,v,b);break;case Tt:D(E,c,v,b);break;case Hi:E==null&&d(c,v,b,I);break;case de:J(E,c,v,b,R,C,I,k,N);break;default:j&1?H(E,c,v,b,R,C,I,k,N):j&6?fe(E,c,v,b,R,C,I,k,N):(j&64||j&128)&&z.process(E,c,v,b,R,C,I,k,N,Ue)}U!=null&&R&&ji(U,E&&E.ref,C,c||E,!c)},P=(E,c,v,b)=>{if(E==null)i(c.el=a(c.children),v,b);else{const R=c.el=E.el;c.children!==E.children&&u(R,c.children)}},D=(E,c,v,b)=>{E==null?i(c.el=o(c.children||""),v,b):c.el=E.el},d=(E,c,v,b)=>{[E.el,E.anchor]=x(E.children,c,v,b,E.el,E.anchor)},_=({el:E,anchor:c},v,b)=>{let R;for(;E&&E!==c;)R=m(E),i(E,v,b),E=R;i(c,v,b)},L=({el:E,anchor:c})=>{let v;for(;E&&E!==c;)v=m(E),n(E),E=v;n(c)},H=(E,c,v,b,R,C,I,k,N)=>{c.type==="svg"?I="svg":c.type==="math"&&(I="mathml"),E==null?M(c,v,b,R,C,I,k,N):Z(E,c,R,C,I,k,N)},M=(E,c,v,b,R,C,I,k)=>{let N,z;const{props:U,shapeFlag:j,transition:X,dirs:K}=E;if(N=E.el=l(E.type,C,U&&U.is,U),j&8?h(N,E.children):j&16&&G(E.children,N,null,b,R,Ri(E,C),I,k),K&&ft(E,null,b,"created"),V(N,E,E.scopeId,I,b),U){for(const ge in U)ge!=="value"&&!Qt(ge)&&r(N,ge,null,U[ge],C,E.children,b,R,Ae);"value"in U&&r(N,"value",null,U.value,C),(z=U.onVnodeBeforeMount)&&qe(z,b,E)}K&&ft(E,null,b,"beforeMount");const te=jo(R,X);te&&X.beforeEnter(N),i(N,c,v),((z=U&&U.onVnodeMounted)||te||K)&&Be(()=>{z&&qe(z,b,E),te&&X.enter(N),K&&ft(E,null,b,"mounted")},R)},V=(E,c,v,b,R)=>{if(v&&T(E,v),b)for(let C=0;C<b.length;C++)T(E,b[C]);if(R){let C=R.subTree;if(c===C){const I=R.vnode;V(E,I,I.scopeId,I.slotScopeIds,R.parent)}}},G=(E,c,v,b,R,C,I,k,N=0)=>{for(let z=N;z<E.length;z++){const U=E[z]=k?ot(E[z]):Xe(E[z]);S(null,U,c,v,b,R,C,I,k)}},Z=(E,c,v,b,R,C,I)=>{const k=c.el=E.el;let{patchFlag:N,dynamicChildren:z,dirs:U}=c;N|=E.patchFlag&16;const j=E.props||_e,X=c.props||_e;let K;if(v&&pt(v,!1),(K=X.onVnodeBeforeUpdate)&&qe(K,v,c,E),U&&ft(c,E,v,"beforeUpdate"),v&&pt(v,!0),z?$(E.dynamicChildren,z,k,v,b,Ri(c,R),C):I||ee(E,c,k,null,v,b,Ri(c,R),C,!1),N>0){if(N&16)se(k,c,j,X,v,b,R);else if(N&2&&j.class!==X.class&&r(k,"class",null,X.class,R),N&4&&r(k,"style",j.style,X.style,R),N&8){const te=c.dynamicProps;for(let ge=0;ge<te.length;ge++){const p=te[ge],f=j[p],y=X[p];(y!==f||p==="value")&&r(k,p,f,y,R,E.children,v,b,Ae)}}N&1&&E.children!==c.children&&h(k,c.children)}else!I&&z==null&&se(k,c,j,X,v,b,R);((K=X.onVnodeUpdated)||U)&&Be(()=>{K&&qe(K,v,c,E),U&&ft(c,E,v,"updated")},b)},$=(E,c,v,b,R,C,I)=>{for(let k=0;k<c.length;k++){const N=E[k],z=c[k],U=N.el&&(N.type===de||!Ft(N,z)||N.shapeFlag&70)?g(N.el):v;S(N,z,U,null,b,R,C,I,!0)}},se=(E,c,v,b,R,C,I)=>{if(v!==b){if(v!==_e)for(const k in v)!Qt(k)&&!(k in b)&&r(E,k,v[k],null,I,c.children,R,C,Ae);for(const k in b){if(Qt(k))continue;const N=b[k],z=v[k];N!==z&&k!=="value"&&r(E,k,z,N,I,c.children,R,C,Ae)}"value"in b&&r(E,"value",v.value,b.value,I)}},J=(E,c,v,b,R,C,I,k,N)=>{const z=c.el=E?E.el:a(""),U=c.anchor=E?E.anchor:a("");let{patchFlag:j,dynamicChildren:X,slotScopeIds:K}=c;K&&(k=k?k.concat(K):K),E==null?(i(z,v,b),i(U,v,b),G(c.children||[],v,U,R,C,I,k,N)):j>0&&j&64&&X&&E.dynamicChildren?($(E.dynamicChildren,X,v,R,C,I,k),(c.key!=null||R&&c===R.subTree)&&Js(E,c,!0)):ee(E,c,v,U,R,C,I,k,N)},fe=(E,c,v,b,R,C,I,k,N)=>{c.slotScopeIds=k,E==null?c.shapeFlag&512?R.ctx.activate(c,v,b,I,N):ue(c,v,b,R,C,I,N):ve(E,c,N)},ue=(E,c,v,b,R,C,I)=>{const k=E.component=$o(E,b,R);if(Ns(E)&&(k.ctx.renderer=Ue),ea(k),k.asyncDep){if(R&&R.registerDep(k,le),!E.el){const N=k.subTree=ie(Tt);D(null,N,c,v)}}else le(k,E,c,v,R,C,I)},ve=(E,c,v)=>{const b=c.component=E.component;if(oo(E,c,v))if(b.asyncDep&&!b.asyncResolved){re(b,c,v);return}else b.next=c,$r(b.update),b.effect.dirty=!0,b.update();else c.el=E.el,b.vnode=c},le=(E,c,v,b,R,C,I)=>{const k=()=>{if(E.isMounted){let{next:U,bu:j,u:X,parent:K,vnode:te}=E;{const w=Qs(E);if(w){U&&(U.el=te.el,re(E,U,I)),w.asyncDep.then(()=>{E.isUnmounted||k()});return}}let ge=U,p;pt(E,!1),U?(U.el=te.el,re(E,U,I)):U=te,j&&$t(j),(p=U.props&&U.props.onVnodeBeforeUpdate)&&qe(p,K,U,te),pt(E,!0);const f=Si(E),y=E.subTree;E.subTree=f,S(y,f,g(y.el),Qe(y),E,R,C),U.el=f.el,ge===null&&ao(E,f.el),X&&Be(X,R),(p=U.props&&U.props.onVnodeUpdated)&&Be(()=>qe(p,K,U,te),R)}else{let U;const{el:j,props:X}=c,{bm:K,m:te,parent:ge}=E,p=ei(c);if(pt(E,!1),K&&$t(K),!p&&(U=X&&X.onVnodeBeforeMount)&&qe(U,ge,c),pt(E,!0),j&&dt){const f=()=>{E.subTree=Si(E),dt(j,E.subTree,E,R,null)};p?c.type.__asyncLoader().then(()=>!E.isUnmounted&&f()):f()}else{const f=E.subTree=Si(E);S(null,f,v,b,E,R,C),c.el=f.el}if(te&&Be(te,R),!p&&(U=X&&X.onVnodeMounted)){const f=c;Be(()=>qe(U,ge,f),R)}(c.shapeFlag&256||ge&&ei(ge.vnode)&&ge.vnode.shapeFlag&256)&&E.a&&Be(E.a,R),E.isMounted=!0,c=v=b=null}},N=E.effect=new en(k,Ve,()=>cn(z),E.scope),z=E.update=()=>{N.dirty&&N.run()};z.id=E.uid,pt(E,!0),z()},re=(E,c,v)=>{c.component=E;const b=E.vnode.props;E.vnode=c,E.next=null,Io(E,c.props,b,v),No(E,c.children,v),bt(),Mn(E),Et()},ee=(E,c,v,b,R,C,I,k,N=!1)=>{const z=E&&E.children,U=E?E.shapeFlag:0,j=c.children,{patchFlag:X,shapeFlag:K}=c;if(X>0){if(X&128){Y(z,j,v,b,R,C,I,k,N);return}else if(X&256){ye(z,j,v,b,R,C,I,k,N);return}}K&8?(U&16&&Ae(z,R,C),j!==z&&h(v,j)):U&16?K&16?Y(z,j,v,b,R,C,I,k,N):Ae(z,R,C,!0):(U&8&&h(v,""),K&16&&G(j,v,b,R,C,I,k,N))},ye=(E,c,v,b,R,C,I,k,N)=>{E=E||Ht,c=c||Ht;const z=E.length,U=c.length,j=Math.min(z,U);let X;for(X=0;X<j;X++){const K=c[X]=N?ot(c[X]):Xe(c[X]);S(E[X],K,v,null,R,C,I,k,N)}z>U?Ae(E,R,C,!0,!1,j):G(c,v,b,R,C,I,k,N,j)},Y=(E,c,v,b,R,C,I,k,N)=>{let z=0;const U=c.length;let j=E.length-1,X=U-1;for(;z<=j&&z<=X;){const K=E[z],te=c[z]=N?ot(c[z]):Xe(c[z]);if(Ft(K,te))S(K,te,v,null,R,C,I,k,N);else break;z++}for(;z<=j&&z<=X;){const K=E[j],te=c[X]=N?ot(c[X]):Xe(c[X]);if(Ft(K,te))S(K,te,v,null,R,C,I,k,N);else break;j--,X--}if(z>j){if(z<=X){const K=X+1,te=K<U?c[K].el:b;for(;z<=X;)S(null,c[z]=N?ot(c[z]):Xe(c[z]),v,te,R,C,I,k,N),z++}}else if(z>X)for(;z<=j;)Fe(E[z],R,C,!0),z++;else{const K=z,te=z,ge=new Map;for(z=te;z<=X;z++){const he=c[z]=N?ot(c[z]):Xe(c[z]);he.key!=null&&ge.set(he.key,z)}let p,f=0;const y=X-te+1;let w=!1,B=0;const W=new Array(y);for(z=0;z<y;z++)W[z]=0;for(z=K;z<=j;z++){const he=E[z];if(f>=y){Fe(he,R,C,!0);continue}let Q;if(he.key!=null)Q=ge.get(he.key);else for(p=te;p<=X;p++)if(W[p-te]===0&&Ft(he,c[p])){Q=p;break}Q===void 0?Fe(he,R,C,!0):(W[Q-te]=z+1,Q>=B?B=Q:w=!0,S(he,c[Q],v,null,R,C,I,k,N),f++)}const ne=w?Go(W):Ht;for(p=ne.length-1,z=y-1;z>=0;z--){const he=te+z,Q=c[he],He=he+1<U?c[he+1].el:b;W[z]===0?S(null,Q,v,He,R,C,I,k,N):w&&(p<0||z!==ne[p]?Pe(Q,v,He,2):p--)}}},Pe=(E,c,v,b,R=null)=>{const{el:C,type:I,transition:k,children:N,shapeFlag:z}=E;if(z&6){Pe(E.component.subTree,c,v,b);return}if(z&128){E.suspense.move(c,v,b);return}if(z&64){I.move(E,c,v,Ue);return}if(I===de){i(C,c,v);for(let j=0;j<N.length;j++)Pe(N[j],c,v,b);i(E.anchor,c,v);return}if(I===Hi){_(E,c,v);return}if(b!==2&&z&1&&k)if(b===0)k.beforeEnter(C),i(C,c,v),Be(()=>k.enter(C),R);else{const{leave:j,delayLeave:X,afterLeave:K}=k,te=()=>i(C,c,v),ge=()=>{j(C,()=>{te(),K&&K()})};X?X(C,te,ge):ge()}else i(C,c,v)},Fe=(E,c,v,b=!1,R=!1)=>{const{type:C,props:I,ref:k,children:N,dynamicChildren:z,shapeFlag:U,patchFlag:j,dirs:X}=E;if(k!=null&&ji(k,null,v,E,!0),U&256){c.ctx.deactivate(E);return}const K=U&1&&X,te=!ei(E);let ge;if(te&&(ge=I&&I.onVnodeBeforeUnmount)&&qe(ge,c,E),U&6)St(E.component,v,b);else{if(U&128){E.suspense.unmount(v,b);return}K&&ft(E,null,c,"beforeUnmount"),U&64?E.type.remove(E,c,v,R,Ue,b):z&&(C!==de||j>0&&j&64)?Ae(z,c,v,!1,!0):(C===de&&j&384||!R&&U&16)&&Ae(N,c,v),b&&ht(E)}(te&&(ge=I&&I.onVnodeUnmounted)||K)&&Be(()=>{ge&&qe(ge,c,E),K&&ft(E,null,c,"unmounted")},v)},ht=E=>{const{type:c,el:v,anchor:b,transition:R}=E;if(c===de){tt(v,b);return}if(c===Hi){L(E);return}const C=()=>{n(v),R&&!R.persisted&&R.afterLeave&&R.afterLeave()};if(E.shapeFlag&1&&R&&!R.persisted){const{leave:I,delayLeave:k}=R,N=()=>I(v,C);k?k(E.el,C,N):N()}else C()},tt=(E,c)=>{let v;for(;E!==c;)v=m(E),n(E),E=v;n(c)},St=(E,c,v)=>{const{bum:b,scope:R,update:C,subTree:I,um:k}=E;b&&$t(b),R.stop(),C&&(C.active=!1,Fe(I,E,c,v)),k&&Be(k,c),Be(()=>{E.isUnmounted=!0},c),c&&c.pendingBranch&&!c.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===c.pendingId&&(c.deps--,c.deps===0&&c.resolve())},Ae=(E,c,v,b=!1,R=!1,C=0)=>{for(let I=C;I<E.length;I++)Fe(E[I],c,v,b,R)},Qe=E=>E.shapeFlag&6?Qe(E.component.subTree):E.shapeFlag&128?E.suspense.next():m(E.anchor||E.el);let it=!1;const Pt=(E,c,v)=>{E==null?c._vnode&&Fe(c._vnode,null,null,!0):S(c._vnode||null,E,c,null,null,null,v),it||(it=!0,Mn(),Ms(),it=!1),c._vnode=E},Ue={p:S,um:Fe,m:Pe,r:ht,mt:ue,mc:G,pc:ee,pbc:$,n:Qe,o:t};let nt,dt;return s&&([nt,dt]=s(Ue)),{render:Pt,hydrate:nt,createApp:Fo(Pt,nt)}}function Ri({type:t,props:s},e){return e==="svg"&&t==="foreignObject"||e==="mathml"&&t==="annotation-xml"&&s&&s.encoding&&s.encoding.includes("html")?void 0:e}function pt({effect:t,update:s},e){t.allowRecurse=s.allowRecurse=e}function jo(t,s){return(!t||t&&!t.pendingBranch)&&s&&!s.persisted}function Js(t,s,e=!1){const i=t.children,n=s.children;if(ce(i)&&ce(n))for(let r=0;r<i.length;r++){const l=i[r];let a=n[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[r]=ot(n[r]),a.el=l.el),e||Js(l,a)),a.type===yi&&(a.el=l.el)}}function Go(t){const s=t.slice(),e=[0];let i,n,r,l,a;const o=t.length;for(i=0;i<o;i++){const u=t[i];if(u!==0){if(n=e[e.length-1],t[n]<u){s[i]=n,e.push(i);continue}for(r=0,l=e.length-1;r<l;)a=r+l>>1,t[e[a]]<u?r=a+1:l=a;u<t[e[r]]&&(r>0&&(s[i]=e[r-1]),e[r]=i)}}for(r=e.length,l=e[r-1];r-- >0;)e[r]=l,l=s[l];return e}function Qs(t){const s=t.subTree.component;if(s)return s.asyncDep&&!s.asyncResolved?s:Qs(s)}const qo=t=>t.__isTeleport,de=Symbol.for("v-fgt"),yi=Symbol.for("v-txt"),Tt=Symbol.for("v-cmt"),Hi=Symbol.for("v-stc"),Vt=[];let je=null;function O(t=!1){Vt.push(je=t?null:[])}function Zo(){Vt.pop(),je=Vt[Vt.length-1]||null}let jt=1;function Wn(t){jt+=t}function $s(t){return t.dynamicChildren=jt>0?je||Ht:null,Zo(),jt>0&&je&&je.push(t),t}function F(t,s,e,i,n,r){return $s(A(t,s,e,i,n,r,!0))}function Re(t,s,e,i,n){return $s(ie(t,s,e,i,n,!0))}function Gi(t){return t?t.__v_isVNode===!0:!1}function Ft(t,s){return t.type===s.type&&t.key===s.key}const wi="__vInternal",er=({key:t})=>t??null,ii=({ref:t,ref_key:s,ref_for:e})=>(typeof t=="number"&&(t=""+t),t!=null?Se(t)||Ne(t)||pe(t)?{i:Ie,r:t,k:s,f:!!e}:t:null);function A(t,s=null,e=null,i=0,n=null,r=t===de?0:1,l=!1,a=!1){const o={__v_isVNode:!0,__v_skip:!0,type:t,props:s,key:s&&er(s),ref:s&&ii(s),scopeId:Fs,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Ie};return a?(pn(o,e),r&128&&t.normalize(o)):e&&(o.shapeFlag|=Se(e)?8:16),jt>0&&!l&&je&&(o.patchFlag>0||r&6)&&o.patchFlag!==32&&je.push(o),o}const ie=Ko;function Ko(t,s=null,e=null,i=0,n=null,r=!1){if((!t||t===uo)&&(t=Tt),Gi(t)){const a=Dt(t,s,!0);return e&&pn(a,e),jt>0&&!r&&je&&(a.shapeFlag&6?je[je.indexOf(t)]=a:je.push(a)),a.patchFlag|=-2,a}if(ra(t)&&(t=t.__vccOpts),s){s=Xo(s);let{class:a,style:o}=s;a&&!Se(a)&&(s.class=Te(a)),xe(o)&&(Ss(o)&&!ce(o)&&(o=Me({},o)),s.style=$i(o))}const l=Se(t)?1:co(t)?128:qo(t)?64:xe(t)?4:pe(t)?2:0;return A(t,s,e,i,n,l,r,!0)}function Xo(t){return t?Ss(t)||wi in t?Me({},t):t:null}function Dt(t,s,e=!1){const{props:i,ref:n,patchFlag:r,children:l}=t,a=s?Yo(i||{},s):i;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&er(a),ref:s&&s.ref?e&&n?ce(n)?n.concat(ii(s)):[n,ii(s)]:ii(s):n,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:l,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:s&&t.type!==de?r===-1?16:r|16:r,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Dt(t.ssContent),ssFallback:t.ssFallback&&Dt(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function be(t=" ",s=0){return ie(yi,null,t,s)}function oe(t="",s=!1){return s?(O(),Re(Tt,null,t)):ie(Tt,null,t)}function Xe(t){return t==null||typeof t=="boolean"?ie(Tt):ce(t)?ie(de,null,t.slice()):typeof t=="object"?ot(t):ie(yi,null,String(t))}function ot(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Dt(t)}function pn(t,s){let e=0;const{shapeFlag:i}=t;if(s==null)s=null;else if(ce(s))e=16;else if(typeof s=="object")if(i&65){const n=s.default;n&&(n._c&&(n._d=!1),pn(t,n()),n._c&&(n._d=!0));return}else{e=32;const n=s._;!n&&!(wi in s)?s._ctx=Ie:n===3&&Ie&&(Ie.slots._===1?s._=1:(s._=2,t.patchFlag|=1024))}else pe(s)?(s={default:s,_ctx:Ie},e=32):(s=String(s),i&64?(e=16,s=[be(s)]):e=8);t.children=s,t.shapeFlag|=e}function Yo(...t){const s={};for(let e=0;e<t.length;e++){const i=t[e];for(const n in i)if(n==="class")s.class!==i.class&&(s.class=Te([s.class,i.class]));else if(n==="style")s.style=$i([s.style,i.style]);else if(ui(n)){const r=s[n],l=i[n];l&&r!==l&&!(ce(r)&&r.includes(l))&&(s[n]=r?[].concat(r,l):l)}else n!==""&&(s[n]=i[n])}return s}function qe(t,s,e,i=null){Ge(t,s,7,[e,i])}const Jo=Gs();let Qo=0;function $o(t,s,e){const i=t.type,n=(s?s.appContext:t.appContext)||Jo,r={uid:Qo++,vnode:t,type:i,parent:s,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,scope:new Er(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(n.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Zs(i,n),emitsOptions:ks(i,n),emit:null,emitted:null,propsDefaults:_e,inheritAttrs:i.inheritAttrs,ctx:_e,data:_e,props:_e,attrs:_e,slots:_e,refs:_e,setupState:_e,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=s?s.root:r,r.emit=io.bind(null,r),t.ce&&t.ce(r),r}let Oe=null,ai,qi;{const t=us(),s=(e,i)=>{let n;return(n=t[e])||(n=t[e]=[]),n.push(i),r=>{n.length>1?n.forEach(l=>l(r)):n[0](r)}};ai=s("__VUE_INSTANCE_SETTERS__",e=>Oe=e),qi=s("__VUE_SSR_SETTERS__",e=>_i=e)}const Gt=t=>{const s=Oe;return ai(t),t.scope.on(),()=>{t.scope.off(),ai(s)}},jn=()=>{Oe&&Oe.scope.off(),ai(null)};function tr(t){return t.vnode.shapeFlag&4}let _i=!1;function ea(t,s=!1){s&&qi(s);const{props:e,children:i}=t.vnode,n=tr(t);Bo(t,e,n,s),Vo(t,i);const r=n?ta(t,s):void 0;return s&&qi(!1),r}function ta(t,s){const e=t.type;t.accessCache=Object.create(null),t.proxy=Ps(new Proxy(t.ctx,Ro));const{setup:i}=e;if(i){const n=t.setupContext=i.length>1?na(t):null,r=Gt(t);bt();const l=ct(i,t,0,[t.props,n]);if(Et(),r(),os(l)){if(l.then(jn,jn),s)return l.then(a=>{Gn(t,a,s)}).catch(a=>{gi(a,t,0)});t.asyncDep=l}else Gn(t,l,s)}else ir(t,s)}function Gn(t,s,e){pe(s)?t.type.__ssrInlineRender?t.ssrRender=s:t.render=s:xe(s)&&(t.setupState=Rs(s)),ir(t,e)}let qn;function ir(t,s,e){const i=t.type;if(!t.render){if(!s&&qn&&!i.render){const n=i.template||dn(t).template;if(n){const{isCustomElement:r,compilerOptions:l}=t.appContext.config,{delimiters:a,compilerOptions:o}=i,u=Me(Me({isCustomElement:r,delimiters:a},l),o);i.render=qn(n,u)}}t.render=i.render||Ve}{const n=Gt(t);bt();try{Ho(t)}finally{Et(),n()}}}function ia(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(s,e){return ze(t,"get","$attrs"),s[e]}}))}function na(t){const s=e=>{t.exposed=e||{}};return{get attrs(){return ia(t)},slots:t.slots,emit:t.emit,expose:s}}function Ti(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(Rs(Ps(t.exposed)),{get(s,e){if(e in s)return s[e];if(e in zt)return zt[e](t)},has(s,e){return e in s||e in zt}}))}function sa(t,s=!0){return pe(t)?t.displayName||t.name:t.name||s&&t.__name}function ra(t){return pe(t)&&"__vccOpts"in t}const Ze=(t,s)=>Zr(t,s,_i);function oa(t,s,e){const i=arguments.length;return i===2?xe(s)&&!ce(s)?Gi(s)?ie(t,null,[s]):ie(t,s):ie(t,null,s):(i>3?e=Array.prototype.slice.call(arguments,2):i===3&&Gi(e)&&(e=[e]),ie(t,s,e))}const aa="3.4.15";/**
* @vue/runtime-dom v3.4.15
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const la="http://www.w3.org/2000/svg",ua="http://www.w3.org/1998/Math/MathML",at=typeof document<"u"?document:null,Zn=at&&at.createElement("template"),ca={insert:(t,s,e)=>{s.insertBefore(t,e||null)},remove:t=>{const s=t.parentNode;s&&s.removeChild(t)},createElement:(t,s,e,i)=>{const n=s==="svg"?at.createElementNS(la,t):s==="mathml"?at.createElementNS(ua,t):at.createElement(t,e?{is:e}:void 0);return t==="select"&&i&&i.multiple!=null&&n.setAttribute("multiple",i.multiple),n},createText:t=>at.createTextNode(t),createComment:t=>at.createComment(t),setText:(t,s)=>{t.nodeValue=s},setElementText:(t,s)=>{t.textContent=s},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>at.querySelector(t),setScopeId(t,s){t.setAttribute(s,"")},insertStaticContent(t,s,e,i,n,r){const l=e?e.previousSibling:s.lastChild;if(n&&(n===r||n.nextSibling))for(;s.insertBefore(n.cloneNode(!0),e),!(n===r||!(n=n.nextSibling)););else{Zn.innerHTML=i==="svg"?`<svg>${t}</svg>`:i==="mathml"?`<math>${t}</math>`:t;const a=Zn.content;if(i==="svg"||i==="mathml"){const o=a.firstChild;for(;o.firstChild;)a.appendChild(o.firstChild);a.removeChild(o)}s.insertBefore(a,e)}return[l?l.nextSibling:s.firstChild,e?e.previousSibling:s.lastChild]}},ha=Symbol("_vtc");function da(t,s,e){const i=t[ha];i&&(s=(s?[s,...i]:[...i]).join(" ")),s==null?t.removeAttribute("class"):e?t.setAttribute("class",s):t.className=s}const gn=Symbol("_vod"),Ke={beforeMount(t,{value:s},{transition:e}){t[gn]=t.style.display==="none"?"":t.style.display,e&&s?e.beforeEnter(t):At(t,s)},mounted(t,{value:s},{transition:e}){e&&s&&e.enter(t)},updated(t,{value:s,oldValue:e},{transition:i}){!s!=!e&&(i?s?(i.beforeEnter(t),At(t,!0),i.enter(t)):i.leave(t,()=>{At(t,!1)}):At(t,s))},beforeUnmount(t,{value:s}){At(t,s)}};function At(t,s){t.style.display=s?t[gn]:"none"}const fa=Symbol("");function pa(t,s,e){const i=t.style,n=i.display,r=Se(e);if(e&&!r){if(s&&!Se(s))for(const l in s)e[l]==null&&Zi(i,l,"");for(const l in e)Zi(i,l,e[l])}else if(r){if(s!==e){const l=i[fa];l&&(e+=";"+l),i.cssText=e}}else s&&t.removeAttribute("style");gn in t&&(i.display=n)}const Kn=/\s*!important$/;function Zi(t,s,e){if(ce(e))e.forEach(i=>Zi(t,s,i));else if(e==null&&(e=""),s.startsWith("--"))t.setProperty(s,e);else{const i=ga(t,s);Kn.test(e)?t.setProperty(xt(i),e.replace(Kn,""),"important"):t[i]=e}}const Xn=["Webkit","Moz","ms"],Li={};function ga(t,s){const e=Li[s];if(e)return e;let i=Je(s);if(i!=="filter"&&i in t)return Li[s]=i;i=di(i);for(let n=0;n<Xn.length;n++){const r=Xn[n]+i;if(r in t)return Li[s]=r}return s}const Yn="http://www.w3.org/1999/xlink";function ma(t,s,e,i,n){if(i&&s.startsWith("xlink:"))e==null?t.removeAttributeNS(Yn,s.slice(6,s.length)):t.setAttributeNS(Yn,s,e);else{const r=br(s);e==null||r&&!cs(e)?t.removeAttribute(s):t.setAttribute(s,r?"":e)}}function va(t,s,e,i,n,r,l){if(s==="innerHTML"||s==="textContent"){i&&l(i,n,r),t[s]=e??"";return}const a=t.tagName;if(s==="value"&&a!=="PROGRESS"&&!a.includes("-")){t._value=e;const u=a==="OPTION"?t.getAttribute("value"):t.value,h=e??"";u!==h&&(t.value=h),e==null&&t.removeAttribute(s);return}let o=!1;if(e===""||e==null){const u=typeof t[s];u==="boolean"?e=cs(e):e==null&&u==="string"?(e="",o=!0):u==="number"&&(e=0,o=!0)}try{t[s]=e}catch{}o&&t.removeAttribute(s)}function Rt(t,s,e,i){t.addEventListener(s,e,i)}function ya(t,s,e,i){t.removeEventListener(s,e,i)}const Jn=Symbol("_vei");function wa(t,s,e,i,n=null){const r=t[Jn]||(t[Jn]={}),l=r[s];if(i&&l)l.value=i;else{const[a,o]=_a(s);if(i){const u=r[s]=ba(i,n);Rt(t,a,u,o)}else l&&(ya(t,a,l,o),r[s]=void 0)}}const Qn=/(?:Once|Passive|Capture)$/;function _a(t){let s;if(Qn.test(t)){s={};let i;for(;i=t.match(Qn);)t=t.slice(0,t.length-i[0].length),s[i[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):xt(t.slice(2)),s]}let Oi=0;const Ta=Promise.resolve(),xa=()=>Oi||(Ta.then(()=>Oi=0),Oi=Date.now());function ba(t,s){const e=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=e.attached)return;Ge(Ea(i,e.value),s,5,[i])};return e.value=t,e.attached=xa(),e}function Ea(t,s){if(ce(s)){const e=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{e.call(t),t._stopped=!0},s.map(i=>n=>!n._stopped&&i&&i(n))}else return s}const $n=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Sa=(t,s,e,i,n,r,l,a,o)=>{const u=n==="svg";s==="class"?da(t,i,u):s==="style"?pa(t,e,i):ui(s)?Yi(s)||wa(t,s,e,i,l):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):Pa(t,s,i,u))?va(t,s,i,r,l,a,o):(s==="true-value"?t._trueValue=i:s==="false-value"&&(t._falseValue=i),ma(t,s,i,u))};function Pa(t,s,e,i){if(i)return!!(s==="innerHTML"||s==="textContent"||s in t&&$n(s)&&pe(e));if(s==="spellcheck"||s==="draggable"||s==="translate"||s==="form"||s==="list"&&t.tagName==="INPUT"||s==="type"&&t.tagName==="TEXTAREA")return!1;if(s==="width"||s==="height"){const n=t.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return $n(s)&&Se(e)?!1:s in t}const es=t=>{const s=t.props["onUpdate:modelValue"]||!1;return ce(s)?e=>$t(s,e):s};function Ca(t){t.target.composing=!0}function ts(t){const s=t.target;s.composing&&(s.composing=!1,s.dispatchEvent(new Event("input")))}const Mi=Symbol("_assign"),nr={created(t,{modifiers:{lazy:s,trim:e,number:i}},n){t[Mi]=es(n);const r=i||n.props&&n.props.type==="number";Rt(t,s?"change":"input",l=>{if(l.target.composing)return;let a=t.value;e&&(a=a.trim()),r&&(a=Di(a)),t[Mi](a)}),e&&Rt(t,"change",()=>{t.value=t.value.trim()}),s||(Rt(t,"compositionstart",Ca),Rt(t,"compositionend",ts),Rt(t,"change",ts))},mounted(t,{value:s}){t.value=s??""},beforeUpdate(t,{value:s,modifiers:{lazy:e,trim:i,number:n}},r){if(t[Mi]=es(r),t.composing)return;const l=n||t.type==="number"?Di(t.value):t.value,a=s??"";l!==a&&(document.activeElement===t&&t.type!=="range"&&(e||i&&t.value.trim()===a)||(t.value=a))}},Ra=["ctrl","shift","alt","meta"],Ha={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,s)=>Ra.some(e=>t[`${e}Key`]&&!s.includes(e))},vt=(t,s)=>{const e=t._withMods||(t._withMods={}),i=s.join(".");return e[i]||(e[i]=(n,...r)=>{for(let l=0;l<s.length;l++){const a=Ha[s[l]];if(a&&a(n,s))return}return t(n,...r)})},La={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},It=(t,s)=>{const e=t._withKeys||(t._withKeys={}),i=s.join(".");return e[i]||(e[i]=n=>{if(!("key"in n))return;const r=xt(n.key);if(s.some(l=>l===r||La[l]===r))return t(n)})},Oa=Me({patchProp:Sa},ca);let is;function Ma(){return is||(is=Uo(Oa))}const Da=(...t)=>{const s=Ma().createApp(...t),{mount:e}=s;return s.mount=i=>{const n=Fa(i);if(!n)return;const r=s._component;!pe(r)&&!r.render&&!r.template&&(r.template=n.innerHTML),n.innerHTML="";const l=e(n,!1,ka(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),l},s};function ka(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function Fa(t){return Se(t)?document.querySelector(t):t}const ae=(t,s)=>{const e=t.__vccOpts||t;for(const[i,n]of s)e[i]=n;return e},Aa={},Ba={class:"tify-icon",viewBox:"0 0 24 24"},Ia=A("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},null,-1),za=[Ia];function Va(t,s){return O(),F("svg",Ba,za)}const sr=ae(Aa,[["render",Va]]),Na={computed:{copyrightHtml(){return'Copyright &copy; 2017&ndash;2022 <a href="https://www.uni-goettingen.de/en/">GÃ¶ttingen University</a>&nbsp;/ <a href="https://www.sub.uni-goettingen.de/en/">GÃ¶ttingen State and University Library</a>'},env(){return{version:"0.29.2",license:"AGPL-3.0",bugsUrl:"https://github.com/tify-iiif-viewer/tify/issues",contributorsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.29.2/CONTRIBUTORS.md",docsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.29.2/doc",docsLanguages:["de","en"],repositoryUrl:"https://github.com/tify-iiif-viewer/tify"}},infoHtml(){return'TIFY is a slim and mobile-friendly IIIF document viewer, released under the <a href="https://www.gnu.org/licenses/agpl-3.0.html.en">GNU Affero General Public License 3.0</a>.'},userGuideUrl(){const t=this.env.docsLanguages.includes(this.$store.options.language)?this.$store.options.language:"en";return`${this.env.docsUrl}/user-guide.${t}.md`}}},Ua={class:"tify-help",tabindex:"0"},Wa={class:"tify-sr-only"},ja=["innerHTML"],Ga=["href"],qa=["href"],Za=["href"],Ka=["href"],Xa={class:"tify-help-footer"},Ya=["innerHTML"];function Ja(t,s,e,i,n,r){return O(),F("section",Ua,[A("h2",Wa,q(t.$translate("Help")),1),A("h3",null,q(t.$translate("About TIFY")),1),A("p",{innerHTML:t.$translate("$info",r.infoHtml)},null,8,ja),A("ul",null,[A("li",null,[A("a",{href:r.userGuideUrl},q(t.$translate("User guide")),9,Ga)]),A("li",null,[A("a",{href:r.env.repositoryUrl},q(t.$translate("Source code")),9,qa)]),A("li",null,[A("a",{href:r.env.contributorsUrl},q(t.$translate("Contributors")),9,Za)]),A("li",null,[A("a",{href:r.env.bugsUrl},q(t.$translate("Report a bug")),9,Ka)])]),A("footer",Xa,[A("p",null,[be(q(t.$translate("Version"))+" ",1),A("b",null,q(r.env.version),1),be(" Â· "),A("span",{innerHTML:t.$translate("$copyright",r.copyrightHtml)},null,8,Ya)])])])}const Qa=ae(Na,[["render",Ja]]),$a={},el={class:"tify-icon",viewBox:"0 0 24 24"},tl=A("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},null,-1),il=[tl];function nl(t,s){return O(),F("svg",el,il)}const rr=ae($a,[["render",nl]]),sl={},rl={class:"tify-icon",viewBox:"0 0 24 24"},ol=A("path",{d:"M19,13H5V11H19V13Z"},null,-1),al=[ol];function ll(t,s){return O(),F("svg",rl,al)}const or=ae(sl,[["render",ll]]),ul={name:"CollectionNode",props:{item:{type:Object,default:()=>{}}},data(){return{children:null,expanded:!1,id:this.$store.getId(`collection-node-${Math.floor(Math.random()*1e12)}`)}},computed:{label(){const t=String.fromCharCode(160);return this.item.label?this.$store.convertValueToArray(this.item.label).join(`${t}Â· `):"â"}},methods:{toggleChildren(){if(this.expanded){this.expanded=!1;return}if(this.children){this.expanded=!0;return}if(this.item.children){this.children=this.item.children,this.expanded=!0;return}this.$store.fetchJson(this.item["@id"]).then(t=>{this.children=t.manifests||t.collections||[],this.expanded=!0},t=>{const s=t.response&&(t.response.statusText||t.response.data)||t.message;this.$store.addError(`Error loading IIIF manifest: ${s}`),this.children=!1})}}},cl=["aria-controls","aria-expanded"],hl={class:"tify-sr-only"},dl={class:"tify-sr-only"},fl=["id"],pl={key:1,class:"tify-collection-error"};function gl(t,s,e,i,n,r){const l=or,a=rr,o=Bs("collection-node",!0);return O(),F("li",{class:Te(["tify-collection-item",{"-current":t.$store.manifest&&t.$store.manifest["@id"]===e.item["@id"]}])},[e.item["@type"]==="sc:Collection"?(O(),F("button",{key:0,type:"button","aria-controls":n.id,"aria-expanded":n.expanded?"true":"false",class:"tify-collection-link -has-children",onClick:s[0]||(s[0]=u=>r.toggleChildren())},[n.expanded?(O(),F(de,{key:0},[ie(l),A("span",hl,q(t.$translate("Collapse")),1)],64)):(O(),F(de,{key:1},[ie(a),A("span",dl,q(t.$translate("Expand")),1)],64)),be(" "+q(r.label),1)],8,cl)):(O(),F("a",{key:1,href:"javascript:;",class:"tify-collection-link",onClick:s[1]||(s[1]=u=>t.$store.loadManifest(e.item["@id"],{expectedType:e.item["@type"],reset:!0}))},q(r.label),1)),n.expanded?(O(),F(de,{key:2},[n.expanded?(O(),F("ol",{key:0,id:n.id,class:"tify-collection-list"},[(O(!0),F(de,null,Ee(n.children,u=>(O(),Re(o,{key:u["@id"],item:u},null,8,["item"]))),128))],8,fl)):n.children===!1?(O(),F("p",pl,q(t.$translate("Could not load child manifest")),1)):oe("",!0)],64)):oe("",!0)],2)}const ml=ae(ul,[["render",gl]]),vl={data(){return{filter:""}},computed:{filteredItems(){const t=this.filter.trim().toLowerCase().split(/\s+/);return this.items.filter(s=>{const e=(s.label||"").toLowerCase();return t.every(i=>e.includes(i))})},items(){return this.$store.collection.manifests&&this.$store.collection.collections?[{"@id":"tify-collection-manifests","@type":"sc:Collection",label:this.$translate("Documents"),children:this.$store.collection.manifests},{"@id":"tify-collection-collections","@type":"sc:Collection",label:this.$translate("Collections"),children:this.$store.collection.collections}]:this.$store.collection.manifests||this.$store.collection.collections}}},yl={class:"tify-collection",tabindex:"0"},wl={class:"tify-sr-only"},_l={key:0,class:"tify-collection-controls"},Tl=["aria-label","placeholder"],xl=["disabled"],bl={key:1,class:"tify-collection-list"},El={key:2,class:"tify-collection-no-results"};function Sl(t,s,e,i,n,r){const l=ml;return O(),F("section",yl,[A("h2",wl,q(t.$translate("Collection")),1),r.items.length>5?(O(),F("p",_l,[ke(A("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>n.filter=a),"aria-label":t.$translate("Filter collection"),class:"tify-collection-filter",placeholder:t.$translate("Filter collection"),type:"text",onKeydown:[s[1]||(s[1]=It(vt(a=>n.filter?n.filter="":a.target.blur(),["prevent"]),["esc"])),s[2]||(s[2]=vt(()=>{},["stop"]))]},null,40,Tl),[[nr,n.filter]]),A("button",{type:"button",class:"tify-collection-reset",disabled:!n.filter,onClick:s[3]||(s[3]=a=>n.filter="")},q(t.$translate("Reset")),9,xl)])):oe("",!0),r.filteredItems.length?(O(),F("ol",bl,[(O(!0),F(de,null,Ee(r.filteredItems,a=>(O(),Re(l,{key:a["@id"],item:a},null,8,["item"]))),128))])):(O(),F("p",El,q(t.$translate("No results")),1))])}const Pl=ae(vl,[["render",Sl]]),Cl={},Rl={class:"tify-icon",viewBox:"0 0 24 24"},Hl=A("path",{d:"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"},null,-1),Ll=[Hl];function Ol(t,s){return O(),F("svg",Rl,Ll)}const Ml=ae(Cl,[["render",Ol]]),Dl={},kl={class:"tify-icon",viewBox:"0 0 24 24"},Fl=A("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},null,-1),Al=[Fl];function Bl(t,s){return O(),F("svg",kl,Al)}const Il=ae(Dl,[["render",Bl]]);function ns(t,s){if(!Array.isArray(t)||new Set(t).size!==t.length)return!1;for(let e=0,i=t.length;e<i;e+=1)if(!Number.isInteger(t[e])||e>0&&t[e]>0&&t[e]<=t[e-1]||t[e]<0||t[e]>s)return!1;return!0}function mn(t,s=["https:","http:"]){let e;try{e=new URL(t)}catch{return!1}return s.includes(e.protocol)}const zl={props:{metadata:{type:Array,default:()=>[]}},data(){return{infoItems:[]}},watch:{metadata(){this.updateInfoItems()}},mounted(){this.updateInfoItems()},methods:{cleanLabel(t){const s=t.replace("_"," ");return s.charAt(0).toUpperCase()+s.substr(1)},updateInfoItems(){this.$nextTick(()=>{this.$refs.contents&&this.$refs.contents.forEach((t,s)=>{const e=t.offsetHeight;this.infoItems[s]={collapsed:!0,exceedsHeight:!0},this.$nextTick(()=>{const i=t.offsetHeight,n=e>=i;this.infoItems[s]={collapsed:n,exceedsHeight:n}})})})},isValidUrl:mn}},Vl={class:"tify-info-metadata"},Nl={class:"tify-info-value"},Ul=["href"],Wl=["innerHTML"],jl=["onClick"];function Gl(t,s,e,i,n,r){const l=Il,a=Ml;return O(),F("div",Vl,[(O(!0),F(de,null,Ee(e.metadata,(o,u)=>(O(),F("div",{key:u},[A("h4",null,[(O(!0),F(de,null,Ee(t.$store.convertValueToArray(o.label),(h,g)=>(O(),F("div",{key:g},q(r.cleanLabel(h)),1))),128))]),A("div",{ref_for:!0,ref:"contents",class:Te(["tify-info-content",{"-collapsed":n.infoItems[u]&&n.infoItems[u].collapsed}])},[A("div",Nl,[(O(!0),F(de,null,Ee(t.$store.convertValueToArray(o.value),h=>(O(),F(de,null,[r.isValidUrl(h)?(O(),F("div",{key:"url-"+h},[A("a",{href:h},q(h),9,Ul)])):(O(),F("div",{key:"html-"+h,innerHTML:h},null,8,Wl))],64))),256))]),n.infoItems[u]&&n.infoItems[u].exceedsHeight?(O(),F("button",{key:0,type:"button",class:"tify-info-toggle",onClick:h=>n.infoItems[u].collapsed=!n.infoItems[u].collapsed},[n.infoItems[u].collapsed?(O(),F(de,{key:0},[ie(l),be(" "+q(t.$translate("Expand")),1)],64)):(O(),F(de,{key:1},[ie(a),be(" "+q(t.$translate("Collapse")),1)],64))],8,jl)):oe("",!0)],2)]))),128))])}const ql=ae(zl,[["render",Gl]]),Zl={data(){return{collectionDataShown:!1}},computed:{license(){return this.manifestOrCollection.license?this.$store.convertValueToArray(this.manifestOrCollection.license):[]},logoId(){return this.manifestOrCollection.logo["@id"]||this.manifestOrCollection.logo},manifestOrCollection(){return this.collectionDataShown?this.$store.collection:this.$store.manifest||this.$store.collection||{}},related(){return this.manifestOrCollection.related?this.$store.convertValueToArray(this.manifestOrCollection.related):[]}},methods:{isValidUrl:mn}},Kl={class:"tify-info",tabindex:"0"},Xl={class:"tify-sr-only"},Yl={key:0,class:"tify-info-header"},Jl={key:1,class:"tify-info-section -title"},Ql={class:"tify-info-heading"},$l={key:2,class:"tify-info-section -metadata"},eu={key:3,class:"tify-info-section -metadata -structure"},tu={key:0,class:"tify-info-structure"},iu={key:4,class:"tify-info-section -description"},nu=["innerHTML"],su={key:5,class:"tify-info-section -license"},ru=["href"],ou=["href"],au={key:6,class:"tify-info-section -related"},lu=["href"],uu=["href"],cu={key:7,class:"tify-info-section -attribution"},hu=["innerHTML"],du={key:8,class:"tify-info-section -logo"},fu=["href"],pu=["src","alt"],gu=["src","alt"];function mu(t,s,e,i,n,r){const l=ql;return O(),F("section",Kl,[A("h2",Xl,q(t.$translate("Info")),1),t.$store.collection&&t.$store.manifest?(O(),F("div",Yl,[A("button",{type:"button",class:Te(["tify-info-button",{"-active":!n.collectionDataShown}]),onClick:s[0]||(s[0]=a=>n.collectionDataShown=!1)},q(t.$translate("Document")),3),A("button",{type:"button",class:Te(["tify-info-button",{"-active":n.collectionDataShown}]),onClick:s[1]||(s[1]=a=>n.collectionDataShown=!0)},q(t.$translate("Collection")),3)])):oe("",!0),r.manifestOrCollection.label?(O(),F("div",Jl,[A("h3",Ql,q(t.$translate("Title")),1),(O(!0),F(de,null,Ee(t.$store.convertValueToArray(r.manifestOrCollection.label),a=>(O(),F("div",{key:a},q(a),1))),128))])):oe("",!0),r.manifestOrCollection.metadata&&r.manifestOrCollection.metadata.length?(O(),F("div",$l,[A("h3",null,q(t.$translate("Metadata")),1),t.$store.options.view==="info"?(O(),Re(l,{key:0,metadata:r.manifestOrCollection.metadata},null,8,["metadata"])):oe("",!0)])):oe("",!0),r.manifestOrCollection.structures&&(t.$store.currentStructure.label||t.$store.currentStructure.metadata)?(O(),F("div",eu,[A("h3",null,q(t.$translate("Current Element")),1),t.$store.currentStructure.label?(O(),F("p",tu,q(t.$store.currentStructure.label),1)):oe("",!0),t.$store.options.view==="info"&&t.$store.currentStructure.metadata?(O(),Re(l,{key:1,class:"tify-info-section -metadata",metadata:t.$store.currentStructure.metadata},null,8,["metadata"])):oe("",!0)])):oe("",!0),r.manifestOrCollection.description?(O(),F("div",iu,[A("h3",null,q(t.$translate("Description")),1),(O(!0),F(de,null,Ee(t.$store.convertValueToArray(r.manifestOrCollection.description),(a,o)=>(O(),F("div",{key:o,innerHTML:a},null,8,nu))),128))])):oe("",!0),r.license.length?(O(),F("div",su,[A("h3",null,q(t.$translate("License")),1),(O(!0),F(de,null,Ee(r.license,(a,o)=>(O(),F("div",{key:o},[typeof a=="string"?(O(),F(de,{key:0},[r.isValidUrl(a)?(O(),F("a",{key:0,href:a},q(a),9,ru)):(O(),F(de,{key:1},[be(q(a),1)],64))],64)):(O(),F(de,{key:1},[r.isValidUrl(a["@id"])?(O(),F("a",{key:0,href:a["@id"]},q(a.label||a["@id"]),9,ou)):(O(),F(de,{key:1},[be(q(a.label||a["@id"]),1)],64))],64))]))),128))])):oe("",!0),r.related.length?(O(),F("div",au,[A("h3",null,q(t.$translate("Related Resources")),1),(O(!0),F(de,null,Ee(r.related,(a,o)=>(O(),F("div",{key:o},[typeof a=="string"?(O(),F("a",{key:0,href:a},q(a),9,lu)):(O(),F("a",{key:1,href:a["@id"]},q(a.label||a["@id"]),9,uu))]))),128))])):oe("",!0),r.manifestOrCollection.attribution?(O(),F("div",cu,[A("h3",null,q(t.$translate("Provided by")),1),(O(!0),F(de,null,Ee(t.$store.convertValueToArray(r.manifestOrCollection.attribution),(a,o)=>(O(),F("div",{key:o,innerHTML:a},null,8,hu))),128))])):oe("",!0),r.manifestOrCollection.logo?(O(),F("div",du,[r.logoId&&r.manifestOrCollection.logo.service&&r.manifestOrCollection.logo.service["@id"]?(O(),F("a",{key:0,href:r.manifestOrCollection.logo.service["@id"]},[A("img",{class:"tify-info-logo",src:r.logoId,alt:t.$translate("Logo")},null,8,pu)],8,fu)):(O(),F("img",{key:1,class:"tify-info-logo",src:r.logoId,alt:t.$translate("Logo")},null,8,gu))])):oe("",!0)])}const vu=ae(Zl,[["render",mu]]),yu={name:"TocList",props:{level:{type:Number,default:0},structures:{type:Array,default:()=>[]},parentStructure:{type:Object,default:()=>{}},purpose:{type:String,default:""}},data(){return{expandedStructures:[],id:this.$store.getId(`toc-list-${Math.floor(Math.random()*1e12)}`)}},methods:{isCurrentPageInStructure(t){const{pages:s}=this.$store.options;return s.some(e=>e>=t.firstPage&&e<=t.lastPage)},setPage(t){this.$store.setPage(t),this.$store.isMobile()&&this.$store.updateOptions({view:"scan"})},toggleAllChildren(t=null){if(this.$refs.children){for(let s=this.structures.length-1;s>=0;s-=1)this.toggleChildren(s,t);this.$refs.children.forEach(s=>{s.toggleAllChildren(t)})}},toggleChildren(t,s=null){this.structures[t].childStructures&&(this.expandedStructures[t]=s!==null?s:!this.expandedStructures[t])}}},wu={class:"tify-toc-list"},_u=["data-level"],Tu=["title","aria-controls","aria-expanded","onClick"],xu=["href"],bu=["onClick"],Eu={class:"tify-toc-label"},Su={class:"tify-toc-page"};function Pu(t,s,e,i,n,r){const l=or,a=rr,o=Bs("toc-list",!0);return O(),F("ul",wu,[(O(!0),F(de,null,Ee(e.structures,(u,h)=>(O(),F("li",{key:h,class:Te(["tify-toc-structure",{"-current":r.isCurrentPageInStructure(u),"-expanded":n.expandedStructures[h]}]),"data-level":e.level},[u.childStructures?(O(),F("button",{key:0,type:"button",class:"tify-toc-toggle",title:t.$translate(n.expandedStructures[h]?"Collapse":"Expand"),"aria-controls":`${n.id}-${h}`,"aria-expanded":n.expandedStructures[h]?"true":"false",onClick:g=>r.toggleChildren(h)},[n.expandedStructures[h]?(O(),Re(l,{key:0})):(O(),Re(a,{key:1}))],8,Tu)):oe("",!0),e.purpose==="pdf"?(O(),F("a",{key:1,class:"tify-toc-link",download:"",href:t.$store.convertValueToArray(u.rendering)[0]["@id"]},q(u.label)+" ("+q(u.pageCount)+"Â "+q(t.$translate(u.pageCount===1?"page":"pages"))+") ",9,xu)):(O(),F("a",{key:2,class:"tify-toc-link -dots",href:"javascript:;",onClick:g=>t.$store.setPage(u.firstPage)},[A("span",Eu,q(u.label),1),A("span",Su,q(u.pageLabel),1)],8,bu)),u.childStructures?ke((O(),Re(o,{key:3,id:`${n.id}-${h}`,ref_for:!0,ref:"children",level:e.level+1,"parent-structure":u,purpose:e.purpose,structures:u.childStructures},null,8,["id","level","parent-structure","purpose","structures"])),[[Ke,n.expandedStructures[h]]]):oe("",!0)],10,_u))),128))])}const ar=ae(yu,[["render",Pu]]),Cu=[{label:"BibTex",profile:"http://www.bibtex.org/Format/",type:"literature"},{label:"EndNote",profile:"http://endnote.com/",type:"literature"},{label:"RIS",profile:"http://referencemanager.com/sites/rm/files/m/direct_export_ris.pdf",type:"literature"},{label:"METS",profile:"http://www.loc.gov/standards/mets/profile_docs/mets.profile.v2-0.xsd",type:"other"},{label:"MODS",format:"application/mods+xml",type:"other"}],Ru={data(){return{literatureItems:[],otherItems:[],perElementPdfLinksVisible:!1}},computed:{hasElementPdfLinks(){return!Array.isArray(this.$store.manifest.structures)||!this.$store.manifest.structures[0]||!this.$store.manifest.structures[0].rendering?!1:this.$store.convertValueToArray(this.$store.manifest.structures[0].rendering).some(s=>s.format&&s.format==="application/pdf")},imageUrls(){const t={};return this.$store.options.pages.forEach(s=>{if(!s)return;const{resource:e}=this.$store.canvases[s-1].images[0];if(e.service){const i=e.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",n=e.service["@id"];t[s]=`${n}${n.slice(-1)==="/"?"":"/"}full/full/0/${i}.jpg`}else t[s]=e["@id"]}),t},pages(){return this.$store.options.pages.filter(t=>t>0)},renderings(){return this.$store.convertValueToArray(this.$store.manifest.rendering)}},created(){const{seeAlso:t}=this.$store.manifest;if(!t)return;JSON.parse(JSON.stringify(Array.isArray(t)?t:[t])).forEach(e=>{const i=typeof e=="object"?e:{"@id":e};let n=!1;Cu.some(r=>{const l=e.format&&r.format===e.format,a=e.profile&&r.profile===e.profile;return l||a?(i.label=r.label,r.type==="literature"&&(n=!0),!0):!1}),n?this.literatureItems.push(i):this.otherItems.push(i)})}},Hu={class:"tify-export",tabindex:"0"},Lu={class:"tify-sr-only"},Ou={class:"tify-export-section -links"},Mu=["href","download"],Du={key:0,class:"tify-export-section -renderings"},ku=["href"],Fu={key:0,class:"tify-export-container"},Au=["aria-controls","aria-expanded"],Bu={class:"tify-sr-only"},Iu=["id"],zu={key:1,class:"tify-export-section -literature"},Vu=["href"],Nu={class:"tify-export-section -other"},Uu={key:0},Wu=["href"],ju=["href"],Gu=["href"];function qu(t,s,e,i,n,r){const l=sr,a=ar;return O(),F("section",Hu,[A("h2",Lu,q(t.$translate("Export")),1),A("div",Ou,[A("h3",null,q(t.$translate("Download Individual Images")),1),A("ul",null,[(O(!0),F(de,null,Ee(r.pages,o=>(O(),F("li",{key:o},[A("a",{href:r.imageUrls[o],download:`${o}.jpg`},q(t.$translate("Page"))+" "+q(t.$store.getPageLabel(o,t.$store.convertValueToArray(t.$store.canvases[o-1].label)[0])),9,Mu)]))),128))])]),t.$store.manifest.rendering?(O(),F("div",Du,[A("h3",null,q(t.$translate("Renderings")),1),A("ul",null,[(O(!0),F(de,null,Ee(r.renderings,o=>(O(),F("li",{key:o["@id"]},[A("a",{href:o["@id"]},q(o.label),9,ku)]))),128))]),r.hasElementPdfLinks?(O(),F("div",Fu,[A("button",{type:"button",class:Te(["tify-export-toggle",{"-close":n.perElementPdfLinksVisible}]),"aria-controls":t.$store.getId("export-pdf-list"),"aria-expanded":n.perElementPdfLinksVisible?"true":"false",onClick:s[0]||(s[0]=o=>n.perElementPdfLinksVisible=!n.perElementPdfLinksVisible)},[n.perElementPdfLinksVisible?(O(),F(de,{key:1},[ie(l),A("span",Bu,q(t.$translate("Close PDF list")),1)],64)):(O(),F(de,{key:0},[be(q(t.$translate("PDFs for each element")),1)],64))],10,Au),n.perElementPdfLinksVisible?(O(),F("div",{key:0,id:t.$store.getId("export-pdf-list"),class:"tify-export-toc"},[A("h4",null,q(t.$translate("PDFs for each element")),1),ie(a,{ref:"children",purpose:"pdf",level:0,structures:t.$store.structures},null,8,["structures"])],8,Iu)):oe("",!0)])):oe("",!0)])):oe("",!0),n.literatureItems.length?(O(),F("div",zu,[A("h3",null,q(t.$translate("Literature Management")),1),A("ul",null,[(O(!0),F(de,null,Ee(n.literatureItems,o=>(O(),F("li",{key:o["@id"]},[A("a",{href:o["@id"],download:""},q(o.label),9,Vu)]))),128))])])):oe("",!0),A("div",Nu,[A("h3",null,q(t.$translate("Other Formats")),1),A("ul",null,[t.$store.options.childManifestUrl?(O(),F("li",Uu,[A("a",{href:t.$store.options.childManifestUrl,download:"manifest.json"},q(t.$translate("IIIF manifest (current document)")),9,Wu)])):oe("",!0),A("li",null,[A("a",{href:t.$store.options.manifestUrl,download:"manifest.json"},q(t.$translate(t.$store.collection?"IIIF manifest (collection)":"IIIF manifest")),9,ju)]),(O(!0),F(de,null,Ee(n.otherItems,o=>(O(),F("li",{key:o["@id"]},[A("a",{href:o["@id"],download:""},q(o.label||o["@id"]),9,Gu)]))),128))])])])}const Zu=ae(Ru,[["render",qu]]);function li(t,s,e=120){const i=t,n=e===!0?120:e;if(!n||n<0){i.scrollTop=s;return}const l=(s-t.scrollTop)/n/.1;setTimeout(()=>{i.scrollTop+=l,i.scrollTop!==s&&li(i,s,n-10)},10)}function Ki(t,s,e=!0){const i=s.querySelectorAll(t);if(!i.length)return;let n=i[0];const r=i[i.length-1];Array.prototype.forEach.call(i,u=>{u.dataset.level>n.dataset.level&&(n=u)});const l=s.getBoundingClientRect(),a=n.getBoundingClientRect(),o=r.getBoundingClientRect();if(a.top<l.top){const u=a.top-l.top+s.scrollTop;li(s,u-50,e)}else if(o.bottom>l.bottom){const u=o.bottom-l.bottom+s.scrollTop;li(s,u+50,e)}}const ss=".tify-toc-structure.-current",Ku={data(){return{isInited:!1}},computed:{hasChildStructures(){return this.$store.structures&&this.$store.structures.some(t=>t.childStructures)}},watch:{"$store.options.pages":function(){this.$nextTick(()=>Ki(ss,this.$el))},"$store.options.view":{handler(t){t==="toc"&&this.$nextTick(this.init)},immediate:!0}},methods:{init(){this.isInited=!0,this.$nextTick(()=>Ki(ss,this.$el,!1))}}},Xu={class:"tify-toc",tabindex:"0"},Yu={class:"tify-sr-only"},Ju={key:0,class:"tify-toc-header"};function Qu(t,s,e,i,n,r){const l=ar;return O(),F("section",Xu,[A("h2",Yu,q(t.$translate("Table of Contents")),1),r.hasChildStructures?(O(),F("div",Ju,[A("button",{type:"button",class:"tify-toc-toggle-all",onClick:s[0]||(s[0]=a=>t.$refs.children.toggleAllChildren(!0))},q(t.$translate("Expand all")),1),A("button",{type:"button",class:"tify-toc-toggle-all",onClick:s[1]||(s[1]=a=>t.$refs.children.toggleAllChildren(!1))},q(t.$translate("Collapse all")),1)])):oe("",!0),n.isInited?(O(),Re(l,{key:1,ref:"children",level:0,structures:t.$store.structures},null,8,["structures"])):oe("",!0)])}const $u=ae(Ku,[["render",Qu]]),ec=750,tc={data(){return{itemHeight:0,itemVMargin:0,items:[{label:""}],itemsPerRow:0,knownImages:[],lastScrollTop:0,resizeTimeout:null,style:{},thumbnailWidth:0,touchTimeout:null}},watch:{"$store.options.pages":function(t){this.$nextTick(()=>{const s=".tify-thumbnails-item.-current";t.length>2||t.length>1&&t[1]!==t[0]+1||(this.$refs.container.querySelector(s)?Ki(s,this.$el):this.scrollToCurrentPage())})},"$store.options.view":{handler(t){t==="thumbnails"&&this.$nextTick(this.init)},immediate:!0}},mounted(){this.style.flex=this.$el.style.flex},methods:{init(){this.updateDimensions(),this.scrollToCurrentPage(!1),new ResizeObserver(this.onResize).observe(this.$el)},onResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.$store.options.view==="thumbnails"&&this.updateDimensions()},200)},updateDimensions(){const t=this.$refs.container.querySelector(".tify-thumbnails-item"),s=t.currentStyle||window.getComputedStyle(t),e=parseInt(s.marginTop,10)+parseFloat(s.marginBottom,10);this.itemHeight=t.offsetHeight+e,this.itemVerticalMargin=e;const i=parseInt(s.marginLeft,10)+parseFloat(s.marginRight,10),n=t.offsetWidth+i;this.thumbnailWidth=t.offsetWidth,this.itemsPerRow=Math.floor(this.$refs.container.clientWidth/n);const l=Math.ceil(this.$store.canvases.length/this.itemsPerRow)*this.itemHeight;this.$refs.container.style.height=`${l}px`,this.redrawThumbnails(),this.scrollToCurrentPage(!1)},redrawThumbnails(){const t=this.$el.scrollTop,s=Math.floor(t/this.itemHeight)*this.itemsPerRow+1,i=Math.ceil(this.$el.offsetHeight/this.itemHeight)*this.itemsPerRow,n=s+this.itemsPerRow+i,r=Math.min(this.$store.canvases.length,n),l=[];for(let a=s-1;a<r;a+=1){const{resource:o}=this.$store.canvases[a].images[0];if(o.service){const u=o.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",h=o.service["@id"];l.push({label:this.$store.convertValueToArray(this.$store.canvases[a].label)[0],imgUrl:`${h}${h.slice(-1)==="/"?"":"/"}full/${this.thumbnailWidth},/0/${u}.jpg`,page:a+1})}else l.push({label:this.$store.convertValueToArray(this.$store.canvases[a].label)[0],imgUrl:o["@id"],page:a+1})}this.items=l,this.$nextTick(()=>{const a=Math.floor(s/this.itemsPerRow);this.$refs.container.style.paddingTop=`${a*this.itemHeight}px`})},scrollToCurrentPage(t=!0){const e=Math.floor((this.$store.options.pages[0]-1)/this.itemsPerRow)*this.itemHeight+(this.itemVMargin-50);t?li(this.$el,e):this.$el.scrollTop=e},setPageAndSwitchView(t,s=!1){if(s){const e=this.$store.options.pages.slice(0),i=e.indexOf(t);i<0?(e.push(t),e.sort((n,r)=>n-r),e[0]===0&&e.shift()):e.length>1&&e.splice(i,1),this.$store.updateOptions({pages:e});return}this.$store.setPage(t),this.$store.isMobile()&&this.$store.updateOptions({view:"scan"})},touchStartTogglePage(t){this.lastScrollTop=this.$el.scrollTop,this.touchTimeout=setTimeout(()=>{this.$el.scrollTop===this.lastScrollTop&&this.setPageAndSwitchView(t,!0)},ec)},touchEnd(){clearTimeout(this.touchTimeout)}}},ic={class:"tify-sr-only"},nc={ref:"container",class:"tify-thumbnails-list"},sc=["onClick","onTouchstart"],rc=["src"],oc={class:"tify-thumbnails-page"};function ac(t,s,e,i,n,r){return O(),F("section",{class:"tify-thumbnails",tabindex:"0",onScroll:s[1]||(s[1]=(...l)=>r.redrawThumbnails&&r.redrawThumbnails(...l))},[A("h2",ic,q(t.$translate("Pages")),1),A("div",nc,[(O(!0),F(de,null,Ee(n.items,l=>(O(),F("a",{key:l.page,class:Te(["tify-thumbnails-item",{"-current":t.$store.options.pages.includes(l.page)}]),href:"javascript:;",onClick:vt(a=>r.setPageAndSwitchView(l.page,a.ctrlKey),["prevent"]),onTouchstart:a=>r.touchStartTogglePage(l.page),onTouchend:s[0]||(s[0]=(...a)=>r.touchEnd&&r.touchEnd(...a))},[A("img",{alt:"",src:l.imgUrl},null,8,rc),A("span",oc,q(t.$store.getPageLabel(l.page,l.label)),1)],42,sc))),128))],512)],32)}const lc=ae(tc,[["render",ac]]);var vn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lr={exports:{}};(function(t){(function(s){if(typeof e!="function"){var e=function(x){return x};e.nonNative=!0}const i=e("plaintext"),n=e("html"),r=e("comment"),l=/<(\w*)>/g,a=/<\/?([^\s\/>]+)/;function o(x,S,P){x=x||"",S=S||[],P=P||"";let D=h(S,P);return g(x,D)}function u(x,S){x=x||[],S=S||"";let P=h(x,S);return function(d){return g(d||"",P)}}o.init_streaming_mode=u;function h(x,S){return x=m(x),{allowable_tags:x,tag_replacement:S,state:i,tag_buffer:"",depth:0,in_quote_char:""}}function g(x,S){if(typeof x!="string")throw new TypeError("'html' parameter must be a string");let P=S.allowable_tags,D=S.tag_replacement,d=S.state,_=S.tag_buffer,L=S.depth,H=S.in_quote_char,M="";for(let V=0,G=x.length;V<G;V++){let Z=x[V];if(d===i)switch(Z){case"<":d=n,_+=Z;break;default:M+=Z;break}else if(d===n)switch(Z){case"<":if(H)break;L++;break;case">":if(H)break;if(L){L--;break}H="",d=i,_+=">",P.has(T(_))?M+=_:M+=D,_="";break;case'"':case"'":Z===H?H="":H=H||Z,_+=Z;break;case"-":_==="<!-"&&(d=r),_+=Z;break;case" ":case`
`:if(_==="<"){d=i,M+="< ",_="";break}_+=Z;break;default:_+=Z;break}else if(d===r)switch(Z){case">":_.slice(-2)=="--"&&(d=i),_="";break;default:_+=Z;break}}return S.state=d,S.tag_buffer=_,S.depth=L,S.in_quote_char=H,M}function m(x){let S=new Set;if(typeof x=="string"){let P;for(;P=l.exec(x);)S.add(P[1])}else!e.nonNative&&typeof x[e.iterator]=="function"?S=new Set(x):typeof x.forEach=="function"&&x.forEach(S.add,S);return S}function T(x){let S=a.exec(x);return S?S[1].toLowerCase():null}t.exports?t.exports=o:s.striptags=o})(vn)})(lr);var uc=lr.exports;const cc=yn(uc);function lt(t){const s=["a","b","br","i","img","p","span"],e={a:["href"],img:["alt","src"]};let i=cc(t,s);const n=/<(\w+)((\s+.+?(\s*=\s*(?:".*?"|'.*?'|.*?|[\^'">\s]+))?)+\s*|\s*)>/g;return i=i.replace(n,(r,l,a)=>{if(!a)return`<${l}>`;const o=/(?:([^\s]+)=(?:"(.*?)"|'(.*?)'))|([^\s]+)/g,u=[];return a.replace(o,(h,g)=>{h!==g&&e[l]&&e[l].includes(g)&&u.push(h)}),u.length>0?`<${l} ${u.join(" ")}>`:`<${l}>`}),i}const hc={data(){return{fulltextAvailable:null,fulltexts:[]}},computed:{pages(){return this.$store.options.pages.filter(t=>!!t)}},watch:{"$store.options.pages":function(){this.loadFulltexts()}},mounted(){this.loadFulltexts()},methods:{loadFulltexts(){this.fulltextAvailable=null,this.fulltexts=[],this.$store.options.pages.forEach(t=>{if(t<1||this.fulltexts[t])return;const s=this.$store.canvases[t-1];if(!("otherContent"in s)){this.fulltextAvailable=!1;return}const e=s.otherContent[0]["@id"];this.$store.fetchJson(e).then(i=>{const{resources:n}=i;Array.isArray(n)&&n.forEach((r,l)=>{const a=r.resource;if(a)if(this.fulltexts[t]||(this.fulltexts[t]=[]),a&&a.chars){const o=lt(a.chars);o&&(this.fulltextAvailable=!0),this.fulltexts[t][l]=o}else a["@id"]&&this.loadRemoteFulltext(t,l,a["@id"])})},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load annotations: ${n}`),this.fulltextAvailable=!1})})},loadRemoteFulltext(t,s,e){mn(e)&&this.$store.fetchText(e).then(i=>{const n=lt(i);n&&(this.fulltextAvailable=!0),this.fulltexts[t]||(this.fulltexts[t]=[]),this.fulltexts[t][s]=n},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load fulltext: ${n}`)})}}},dc={class:"tify-fulltext",tabindex:"0"},fc={class:"tify-sr-only"},pc={key:0,class:"tify-fulltext-texts"},gc=["innerHTML"],mc={key:1,class:"tify-fulltext-none"};function vc(t,s,e,i,n,r){return O(),F("section",dc,[A("h2",fc,q(t.$translate("Fulltext")),1),n.fulltextAvailable!==!1?(O(),F("div",pc,[(O(!0),F(de,null,Ee(r.pages,l=>(O(),F("div",{key:l,class:"tify-fulltext-page"},[A("h3",null,q(t.$translate("Page"))+" "+q(t.$store.getPageLabel(l,t.$store.canvases[l-1].label)),1),(O(!0),F(de,null,Ee(n.fulltexts[l],(a,o)=>(O(),F("div",{key:`${l}-${o}`,class:"tify-fulltext-text",innerHTML:a},null,8,gc))),128))]))),128))])):(O(),F("div",mc,q(t.$translate("Fulltext not available for this page")),1))])}const yc=ae(hc,[["render",vc]]),wc={},_c={class:"tify-icon",viewBox:"0 0 24 24"},Tc=A("path",{d:"M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z"},null,-1),xc=[Tc];function bc(t,s){return O(),F("svg",_c,xc)}const Ec=ae(wc,[["render",bc]]),Sc={},Pc={class:"tify-icon",viewBox:"0 0 24 24"},Cc=A("path",{d:"M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M14.5,8A1.5,1.5 0 0,1 13,6.5A1.5,1.5 0 0,1 14.5,5A1.5,1.5 0 0,1 16,6.5A1.5,1.5 0 0,1 14.5,8M9.5,8A1.5,1.5 0 0,1 8,6.5A1.5,1.5 0 0,1 9.5,5A1.5,1.5 0 0,1 11,6.5A1.5,1.5 0 0,1 9.5,8M6.5,12A1.5,1.5 0 0,1 5,10.5A1.5,1.5 0 0,1 6.5,9A1.5,1.5 0 0,1 8,10.5A1.5,1.5 0 0,1 6.5,12M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A1.5,1.5 0 0,0 13.5,19.5C13.5,19.11 13.35,18.76 13.11,18.5C12.88,18.23 12.73,17.88 12.73,17.5A1.5,1.5 0 0,1 14.23,16H16A5,5 0 0,0 21,11C21,6.58 16.97,3 12,3Z"},null,-1),Rc=[Cc];function Hc(t,s){return O(),F("svg",Pc,Rc)}const Lc=ae(Sc,[["render",Hc]]),Oc={},Mc={class:"tify-icon",viewBox:"0 0 24 24"},Dc=A("path",{d:"M12,18V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"},null,-1),kc=[Dc];function Fc(t,s){return O(),F("svg",Mc,kc)}const Ac=ae(Oc,[["render",Fc]]),Bc={},Ic={class:"tify-icon",viewBox:"0 0 24 24"},zc=A("path",{d:"M3.55 19.09L4.96 20.5L6.76 18.71L5.34 17.29M12 6C8.69 6 6 8.69 6 12S8.69 18 12 18 18 15.31 18 12C18 8.68 15.31 6 12 6M20 13H23V11H20M17.24 18.71L19.04 20.5L20.45 19.09L18.66 17.29M20.45 5L19.04 3.6L17.24 5.39L18.66 6.81M13 1H11V4H13M6.76 5.39L4.96 3.6L3.55 5L5.34 6.81L6.76 5.39M1 13H4V11H1M13 20H11V23H13"},null,-1),Vc=[zc];function Nc(t,s){return O(),F("svg",Ic,Vc)}const Uc=ae(Bc,[["render",Nc]]),Wc={},jc={class:"tify-icon",viewBox:"0 0 24 24"},Gc=A("path",{d:"M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"},null,-1),qc=[Gc];function Zc(t,s){return O(),F("svg",jc,qc)}const Kc=ae(Wc,[["render",Zc]]),Xc={},Yc={class:"tify-icon",viewBox:"0 0 24 24"},Jc=A("path",{d:"M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z"},null,-1),Qc=[Jc];function $c(t,s){return O(),F("svg",Yc,Qc)}const eh=ae(Xc,[["render",$c]]),th={},ih={class:"tify-icon",viewBox:"0 0 24 24"},nh=A("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M5,8V10H13V8H5Z"},null,-1),sh=[nh];function rh(t,s){return O(),F("svg",ih,sh)}const oh=ae(th,[["render",rh]]),ah={},lh={class:"tify-icon",viewBox:"0 0 24 24"},uh=A("path",{d:"M19,12H17V15H14V17H19V12M7,9H10V7H5V12H7V9M21,3H3A2,2 0 0,0 1,5V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V5A2,2 0 0,0 21,3M21,19H3V5H21V19Z"},null,-1),ch=[uh];function hh(t,s){return O(),F("svg",lh,ch)}const dh=ae(ah,[["render",hh]]),fh={},ph={class:"tify-icon",viewBox:"0 0 24 24"},gh=A("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M8,5V8H5V10H8V13H10V10H13V8H10V5H8Z"},null,-1),mh=[gh];function vh(t,s){return O(),F("svg",ph,mh)}const yh=ae(fh,[["render",vh]]),wh={},_h={class:"tify-icon",viewBox:"0 0 24 24"},Th=A("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1),xh=[Th];function bh(t,s){return O(),F("svg",_h,xh)}const ur=ae(wh,[["render",bh]]),Eh={},Sh={class:"tify-icon",viewBox:"0 0 24 24"},Ph=A("path",{d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"},null,-1),Ch=[Ph];function Rh(t,s){return O(),F("svg",Sh,Ch)}const cr=ae(Eh,[["render",Rh]]);var hr={exports:{}};(function(t,s){(function(e,i){t.exports=i()})(vn,function(){var e="__v-click-outside",i=typeof window<"u",n=typeof navigator<"u",r=i&&("ontouchstart"in window||n&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],l=function(h){var g=h.event,m=h.handler;(0,h.middleware)(g)&&m(g)},a=function(h,g){var m=function(d){var _=typeof d=="function";if(!_&&typeof d!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:_?d:d.handler,middleware:d.middleware||function(L){return L},events:d.events||r,isActive:d.isActive!==!1,detectIframe:d.detectIframe!==!1,capture:!!d.capture}}(g.value),T=m.handler,x=m.middleware,S=m.detectIframe,P=m.capture;if(m.isActive){if(h[e]=m.events.map(function(d){return{event:d,srcTarget:document.documentElement,handler:function(_){return function(L){var H=L.el,M=L.event,V=L.handler,G=L.middleware,Z=M.path||M.composedPath&&M.composedPath();(Z?Z.indexOf(H)<0:!H.contains(M.target))&&l({event:M,handler:V,middleware:G})}({el:h,event:_,handler:T,middleware:x})},capture:P}}),S){var D={event:"blur",srcTarget:window,handler:function(d){return function(_){var L=_.el,H=_.event,M=_.handler,V=_.middleware;setTimeout(function(){var G=document.activeElement;G&&G.tagName==="IFRAME"&&!L.contains(G)&&l({event:H,handler:M,middleware:V})},0)}({el:h,event:d,handler:T,middleware:x})},capture:P};h[e]=[].concat(h[e],[D])}h[e].forEach(function(d){var _=d.event,L=d.srcTarget,H=d.handler;return setTimeout(function(){h[e]&&L.addEventListener(_,H,P)},0)})}},o=function(h){(h[e]||[]).forEach(function(g){return g.srcTarget.removeEventListener(g.event,g.handler,g.capture)}),delete h[e]},u=i?{beforeMount:a,updated:function(h,g){var m=g.value,T=g.oldValue;JSON.stringify(m)!==JSON.stringify(T)&&(o(h),a(h,{value:m}))},unmounted:o}:{};return{install:function(h){h.directive("click-outside",u)},directive:u}})})(hr);var Hh=hr.exports;const wn=yn(Hh);var dr={exports:{}};(function(t){//! openseadragon 3.0.0
//! Built on 2021-12-15
//! Git commit: v3.0.0-0-3eded36
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function s(e){return new s.Viewer(e)}(function(e){e.version={versionStr:"3.0.0",major:parseInt("3",10),minor:parseInt("0",10),revision:parseInt("0",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,r=Object.prototype.hasOwnProperty;e.isFunction=function(l){return e.type(l)==="function"},e.isArray=Array.isArray||function(l){return e.type(l)==="array"},e.isWindow=function(l){return l&&typeof l=="object"&&"setInterval"in l},e.type=function(l){return l==null?String(l):i[n.call(l)]||"object"},e.isPlainObject=function(l){if(!l||s.type(l)!=="object"||l.nodeType||e.isWindow(l)||l.constructor&&!r.call(l,"constructor")&&!r.call(l.constructor.prototype,"isPrototypeOf"))return!1;var a;for(var o in l)a=o;return a===void 0||r.call(l,a)},e.isEmptyObject=function(l){for(var a in l)return!1;return!0},e.freezeObject=function(l){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(a){return a},e.freezeObject(l)},e.supportsCanvas=function(){var l=document.createElement("canvas");return!!(e.isFunction(l.getContext)&&l.getContext("2d"))}(),e.isCanvasTainted=function(l){var a=!1;try{l.getContext("2d").getImageData(0,0,1,1)}catch{a=!0}return a},e.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),e.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),e.supportsEventListenerOptions=function(){var l=0;if(e.supportsAddEventListener)try{var a={get capture(){return l++,!1},get once(){return l++,!1},get passive(){return l++,!1}};window.addEventListener("test",null,a),window.removeEventListener("test",null,a)}catch{l=0}return l>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var l=document.createElement("canvas").getContext("2d"),a=window.devicePixelRatio||1,o=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1;return Math.max(a,1)/o}else return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(s),function(e){e.extend=function(){var o,u,h,g,m,T,x=arguments[0]||{},S=arguments.length,P=!1,D=1;for(typeof x=="boolean"&&(P=x,x=arguments[1]||{},D=2),typeof x!="object"&&!s.isFunction(x)&&(x={}),S===D&&(x=this,--D);D<S;D++)if(o=arguments[D],o!==null||o!==void 0)for(u in o)h=x[u],g=o[u],x!==g&&(P&&g&&(s.isPlainObject(g)||(m=s.isArray(g)))?(m?(m=!1,T=h&&s.isArray(h)?h:[]):T=h&&s.isPlainObject(h)?h:{},x[u]=s.extend(P,T,g)):g!==void 0&&(x[u]=g));return x};var i=function(){if(typeof navigator!="object")return!1;var o=navigator.userAgent;return typeof o!="string"?!1:o.indexOf("iPhone")!==-1||o.indexOf("iPad")!==-1||o.indexOf("iPod")!==-1};e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(o,u){return function(){var h=arguments;return h===void 0&&(h=[]),u.apply(o,h)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},_viewers:new Map,getViewer:function(o){return e._viewers.get(this.getElement(o))},getElement:function(o){return typeof o=="string"&&(o=document.getElementById(o)),o},getElementPosition:function(o){var u=new e.Point,h,g;for(o=e.getElement(o),h=e.getElementStyle(o).position==="fixed",g=a(o,h);g;)u.x+=o.offsetLeft,u.y+=o.offsetTop,h&&(u=u.plus(e.getPageScroll())),o=g,h=e.getElementStyle(o).position==="fixed",g=a(o,h);return u},getElementOffset:function(o){o=e.getElement(o);var u=o&&o.ownerDocument,h,g,m={top:0,left:0};return u?(h=u.documentElement,typeof o.getBoundingClientRect<"u"&&(m=o.getBoundingClientRect()),g=u===u.window?u:u.nodeType===9?u.defaultView||u.parentWindow:!1,new e.Point(m.left+(g.pageXOffset||h.scrollLeft)-(h.clientLeft||0),m.top+(g.pageYOffset||h.scrollTop)-(h.clientTop||0))):new e.Point},getElementSize:function(o){return o=e.getElement(o),new e.Point(o.clientWidth,o.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(o){return o=e.getElement(o),o.currentStyle}:function(o){return o=e.getElement(o),window.getComputedStyle(o,"")},getCssPropertyWithVendorPrefix:function(o){var u={};return e.getCssPropertyWithVendorPrefix=function(h){if(u[h]!==void 0)return u[h];var g=document.createElement("div").style,m=null;if(g[h]!==void 0)m=h;else for(var T=["Webkit","Moz","MS","O","webkit","moz","ms","o"],x=e.capitalizeFirstLetter(h),S=0;S<T.length;S++){var P=T[S]+x;if(g[P]!==void 0){m=P;break}}return u[h]=m,m},e.getCssPropertyWithVendorPrefix(o)},capitalizeFirstLetter:function(o){return o.charAt(0).toUpperCase()+o.slice(1)},positiveModulo:function(o,u){var h=o%u;return h<0&&(h+=u),h},pointInElement:function(o,u){o=e.getElement(o);var h=e.getElementOffset(o),g=e.getElementSize(o);return u.x>=h.x&&u.x<h.x+g.x&&u.y<h.y+g.y&&u.y>=h.y},getMousePosition:function(o){if(typeof o.pageX=="number")e.getMousePosition=function(u){var h=new e.Point;return h.x=u.pageX,h.y=u.pageY,h};else if(typeof o.clientX=="number")e.getMousePosition=function(u){var h=new e.Point;return h.x=u.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,h.y=u.clientY+document.body.scrollTop+document.documentElement.scrollTop,h};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(o)},getPageScroll:function(){var o=document.documentElement||{},u=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(u.scrollLeft||u.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(o.scrollLeft||o.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(o){if(typeof window.scrollTo<"u")e.setPageScroll=function(g){window.scrollTo(g.x,g.y)};else{var u=e.getPageScroll();if(u.x===o.x&&u.y===o.y)return;document.body.scrollLeft=o.x,document.body.scrollTop=o.y;var h=e.getPageScroll();if(h.x!==u.x&&h.y!==u.y){e.setPageScroll=function(g){document.body.scrollLeft=g.x,document.body.scrollTop=g.y};return}if(document.documentElement.scrollLeft=o.x,document.documentElement.scrollTop=o.y,h=e.getPageScroll(),h.x!==u.x&&h.y!==u.y){e.setPageScroll=function(g){document.documentElement.scrollLeft=g.x,document.documentElement.scrollTop=g.y};return}e.setPageScroll=function(g){}}e.setPageScroll(o)},getWindowSize:function(){var o=document.documentElement||{},u=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(o.clientWidth||o.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(u.clientWidth||u.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(o){o=e.getElement(o);var u=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(u[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(u[1].style,{display:"table-row"}),e.extend(u[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),u[0].appendChild(u[1]),u[1].appendChild(u[2]),u[2].appendChild(o),u[0]},makeNeutralElement:function(o){var u=document.createElement(o),h=u.style;return h.background="transparent none",h.border="none",h.margin="0px",h.padding="0px",h.position="static",u},now:function(){return Date.now?e.now=Date.now:e.now=function(){return new Date().getTime()},e.now()},makeTransparentImage:function(o){var u=e.makeNeutralElement("img");return u.src=o,u},setElementOpacity:function(o,u,h){var g,m;o=e.getElement(o),h&&!e.Browser.alpha&&(u=Math.round(u)),e.Browser.opacity?o.style.opacity=u<1?u:"":u<1?(g=Math.round(100*u),m="alpha(opacity="+g+")",o.style.filter=m):o.style.filter=""},setElementTouchActionNone:function(o){o=e.getElement(o),typeof o.style.touchAction<"u"?o.style.touchAction="none":typeof o.style.msTouchAction<"u"&&(o.style.msTouchAction="none")},setElementPointerEvents:function(o,u){o=e.getElement(o),typeof o.style.pointerEvents<"u"&&(o.style.pointerEvents=u)},setElementPointerEventsNone:function(o){e.setElementPointerEvents(o,"none")},addClass:function(o,u){o=e.getElement(o),o.className?(" "+o.className+" ").indexOf(" "+u+" ")===-1&&(o.className+=" "+u):o.className=u},indexOf:function(o,u,h){return Array.prototype.indexOf?this.indexOf=function(g,m,T){return g.indexOf(m,T)}:this.indexOf=function(g,m,T){var x,S=T||0,P;if(!g)throw new TypeError;if(P=g.length,P===0||S>=P)return-1;for(S<0&&(S=P-Math.abs(S)),x=S;x<P;x++)if(g[x]===m)return x;return-1},this.indexOf(o,u,h)},removeClass:function(o,u){var h,g=[],m;for(o=e.getElement(o),h=o.className.split(/\s+/),m=0;m<h.length;m++)h[m]&&h[m]!==u&&g.push(h[m]);o.className=g.join(" ")},normalizeEventListenerOptions:function(o){var u;return typeof o<"u"?typeof o=="boolean"?u=e.supportsEventListenerOptions?{capture:o}:o:u=e.supportsEventListenerOptions?o:typeof o.capture<"u"?o.capture:!1:u=e.supportsEventListenerOptions?{capture:!1}:!1,u},addEvent:function(){if(e.supportsAddEventListener)return function(o,u,h,g){g=e.normalizeEventListenerOptions(g),o=e.getElement(o),o.addEventListener(u,h,g)};if(document.documentElement.attachEvent&&document.attachEvent)return function(o,u,h){o=e.getElement(o),o.attachEvent("on"+u,h)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(o,u,h,g){g=e.normalizeEventListenerOptions(g),o=e.getElement(o),o.removeEventListener(u,h,g)};if(document.documentElement.detachEvent&&document.detachEvent)return function(o,u,h){o=e.getElement(o),o.detachEvent("on"+u,h)};throw new Error("No known event model.")}(),cancelEvent:function(o){o.preventDefault()},eventIsCanceled:function(o){return o.defaultPrevented},stopEvent:function(o){o.stopPropagation()},createCallback:function(o,u){var h=[],g;for(g=2;g<arguments.length;g++)h.push(arguments[g]);return function(){var m=h.concat([]),T;for(T=0;T<arguments.length;T++)m.push(arguments[T]);return u.apply(o,m)}},getUrlParameter:function(o){var u=l[o];return u||null},getUrlProtocol:function(o){var u=o.match(/^([a-z]+:)\/\//i);return u===null?window.location.protocol:u[1].toLowerCase()},createAjaxRequest:function(o){var u;try{u=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{u=!1}if(u)window.XMLHttpRequest?e.createAjaxRequest=function(h){return h?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:e.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return e.createAjaxRequest(o)},makeAjaxRequest:function(o,u,h){var g,m,T;e.isPlainObject(o)&&(u=o.success,h=o.error,g=o.withCredentials,m=o.headers,T=o.responseType||null,o=o.url);var x=e.getUrlProtocol(o),S=e.createAjaxRequest(x==="file:");if(!e.isFunction(u))throw new Error("makeAjaxRequest requires a success callback");S.onreadystatechange=function(){S.readyState===4&&(S.onreadystatechange=function(){},S.status>=200&&S.status<300||S.status===0&&x!=="http:"&&x!=="https:"?u(S):(e.console.log("AJAX request returned %d: %s",S.status,o),e.isFunction(h)&&h(S)))};try{if(S.open("GET",o,!0),T&&(S.responseType=T),m)for(var P in m)Object.prototype.hasOwnProperty.call(m,P)&&m[P]&&S.setRequestHeader(P,m[P]);g&&(S.withCredentials=!0),S.send(null)}catch(D){e.console.log("%s while making AJAX request: %s",D.name,D.message),S.onreadystatechange=function(){},e.isFunction(h)&&h(S,D)}return S},jsonp:function(o){var u,h=o.url,g=document.head||document.getElementsByTagName("head")[0]||document.documentElement,m=o.callbackName||"openseadragon"+e.now(),T=window[m],x="$1"+m+"$2",S=o.param||"callback",P=o.callback;h=h.replace(/(=)\?(&|$)|\?\?/i,x),h+=(/\?/.test(h)?"&":"?")+S+"="+m,window[m]=function(D){if(T)window[m]=T;else try{delete window[m]}catch{}P&&e.isFunction(P)&&P(D)},u=document.createElement("script"),(o.async!==void 0||o.async!==!1)&&(u.async="async"),o.scriptCharset&&(u.charset=o.scriptCharset),u.src=h,u.onload=u.onreadystatechange=function(D,d){(d||!u.readyState||/loaded|complete/.test(u.readyState))&&(u.onload=u.onreadystatechange=null,g&&u.parentNode&&g.removeChild(u),u=void 0)},g.insertBefore(u,g.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(o){if(window.DOMParser)e.parseXml=function(u){var h=null,g;return g=new DOMParser,h=g.parseFromString(u,"text/xml"),h};else if(window.ActiveXObject)e.parseXml=function(u){var h=null;return h=new ActiveXObject("Microsoft.XMLDOM"),h.async=!1,h.loadXML(u),h};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(o)},parseJSON:function(o){return e.parseJSON=window.JSON.parse,e.parseJSON(o)},imageFormatSupported:function(o){return o=o||"",!!r[o.toLowerCase()]},setImageFormatsSupported:function(o){e.extend(r,o)}});var n=function(o){};e.console=window.console||{log:n,debug:n,info:n,warn:n,error:n,assert:n},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var r={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},l={};(function(){var o=navigator.appVersion,u=navigator.userAgent,h;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(u.substring(u.indexOf("MSIE")+5,u.indexOf(";",u.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(u.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(u.substring(u.indexOf("Edge")+5))):u.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(u.substring(u.indexOf("Edg")+4))):u.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(u.substring(u.indexOf("Firefox")+8))):u.indexOf("Safari")>=0?(e.Browser.vendor=u.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(u.substring(u.substring(0,u.indexOf("Safari")).lastIndexOf("/")+1,u.indexOf("Safari")))):(h=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),h.exec(u)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(o);break}var g=window.location.search.substring(1),m=g.split("&"),T,x,S;for(S=0;S<m.length;S++)if(T=m[S],x=T.indexOf("="),x>0){var P=T.substring(0,x),D=T.substring(x+1);try{l[P]=decodeURIComponent(D)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",P,D)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(o){var u=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,h=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame;if(u&&h)e.requestAnimationFrame=function(){return u.apply(o,arguments)},e.cancelAnimationFrame=function(){return h.apply(o,arguments)};else{var g=[],m=[],T=0,x;e.requestAnimationFrame=function(S){return g.push([++T,S]),x||(x=setInterval(function(){if(g.length){var P=e.now(),D=m;for(m=g,g=D;m.length;)m.shift()[1](P)}else clearInterval(x),x=void 0},1e3/50)),T},e.cancelAnimationFrame=function(S){var P,D;for(P=0,D=g.length;P<D;P+=1)if(g[P][0]===S){g.splice(P,1);return}for(P=0,D=m.length;P<D;P+=1)if(m[P][0]===S){m.splice(P,1);return}}}}(window);function a(o,u){return u&&o!==document.body?document.body:o.offsetParent}}(s),function(e,i){t.exports?t.exports=i():e.OpenSeadragon=i()}(vn,function(){return s}),function(e){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(n){return n.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(n){return n.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(n){return n.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},e.extend(e,i)}(s),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(i,n,r,l){var a=this;l=l||1;var o=0,u=function(h){o++,o===l&&a.removeHandler(i,u),n(h)};this.addHandler(i,u,r)},addHandler:function(i,n,r){var l=this.events[i];l||(this.events[i]=l=[]),n&&e.isFunction(n)&&(l[l.length]={handler:n,userData:r||null})},removeHandler:function(i,n){var r=this.events[i],l=[],a;if(r&&e.isArray(r)){for(a=0;a<r.length;a++)r[a].handler!==n&&l.push(r[a]);this.events[i]=l}},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var n in this.events)this.events[n]=[]},getHandler:function(i){var n=this.events[i];return!n||!n.length?null:(n=n.length===1?[n[0]]:Array.apply(null,n),function(r,l){var a,o=n.length;for(a=0;a<o;a++)n[a]&&(l.eventSource=r,l.userData=n[a].userData,n[a].handler(l))})},raiseEvent:function(i,n){var r=this.getHandler(i);r&&(n||(n={}),r(this,n))}}}(s),function(e){var i={};e.MouseTracker=function(p){var f=arguments;e.isPlainObject(p)||(p={element:f[0],clickTimeThreshold:f[1],clickDistThreshold:f[2]}),this.hash=Math.random(),this.element=e.getElement(p.element),this.clickTimeThreshold=p.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=p.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=p.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=p.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=p.userData||null,this.stopDelay=p.stopDelay||50,this.preProcessEventHandler=p.preProcessEventHandler||null,this.contextMenuHandler=p.contextMenuHandler||null,this.enterHandler=p.enterHandler||null,this.leaveHandler=p.leaveHandler||null,this.exitHandler=p.exitHandler||null,this.overHandler=p.overHandler||null,this.outHandler=p.outHandler||null,this.pressHandler=p.pressHandler||null,this.nonPrimaryPressHandler=p.nonPrimaryPressHandler||null,this.releaseHandler=p.releaseHandler||null,this.nonPrimaryReleaseHandler=p.nonPrimaryReleaseHandler||null,this.moveHandler=p.moveHandler||null,this.scrollHandler=p.scrollHandler||null,this.clickHandler=p.clickHandler||null,this.dblClickHandler=p.dblClickHandler||null,this.dragHandler=p.dragHandler||null,this.dragEndHandler=p.dragEndHandler||null,this.pinchHandler=p.pinchHandler||null,this.stopHandler=p.stopHandler||null,this.keyDownHandler=p.keyDownHandler||null,this.keyUpHandler=p.keyUpHandler||null,this.keyHandler=p.keyHandler||null,this.focusHandler=p.focusHandler||null,this.blurHandler=p.blurHandler||null;var y=this;i[this.hash]={click:function(w){_(y,w)},dblclick:function(w){L(y,w)},keydown:function(w){H(y,w)},keyup:function(w){M(y,w)},keypress:function(w){V(y,w)},focus:function(w){G(y,w)},blur:function(w){Z(y,w)},contextmenu:function(w){$(y,w)},wheel:function(w){se(y,w)},mousewheel:function(w){J(y,w)},DOMMouseScroll:function(w){J(y,w)},MozMousePixelScroll:function(w){J(y,w)},losecapture:function(w){ue(y,w)},mouseenter:function(w){ht(y,w)},mouseleave:function(w){tt(y,w)},mouseover:function(w){St(y,w)},mouseout:function(w){Ae(y,w)},mousedown:function(w){Qe(y,w)},mouseup:function(w){it(y,w)},mousemove:function(w){nt(y,w)},touchstart:function(w){ve(y,w)},touchend:function(w){le(y,w)},touchmove:function(w){re(y,w)},touchcancel:function(w){ee(y,w)},gesturestart:function(w){ye(y,w)},gesturechange:function(w){Y(y,w)},gotpointercapture:function(w){Pe(y,w)},lostpointercapture:function(w){Fe(y,w)},pointerenter:function(w){ht(y,w)},pointerleave:function(w){tt(y,w)},pointerover:function(w){St(y,w)},pointerout:function(w){Ae(y,w)},pointerdown:function(w){Qe(y,w)},pointerup:function(w){it(y,w)},pointermove:function(w){nt(y,w)},pointercancel:function(w){c(y,w)},pointerupcaptured:function(w){Pt(y,w)},pointermovecaptured:function(w){dt(y,w)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),p.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){o(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(p){return p?a(this):o(this),this},getActivePointersListByType:function(p){var f=i[this.hash],y,w=f.activePointersLists.length,B;for(y=0;y<w;y++)if(f.activePointersLists[y].type===p)return f.activePointersLists[y];return B=new e.MouseTracker.GesturePointList(p),f.activePointersLists.push(B),B},getActivePointerCount:function(){var p=i[this.hash],f,y=p.activePointersLists.length,w=0;for(f=0;f<y;f++)w+=p.activePointersLists[f].getLength();return w},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var n=function(){try{return window.self!==window.top}catch{return!0}}();function r(p){try{return p.addEventListener&&p.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=function(){var p=[],f=0,y=0,w=function(he,Q){return he.hash.toString()+Q.type+Q.id.toString()},B=function(){var he,Q=p.length,He,Ce,Ct=e.now(),Tn,xn,bn;for(Tn=Ct-y,y=Ct,he=0;he<Q;he++)He=p[he],Ce=He.gPoint,Ce.direction=Math.atan2(Ce.currentPos.y-He.lastPos.y,Ce.currentPos.x-He.lastPos.x),xn=He.lastPos.distanceTo(Ce.currentPos),He.lastPos=Ce.currentPos,bn=1e3*xn/(Tn+1),Ce.speed=.75*bn+.25*Ce.speed},W=function(he,Q){var He=w(he,Q);p.push({guid:He,gPoint:Q,lastPos:Q.currentPos}),p.length===1&&(y=e.now(),f=window.setInterval(B,50))},ne=function(he,Q){var He=w(he,Q),Ce,Ct=p.length;for(Ce=0;Ce<Ct;Ce++)if(p[Ce].guid===He){p.splice(Ce,1),Ct--,Ct===0&&window.clearInterval(f);break}};return{addPoint:W,removePoint:ne}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=function(){var p=document.createElement("div");return e.isFunction(p.setPointerCapture)&&e.isFunction(p.releasePointerCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var p=document.createElement("div");return e.isFunction(p.setCapture)&&e.isFunction(p.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(p){this._gPoints=[],this.type=p,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(p){return this._gPoints.push(p)},removeById:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].id===p){this._gPoints.splice(f,1);break}return this._gPoints.length},getByIndex:function(p){return p<this._gPoints.length?this._gPoints[p]:null},getById:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].id===p)return this._gPoints[f];return null},getPrimary:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].isPrimary)return this._gPoints[f];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(e.console.warn("GesturePointList.removeContact() Implausible contacts value"),this.contacts=0)}};function l(p){var f=i[p.hash],y,w,B,W,ne,he=f.activePointersLists.length;for(y=0;y<he;y++)if(B=f.activePointersLists[y],B.getLength()>0){for(ne=[],W=B.asArray(),w=0;w<W.length;w++)ne.push(W[w]);for(w=0;w<ne.length;w++)b(p,B,ne[w])}for(y=0;y<he;y++)f.activePointersLists.pop();f.sentDragEvent=!1}function a(p){var f=i[p.hash],y,w;if(!f.tracking){for(w=0;w<e.MouseTracker.subscribeEvents.length;w++)y=e.MouseTracker.subscribeEvents[w],e.addEvent(p.element,y,f[y],y===e.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);l(p),f.tracking=!0}}function o(p){var f=i[p.hash],y,w;if(f.tracking){for(w=0;w<e.MouseTracker.subscribeEvents.length;w++)y=e.MouseTracker.subscribeEvents[w],e.removeEvent(p.element,y,f[y],!1);l(p),f.tracking=!1}}function u(p,f){var y=i[p.hash];if(f==="pointerevent")return{upName:"pointerup",upHandler:y.pointerupcaptured,moveName:"pointermove",moveHandler:y.pointermovecaptured};if(f==="mouse")return{upName:"pointerup",upHandler:y.pointerupcaptured,moveName:"pointermove",moveHandler:y.pointermovecaptured};if(f==="touch")return{upName:"touchend",upHandler:y.touchendcaptured,moveName:"touchmove",moveHandler:y.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function h(p,f){var y;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{p.element.setPointerCapture(f.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else p.element.setCapture(!0);else y=u(p,e.MouseTracker.havePointerEvents?"pointerevent":f.type),n&&r(window.top)&&e.addEvent(window.top,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0);I(p,f,!0)}function g(p,f){var y,w,B;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(w=p.getActivePointersListByType(f.type),B=w.getById(f.id),!B||!B.captured)return;try{p.element.releasePointerCapture(f.id)}catch{}}else p.element.releaseCapture();else y=u(p,e.MouseTracker.havePointerEvents?"pointerevent":f.type),n&&r(window.top)&&e.removeEvent(window.top,y.upName,y.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0);I(p,f,!1)}function m(p){return e.MouseTracker.havePointerEvents?p.pointerId:e.MouseTracker.mousePointerId}function T(p){return e.MouseTracker.havePointerEvents?p.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function x(p){return e.MouseTracker.havePointerEvents?p.isPrimary:!0}function S(p){return e.getMousePosition(p)}function P(p,f){return D(S(p),f)}function D(p,f){var y=e.getElementOffset(f);return p.minus(y)}function d(p,f){return new e.Point((p.x+f.x)/2,(p.y+f.y)/2)}function _(p,f){var y={originalEvent:f,eventType:"click",pointerType:"mouse",isEmulated:!1};C(p,y),y.preventDefault&&!y.defaultPrevented&&e.cancelEvent(f),y.stopPropagation&&e.stopEvent(f)}function L(p,f){var y={originalEvent:f,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};C(p,y),y.preventDefault&&!y.defaultPrevented&&e.cancelEvent(f),y.stopPropagation&&e.stopEvent(f)}function H(p,f){var y=null,w={originalEvent:f,eventType:"keydown",pointerType:"",isEmulated:!1};C(p,w),p.keyDownHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.keyDownHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function M(p,f){var y=null,w={originalEvent:f,eventType:"keyup",pointerType:"",isEmulated:!1};C(p,w),p.keyUpHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.keyUpHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function V(p,f){var y=null,w={originalEvent:f,eventType:"keypress",pointerType:"",isEmulated:!1};C(p,w),p.keyHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.keyHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function G(p,f){var y={originalEvent:f,eventType:"focus",pointerType:"",isEmulated:!1};C(p,y),p.focusHandler&&!y.preventGesture&&p.focusHandler({eventSource:p,originalEvent:f,userData:p.userData})}function Z(p,f){var y={originalEvent:f,eventType:"blur",pointerType:"",isEmulated:!1};C(p,y),p.blurHandler&&!y.preventGesture&&p.blurHandler({eventSource:p,originalEvent:f,userData:p.userData})}function $(p,f){var y=null,w={originalEvent:f,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};C(p,w),p.contextMenuHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,position:D(S(f),p.element),originalEvent:w.originalEvent,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.contextMenuHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function se(p,f){fe(p,f,f)}function J(p,f){var y={target:f.target||f.srcElement,type:"wheel",shiftKey:f.shiftKey||!1,clientX:f.clientX,clientY:f.clientY,pageX:f.pageX?f.pageX:f.clientX,pageY:f.pageY?f.pageY:f.clientY,deltaMode:f.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?y.deltaY=-f.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:y.deltaY=f.detail,fe(p,y,f)}function fe(p,f,y){var w=0,B,W=null;w=f.deltaY<0?1:-1,B={originalEvent:f,eventType:"wheel",pointerType:"mouse",isEmulated:f!==y},C(p,B),p.scrollHandler&&!B.preventGesture&&!B.defaultPrevented&&(W={eventSource:p,pointerType:"mouse",position:P(f,p.element),scroll:w,shift:f.shiftKey,isTouchEvent:!1,originalEvent:y,preventDefault:B.preventDefault||B.defaultPrevented,userData:p.userData},p.scrollHandler(W)),B.stopPropagation&&e.stopEvent(y),(W&&W.preventDefault||B.preventDefault&&!B.defaultPrevented)&&e.cancelEvent(y)}function ue(p,f){var y={id:e.MouseTracker.mousePointerId,type:"mouse"},w={originalEvent:f,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};C(p,w),f.target===p.element&&I(p,y,!1),w.stopPropagation&&e.stopEvent(f)}function ve(p,f){var y,w,B=f.changedTouches.length,W,ne=p.getActivePointersListByType("touch");y=e.now(),ne.getLength()>f.touches.length-B&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var he={originalEvent:f,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(C(p,he),w=0;w<B;w++)W={id:f.changedTouches[w].identifier,type:"touch",isPrimary:ne.getLength()===0,currentPos:S(f.changedTouches[w]),currentTime:y},k(p,he,W),j(p,he,W,0),I(p,W,!0);he.preventDefault&&!he.defaultPrevented&&e.cancelEvent(f),he.stopPropagation&&e.stopEvent(f)}function le(p,f){var y,w,B=f.changedTouches.length,W;y=e.now();var ne={originalEvent:f,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(C(p,ne),w=0;w<B;w++)W={id:f.changedTouches[w].identifier,type:"touch",currentPos:S(f.changedTouches[w]),currentTime:y},X(p,ne,W,0),I(p,W,!1),N(p,ne,W);ne.preventDefault&&!ne.defaultPrevented&&e.cancelEvent(f),ne.stopPropagation&&e.stopEvent(f)}function re(p,f){var y,w,B=f.changedTouches.length,W;y=e.now();var ne={originalEvent:f,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(C(p,ne),w=0;w<B;w++)W={id:f.changedTouches[w].identifier,type:"touch",currentPos:S(f.changedTouches[w]),currentTime:y},K(p,ne,W);ne.preventDefault&&!ne.defaultPrevented&&e.cancelEvent(f),ne.stopPropagation&&e.stopEvent(f)}function ee(p,f){var y=f.changedTouches.length,w,B,W={originalEvent:f,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(C(p,W),w=0;w<y;w++)B={id:f.changedTouches[w].identifier,type:"touch"},te(p,W,B);W.stopPropagation&&e.stopEvent(f)}function ye(p,f){return e.eventIsCanceled(f)||f.preventDefault(),!1}function Y(p,f){return e.eventIsCanceled(f)||f.preventDefault(),!1}function Pe(p,f){var y={originalEvent:f,eventType:"gotpointercapture",pointerType:T(f),isEmulated:!1};C(p,y),f.target===p.element&&I(p,{id:f.pointerId,type:T(f)},!0),y.stopPropagation&&e.stopEvent(f)}function Fe(p,f){var y={originalEvent:f,eventType:"lostpointercapture",pointerType:T(f),isEmulated:!1};C(p,y),f.target===p.element&&I(p,{id:f.pointerId,type:T(f)},!1),y.stopPropagation&&e.stopEvent(f)}function ht(p,f){var y={id:m(f),type:T(f),isPrimary:x(f),currentPos:S(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerenter",pointerType:y.type,isEmulated:!1};C(p,w),k(p,w,y)}function tt(p,f){var y={id:m(f),type:T(f),isPrimary:x(f),currentPos:S(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerleave",pointerType:y.type,isEmulated:!1};C(p,w),N(p,w,y)}function St(p,f){var y={id:m(f),type:T(f),isPrimary:x(f),currentPos:S(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerover",pointerType:y.type,isEmulated:!1};C(p,w),z(p,w,y),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function Ae(p,f){var y={id:m(f),type:T(f),isPrimary:x(f),currentPos:S(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerout",pointerType:y.type,isEmulated:!1};C(p,w),U(p,w,y),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function Qe(p,f){var y={id:m(f),type:T(f),isPrimary:x(f),currentPos:S(f),currentTime:e.now()},w=e.MouseTracker.havePointerEvents&&y.type==="touch"&&e.Browser.vendor!==e.BROWSERS.IE,B={originalEvent:f,eventType:"pointerdown",pointerType:y.type,isEmulated:!1};C(p,B),j(p,B,y,f.button),B.preventDefault&&!B.defaultPrevented&&e.cancelEvent(f),B.stopPropagation&&e.stopEvent(f),B.shouldCapture&&(w?I(p,y,!0):h(p,y))}function it(p,f){Ue(p,f)}function Pt(p,f){var y=p.getActivePointersListByType(T(f));y.getById(f.pointerId)&&Ue(p,f),e.stopEvent(f)}function Ue(p,f){var y;y={id:m(f),type:T(f),isPrimary:x(f),currentPos:S(f),currentTime:e.now()};var w={originalEvent:f,eventType:"pointerup",pointerType:y.type,isEmulated:!1};C(p,w),X(p,w,y,f.button),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f),w.shouldReleaseCapture&&(f.target===p.element?g(p,y):I(p,y,!1))}function nt(p,f){E(p,f)}function dt(p,f){var y=p.getActivePointersListByType(T(f));y.getById(f.pointerId)&&E(p,f),e.stopEvent(f)}function E(p,f){var y={id:m(f),type:T(f),isPrimary:x(f),currentPos:S(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointermove",pointerType:y.type,isEmulated:!1};C(p,w),K(p,w,y),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function c(p,f){var y={id:f.pointerId,type:T(f)},w={originalEvent:f,eventType:"pointercancel",pointerType:y.type,isEmulated:!1};C(p,w),te(p,w,y),w.stopPropagation&&e.stopEvent(f)}function v(p,f){return f.speed=0,f.direction=0,f.contactPos=f.currentPos,f.contactTime=f.currentTime,f.lastPos=f.currentPos,f.lastTime=f.currentTime,p.add(f)}function b(p,f,y){var w,B=f.getById(y.id);return B?(B.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),g(p,B)),(f.type==="mouse"||f.type==="pen")&&f.contacts>0&&f.removeContact(),w=f.removeById(y.id)):w=f.getLength(),w}function R(p,f){switch(f.eventType){case"pointermove":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break;case"pointerdown":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"pointerup":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"wheel":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasScrollHandler,f.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":f.isStoppable=!0,f.isCancelable=!1,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break;case"click":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!!p.clickHandler,f.preventGesture=!1,f.stopPropagation=!1;break;case"dblclick":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!!p.dblClickHandler,f.preventGesture=!1,f.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:f.isStoppable=!1,f.isCancelable=!1,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break}}function C(p,f){f.eventSource=p,f.eventPhase=f.originalEvent&&typeof f.originalEvent.eventPhase<"u"?f.originalEvent.eventPhase:0,f.defaultPrevented=e.eventIsCanceled(f.originalEvent),f.shouldCapture=!1,f.shouldReleaseCapture=!1,f.userData=p.userData,R(p,f),p.preProcessEventHandler&&p.preProcessEventHandler(f)}function I(p,f,y){var w=p.getActivePointersListByType(f.type),B=w.getById(f.id);B?y&&!B.captured?(B.captured=!0,w.captureCount++):!y&&B.captured&&(B.captured=!1,w.captureCount--,w.captureCount<0&&(w.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function k(p,f,y){var w=p.getActivePointersListByType(y.type),B;B=w.getById(y.id),B?(B.insideElement=!0,B.lastPos=B.currentPos,B.lastTime=B.currentTime,B.currentPos=y.currentPos,B.currentTime=y.currentTime,y=B):(y.captured=!1,y.insideElementPressed=!1,y.insideElement=!0,v(w,y)),p.enterHandler&&p.enterHandler({eventSource:p,pointerType:y.type,position:D(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function N(p,f,y){var w=p.getActivePointersListByType(y.type),B,W;B=w.getById(y.id),B?(B.captured?(B.insideElement=!1,B.lastPos=B.currentPos,B.lastTime=B.currentTime,B.currentPos=y.currentPos,B.currentTime=y.currentTime):b(p,w,B),y=B):(y.captured=!1,y.insideElementPressed=!1),(p.leaveHandler||p.exitHandler)&&(W={eventSource:p,pointerType:y.type,position:y.currentPos&&D(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData},p.leaveHandler&&p.leaveHandler(W),p.exitHandler&&p.exitHandler(W))}function z(p,f,y){var w,B;w=p.getActivePointersListByType(y.type),B=w.getById(y.id),B?y=B:(y.captured=!1,y.insideElementPressed=!1),p.overHandler&&p.overHandler({eventSource:p,pointerType:y.type,position:D(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function U(p,f,y){var w,B;w=p.getActivePointersListByType(y.type),B=w.getById(y.id),B?y=B:(y.captured=!1,y.insideElementPressed=!1),p.outHandler&&p.outHandler({eventSource:p,pointerType:y.type,position:y.currentPos&&D(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function j(p,f,y,w){var B=i[p.hash],W=p.getActivePointersListByType(y.type),ne;if(typeof f.originalEvent.buttons<"u"?W.buttons=f.originalEvent.buttons:w===0?W.buttons|=1:w===1?W.buttons|=4:w===2?W.buttons|=2:w===3?W.buttons|=8:w===4?W.buttons|=16:w===5&&(W.buttons|=32),w!==0){f.shouldCapture=!1,f.shouldReleaseCapture=!1,p.nonPrimaryPressHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,p.nonPrimaryPressHandler({eventSource:p,pointerType:y.type,position:D(y.currentPos,p.element),button:w,buttons:W.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}));return}if(ne=W.getById(y.id),ne)ne.insideElementPressed=!0,ne.insideElement=!0,ne.originalTarget=f.originalEvent.target,ne.contactPos=y.currentPos,ne.contactTime=y.currentTime,ne.lastPos=ne.currentPos,ne.lastTime=ne.currentTime,ne.currentPos=y.currentPos,ne.currentTime=y.currentTime,y=ne;else{e.console.warn("pointerdown event on untracked pointer"),y.captured=!1,y.insideElementPressed=!0,y.insideElement=!0,y.originalTarget=f.originalEvent.target,v(W,y);return}W.addContact(),!f.preventGesture&&!f.defaultPrevented?(f.shouldCapture=!0,f.shouldReleaseCapture=!1,f.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(p,y),W.contacts===1?p.pressHandler&&!f.preventGesture&&p.pressHandler({eventSource:p,pointerType:y.type,position:D(y.contactPos,p.element),buttons:W.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}):W.contacts===2&&p.pinchHandler&&y.type==="touch"&&(B.pinchGPoints=W.asArray(),B.lastPinchDist=B.currentPinchDist=B.pinchGPoints[0].currentPos.distanceTo(B.pinchGPoints[1].currentPos),B.lastPinchCenter=B.currentPinchCenter=d(B.pinchGPoints[0].currentPos,B.pinchGPoints[1].currentPos))):(f.shouldCapture=!1,f.shouldReleaseCapture=!1)}function X(p,f,y,w){var B=i[p.hash],W=p.getActivePointersListByType(y.type),ne,he,Q,He=!1,Ce;if(typeof f.originalEvent.buttons<"u"?W.buttons=f.originalEvent.buttons:w===0?W.buttons^=-2:w===1?W.buttons^=-5:w===2?W.buttons^=-3:w===3?W.buttons^=-9:w===4?W.buttons^=-17:w===5&&(W.buttons^=-33),f.shouldCapture=!1,w!==0){f.shouldReleaseCapture=!1,p.nonPrimaryReleaseHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,p.nonPrimaryReleaseHandler({eventSource:p,pointerType:y.type,position:D(y.currentPos,p.element),button:w,buttons:W.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}));return}Q=W.getById(y.id),Q?(W.removeContact(),Q.captured&&(He=!0),Q.lastPos=Q.currentPos,Q.lastTime=Q.currentTime,Q.currentPos=y.currentPos,Q.currentTime=y.currentTime,Q.insideElement||b(p,W,Q),ne=Q.currentPos,he=Q.currentTime):(e.console.warn("updatePointerUp(): pointerup on untracked gPoint"),y.captured=!1,y.insideElementPressed=!1,y.insideElement=!0,v(W,y),Q=y),!f.preventGesture&&!f.defaultPrevented&&(He?(f.shouldReleaseCapture=!0,f.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(p,Q),W.contacts===0?(p.releaseHandler&&p.releaseHandler({eventSource:p,pointerType:Q.type,position:D(ne,p.element),buttons:W.buttons,insideElementPressed:Q.insideElementPressed,insideElementReleased:Q.insideElement,isTouchEvent:Q.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),p.dragEndHandler&&B.sentDragEvent&&p.dragEndHandler({eventSource:p,pointerType:Q.type,position:D(Q.currentPos,p.element),speed:Q.speed,direction:Q.direction,shift:f.originalEvent.shiftKey,isTouchEvent:Q.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),B.sentDragEvent=!1,(p.clickHandler||p.dblClickHandler)&&Q.insideElement&&(Ce=he-Q.contactTime<=p.clickTimeThreshold&&Q.contactPos.distanceTo(ne)<=p.clickDistThreshold,p.clickHandler&&p.clickHandler({eventSource:p,pointerType:Q.type,position:D(Q.currentPos,p.element),quick:Ce,shift:f.originalEvent.shiftKey,isTouchEvent:Q.type==="touch",originalEvent:f.originalEvent,originalTarget:Q.originalTarget,userData:p.userData}),p.dblClickHandler&&Ce&&(W.clicks++,W.clicks===1?(B.lastClickPos=ne,B.dblClickTimeOut=setTimeout(function(){W.clicks=0},p.dblClickTimeThreshold)):W.clicks===2&&(clearTimeout(B.dblClickTimeOut),W.clicks=0,B.lastClickPos.distanceTo(ne)<=p.dblClickDistThreshold&&p.dblClickHandler({eventSource:p,pointerType:Q.type,position:D(Q.currentPos,p.element),shift:f.originalEvent.shiftKey,isTouchEvent:Q.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),B.lastClickPos=null)))):W.contacts===2&&p.pinchHandler&&Q.type==="touch"&&(B.pinchGPoints=W.asArray(),B.lastPinchDist=B.currentPinchDist=B.pinchGPoints[0].currentPos.distanceTo(B.pinchGPoints[1].currentPos),B.lastPinchCenter=B.currentPinchCenter=d(B.pinchGPoints[0].currentPos,B.pinchGPoints[1].currentPos))):(f.shouldReleaseCapture=!1,p.releaseHandler&&(p.releaseHandler({eventSource:p,pointerType:Q.type,position:D(ne,p.element),buttons:W.buttons,insideElementPressed:Q.insideElementPressed,insideElementReleased:Q.insideElement,isTouchEvent:Q.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0)))}function K(p,f,y){var w=i[p.hash],B=p.getActivePointersListByType(y.type),W,ne,he;if(typeof f.originalEvent.buttons<"u"&&(B.buttons=f.originalEvent.buttons),W=B.getById(y.id),W)W.lastPos=W.currentPos,W.lastTime=W.currentTime,W.currentPos=y.currentPos,W.currentTime=y.currentTime;else return;f.shouldCapture=!1,f.shouldReleaseCapture=!1,p.stopHandler&&y.type==="mouse"&&(clearTimeout(p.stopTimeOut),p.stopTimeOut=setTimeout(function(){ge(p,f.originalEvent,y.type)},p.stopDelay)),B.contacts===0?p.moveHandler&&p.moveHandler({eventSource:p,pointerType:y.type,position:D(y.currentPos,p.element),buttons:B.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}):B.contacts===1?(p.moveHandler&&(W=B.asArray()[0],p.moveHandler({eventSource:p,pointerType:W.type,position:D(W.currentPos,p.element),buttons:B.buttons,isTouchEvent:W.type==="touch",originalEvent:f.originalEvent,userData:p.userData})),p.dragHandler&&!f.preventGesture&&!f.defaultPrevented&&(W=B.asArray()[0],he=W.currentPos.minus(W.lastPos),p.dragHandler({eventSource:p,pointerType:W.type,position:D(W.currentPos,p.element),buttons:B.buttons,delta:he,speed:W.speed,direction:W.direction,shift:f.originalEvent.shiftKey,isTouchEvent:W.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0,w.sentDragEvent=!0)):B.contacts===2&&(p.moveHandler&&(ne=B.asArray(),p.moveHandler({eventSource:p,pointerType:ne[0].type,position:D(d(ne[0].currentPos,ne[1].currentPos),p.element),buttons:B.buttons,isTouchEvent:ne[0].type==="touch",originalEvent:f.originalEvent,userData:p.userData})),p.pinchHandler&&y.type==="touch"&&!f.preventGesture&&!f.defaultPrevented&&(he=w.pinchGPoints[0].currentPos.distanceTo(w.pinchGPoints[1].currentPos),he!==w.currentPinchDist&&(w.lastPinchDist=w.currentPinchDist,w.currentPinchDist=he,w.lastPinchCenter=w.currentPinchCenter,w.currentPinchCenter=d(w.pinchGPoints[0].currentPos,w.pinchGPoints[1].currentPos),p.pinchHandler({eventSource:p,pointerType:"touch",gesturePoints:w.pinchGPoints,lastCenter:D(w.lastPinchCenter,p.element),center:D(w.currentPinchCenter,p.element),lastDistance:w.lastPinchDist,distance:w.currentPinchDist,shift:f.originalEvent.shiftKey,originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0)))}function te(p,f,y){var w=p.getActivePointersListByType(y.type),B;B=w.getById(y.id),B&&b(p,w,B)}function ge(p,f,y){p.stopHandler&&p.stopHandler({eventSource:p,pointerType:y,position:P(f,p.element),buttons:p.getActivePointersListByType(y).buttons,isTouchEvent:y==="touch",originalEvent:f,userData:p.userData})}}(s),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(i,n,r){var l=i.parentNode;typeof n=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=typeof n.attachToViewer>"u"?!0:n.attachToViewer,this.autoFade=typeof n.autoFade>"u"?!0:n.autoFade,this.element=i,this.anchor=n.anchor,this.container=r,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof n.top=="number"?n.top+"px":n.top,this.wrapper.style.left=typeof n.left=="number"?n.left+"px":n.left,this.wrapper.style.height=typeof n.height=="number"?n.height+"px":n.height,this.wrapper.style.width=typeof n.width=="number"?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):l.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?e.setElementOpacity(this.element,i,!0):e.setElementOpacity(this.wrapper,i,!0)}}}(s),function(e){e.ControlDock=function(n){var r=["topleft","topright","bottomright","bottomleft"],l,a;for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},n),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),a=0;a<r.length;a++)l=r[a],this.controls[l]=e.makeNeutralElement("div"),this.controls[l].style.position="absolute",l.match("left")&&(this.controls[l].style.left="0px"),l.match("right")&&(this.controls[l].style.right="0px"),l.match("top")&&(this.controls[l].style.top="0px"),l.match("bottom")&&(this.controls[l].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,r){n=e.getElement(n);var l=null;if(!(i(this,n)>=0)){switch(r.anchor){case e.ControlAnchor.TOP_RIGHT:l=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:l=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:l=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:l=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:l=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case e.ControlAnchor.NONE:l=this.container,n.style.margin="0px",n.style.padding="0px";break}this.controls.push(new e.Control(n,r,l)),n.style.display="inline-block"}},removeControl:function(n){n=e.getElement(n);var r=i(this,n);return r>=0&&(this.controls[r].destroy(),this.controls.splice(r,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var n;for(n=this.controls.length-1;n>=0;n--)if(this.controls[n].isVisible())return!0;return!1},setControlsEnabled:function(n){var r;for(r=this.controls.length-1;r>=0;r--)this.controls[r].setVisible(n);return this}};function i(n,r){var l=n.controls,a;for(a=l.length-1;a>=0;a--)if(l[a].element===r)return a;return-1}}(s),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(s),function(e){var i={},n=1;e.Viewer=function(c){var v=arguments,b=this,R;if(e.isPlainObject(c)||(c={id:v[0],xmlPath:v.length>1?v[1]:void 0,prefixUrl:v.length>2?v[2]:void 0,controls:v.length>3?v[3]:void 0,overlays:v.length>4?v[4]:void 0}),c.config&&(e.extend(!0,c,c.config),delete c.config),e.extend(!0,this,{id:c.id,hash:c.hash||n++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,c),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&e.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(C){var I=e.getString("Errors.OpenFailed",C.eventSource,C.message);b._showMessage(I)}),e.ControlDock.call(this,c),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(C){C.width="100%",C.height="100%",C.overflow="hidden",C.position="absolute",C.top="0px",C.left="0px"}(this.canvas.style),e.setElementTouchActionNone(this.canvas),c.tabIndex!==""&&(this.canvas.tabIndex=c.tabIndex===void 0?0:c.tabIndex),this.container.className="openseadragon-container",function(C){C.width="100%",C.height="100%",C.position="relative",C.overflow="hidden",C.left="0px",C.top="0px",C.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,P),keyDownHandler:e.delegate(this,D),keyHandler:e.delegate(this,d),clickHandler:e.delegate(this,_),dblClickHandler:e.delegate(this,L),dragHandler:e.delegate(this,H),dragEndHandler:e.delegate(this,M),enterHandler:e.delegate(this,V),leaveHandler:e.delegate(this,G),pressHandler:e.delegate(this,Z),releaseHandler:e.delegate(this,$),nonPrimaryPressHandler:e.delegate(this,se),nonPrimaryReleaseHandler:e.delegate(this,J),scrollHandler:e.delegate(this,ue),pinchHandler:e.delegate(this,fe)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,ve),leaveHandler:e.delegate(this,le)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=r(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(C){b.source=b.world.getItemAt(0).source,i[b.hash].forceRedraw=!0,b._updateRequestId||(b._updateRequestId=u(b,re))}),this.world.addHandler("remove-item",function(C){b.world.getItemCount()?b.source=b.world.getItemAt(0).source:b.source=null,i[b.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(C){b.viewport&&b.viewport._setContentBounds(b.world.getHomeBounds(),b.world.getContentFactor())}),this.world.addHandler("item-index-change",function(C){b.source=b.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:c.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(R=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(R,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(R=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(R,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),R=0;R<this.customControls.length;R++)this.addControl(this.customControls[R].id,{anchor:this.customControls[R].anchor});e.requestAnimationFrame(function(){g(b)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(c){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(c)},openTileSource:function(c){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(c)},open:function(c,v){var b=this;if(this.close(),!c)return this;if(this.sequenceMode&&e.isArray(c))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof v<"u"&&!isNaN(v)&&(this.initialPage=v),this.tileSources=c,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(c)||(c=[c]),!c.length)return this;this._opening=!0;for(var R=c.length,C=0,I=0,k,N=function(){if(C+I===R)if(C){(b._firstOpen||!b.preserveViewport)&&(b.viewport.goHome(!0),b.viewport.update()),b._firstOpen=!1;var j=c[0];if(j.tileSource&&(j=j.tileSource),b.overlays&&!b.preserveOverlays)for(var X=0;X<b.overlays.length;X++)b.currentOverlays[X]=a(b,b.overlays[X]);b._drawOverlays(),b._opening=!1,b.raiseEvent("open",{source:j})}else b._opening=!1,b.raiseEvent("open-failed",k)},z=function(j){(!e.isPlainObject(j)||!j.tileSource)&&(j={tileSource:j}),j.index!==void 0&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete j.index),j.collectionImmediately===void 0&&(j.collectionImmediately=!0);var X=j.success;j.success=function(te){if(C++,j.tileSource.overlays)for(var ge=0;ge<j.tileSource.overlays.length;ge++)b.addOverlay(j.tileSource.overlays[ge]);X&&X(te),N()};var K=j.error;j.error=function(te){I++,k||(k=te),K&&K(te),N()},b.addTiledImage(j)},U=0;U<c.length;U++)z(c[U]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(c){return this.innerTracker.setTracking(c),this.outerTracker.setTracking(c),this.raiseEvent("mouse-enabled",{enabled:c}),this},areControlsEnabled:function(){var c=this.controls.length,v;for(v=0;v<this.controls.length;v++)c=c&&this.controls[v].isVisible();return c},setControlsEnabled:function(c){return c?T(this):g(this),this.raiseEvent("controls-enabled",{enabled:c}),this},setDebugMode:function(c){for(var v=0;v<this.world.getItemCount();v++)this.world.getItemAt(v).debugMode=c;this.debugMode=c,this.forceRedraw()},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(c){var v=document.body,b=v.style,R=document.documentElement.style,C=this,I,k;if(c===this.isFullPage())return this;var N={fullPage:c,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",N),N.preventDefaultAction)return this;if(c){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=b.margin,this.docMargin=R.margin,b.margin="0",R.margin="0",this.bodyPadding=b.padding,this.docPadding=R.padding,b.padding="0",R.padding="0",this.bodyWidth=b.width,this.docWidth=R.width,b.width="100%",R.width="100%",this.bodyHeight=b.height,this.docHeight=R.height,b.height="100%",R.height="100%",this.bodyDisplay=b.display,b.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,I=v.childNodes.length,k=0;k<I;k++)this.previousBody.push(v.childNodes[0]),v.removeChild(v.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,v.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),v.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,e.delegate(this,ve)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,b.margin=this.bodyMargin,R.margin=this.docMargin,b.padding=this.bodyPadding,R.padding=this.docPadding,b.width=this.bodyWidth,R.width=this.docWidth,b.height=this.bodyHeight,R.height=this.docHeight,b.display=this.bodyDisplay,v.removeChild(this.element),I=this.previousBody.length,k=0;k<I;k++)v.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(v.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var z=0,U=function(){e.setPageScroll(C.pageScroll);var j=e.getPageScroll();z++,z<10&&(j.x!==C.pageScroll.x||j.y!==C.pageScroll.y)&&e.requestAnimationFrame(U)};e.requestAnimationFrame(U),i[this.hash].fullPage=!1,e.delegate(this,le)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:c}),this},setFullScreen:function(c){var v=this;if(!e.supportsFullScreen)return this.setFullPage(c);if(e.isFullScreen()===c)return this;var b={fullScreen:c,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",b),b.preventDefaultAction)return this;if(c){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var R=function(){var C=e.isFullScreen();C||(e.removeEvent(document,e.fullScreenEventName,R),e.removeEvent(document,e.fullScreenErrorEventName,R),v.setFullPage(!1),v.isFullPage()&&(v.element.style.width=v.fullPageStyleWidth,v.element.style.height=v.fullPageStyleHeight)),v.navigator&&v.viewport&&setTimeout(function(){v.navigator.update(v.viewport)}),v.raiseEvent("full-screen",{fullScreen:C})};e.addEvent(document,e.fullScreenEventName,R),e.addEvent(document,e.fullScreenErrorEventName,R),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},setVisible:function(c){return this.container.style.visibility=c?"":"hidden",this.raiseEvent("visible",{visible:c}),this},addTiledImage:function(c){e.console.assert(c,"[Viewer.addTiledImage] options is required"),e.console.assert(c.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!c.replace||c.index>-1&&c.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var v=this;c.replace&&(c.replaceItem=v.world.getItemAt(c.index)),this._hideMessage(),c.placeholderFillStyle===void 0&&(c.placeholderFillStyle=this.placeholderFillStyle),c.opacity===void 0&&(c.opacity=this.opacity),c.preload===void 0&&(c.preload=this.preload),c.compositeOperation===void 0&&(c.compositeOperation=this.compositeOperation),c.crossOriginPolicy===void 0&&(c.crossOriginPolicy=c.tileSource.crossOriginPolicy!==void 0?c.tileSource.crossOriginPolicy:this.crossOriginPolicy),c.ajaxWithCredentials===void 0&&(c.ajaxWithCredentials=this.ajaxWithCredentials),c.loadTilesWithAjax===void 0&&(c.loadTilesWithAjax=this.loadTilesWithAjax),c.ajaxHeaders===void 0||c.ajaxHeaders===null?c.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(c.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(c.ajaxHeaders=e.extend({},this.ajaxHeaders,c.ajaxHeaders));var b={options:c};function R(k){for(var N=0;N<v._loadQueue.length;N++)if(v._loadQueue[N]===b){v._loadQueue.splice(N,1);break}v._loadQueue.length===0&&C(b),v.raiseEvent("add-item-failed",k),c.error&&c.error(k)}function C(k){v.collectionMode&&(v.world.arrange({immediately:k.options.collectionImmediately,rows:v.collectionRows,columns:v.collectionColumns,layout:v.collectionLayout,tileSize:v.collectionTileSize,tileMargin:v.collectionTileMargin}),v.world.setAutoRefigureSizes(!0))}if(e.isArray(c.tileSource)){setTimeout(function(){R({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:c.tileSource,options:c})});return}this._loadQueue.push(b);function I(){for(var k,N,z;v._loadQueue.length&&(k=v._loadQueue[0],!!k.tileSource);){if(v._loadQueue.splice(0,1),k.options.replace){var U=v.world.getIndexOfItem(k.options.replaceItem);U!==-1&&(k.options.index=U),v.world.removeItem(k.options.replaceItem)}N=new e.TiledImage({viewer:v,source:k.tileSource,viewport:v.viewport,drawer:v.drawer,tileCache:v.tileCache,imageLoader:v.imageLoader,x:k.options.x,y:k.options.y,width:k.options.width,height:k.options.height,fitBounds:k.options.fitBounds,fitBoundsPlacement:k.options.fitBoundsPlacement,clip:k.options.clip,placeholderFillStyle:k.options.placeholderFillStyle,opacity:k.options.opacity,preload:k.options.preload,degrees:k.options.degrees,flipped:k.options.flipped,compositeOperation:k.options.compositeOperation,springStiffness:v.springStiffness,animationTime:v.animationTime,minZoomImageRatio:v.minZoomImageRatio,wrapHorizontal:v.wrapHorizontal,wrapVertical:v.wrapVertical,immediateRender:v.immediateRender,blendTime:v.blendTime,alwaysBlend:v.alwaysBlend,minPixelRatio:v.minPixelRatio,smoothTileEdgesMinZoom:v.smoothTileEdgesMinZoom,iOSDevice:v.iOSDevice,crossOriginPolicy:k.options.crossOriginPolicy,ajaxWithCredentials:k.options.ajaxWithCredentials,loadTilesWithAjax:k.options.loadTilesWithAjax,ajaxHeaders:k.options.ajaxHeaders,debugMode:v.debugMode}),v.collectionMode&&v.world.setAutoRefigureSizes(!1),v.navigator&&(z=e.extend({},k.options,{replace:!1,originalTiledImage:N,tileSource:k.tileSource}),v.navigator.addTiledImage(z)),v.world.addItem(N,{index:k.options.index}),v._loadQueue.length===0&&C(k),v.world.getItemCount()===1&&!v.preserveViewport&&v.viewport.goHome(!0),k.options.success&&k.options.success({item:N})}}l(this,c.tileSource,c,function(k){b.tileSource=k,I()},function(k){k.options=c,R(k),I()})},addSimpleImage:function(c){e.console.assert(c,"[Viewer.addSimpleImage] options is required"),e.console.assert(c.url,"[Viewer.addSimpleImage] options.url is required");var v=e.extend({},c,{tileSource:{type:"image",url:c.url}});delete v.url,this.addTiledImage(v)},addLayer:function(c){var v=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var b=e.extend({},c,{success:function(R){v.raiseEvent("add-layer",{options:c,drawer:R.item})},error:function(R){v.raiseEvent("add-layer-failed",R)}});return this.addTiledImage(b),this},getLayerAtLevel:function(c){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(c)},getLevelOfLayer:function(c){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(c)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(c,v){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(c,v)},removeLayer:function(c){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(c)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var c=e.delegate(this,x),v=e.delegate(this,S),b=e.delegate(this,this.goToNextPage),R=e.delegate(this,this.goToPreviousPage),C=this.navImages,I=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(I=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:Y(this.prefixUrl,C.previous.REST),srcGroup:Y(this.prefixUrl,C.previous.GROUP),srcHover:Y(this.prefixUrl,C.previous.HOVER),srcDown:Y(this.prefixUrl,C.previous.DOWN),onRelease:R,onFocus:c,onBlur:v}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:Y(this.prefixUrl,C.next.REST),srcGroup:Y(this.prefixUrl,C.next.GROUP),srcHover:Y(this.prefixUrl,C.next.HOVER),srcDown:Y(this.prefixUrl,C.next.DOWN),onRelease:b,onFocus:c,onBlur:v}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),I&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var c=e.delegate(this,Pe),v=e.delegate(this,ht),b=e.delegate(this,Ae),R=e.delegate(this,Fe),C=e.delegate(this,Qe),I=e.delegate(this,Pt),k=e.delegate(this,Ue),N=e.delegate(this,nt),z=e.delegate(this,dt),U=e.delegate(this,E),j=e.delegate(this,x),X=e.delegate(this,S),K=this.navImages,te=[],ge=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(ge=!1),this.showZoomControl&&(te.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:Y(this.prefixUrl,K.zoomIn.REST),srcGroup:Y(this.prefixUrl,K.zoomIn.GROUP),srcHover:Y(this.prefixUrl,K.zoomIn.HOVER),srcDown:Y(this.prefixUrl,K.zoomIn.DOWN),onPress:c,onRelease:v,onClick:b,onEnter:c,onExit:v,onFocus:j,onBlur:X})),te.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:Y(this.prefixUrl,K.zoomOut.REST),srcGroup:Y(this.prefixUrl,K.zoomOut.GROUP),srcHover:Y(this.prefixUrl,K.zoomOut.HOVER),srcDown:Y(this.prefixUrl,K.zoomOut.DOWN),onPress:R,onRelease:v,onClick:C,onEnter:R,onExit:v,onFocus:j,onBlur:X}))),this.showHomeControl&&te.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:Y(this.prefixUrl,K.home.REST),srcGroup:Y(this.prefixUrl,K.home.GROUP),srcHover:Y(this.prefixUrl,K.home.HOVER),srcDown:Y(this.prefixUrl,K.home.DOWN),onRelease:I,onFocus:j,onBlur:X})),this.showFullPageControl&&te.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:Y(this.prefixUrl,K.fullpage.REST),srcGroup:Y(this.prefixUrl,K.fullpage.GROUP),srcHover:Y(this.prefixUrl,K.fullpage.HOVER),srcDown:Y(this.prefixUrl,K.fullpage.DOWN),onRelease:k,onFocus:j,onBlur:X})),this.showRotationControl&&(te.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:Y(this.prefixUrl,K.rotateleft.REST),srcGroup:Y(this.prefixUrl,K.rotateleft.GROUP),srcHover:Y(this.prefixUrl,K.rotateleft.HOVER),srcDown:Y(this.prefixUrl,K.rotateleft.DOWN),onRelease:N,onFocus:j,onBlur:X})),te.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:Y(this.prefixUrl,K.rotateright.REST),srcGroup:Y(this.prefixUrl,K.rotateright.GROUP),srcHover:Y(this.prefixUrl,K.rotateright.HOVER),srcDown:Y(this.prefixUrl,K.rotateright.DOWN),onRelease:z,onFocus:j,onBlur:X}))),this.showFlipControl&&te.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:Y(this.prefixUrl,K.flip.REST),srcGroup:Y(this.prefixUrl,K.flip.GROUP),srcHover:Y(this.prefixUrl,K.flip.HOVER),srcDown:Y(this.prefixUrl,K.flip.DOWN),onRelease:U,onFocus:j,onBlur:X})),ge?(this.buttonGroup=new e.ButtonGroup({buttons:te,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,it)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=te),this},currentPage:function(){return this._sequenceIndex},goToPage:function(c){return this.tileSources&&c>=0&&c<this.tileSources.length&&(this._sequenceIndex=c,this._updateSequenceButtons(c),this.open(this.tileSources[c]),this.referenceStrip&&this.referenceStrip.setFocus(c),this.raiseEvent("page",{page:c})),this},addOverlay:function(c,v,b,R){var C;if(e.isPlainObject(c)?C=c:C={element:c,location:v,placement:b,onDraw:R},c=e.getElement(C.element),o(this.currentOverlays,c)>=0)return this;var I=a(this,C);return this.currentOverlays.push(I),I.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:c,location:C.location,placement:C.placement}),this},updateOverlay:function(c,v,b){var R;return c=e.getElement(c),R=o(this.currentOverlays,c),R>=0&&(this.currentOverlays[R].update(v,b),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:c,location:v,placement:b})),this},removeOverlay:function(c){var v;return c=e.getElement(c),v=o(this.currentOverlays,c),v>=0&&(this.currentOverlays[v].destroy(),this.currentOverlays.splice(v,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:c})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(c){var v;return c=e.getElement(c),v=o(this.currentOverlays,c),v>=0?this.currentOverlays[v]:null},_updateSequenceButtons:function(c){this.nextButton&&(!this.tileSources||this.tileSources.length-1===c?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(c>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(c){this._hideMessage();var v=e.makeNeutralElement("div");v.appendChild(document.createTextNode(c)),this.messageDiv=e.makeCenteredNode(v),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var c=this.messageDiv;c&&(c.parentNode.removeChild(c),delete this.messageDiv)},gestureSettingsByDeviceType:function(c){switch(c){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var c,v=this.currentOverlays.length;for(c=0;c<v;c++)this.currentOverlays[c].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var c=e.pixelDensityRatio,v=e.getCurrentPixelDensityRatio();c!==v&&(e.pixelDensityRatio=v,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var c=this._sequenceIndex-1;this.navPrevNextWrap&&c<0&&(c+=this.tileSources.length),this.goToPage(c)},goToNextPage:function(){var c=this._sequenceIndex+1;this.navPrevNextWrap&&c>=this.tileSources.length&&(c=0),this.goToPage(c)}});function r(c){return c=e.getElement(c),new e.Point(c.clientWidth===0?1:c.clientWidth,c.clientHeight===0?1:c.clientHeight)}function l(c,v,b,R,C){var I=c;if(e.type(v)==="string"){if(v.match(/^\s*<.*>\s*$/))v=e.parseXml(v);else if(v.match(/^\s*[{[].*[}\]]\s*$/))try{var k=e.parseJSON(v);v=k}catch{}}function N(z,U){z.ready?R(z):(z.addHandler("ready",function(){R(z)}),z.addHandler("open-failed",function(j){C({message:j.message,source:U})}))}setTimeout(function(){if(e.type(v)==="string")v=new e.TileSource({url:v,crossOriginPolicy:b.crossOriginPolicy!==void 0?b.crossOriginPolicy:c.crossOriginPolicy,ajaxWithCredentials:c.ajaxWithCredentials,ajaxHeaders:b.ajaxHeaders?b.ajaxHeaders:c.ajaxHeaders,useCanvas:c.useCanvas,success:function(X){R(X.tileSource)}}),v.addHandler("open-failed",function(X){C(X)});else if(e.isPlainObject(v)||v.nodeType)if(v.crossOriginPolicy===void 0&&(b.crossOriginPolicy!==void 0||c.crossOriginPolicy!==void 0)&&(v.crossOriginPolicy=b.crossOriginPolicy!==void 0?b.crossOriginPolicy:c.crossOriginPolicy),v.ajaxWithCredentials===void 0&&(v.ajaxWithCredentials=c.ajaxWithCredentials),v.useCanvas===void 0&&(v.useCanvas=c.useCanvas),e.isFunction(v.getTileUrl)){var z=new e.TileSource(v);z.getTileUrl=v.getTileUrl,R(z)}else{var U=e.TileSource.determineType(I,v);if(!U){C({message:"Unable to load TileSource",source:v});return}var j=U.prototype.configure.apply(I,[v]);N(new U(j),v)}else N(v,v)})}function a(c,v){if(v instanceof e.Overlay)return v;var b=null;if(v.element)b=e.getElement(v.element);else{var R=v.id?v.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);b=e.getElement(v.id),b||(b=document.createElement("a"),b.href="#/overlay/"+R),b.id=R,e.addClass(b,v.className?v.className:"openseadragon-overlay")}var C=v.location,I=v.width,k=v.height;if(!C){var N=v.x,z=v.y;if(v.px!==void 0){var U=c.viewport.imageToViewportRectangle(new e.Rect(v.px,v.py,I||0,k||0));N=U.x,z=U.y,I=I!==void 0?U.width:void 0,k=k!==void 0?U.height:void 0}C=new e.Point(N,z)}var j=v.placement;return j&&e.type(j)==="string"&&(j=e.Placement[v.placement.toUpperCase()]),new e.Overlay({element:b,location:C,placement:j,onDraw:v.onDraw,checkResize:v.checkResize,width:I,height:k,rotationMode:v.rotationMode})}function o(c,v){var b;for(b=c.length-1;b>=0;b--)if(c[b].element===v)return b;return-1}function u(c,v){return e.requestAnimationFrame(function(){v(c)})}function h(c){e.requestAnimationFrame(function(){m(c)})}function g(c){c.autoHideControls&&(c.controlsShouldFade=!0,c.controlsFadeBeginTime=e.now()+c.controlsFadeDelay,window.setTimeout(function(){h(c)},c.controlsFadeDelay))}function m(c){var v,b,R,C;if(c.controlsShouldFade){for(v=e.now(),b=v-c.controlsFadeBeginTime,R=1-b/c.controlsFadeLength,R=Math.min(1,R),R=Math.max(0,R),C=c.controls.length-1;C>=0;C--)c.controls[C].autoFade&&c.controls[C].setOpacity(R);R>0&&h(c)}}function T(c){var v;for(c.controlsShouldFade=!1,v=c.controls.length-1;v>=0;v--)c.controls[v].setOpacity(1)}function x(){T(this)}function S(){g(this)}function P(c){var v={tracker:c.eventSource,position:c.position,originalEvent:c.originalEvent,preventDefault:c.preventDefault};this.raiseEvent("canvas-contextmenu",v),c.preventDefault=v.preventDefault}function D(c){var v={originalEvent:c.originalEvent,preventDefaultAction:!1,preventVerticalPan:c.preventVerticalPan,preventHorizontalPan:c.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!c.ctrl&&!c.alt&&!c.meta)switch(c.keyCode){case 38:v.preventVerticalPan||(c.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),c.preventDefault=!0;break;case 40:v.preventVerticalPan||(c.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),c.preventDefault=!0;break;case 37:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),c.preventDefault=!0;break;case 39:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),c.preventDefault=!0;break;default:c.preventDefault=!1;break}else c.preventDefault=!1}function d(c){var v={originalEvent:c.originalEvent,preventDefaultAction:!1,preventVerticalPan:c.preventVerticalPan,preventHorizontalPan:c.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!c.ctrl&&!c.alt&&!c.meta)switch(c.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),c.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),c.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),c.preventDefault=!0;break;case 119:case 87:v.preventVerticalPan||(c.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),c.preventDefault=!0;break;case 115:case 83:v.preventVerticalPan||(c.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),c.preventDefault=!0;break;case 97:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),c.preventDefault=!0;break;case 100:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),c.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),c.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),c.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),c.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:c.preventDefault=!1;break}else c.preventDefault=!1}function _(c){var v,b=document.activeElement===this.canvas;b||this.canvas.focus(),this.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x);var R={tracker:c.eventSource,position:c.position,quick:c.quick,shift:c.shift,originalEvent:c.originalEvent,originalTarget:c.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",R),!R.preventDefaultAction&&this.viewport&&c.quick&&(v=this.gestureSettingsByDeviceType(c.pointerType),v.clickToZoom&&(this.viewport.zoomBy(c.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(c.position,!0):null),this.viewport.applyConstraints()))}function L(c){var v,b={tracker:c.eventSource,position:c.position,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",b),!b.preventDefaultAction&&this.viewport&&(v=this.gestureSettingsByDeviceType(c.pointerType),v.dblClickToZoom&&(this.viewport.zoomBy(c.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(c.position,!0):null),this.viewport.applyConstraints()))}function H(c){var v,b={tracker:c.eventSource,pointerType:c.pointerType,position:c.position,delta:c.delta,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",b),v=this.gestureSettingsByDeviceType(c.pointerType),v.dragToPan&&!b.preventDefaultAction&&this.viewport){if(this.panHorizontal||(c.delta.x=0),this.panVertical||(c.delta.y=0),this.viewport.flipped&&(c.delta.x=-c.delta.x),this.constrainDuringPan){var R=this.viewport.deltaPointsFromPixels(c.delta.negate());this.viewport.centerSpringX.target.value+=R.x,this.viewport.centerSpringY.target.value+=R.y;var C=this.viewport.getBounds(),I=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=R.x,this.viewport.centerSpringY.target.value-=R.y,C.x!==I.x&&(c.delta.x=0),C.y!==I.y&&(c.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(c.delta.negate()),v.flickEnabled&&!this.constrainDuringPan)}}function M(c){var v={tracker:c.eventSource,pointerType:c.pointerType,position:c.position,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",v),!v.preventDefaultAction&&this.viewport){var b=this.gestureSettingsByDeviceType(c.pointerType);if(b.flickEnabled&&c.speed>=b.flickMinSpeed){var R=0;this.panHorizontal&&(R=b.flickMomentum*c.speed*Math.cos(c.direction));var C=0;this.panVertical&&(C=b.flickMomentum*c.speed*Math.sin(c.direction));var I=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),k=this.viewport.pointFromPixel(new e.Point(I.x-R,I.y-C));this.viewport.panTo(k,!1)}this.viewport.applyConstraints()}}function V(c){this.raiseEvent("canvas-enter",{tracker:c.eventSource,pointerType:c.pointerType,position:c.position,buttons:c.buttons,pointers:c.pointers,insideElementPressed:c.insideElementPressed,buttonDownAny:c.buttonDownAny,originalEvent:c.originalEvent})}function G(c){this.raiseEvent("canvas-exit",{tracker:c.eventSource,pointerType:c.pointerType,position:c.position,buttons:c.buttons,pointers:c.pointers,insideElementPressed:c.insideElementPressed,buttonDownAny:c.buttonDownAny,originalEvent:c.originalEvent})}function Z(c){this.raiseEvent("canvas-press",{tracker:c.eventSource,pointerType:c.pointerType,position:c.position,insideElementPressed:c.insideElementPressed,insideElementReleased:c.insideElementReleased,originalEvent:c.originalEvent})}function $(c){this.raiseEvent("canvas-release",{tracker:c.eventSource,pointerType:c.pointerType,position:c.position,insideElementPressed:c.insideElementPressed,insideElementReleased:c.insideElementReleased,originalEvent:c.originalEvent})}function se(c){this.raiseEvent("canvas-nonprimary-press",{tracker:c.eventSource,position:c.position,pointerType:c.pointerType,button:c.button,buttons:c.buttons,originalEvent:c.originalEvent})}function J(c){this.raiseEvent("canvas-nonprimary-release",{tracker:c.eventSource,position:c.position,pointerType:c.pointerType,button:c.button,buttons:c.buttons,originalEvent:c.originalEvent})}function fe(c){var v,b,R,C,I={tracker:c.eventSource,pointerType:c.pointerType,gesturePoints:c.gesturePoints,lastCenter:c.lastCenter,center:c.center,lastDistance:c.lastDistance,distance:c.distance,shift:c.shift,originalEvent:c.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",I),this.viewport&&(v=this.gestureSettingsByDeviceType(c.pointerType),v.pinchToZoom&&(!I.preventDefaultPanAction||!I.preventDefaultZoomAction)&&(b=this.viewport.pointFromPixel(c.center,!0),I.preventDefaultZoomAction||this.viewport.zoomBy(c.distance/c.lastDistance,b,!0),v.zoomToRefPoint&&!I.preventDefaultPanAction&&(R=this.viewport.pointFromPixel(c.lastCenter,!0),C=R.minus(b),this.panHorizontal||(C.x=0),this.panVertical||(C.y=0),this.viewport.panBy(C,!0)),this.viewport.applyConstraints()),v.pinchRotate&&!I.preventDefaultRotateAction)){var k=Math.atan2(c.gesturePoints[0].currentPos.y-c.gesturePoints[1].currentPos.y,c.gesturePoints[0].currentPos.x-c.gesturePoints[1].currentPos.x),N=Math.atan2(c.gesturePoints[0].lastPos.y-c.gesturePoints[1].lastPos.y,c.gesturePoints[0].lastPos.x-c.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(k-N)*(180/Math.PI))}}function ue(c){var v,b,R,C,I;C=e.now(),I=C-this._lastScrollTime,I>this.minScrollDeltaTime?(this._lastScrollTime=C,v={tracker:c.eventSource,position:c.position,scroll:c.scroll,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",v),!v.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x),b=this.gestureSettingsByDeviceType(c.pointerType),b.scrollToZoom&&(R=Math.pow(this.zoomPerScroll,c.scroll),this.viewport.zoomBy(R,b.zoomToRefPoint?this.viewport.pointFromPixel(c.position,!0):null),this.viewport.applyConstraints())),c.preventDefault=v.preventDefault):c.preventDefault=!0}function ve(c){i[this.hash].mouseInside=!0,T(this),this.raiseEvent("container-enter",{tracker:c.eventSource,pointerType:c.pointerType,position:c.position,buttons:c.buttons,pointers:c.pointers,insideElementPressed:c.insideElementPressed,buttonDownAny:c.buttonDownAny,originalEvent:c.originalEvent})}function le(c){c.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||g(this)),this.raiseEvent("container-exit",{tracker:c.eventSource,pointerType:c.pointerType,position:c.position,buttons:c.buttons,pointers:c.pointers,insideElementPressed:c.insideElementPressed,buttonDownAny:c.buttonDownAny,originalEvent:c.originalEvent})}function re(c){ee(c),c.isOpen()?c._updateRequestId=u(c,re):c._updateRequestId=!1}function ee(c){if(!(c._opening||!i[c.hash])){if(c.autoResize){var v=r(c.container),b=i[c.hash].prevContainerSize;if(!v.equals(b)){var R=c.viewport;if(c.preserveImageSizeOnResize){var C=b.x/v.x,I=R.getZoom()*C,k=R.getCenter();R.resize(v,!1),R.zoomTo(I,null,!0),R.panTo(k,!0)}else{var N=R.getBounds();R.resize(v,!0),R.fitBoundsWithConstraints(N,!0)}i[c.hash].prevContainerSize=v,i[c.hash].forceRedraw=!0}}var z=c.viewport.update(),U=c.world.update()||z;z&&c.raiseEvent("viewport-change"),c.referenceStrip&&(U=c.referenceStrip.update(c.viewport)||U),!i[c.hash].animating&&U&&(c.raiseEvent("animation-start"),T(c)),(U||i[c.hash].forceRedraw||c.world.needsDraw())&&(ye(c),c._drawOverlays(),c.navigator&&c.navigator.update(c.viewport),i[c.hash].forceRedraw=!1,U&&c.raiseEvent("animation")),i[c.hash].animating&&!U&&(c.raiseEvent("animation-finish"),i[c.hash].mouseInside||g(c)),i[c.hash].animating=U}}function ye(c){c.imageLoader.clear(),c.drawer.clear(),c.world.draw(),c.raiseEvent("update-viewport",{})}function Y(c,v){return c?c+v:v}function Pe(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,tt(this)}function Fe(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,tt(this)}function ht(){i[this.hash].zooming=!1}function tt(c){e.requestAnimationFrame(e.delegate(c,St))}function St(){var c,v,b;i[this.hash].zooming&&this.viewport&&(c=e.now(),v=c-i[this.hash].lastZoomTime,b=Math.pow(i[this.hash].zoomFactor,v/1e3),this.viewport.zoomBy(b),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=c,tt(this))}function Ae(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Qe(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function it(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function Pt(){this.viewport&&this.viewport.goHome()}function Ue(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function nt(){if(this.viewport){var c=this.viewport.getRotation();this.viewport.flipped?c=e.positiveModulo(c+this.rotationIncrement,360):c=e.positiveModulo(c-this.rotationIncrement,360),this.viewport.setRotation(c)}}function dt(){if(this.viewport){var c=this.viewport.getRotation();this.viewport.flipped?c=e.positiveModulo(c-this.rotationIncrement,360):c=e.positiveModulo(c+this.rotationIncrement,360),this.viewport.setRotation(c)}}function E(){this.viewport.toggleFlip()}}(s),function(e){e.Navigator=function(u){var h=u.viewer,g=this,m,T;u.id?(this.element=document.getElementById(u.id),u.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(u.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),u.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:u.autoFade},u.position&&(u.position==="BOTTOM_RIGHT"?u.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:u.position==="BOTTOM_LEFT"?u.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:u.position==="TOP_RIGHT"?u.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:u.position==="TOP_LEFT"?u.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:u.position==="ABSOLUTE"&&(u.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,u.controlOptions.top=u.top,u.controlOptions.left=u.left,u.controlOptions.height=u.height,u.controlOptions.width=u.width))),this.element.id=u.id,this.element.className+=" navigator",u=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},u,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:u.autoResize,minZoomImageRatio:1,background:u.background,opacity:u.opacity,borderColor:u.borderColor,displayRegionColor:u.displayRegionColor}),u.minPixelRatio=this.minPixelRatio=h.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),u.controlOptions.anchor!==e.ControlAnchor.NONE&&function(P,D){P.margin="0px",P.border=D+"px solid "+u.borderColor,P.padding="0px",P.background=u.background,P.opacity=u.opacity,P.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(P,D){P.position="relative",P.top="0px",P.left="0px",P.fontSize="0px",P.overflow="hidden",P.border=D+"px solid "+u.displayRegionColor,P.margin="0px",P.padding="0px",P.background="transparent",P.float="left",P.cssFloat="left",P.styleFloat="left",P.zIndex=999999999,P.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),h.addControl(this.element,u.controlOptions),this._resizeWithViewer=u.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&u.controlOptions.anchor!==e.ControlAnchor.NONE,u.width&&u.height?(this.setWidth(u.width),this.setHeight(u.height)):this._resizeWithViewer&&(m=e.getElementSize(h.element),this.element.style.height=Math.round(m.y*u.sizeRatio)+"px",this.element.style.width=Math.round(m.x*u.sizeRatio)+"px",this.oldViewerSize=m,T=e.getElementSize(this.element),this.elementArea=T.x*T.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[u]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function x(P){a(g.displayRegionContainer,P),a(g.displayRegion,-P),g.viewport.setRotation(P)}if(u.navigatorRotate){var S=u.viewer.viewport?u.viewer.viewport.getRotation():u.viewer.degrees||0;x(S),u.viewer.addHandler("rotate",function(P){x(P.degrees)})}this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,n),clickHandler:e.delegate(this,i),releaseHandler:e.delegate(this,r),scrollHandler:e.delegate(this,l),preProcessEventHandler:function(P){P.eventType==="wheel"&&(P.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){g.viewport&&g.viewport.goHome(!0)}),h.world.addHandler("item-index-change",function(P){window.setTimeout(function(){var D=g.world.getItemAt(P.previousIndex);g.world.setItemIndex(D,P.newIndex)},1)}),h.world.addHandler("remove-item",function(P){var D=P.item,d=g._getMatchingItem(D);d&&g.world.removeItem(d)}),this.update(h.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var u=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);u.equals(this.oldContainerSize)||(this.viewport.resize(u,!0),this.viewport.goHome(!0),this.oldContainerSize=u,this.drawer.clear(),this.world.draw())}},setWidth:function(u){this.width=u,this.element.style.width=typeof u=="number"?u+"px":u,this._resizeWithViewer=!1},setHeight:function(u){this.height=u,this.element.style.height=typeof u=="number"?u+"px":u,this._resizeWithViewer=!1},setFlip:function(u){return this.viewport.setFlip(u),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(u){o(this.displayRegion,u),o(this.canvas,u),o(this.element,u)},update:function(u){var h,g,m,T,x,S;if(h=e.getElementSize(this.viewer.element),this._resizeWithViewer&&h.x&&h.y&&!h.equals(this.oldViewerSize)&&(this.oldViewerSize=h,this.maintainSizeRatio||!this.elementArea?(g=h.x*this.sizeRatio,m=h.y*this.sizeRatio):(g=Math.sqrt(this.elementArea*(h.x/h.y)),m=this.elementArea/g),this.element.style.width=Math.round(g)+"px",this.element.style.height=Math.round(m)+"px",this.elementArea||(this.elementArea=g*m),this.updateSize()),u&&this.viewport){T=u.getBoundsNoRotate(!0),x=this.viewport.pixelFromPointNoRotate(T.getTopLeft(),!1),S=this.viewport.pixelFromPointNoRotate(T.getBottomRight(),!1).minus(this.totalBorderWidths);var P=this.displayRegion.style;P.display=this.world.getItemCount()?"block":"none",P.top=Math.round(x.y)+"px",P.left=Math.round(x.x)+"px";var D=Math.abs(x.x-S.x),d=Math.abs(x.y-S.y);P.width=Math.round(Math.max(D,0))+"px",P.height=Math.round(Math.max(d,0))+"px"}},addTiledImage:function(u){var h=this,g=u.originalTiledImage;delete u.original;var m=e.extend({},u,{success:function(T){var x=T.item;x._originalForNavigator=g,h._matchBounds(x,g,!0),h._matchOpacity(x,g),h._matchCompositeOperation(x,g);function S(){h._matchBounds(x,g)}function P(){h._matchOpacity(x,g)}function D(){h._matchCompositeOperation(x,g)}g.addHandler("bounds-change",S),g.addHandler("clip-change",S),g.addHandler("opacity-change",P),g.addHandler("composite-operation-change",D)}});return e.Viewer.prototype.addTiledImage.apply(this,[m])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(u){for(var h=this.world.getItemCount(),g,m=0;m<h;m++)if(g=this.world.getItemAt(m),g._originalForNavigator===u)return g;return null},_matchBounds:function(u,h,g){var m=h.getBoundsNoRotate();u.setPosition(m.getTopLeft(),g),u.setWidth(m.width,g),u.setRotation(h.getRotation(),g),u.setClip(h.getClip()),u.setFlip(h.getFlip())},_matchOpacity:function(u,h){u.setOpacity(h.opacity)},_matchCompositeOperation:function(u,h){u.setCompositeOperation(h.compositeOperation)}});function i(u){var h={tracker:u.eventSource,position:u.position,quick:u.quick,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",h),!h.preventDefaultAction&&u.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(u.position.x=this.viewport.getContainerSize().x-u.position.x);var g=this.viewport.pointFromPixel(u.position);this.panVertical?this.panHorizontal||(g.x=this.viewer.viewport.getCenter(!0).x):g.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(g),this.viewer.viewport.applyConstraints()}}function n(u){var h={tracker:u.eventSource,position:u.position,delta:u.delta,speed:u.speed,direction:u.direction,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",h),!h.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(u.delta.x=0),this.panVertical||(u.delta.y=0),this.viewer.viewport.flipped&&(u.delta.x=-u.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(u.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function r(u){u.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function l(u){var h={tracker:u.eventSource,position:u.position,scroll:u.scroll,shift:u.shift,originalEvent:u.originalEvent,preventDefault:u.preventDefault};this.viewer.raiseEvent("navigator-scroll",h),u.preventDefault=h.preventDefault}function a(u,h){o(u,"rotate("+h+"deg)")}function o(u,h){u.style.webkitTransform=h,u.style.mozTransform=h,u.style.msTransform=h,u.style.oTransform=h,u.style.transform=h}}(s),function(e){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var r=n.split("."),l=null,a=arguments,o=i,u;for(u=0;u<r.length-1;u++)o=o[r[u]]||{};return l=o[r[u]],typeof l!="string"&&(e.console.log("Untranslated source string:",n),l=""),l.replace(/\{\d+\}/g,function(h){var g=parseInt(h.match(/\d+/),10)+1;return g<a.length?a[g]:""})},setString:function(n,r){var l=n.split("."),a=i,o;for(o=0;o<l.length-1;o++)a[l[o]]||(a[l[o]]={}),a=a[l[o]];a[l[o]]=r}})}(s),function(e){e.Point=function(i,n){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(i){return new e.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new e.Point(this.x-i.x,this.y-i.y)},times:function(i){return new e.Point(this.x*i,this.y*i)},divide:function(i){return new e.Point(this.x/i,this.y/i)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new e.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof e.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,n){n=n||new e.Point(0,0);var r,l;if(i%90===0){var a=e.positiveModulo(i,360);switch(a){case 0:r=1,l=0;break;case 90:r=0,l=1;break;case 180:r=-1,l=0;break;case 270:r=0,l=-1;break}}else{var o=i*Math.PI/180;r=Math.cos(o),l=Math.sin(o)}var u=r*(this.x-n.x)-l*(this.y-n.y)+n.x,h=l*(this.x-n.x)+r*(this.y-n.y)+n.y;return new e.Point(u,h)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(s),function(e){e.TileSource=function(n,r,l,a,o,u){var h=this,g=arguments,m,T;if(e.isPlainObject(n)?m=n:m={width:g[0],height:g[1],tileSize:g[2],tileOverlap:g[3],minLevel:g[4],maxLevel:g[5]},e.EventSource.call(this),e.extend(!0,this,m),!this.success){for(T=0;T<arguments.length;T++)if(e.isFunction(arguments[T])){this.success=arguments[T];break}}this.success&&this.addHandler("ready",function(x){h.success(x)}),e.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=m.width&&m.height?m.width/m.height:1,this.dimensions=new e.Point(m.width,m.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=m.tileOverlap?m.tileOverlap:0,this.minLevel=m.minLevel?m.minLevel:0,this.maxLevel=m.maxLevel!==void 0&&m.maxLevel!==null?m.maxLevel:m.width&&m.height?Math.ceil(Math.log(Math.max(m.width,m.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(n){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(n){return this._tileWidth?this._tileWidth:this.getTileSize(n)},getTileHeight:function(n){return this._tileHeight?this._tileHeight:this.getTileSize(n)},setMaxLevel:function(n){this.maxLevel=n,this._memoizeLevelScale()},getLevelScale:function(n){return this._memoizeLevelScale(),this.getLevelScale(n)},_memoizeLevelScale:function(){var n={},r;for(r=0;r<=this.maxLevel;r++)n[r]=1/Math.pow(2,this.maxLevel-r);this.getLevelScale=function(l){return n[l]}},getNumTiles:function(n){var r=this.getLevelScale(n),l=Math.ceil(r*this.dimensions.x/this.getTileWidth(n)),a=Math.ceil(r*this.dimensions.y/this.getTileHeight(n));return new e.Point(l,a)},getPixelRatio:function(n){var r=this.dimensions.times(this.getLevelScale(n)),l=1/r.x*e.pixelDensityRatio,a=1/r.y*e.pixelDensityRatio;return new e.Point(l,a)},getClosestLevel:function(){var n,r;for(n=this.minLevel+1;n<=this.maxLevel&&(r=this.getNumTiles(n),!(r.x>1||r.y>1));n++);return n-1},getTileAtPoint:function(n,r){var l=r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1/this.aspectRatio;e.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point.");var a=this.dimensions.x*this.getLevelScale(n),o=r.x*a,u=r.y*a,h=Math.floor(o/this.getTileWidth(n)),g=Math.floor(u/this.getTileHeight(n));r.x>=1&&(h=this.getNumTiles(n).x-1);var m=1e-15;return r.y>=1/this.aspectRatio-m&&(g=this.getNumTiles(n).y-1),new e.Point(h,g)},getTileBounds:function(n,r,l,a){var o=this.dimensions.times(this.getLevelScale(n)),u=this.getTileWidth(n),h=this.getTileHeight(n),g=r===0?0:u*r-this.tileOverlap,m=l===0?0:h*l-this.tileOverlap,T=u+(r===0?1:2)*this.tileOverlap,x=h+(l===0?1:2)*this.tileOverlap,S=1/o.x;return T=Math.min(T,o.x-g),x=Math.min(x,o.y-m),a?new e.Rect(0,0,T,x):new e.Rect(g*S,m*S,T*S,x*S)},getImageInfo:function(n){var r=this,l,a,o,u,h,g,m;n&&(h=n.split("/"),g=h[h.length-1],m=g.lastIndexOf("."),m>-1&&(h[h.length-1]=g.slice(0,m))),a=function(T){typeof T=="string"&&(T=e.parseXml(T));var x=e.TileSource.determineType(r,T,n);if(!x){r.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n});return}u=x.prototype.configure.apply(r,[T,n]),u.ajaxWithCredentials===void 0&&(u.ajaxWithCredentials=r.ajaxWithCredentials),o=new x(u),r.ready=!0,r.raiseEvent("ready",{tileSource:o})},n.match(/\.js$/)?(l=n.split("/").pop().replace(".js",""),e.jsonp({url:n,async:!1,callbackName:l,callback:a})):e.makeAjaxRequest({url:n,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(T){var x=i(T);a(x)},error:function(T,x){var S;try{S="HTTP "+T.status+" attempting to load TileSource"}catch{var P;typeof x>"u"||!x.toString?P="Unknown error":P=x.toString(),S=P+" attempting to load TileSource"}r.raiseEvent("open-failed",{message:S,source:n})}})},supports:function(n,r){return!1},configure:function(n,r){throw new Error("Method not implemented.")},getTileUrl:function(n,r,l){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(n,r,l){return{}},tileExists:function(n,r,l){var a=this.getNumTiles(n);return n>=this.minLevel&&n<=this.maxLevel&&r>=0&&l>=0&&r<a.x&&l<a.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function i(n){var r=n.responseText,l=n.status,a,o;if(n){if(n.status!==200&&n.status!==0)throw l=n.status,a=l===404?"Not Found":n.statusText,new Error(e.getString("Errors.Status",l,a))}else throw new Error(e.getString("Errors.Security"));if(r.match(/\s*<.*/))try{o=n.responseXML&&n.responseXML.documentElement?n.responseXML:e.parseXml(r)}catch{o=n.responseText}else if(r.match(/\s*[{[].*/))try{o=e.parseJSON(r)}catch{o=r}else o=r;return o}e.TileSource.determineType=function(n,r,l){var a;for(a in s)if(a.match(/.+TileSource$/)&&e.isFunction(s[a])&&e.isFunction(s[a].prototype.supports)&&s[a].prototype.supports.call(n,r,l))return s[a];return e.console.error("No TileSource was able to open %s %s",l,r),null}}(s),function(e){e.DziTileSource=function(r,l,a,o,u,h,g,m,T){var x,S,P,D;if(e.isPlainObject(r)?D=r:D={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=D.tilesUrl,this.fileFormat=D.fileFormat,this.displayRects=D.displayRects,this.displayRects)for(x=this.displayRects.length-1;x>=0;x--)for(S=this.displayRects[x],P=S.minLevel;P<=S.maxLevel;P++)this._levelRects[P]||(this._levelRects[P]=[]),this._levelRects[P].push(S);e.TileSource.apply(this,[D])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(r,l){var a;return r.Image?a=r.Image.xmlns:r.documentElement&&(r.documentElement.localName==="Image"||r.documentElement.tagName==="Image")&&(a=r.documentElement.namespaceURI),a=(a||"").toLowerCase(),a.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||a.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(r,l){var a;return e.isPlainObject(r)?a=n(this,r):a=i(this,r),l&&!a.tilesUrl&&(a.tilesUrl=l.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),l.search(/\.(dzi|xml|js)\?/)!==-1?a.queryParams=l.match(/\?.*/):a.queryParams=""),a},getTileUrl:function(r,l,a){return[this.tilesUrl,r,"/",l,"_",a,".",this.fileFormat,this.queryParams].join("")},tileExists:function(r,l,a){var o=this._levelRects[r],u,h,g,m,T,x,S;if(this.minLevel&&r<this.minLevel||this.maxLevel&&r>this.maxLevel)return!1;if(!o||!o.length)return!0;for(S=o.length-1;S>=0;S--)if(u=o[S],!(r<u.minLevel||r>u.maxLevel)&&(h=this.getLevelScale(r),g=u.x*h,m=u.y*h,T=g+u.width*h,x=m+u.height*h,g=Math.floor(g/this._tileWidth),m=Math.floor(m/this._tileWidth),T=Math.ceil(T/this._tileWidth),x=Math.ceil(x/this._tileWidth),g<=l&&l<T&&m<=a&&a<x))return!0;return!1}});function i(r,l){if(!l||!l.documentElement)throw new Error(e.getString("Errors.Xml"));var a=l.documentElement,o=a.localName||a.tagName,u=l.documentElement.namespaceURI,h=null,g=[],m,T,x,S,P;if(o==="Image")try{if(S=a.getElementsByTagName("Size")[0],S===void 0&&(S=a.getElementsByTagNameNS(u,"Size")[0]),h={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(S.getAttribute("Height"),10),Width:parseInt(S.getAttribute("Width"),10)}}},!e.imageFormatSupported(h.Image.Format))throw new Error(e.getString("Errors.ImageFormat",h.Image.Format.toUpperCase()));for(m=a.getElementsByTagName("DisplayRect"),m===void 0&&(m=a.getElementsByTagNameNS(u,"DisplayRect")[0]),P=0;P<m.length;P++)T=m[P],x=T.getElementsByTagName("Rect")[0],x===void 0&&(x=T.getElementsByTagNameNS(u,"Rect")[0]),g.push({Rect:{X:parseInt(x.getAttribute("X"),10),Y:parseInt(x.getAttribute("Y"),10),Width:parseInt(x.getAttribute("Width"),10),Height:parseInt(x.getAttribute("Height"),10),MinLevel:parseInt(T.getAttribute("MinLevel"),10),MaxLevel:parseInt(T.getAttribute("MaxLevel"),10)}});return g.length&&(h.Image.DisplayRect=g),n(r,h)}catch(_){throw _ instanceof Error?_:new Error(e.getString("Errors.Dzi"))}else{if(o==="Collection")throw new Error(e.getString("Errors.Dzc"));if(o==="Error"){var D=a.getElementsByTagName("Message")[0],d=D.firstChild.nodeValue;throw new Error(d)}}throw new Error(e.getString("Errors.Dzi"))}function n(r,l){var a=l.Image,o=a.Url,u=a.Format,h=a.Size,g=a.DisplayRect||[],m=parseInt(h.Width,10),T=parseInt(h.Height,10),x=parseInt(a.TileSize,10),S=parseInt(a.Overlap,10),P=[],D,d;for(d=0;d<g.length;d++)D=g[d].Rect,P.push(new e.DisplayRect(parseInt(D.X,10),parseInt(D.Y,10),parseInt(D.Width,10),parseInt(D.Height,10),parseInt(D.MinLevel,10),parseInt(D.MaxLevel,10)));return e.extend(!0,{width:m,height:T,tileSize:x,tileOverlap:S,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:u,displayRects:P},l)}}(s),function(e){e.IIIFTileSource=function(a){if(e.extend(!0,this,a),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(a.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=a.version,this.tile_width&&this.tile_height)a.tileWidth=this.tile_width,a.tileHeight=this.tile_height;else if(this.tile_width)a.tileSize=this.tile_width;else if(this.tile_height)a.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)a.tileWidth=this.tiles[0].width,a.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var o=0;o<this.tiles.length;o++)for(var u=0;u<this.tiles[o].scaleFactors.length;u++){var h=this.tiles[o].scaleFactors[u];this.scale_factors.push(h),a.tileSizePerScaleFactor[h]={width:this.tiles[o].width,height:this.tiles[o].height||this.tiles[o].width}}}else if(i(a)){for(var g=Math.min(this.height,this.width),m=[256,512,1024],T=[],x=0;x<m.length;x++)m[x]<=g&&T.push(m[x]);T.length>0?a.tileSize=Math.max.apply(null,T):a.tileSize=g}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,a.levels=n(this),e.extend(!0,a,{width:a.levels[a.levels.length-1].width,height:a.levels[a.levels.length-1].height,tileSize:Math.max(a.height,a.width),tileOverlap:0,minLevel:0,maxLevel:a.levels.length-1}),this.levels=a.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!a.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)a.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var S=Math.max.apply(null,this.scale_factors);a.maxLevel=Math.round(Math.log(S)*Math.LOG2E)}e.TileSource.apply(this,[a])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(a,o){return a.protocol&&a.protocol==="http://iiif.io/api/image"||a["@context"]&&(a["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||a["@context"]==="http://iiif.io/api/image/1/context.json")||a.profile&&a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||a.identifier&&a.width&&a.height?!0:!!(a.documentElement&&a.documentElement.tagName==="info"&&a.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(a,o){if(e.isPlainObject(a)){if(!a["@context"])a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=o.replace("/info.json",""),a.version=1;else{var h=a["@context"];if(Array.isArray(h)){for(var g=0;g<h.length;g++)if(typeof h[g]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(h[g])||h[g]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){h=h[g];break}}switch(h){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":a.version=1;break;case"http://iiif.io/api/image/2/context.json":a.version=2;break;case"http://iiif.io/api/image/3/context.json":a.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!a["@id"]&&a.id&&(a["@id"]=a.id),a.preferredFormats){for(var m=0;m<a.preferredFormats.length;m++)if(s.imageFormatSupported(a.preferredFormats[m])){a.tileFormat=a.preferredFormats[m];break}}return a}else{var u=r(a);return u["@context"]="http://iiif.io/api/image/1.0/context.json",u["@id"]=o.replace("/info.xml",""),u.version=1,u}},getTileWidth:function(a){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,a);var o=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[o]?this.tileSizePerScaleFactor[o].width:this._tileWidth},getTileHeight:function(a){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,a);var o=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[o]?this.tileSizePerScaleFactor[o].height:this._tileHeight},getLevelScale:function(a){if(this.emulateLegacyImagePyramid){var o=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(o=this.levels[a].width/this.levels[this.maxLevel].width),o}return e.TileSource.prototype.getLevelScale.call(this,a)},getNumTiles:function(a){if(this.emulateLegacyImagePyramid){var o=this.getLevelScale(a);return o?new e.Point(1,1):new e.Point(0,0)}return e.TileSource.prototype.getNumTiles.call(this,a)},getTileAtPoint:function(a,o){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,a,o)},getTileUrl:function(a,o,u){if(this.emulateLegacyImagePyramid){var h=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(h=this.levels[a].url),h}var g="0",m=Math.pow(.5,this.maxLevel-a),T=Math.ceil(this.width*m),x=Math.ceil(this.height*m),S,P,D,d,_,L,H,M,V,G,Z,$,se,J;return S=this.getTileWidth(a),P=this.getTileHeight(a),D=Math.ceil(S/m),d=Math.ceil(P/m),this.version===1?se="native."+this.tileFormat:se="default."+this.tileFormat,T<S&&x<P?(this.version===2&&T===this.width?G="full":this.version===3&&T===this.width&&x===this.height?G="max":this.version===3?G=T+","+x:G=T+",",_="full"):(L=o*D,H=u*d,M=Math.min(D,this.width-L),V=Math.min(d,this.height-H),o===0&&u===0&&M===this.width&&V===this.height?_="full":_=[L,H,M,V].join(","),Z=Math.ceil(M*m),$=Math.ceil(V*m),this.version===2&&Z===this.width?G="full":this.version===3&&Z===this.width&&$===this.height?G="max":this.version===3?G=Z+","+$:G=Z+","),J=[this["@id"],_,G,g,se].join("/"),J},__testonly__:{canBeTiled:i,constructLevels:n}});function i(a){var o=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],u=Array.isArray(a.profile)?a.profile[0]:a.profile,h=o.indexOf(u)!==-1,g=!1;return a.version===2&&a.profile.length>1&&a.profile[1].supports&&(g=a.profile[1].supports.indexOf("sizeByW")!==-1),a.version===3&&a.extraFeatures&&(g=a.extraFeatures.indexOf("sizeByWh")!==-1),!h||g}function n(a){for(var o=[],u=0;u<a.sizes.length;u++)o.push({url:a["@id"]+"/full/"+a.sizes[u].width+","+(a.version===3?a.sizes[u].height:"")+"/0/default."+a.tileFormat,width:a.sizes[u].width,height:a.sizes[u].height});return o.sort(function(h,g){return h.width-g.width})}function r(a){if(!a||!a.documentElement)throw new Error(e.getString("Errors.Xml"));var o=a.documentElement,u=o.tagName,h=null;if(u==="info")try{return h={},l(o,h),h}catch(g){throw g instanceof Error?g:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function l(a,o,u){var h,g;if(a.nodeType===3&&u)g=a.nodeValue.trim(),g.match(/^\d*$/)&&(g=Number(g)),o[u]?(e.isArray(o[u])||(o[u]=[o[u]]),o[u].push(g)):o[u]=g;else if(a.nodeType===1)for(h=0;h<a.childNodes.length;h++)l(a.childNodes[h],o,a.nodeName)}}(s),function(e){e.OsmTileSource=function(i,n,r,l,a){var o;e.isPlainObject(i)?o=i:o={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!o.width||!o.height)&&(o.width=65572864,o.height=65572864),o.tileSize||(o.tileSize=256,o.tileOverlap=0),o.tilesUrl||(o.tilesUrl="http://tile.openstreetmap.org/"),o.minLevel=8,e.TileSource.apply(this,[o])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="openstreetmaps"},configure:function(i,n){return i},getTileUrl:function(i,n,r){return this.tilesUrl+(i-8)+"/"+n+"/"+r+".png"}})}(s),function(e){e.TmsTileSource=function(i,n,r,l,a){var o;e.isPlainObject(i)?o=i:o={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var u=Math.ceil(o.width/256)*256,h=Math.ceil(o.height/256)*256,g;u>h?g=u/256:g=h/256,o.maxLevel=Math.ceil(Math.log(g)/Math.log(2))-1,o.tileSize=256,o.width=u,o.height=h,e.TileSource.apply(this,[o])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="tiledmapservice"},configure:function(i,n){return i},getTileUrl:function(i,n,r){var l=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+n+"/"+(l-r)+".png"}})}(s),function(e){e.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var n={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(n.x,10)>i.tileSize||parseInt(n.y,10)>i.tileSize;)n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2),i.imageSizes.push({x:n.x,y:n.y}),i.gridSize.push(this._getGridSize(n.x,n.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,s.TileSource.apply(this,[i])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(i,n,r){return{x:Math.ceil(i/r),y:Math.ceil(n/r)}},_calculateAbsoluteTileNumber:function(i,n,r){for(var l=0,a={},o=0;o<i;o++)a=this.gridSize[o],l+=a.x*a.y;return a=this.gridSize[i],l+=a.x*r+n,l},supports:function(i,n){return i.type&&i.type==="zoomifytileservice"},configure:function(i,n){return i},getTileUrl:function(i,n,r){var l=0,a=this._calculateAbsoluteTileNumber(i,n,r);return l=Math.floor(a/256),this.tilesUrl+"TileGroup"+l+"/"+i+"-"+n+"-"+r+"."+this.fileFormat}})}(s),function(e){e.LegacyTileSource=function(l){var a,o,u;e.isArray(l)&&(a={type:"legacy-image-pyramid",levels:l}),a.levels=i(a.levels),a.levels.length>0?(o=a.levels[a.levels.length-1].width,u=a.levels[a.levels.length-1].height):(o=0,u=0,e.console.error("No supported image formats found")),e.extend(!0,a,{width:o,height:u,tileSize:Math.max(u,o),tileOverlap:0,minLevel:0,maxLevel:a.levels.length>0?a.levels.length-1:0}),e.TileSource.apply(this,[a]),this.levels=a.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(l,a){return l.type&&l.type==="legacy-image-pyramid"||l.documentElement&&l.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(l,a){var o;return e.isPlainObject(l)?o=r(this,l):o=n(this,l),o},getLevelScale:function(l){var a=NaN;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(a=this.levels[l].width/this.levels[this.maxLevel].width),a},getNumTiles:function(l){var a=this.getLevelScale(l);return a?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(l,a,o){var u=null;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(u=this.levels[l].url),u}});function i(l){var a=[],o,u;for(u=0;u<l.length;u++)o=l[u],o.height&&o.width&&o.url?a.push({url:o.url,width:Number(o.width),height:Number(o.height)}):e.console.error("Unsupported image format: %s",o.url?o.url:"<no URL>");return a.sort(function(h,g){return h.height-g.height})}function n(l,a){if(!a||!a.documentElement)throw new Error(e.getString("Errors.Xml"));var o=a.documentElement,u=o.tagName,h=null,g=[],m,T;if(u==="image")try{for(h={type:o.getAttribute("type"),levels:[]},g=o.getElementsByTagName("level"),T=0;T<g.length;T++)m=g[T],h.levels.push({url:m.getAttribute("url"),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10)});return r(l,h)}catch(x){throw x instanceof Error?x:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(u==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(u==="error")throw new Error("Error: "+a)}throw new Error("Unknown element "+u)}function r(l,a){return a.levels}}(s),function(e){e.ImageTileSource=function(i){i=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),e.TileSource.apply(this,[i])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="image"},configure:function(i,n){return i},getImageInfo:function(i){var n=this._image=new Image,r=this;this.crossOriginPolicy&&(n.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(n.useCredentials=this.ajaxWithCredentials),e.addEvent(n,"load",function(){r.width=n.naturalWidth,r.height=n.naturalHeight,r.aspectRatio=r.width/r.height,r.dimensions=new e.Point(r.width,r.height),r._tileWidth=r.width,r._tileHeight=r.height,r.tileOverlap=0,r.minLevel=0,r.levels=r._buildLevels(),r.maxLevel=r.levels.length-1,r.ready=!0,r.raiseEvent("ready",{tileSource:r})}),e.addEvent(n,"error",function(){r.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),n.src=i},getLevelScale:function(i){var n=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(n=this.levels[i].width/this.levels[this.maxLevel].width),n},getNumTiles:function(i){var n=this.getLevelScale(i);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(i,n,r){var l=null;return i>=this.minLevel&&i<=this.maxLevel&&(l=this.levels[i].url),l},getContext2D:function(i,n,r){var l=null;return i>=this.minLevel&&i<=this.maxLevel&&(l=this.levels[i].context2D),l},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,i;var n=this._image.naturalWidth,r=this._image.naturalHeight,l=document.createElement("canvas"),a=l.getContext("2d");if(l.width=n,l.height=r,a.drawImage(this._image,0,0,n,r),i[0].context2D=a,delete this._image,e.isCanvasTainted(l))return i;for(;n>=2&&r>=2;){n=Math.floor(n/2),r=Math.floor(r/2);var o=document.createElement("canvas"),u=o.getContext("2d");o.width=n,o.height=r,u.drawImage(l,0,0,n,r),i.splice(0,0,{context2D:u,width:n,height:r}),l=o,a=u}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0}})}(s),function(e){e.TileSourceCollection=function(i,n,r,l){e.console.error("TileSourceCollection is deprecated; use World instead")}}(s),function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(u){var h=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},u),this.element=u.element||e.makeNeutralElement("div"),u.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(g){g.insideElementPressed?(a(h,e.ButtonState.DOWN),h.raiseEvent("enter",{originalEvent:g.originalEvent})):g.buttonDownAny||a(h,e.ButtonState.HOVER)},focusHandler:function(g){h.tracker.enterHandler(g),h.raiseEvent("focus",{originalEvent:g.originalEvent})},leaveHandler:function(g){o(h,e.ButtonState.GROUP),g.insideElementPressed&&h.raiseEvent("exit",{originalEvent:g.originalEvent})},blurHandler:function(g){h.tracker.leaveHandler(g),h.raiseEvent("blur",{originalEvent:g.originalEvent})},pressHandler:function(g){a(h,e.ButtonState.DOWN),h.raiseEvent("press",{originalEvent:g.originalEvent})},releaseHandler:function(g){g.insideElementPressed&&g.insideElementReleased?(o(h,e.ButtonState.HOVER),h.raiseEvent("release",{originalEvent:g.originalEvent})):g.insideElementPressed?o(h,e.ButtonState.GROUP):a(h,e.ButtonState.HOVER)},clickHandler:function(g){g.quick&&h.raiseEvent("click",{originalEvent:g.originalEvent})},keyHandler:function(g){g.keyCode===13?(h.raiseEvent("click",{originalEvent:g.originalEvent}),h.raiseEvent("release",{originalEvent:g.originalEvent}),g.preventDefault=!0):g.preventDefault=!1}}),o(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){a(this,e.ButtonState.GROUP)},notifyGroupExit:function(){o(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(u){e.requestAnimationFrame(function(){n(u)})}function n(u){var h,g,m;u.shouldFade&&(h=e.now(),g=h-u.fadeBeginTime,m=1-g/u.fadeLength,m=Math.min(1,m),m=Math.max(0,m),u.imgGroup&&e.setElementOpacity(u.imgGroup,m,!0),m>0&&i(u))}function r(u){u.shouldFade=!0,u.fadeBeginTime=e.now()+u.fadeDelay,window.setTimeout(function(){i(u)},u.fadeDelay)}function l(u){u.shouldFade=!1,u.imgGroup&&e.setElementOpacity(u.imgGroup,1,!0)}function a(u,h){u.element.disabled||(h>=e.ButtonState.GROUP&&u.currentState===e.ButtonState.REST&&(l(u),u.currentState=e.ButtonState.GROUP),h>=e.ButtonState.HOVER&&u.currentState===e.ButtonState.GROUP&&(u.imgHover&&(u.imgHover.style.visibility=""),u.currentState=e.ButtonState.HOVER),h>=e.ButtonState.DOWN&&u.currentState===e.ButtonState.HOVER&&(u.imgDown&&(u.imgDown.style.visibility=""),u.currentState=e.ButtonState.DOWN))}function o(u,h){u.element.disabled||(h<=e.ButtonState.HOVER&&u.currentState===e.ButtonState.DOWN&&(u.imgDown&&(u.imgDown.style.visibility="hidden"),u.currentState=e.ButtonState.HOVER),h<=e.ButtonState.GROUP&&u.currentState===e.ButtonState.HOVER&&(u.imgHover&&(u.imgHover.style.visibility="hidden"),u.currentState=e.ButtonState.GROUP),h<=e.ButtonState.REST&&u.currentState===e.ButtonState.GROUP&&(r(u),u.currentState=e.ButtonState.REST))}}(s),function(e){e.ButtonGroup=function(i){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var n=this.buttons.concat([]),r=this,l;if(this.element=i.element||e.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",l=0;l<n.length;l++)this.element.appendChild(n[l].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var o;for(o=0;o<r.buttons.length;o++)r.buttons[o].notifyGroupEnter()},leaveHandler:function(a){var o;if(!a.insideElementPressed)for(o=0;o<r.buttons.length;o++)r.buttons[o].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(s),function(e){e.Rect=function(i,n,r,l,a){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0,this.width=typeof r=="number"?r:0,this.height=typeof l=="number"?l:0,this.degrees=typeof a=="number"?a:0,this.degrees=e.positiveModulo(this.degrees,360);var o,u;this.degrees>=270?(o=this.getTopRight(),this.x=o.x,this.y=o.y,u=this.height,this.height=this.width,this.width=u,this.degrees-=270):this.degrees>=180?(o=this.getBottomRight(),this.x=o.x,this.y=o.y,this.degrees-=180):this.degrees>=90&&(o=this.getBottomLeft(),this.x=o.x,this.y=o.y,u=this.height,this.height=this.width,this.width=u,this.degrees-=90)},e.Rect.fromSummits=function(i,n,r){var l=i.distanceTo(n),a=i.distanceTo(r),o=n.minus(i),u=Math.atan(o.y/o.x);return o.x<0?u+=Math.PI:o.y<0&&(u+=2*Math.PI),new e.Rect(i.x,i.y,l,a,u/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(i){return i instanceof e.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new e.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new e.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var n=this.getBoundingBox(),r=i.getBoundingBox(),l=Math.min(n.x,r.x),a=Math.min(n.y,r.y),o=Math.max(n.x+n.width,r.x+r.width),u=Math.max(n.y+n.height,r.y+r.height);return new e.Rect(l,a,o-l,u-a)},intersection:function(i){var n=1e-10,r=[],l=this.getTopLeft();i.containsPoint(l,n)&&r.push(l);var a=this.getTopRight();i.containsPoint(a,n)&&r.push(a);var o=this.getBottomLeft();i.containsPoint(o,n)&&r.push(o);var u=this.getBottomRight();i.containsPoint(u,n)&&r.push(u);var h=i.getTopLeft();this.containsPoint(h,n)&&r.push(h);var g=i.getTopRight();this.containsPoint(g,n)&&r.push(g);var m=i.getBottomLeft();this.containsPoint(m,n)&&r.push(m);var T=i.getBottomRight();this.containsPoint(T,n)&&r.push(T);for(var x=this._getSegments(),S=i._getSegments(),P=0;P<x.length;P++)for(var D=x[P],d=0;d<S.length;d++){var _=S[d],L=H(D[0],D[1],_[0],_[1]);L&&r.push(L)}function H(J,fe,ue,ve){var le=fe.minus(J),re=ve.minus(ue),ee=-re.x*le.y+le.x*re.y;if(ee===0)return null;var ye=(le.x*(J.y-ue.y)-le.y*(J.x-ue.x))/ee,Y=(re.x*(J.y-ue.y)-re.y*(J.x-ue.x))/ee;return-n<=ye&&ye<=1-n&&-n<=Y&&Y<=1-n?new e.Point(J.x+Y*le.x,J.y+Y*le.y):null}if(r.length===0)return null;for(var M=r[0].x,V=r[0].x,G=r[0].y,Z=r[0].y,$=1;$<r.length;$++){var se=r[$];se.x<M&&(M=se.x),se.x>V&&(V=se.x),se.y<G&&(G=se.y),se.y>Z&&(Z=se.y)}return new e.Rect(M,G,V-M,Z-G)},_getSegments:function(){var i=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),l=this.getBottomRight();return[[i,n],[n,l],[l,r],[r,i]]},rotate:function(i,n){if(i=e.positiveModulo(i,360),i===0)return this.clone();n=n||this.getCenter();var r=this.getTopLeft().rotate(i,n),l=this.getTopRight().rotate(i,n),a=l.minus(r);a=a.apply(function(u){var h=1e-15;return Math.abs(u)<h?0:u});var o=Math.atan(a.y/a.x);return a.x<0?o+=Math.PI:a.y<0&&(o+=2*Math.PI),new e.Rect(r.x,r.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),l=this.getBottomRight(),a=Math.min(i.x,n.x,r.x,l.x),o=Math.max(i.x,n.x,r.x,l.x),u=Math.min(i.y,n.y,r.y,l.y),h=Math.max(i.y,n.y,r.y,l.y);return new e.Rect(a,u,o-a,h-u)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),n=Math.floor(i.x),r=Math.floor(i.y),l=Math.ceil(i.width+i.x-n),a=Math.ceil(i.height+i.y-r);return new e.Rect(n,r,l,a)},containsPoint:function(i,n){n=n||0;var r=this.getTopLeft(),l=this.getTopRight(),a=this.getBottomLeft(),o=l.minus(r),u=a.minus(r);return(i.x-r.x)*o.x+(i.y-r.y)*o.y>=-n&&(i.x-l.x)*o.x+(i.y-l.y)*o.y<=n&&(i.x-r.x)*u.x+(i.y-r.y)*u.y>=-n&&(i.x-a.x)*u.x+(i.y-a.y)*u.y<=n},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(s),function(e){var i={};e.ReferenceStrip=function(m){var T=this,x=m.viewer,S=e.getElementSize(x.element),P,D,d;for(m.id||(m.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=m.id,this.element.className="referencestrip"),m=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},m,{element:this.element}),e.extend(this,m),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,D=this.element.style,D.marginTop="0px",D.marginRight="0px",D.marginBottom="0px",D.marginLeft="0px",D.left="0px",D.bottom="0px",D.border="0px",D.background="#000",D.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=x,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,n),dragHandler:e.delegate(this,r),scrollHandler:e.delegate(this,l),enterHandler:e.delegate(this,o),leaveHandler:e.delegate(this,u),keyDownHandler:e.delegate(this,h),keyHandler:e.delegate(this,g),preProcessEventHandler:function(_){_.eventType==="wheel"&&(_.preventDefault=!0)}}),m.width&&m.height?(this.element.style.width=m.width+"px",this.element.style.height=m.height+"px",x.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):m.scroll==="horizontal"?(this.element.style.width=S.x*m.sizeRatio*x.tileSources.length+12*x.tileSources.length+"px",this.element.style.height=S.y*m.sizeRatio+"px",x.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=S.y*m.sizeRatio*x.tileSources.length+12*x.tileSources.length+"px",this.element.style.width=S.x*m.sizeRatio+"px",x.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=S.x*this.sizeRatio+8,this.panelHeight=S.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<x.tileSources.length;d++)P=e.makeNeutralElement("div"),P.id=this.element.id+"-"+d,P.style.width=T.panelWidth+"px",P.style.height=T.panelHeight+"px",P.style.display="inline",P.style.float="left",P.style.cssFloat="left",P.style.styleFloat="left",P.style.padding="2px",e.setElementTouchActionNone(P),e.setElementPointerEventsNone(P),this.element.appendChild(P),P.activePanel=!1,this.panels.push(P);a(this,this.scroll==="vertical"?S.y:S.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(m){var T=this.element.querySelector("#"+this.element.id+"-"+m),x=e.getElementSize(this.viewer.canvas),S=Number(this.element.style.width.replace("px","")),P=Number(this.element.style.height.replace("px","")),D=-Number(this.element.style.marginLeft.replace("px","")),d=-Number(this.element.style.marginTop.replace("px","")),_;this.currentSelected!==T&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=T,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(_=Number(m)*(this.panelWidth+3),_>D+x.x-this.panelWidth?(_=Math.min(_,S-x.x),this.element.style.marginLeft=-_+"px",a(this,x.x,-_)):_<D&&(_=Math.max(0,_-x.x/2),this.element.style.marginLeft=-_+"px",a(this,x.x,-_))):(_=Number(m)*(this.panelHeight+3),_>d+x.y-this.panelHeight?(_=Math.min(_,P-x.y),this.element.style.marginTop=-_+"px",a(this,x.y,-_)):_<d&&(_=Math.max(0,_-x.y/2),this.element.style.marginTop=-_+"px",a(this,x.y,-_))),this.currentPage=m,o.call(this,{eventSource:this.tracker}))},update:function(){return i[this.id].animating?(e.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var m in this.miniViewers)this.miniViewers[m].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function n(m){if(m.quick){var T;this.scroll==="horizontal"?T=Math.floor(m.position.x/this.panelWidth):T=Math.floor(m.position.y/this.panelHeight),this.viewer.goToPage(T)}this.element.focus()}function r(m){if(this.dragging=!0,this.element){var T=Number(this.element.style.marginLeft.replace("px","")),x=Number(this.element.style.marginTop.replace("px","")),S=Number(this.element.style.width.replace("px","")),P=Number(this.element.style.height.replace("px","")),D=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-m.delta.x>0?T>-(S-D.x)&&(this.element.style.marginLeft=T+m.delta.x*2+"px",a(this,D.x,T+m.delta.x*2)):-m.delta.x<0&&T<0&&(this.element.style.marginLeft=T+m.delta.x*2+"px",a(this,D.x,T+m.delta.x*2)):-m.delta.y>0?x>-(P-D.y)&&(this.element.style.marginTop=x+m.delta.y*2+"px",a(this,D.y,x+m.delta.y*2)):-m.delta.y<0&&x<0&&(this.element.style.marginTop=x+m.delta.y*2+"px",a(this,D.y,x+m.delta.y*2))}}function l(m){if(this.element){var T=Number(this.element.style.marginLeft.replace("px","")),x=Number(this.element.style.marginTop.replace("px","")),S=Number(this.element.style.width.replace("px","")),P=Number(this.element.style.height.replace("px","")),D=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?m.scroll>0?T>-(S-D.x)&&(this.element.style.marginLeft=T-m.scroll*60+"px",a(this,D.x,T-m.scroll*60)):m.scroll<0&&T<0&&(this.element.style.marginLeft=T-m.scroll*60+"px",a(this,D.x,T-m.scroll*60)):m.scroll<0?x>D.y-P&&(this.element.style.marginTop=x+m.scroll*60+"px",a(this,D.y,x+m.scroll*60)):m.scroll>0&&x<0&&(this.element.style.marginTop=x+m.scroll*60+"px",a(this,D.y,x+m.scroll*60)),m.preventDefault=!0}}function a(m,T,x){var S,P,D,d,_,L;for(m.scroll==="horizontal"?S=m.panelWidth:S=m.panelHeight,P=Math.ceil(T/S)+5,D=Math.ceil((Math.abs(x)+T)/S)+1,P=D-P,P=P<0?0:P,_=P;_<D&&_<m.panels.length;_++)if(L=m.panels[_],!L.activePanel){var H,M=m.viewer.tileSources[_];M.referenceStripThumbnailUrl?H={type:"image",url:M.referenceStripThumbnailUrl}:H=M,d=new e.Viewer({id:L.id,tileSources:[H],element:L,navigatorSizeRatio:m.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:m.viewer.loadTilesWithAjax,ajaxHeaders:m.viewer.ajaxHeaders,useCanvas:m.useCanvas}),e.setElementPointerEventsNone(d.canvas),e.setElementPointerEventsNone(d.container),d.innerTracker.setTracking(!1),d.outerTracker.setTracking(!1),m.miniViewers[L.id]=d,L.activePanel=!0}}function o(m){var T=m.eventSource.element;this.scroll==="horizontal"?T.style.marginBottom="0px":T.style.marginLeft="0px"}function u(m){var T=m.eventSource.element;this.scroll==="horizontal"?T.style.marginBottom="-"+e.getElementSize(T).y/2+"px":T.style.marginLeft="-"+e.getElementSize(T).x/2+"px"}function h(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 38:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 40:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 37:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 39:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}function g(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 61:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 45:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 48:case 119:case 87:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 115:case 83:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 97:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 100:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}}(s),function(e){e.DisplayRect=function(i,n,r,l,a,o){e.Rect.apply(this,[i,n,r,l]),this.minLevel=a,this.maxLevel=o},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(s),function(e){e.Spring=function(n){var r=arguments;typeof n!="object"&&(n={initial:r.length&&typeof r[0]=="number"?r[0]:void 0,springStiffness:r.length>1?r[1].springStiffness:5,animationTime:r.length>1?r[1].animationTime:1.5}),e.console.assert(typeof n.springStiffness=="number"&&n.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof n.animationTime=="number"&&n.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),n.exponential&&(this._exponential=!0,delete n.exponential),e.extend(!0,this,n),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=n,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=n,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(n){this.start.value+=n,this.target.value+=n,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(n){this._exponential=n,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();var n,r;this._exponential?(n=this.start._logValue,r=this.target._logValue):(n=this.start.value,r=this.target.value);var l=this.current.time>=this.target.time?r:n+(r-n)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),a=this.current.value;return this._exponential?this.current.value=Math.exp(l):this.current.value=l,a!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(n,r){return(1-Math.exp(n*-r))/(1-Math.exp(-n))}}(s),function(e){function i(r){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},r),this.image=null}i.prototype={errorMsg:null,start:function(){var r=this,l=this.abort;this.image=new Image,this.image.onload=function(){r.finish(!0)},this.image.onabort=this.image.onerror=function(){r.errorMsg="Image load aborted",r.finish(!1)},this.jobId=window.setTimeout(function(){r.errorMsg="Image load exceeded timeout ("+r.timeout+" ms)",r.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(a){var o;try{o=new window.Blob([a.response])}catch(m){var u=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(m.name==="TypeError"&&u){var h=new u;h.append(a.response),o=h.getBlob()}}o.size===0&&(r.errorMsg="Empty image response.",r.finish(!1));var g=(window.URL||window.webkitURL).createObjectURL(o);r.image.src=g},error:function(a){r.errorMsg="Image load aborted - XHR error",r.finish(!1)}}),this.abort=function(){r.request.abort(),typeof l=="function"&&l()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(r){this.image.onload=this.image.onerror=this.image.onabort=null,r||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(r){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},r)},e.ImageLoader.prototype={addJob:function(r){var l=this,a=function(h){n(l,h,r.callback)},o={src:r.src,loadWithAjax:r.loadWithAjax,ajaxHeaders:r.loadWithAjax?r.ajaxHeaders:null,crossOriginPolicy:r.crossOriginPolicy,ajaxWithCredentials:r.ajaxWithCredentials,callback:a,abort:r.abort,timeout:this.timeout},u=new i(o);!this.jobLimit||this.jobsInProgress<this.jobLimit?(u.start(),this.jobsInProgress++):this.jobQueue.push(u)},clear:function(){for(var r=0;r<this.jobQueue.length;r++){var l=this.jobQueue[r];typeof l.abort=="function"&&l.abort()}this.jobQueue=[]}};function n(r,l,a){var o;r.jobsInProgress--,(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.jobQueue.length>0&&(o=r.jobQueue.shift(),o.start(),r.jobsInProgress++),a(l.image,l.errorMsg,l.request)}}(s),function(e){e.Tile=function(i,n,r,l,a,o,u,h,g,m){this.level=i,this.x=n,this.y=r,this.bounds=l,this.sourceBounds=m,this.exists=a,this.url=o,this.context2D=u,this.loadWithAjax=h,this.ajaxHeaders=g,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)},drawCanvas:function(i,n,r,l){var a=this.position.times(e.pixelDensityRatio),o=this.size.times(e.pixelDensityRatio),u;if(!this.context2D&&!this.cacheImageRecord){e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(u=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!u){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof r=="number"&&r!==1&&(a=a.times(r),o=o.times(r)),l instanceof e.Point&&(a=a.plus(l)),i.globalAlpha===1&&this._hasTransparencyChannel()&&i.clearRect(a.x,a.y,o.x,o.y),n({context:i,tile:this,rendered:u});var h,g;this.sourceBounds?(h=Math.min(this.sourceBounds.width,u.canvas.width),g=Math.min(this.sourceBounds.height,u.canvas.height)):(h=u.canvas.width,g=u.canvas.height),i.translate(a.x+o.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(u.canvas,0,0,h,g,-o.x/2,a.y,o.x,o.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,n,r){var l=Math.max(1,Math.ceil((r.x-n.x)/2)),a=Math.max(1,Math.ceil((r.y-n.y)/2));return new e.Point(l,a).minus(this.position.times(e.pixelDensityRatio).times(i||1).apply(function(o){return o%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(s),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(i,n,r){var l;e.isPlainObject(i)?l=i:l={element:i,location:n,placement:r},this.element=l.element,this.style=l.element.style,this._init(l)},e.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?e.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,n){var r=e.Placement.properties[this.placement];r&&(r.isHorizontallyCentered?i.x-=n.x/2:r.isRight&&(i.x-=n.x),r.isVerticallyCentered?i.y-=n.y/2:r.isBottom&&(i.y-=n.y))},destroy:function(){var i=this.element,n=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(n.display="none",document.body.appendChild(i))),this.onDraw=null,n.top="",n.left="",n.position="",this.width!==null&&(n.width=""),this.height!==null&&(n.height="");var r=e.getCssPropertyWithVendorPrefix("transformOrigin"),l=e.getCssPropertyWithVendorPrefix("transform");r&&l&&(n[r]="",n[l]="")},drawHTML:function(i,n){var r=this.element;r.parentNode!==i&&(r.prevElementParent=r.parentNode,r.prevNextSibling=r.nextSibling,i.appendChild(r),this.style.position="absolute",this.size=e.getElementSize(r));var l=this._getOverlayPositionAndSize(n),a=l.position,o=this.size=l.size,u=l.rotate;if(this.onDraw)this.onDraw(a,o,this.element);else{var h=this.style;h.left=a.x+"px",h.top=a.y+"px",this.width!==null&&(h.width=o.x+"px"),this.height!==null&&(h.height=o.y+"px");var g=e.getCssPropertyWithVendorPrefix("transformOrigin"),m=e.getCssPropertyWithVendorPrefix("transform");g&&m&&(u?(h[g]=this._getTransformOrigin(),h[m]="rotate("+u+"deg)"):(h[g]="",h[m]="")),h.display="block"}},_getOverlayPositionAndSize:function(i){var n=i.pixelFromPoint(this.location,!0),r=this._getSizeInPixels(i);this.adjust(n,r);var l=0;if(i.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var a=new e.Rect(n.x,n.y,r.x,r.y),o=this._getBoundingBox(a,i.degrees);n=o.getTopLeft(),r=o.getSize()}else l=i.degrees;return{position:n,size:r,rotate:l}},_getSizeInPixels:function(i){var n=this.size.x,r=this.size.y;if(this.width!==null||this.height!==null){var l=i.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);this.width!==null&&(n=l.x),this.height!==null&&(r=l.y)}if(this.checkResize&&(this.width===null||this.height===null)){var a=this.size=e.getElementSize(this.element);this.width===null&&(n=a.x),this.height===null&&(r=a.y)}return new e.Point(n,r)},_getBoundingBox:function(i,n){var r=this._getPlacementPoint(i);return i.rotate(n,r).getBoundingBox()},_getPlacementPoint:function(i){var n=new e.Point(i.x,i.y),r=e.Placement.properties[this.placement];return r&&(r.isHorizontallyCentered?n.x+=i.width/2:r.isRight&&(n.x+=i.width),r.isVerticallyCentered?n.y+=i.height/2:r.isBottom&&(n.y+=i.height)),n},_getTransformOrigin:function(){var i="",n=e.Placement.properties[this.placement];return n&&(n.isLeft?i="left":n.isRight&&(i="right"),n.isTop?i+=" top":n.isBottom&&(i+=" bottom")),i},update:function(i,n){var r=e.isPlainObject(i)?i:{location:i,placement:n};this._init({location:r.location||this.location,placement:r.placement!==void 0?r.placement:this.placement,onDraw:r.onDraw||this.onDraw,checkResize:r.checkResize||this.checkResize,width:r.width!==void 0?r.width:this.width,height:r.height!==void 0?r.height:this.height,rotationMode:r.rotationMode||this.rotationMode})},getBounds:function(i){e.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,r=this.height;if(n===null||r===null){var l=i.deltaPointsFromPixelsNoRotate(this.size,!0);n===null&&(n=l.x),r===null&&(r=l.y)}var a=this.location.clone();return this.adjust(a,new e.Point(n,r)),this._adjustBoundsForRotation(i,new e.Rect(a.x,a.y,n,r))},_adjustBoundsForRotation:function(i,n){if(!i||i.degrees===0||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return n;var r=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new e.Rect(r.position.x,r.position.y,r.size.x,r.size.y))}return n.rotate(-i.degrees,this._getPlacementPoint(n))}}}(s),function(e){e.Drawer=function(i){e.console.assert(i.viewer,"[Drawer] options.viewer is required");var n=arguments;if(e.isPlainObject(i)||(i={source:n[0],viewport:n[1],element:n[2]}),e.console.assert(i.viewport,"[Drawer] options.viewport is required"),e.console.assert(i.element,"[Drawer] options.element is required"),i.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,i.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(i.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var r=this._calculateCanvasSize();this.canvas.width=r.x,this.canvas.height=r.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(i,n,r,l){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,n,r,l),this},updateOverlay:function(i,n,r){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,n,r),this},removeOverlay:function(i){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var n=this.viewport.pixelFromPointNoRotate(i,!0);return new e.Point(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},clipWithPolygons:function(i,n){if(this.useCanvas){var r=this._getContext(n);r.beginPath(),i.forEach(function(l){l.forEach(function(a,o){r[o===0?"moveTo":"lineTo"](a.x,a.y)})}),r.clip()}},setOpacity:function(i){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var n=this.viewer.world,r=0;r<n.getItemCount();r++)n.getItemAt(r).setOpacity(i);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,n=0,r=0;r<i.getItemCount();r++){var l=i.getItemAt(r).getOpacity();l>n&&(n=l)}return n},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var n=this._calculateSketchCanvasSize();this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,n){if(this.useCanvas){var r=this._getContext(i);if(n)r.clearRect(n.x,n.y,n.width,n.height);else{var l=r.canvas;r.clearRect(0,0,l.width,l.height)}}},viewportToDrawerRectangle:function(i){var n=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),r=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,r.x*e.pixelDensityRatio,r.y*e.pixelDensityRatio)},drawTile:function(i,n,r,l,a){if(e.console.assert(i,"[Drawer.drawTile] tile is required"),e.console.assert(n,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var o=this._getContext(r);l=l||1,i.drawCanvas(o,n,l,a)}else i.drawHTML(this.canvas)},_getContext:function(i){var n=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var r=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var l=this;this.viewer.addHandler("rotate",function a(){if(l.viewport.getRotation()!==0){l.viewer.removeHandler("rotate",a);var o=l._calculateSketchCanvasSize();l.sketchCanvas.width=o.x,l.sketchCanvas.height=o.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}n=this.sketchContext}return n},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,n){if(this.useCanvas){var r=this._getContext(n);r.beginPath(),r.rect(i.x,i.y,i.width,i.height),r.clip()}},drawRectangle:function(i,n,r){if(this.useCanvas){var l=this._getContext(r);l.save(),l.fillStyle=n,l.fillRect(i.x,i.y,i.width,i.height),l.restore()}},blendSketch:function(i,n,r,l){var a=i;if(e.isPlainObject(a)||(a={opacity:i,scale:n,translate:r,compositeOperation:l}),!(!this.useCanvas||!this.sketchCanvas)){i=a.opacity,l=a.compositeOperation;var o=a.bounds;if(this.context.save(),this.context.globalAlpha=i,l&&(this.context.globalCompositeOperation=l),o)o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height);else{n=a.scale||1,r=a.translate;var u=r instanceof e.Point?r:new e.Point(0,0),h=0,g=0;if(r){var m=this.sketchCanvas.width-this.canvas.width,T=this.sketchCanvas.height-this.canvas.height;h=Math.round(m/2),g=Math.round(T/2)}this.context.drawImage(this.sketchCanvas,u.x-h*n,u.y-g*n,(this.canvas.width+2*h)*n,(this.canvas.height+2*g)*n,-h,-g,this.canvas.width+2*h,this.canvas.height+2*g)}this.context.restore()}},drawDebugInfo:function(i,n,r,l){if(this.useCanvas){var a=this.viewer.world.getIndexOfItem(l)%this.debugGridColor.length,o=this.context;o.save(),o.lineWidth=2*e.pixelDensityRatio,o.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor[a],o.fillStyle=this.debugGridColor[a],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),l.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:l.getRotation(!0),point:l.viewport.pixelFromPointNoRotate(l._getRotationPoint(!0),!0)}),l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),o.strokeRect(i.position.x*e.pixelDensityRatio,i.position.y*e.pixelDensityRatio,i.size.x*e.pixelDensityRatio,i.size.y*e.pixelDensityRatio);var u=(i.position.x+i.size.x/2)*e.pixelDensityRatio,h=(i.position.y+i.size.y/2)*e.pixelDensityRatio;o.translate(u,h),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-u,-h),i.x===0&&i.y===0&&(o.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*e.pixelDensityRatio,(i.position.y-30)*e.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*e.pixelDensityRatio,(i.position.y-20)*e.pixelDensityRatio)),o.fillText("Level: "+i.level,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+20)*e.pixelDensityRatio),o.fillText("Column: "+i.x,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+30)*e.pixelDensityRatio),o.fillText("Row: "+i.y,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+40)*e.pixelDensityRatio),o.fillText("Order: "+r+" of "+n,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+50)*e.pixelDensityRatio),o.fillText("Size: "+i.size.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+60)*e.pixelDensityRatio),o.fillText("Position: "+i.position.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+70)*e.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),l.getRotation(!0)%360!==0&&this._restoreRotationChanges(),l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),o.restore()}},debugRect:function(i){if(this.useCanvas){var n=this.context;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,i.width*e.pixelDensityRatio,i.height*e.pixelDensityRatio),n.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var n=this._getContext(i).canvas;return new e.Point(n.width,n.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),r=this._getContext(i.useSketch);r.save(),r.translate(n.x,n.y),this.viewer.viewport.flipped?(r.rotate(Math.PI/180*-i.degrees),r.scale(-1,1)):r.rotate(Math.PI/180*i.degrees),r.translate(-n.x,-n.y)},_flip:function(i){i=i||{};var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),r=this._getContext(i.useSketch);r.translate(n.x,0),r.scale(-1,1),r.translate(-n.x,0)},_restoreRotationChanges:function(i){var n=this._getContext(i);n.restore()},_calculateCanvasSize:function(){var i=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*i),y:Math.round(n.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var n=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:n,y:n}}}}(s),function(e){e.Viewport=function(i){var n=arguments;n.length&&n[0]instanceof e.Point&&(i={containerSize:n[0],contentSize:n[1],config:n[2]}),i.config&&(e.extend(!0,i,i.config),delete i.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},i),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(i){return e.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(i instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,n)},_setContentBounds:function(i,n){e.console.assert(i,"[Viewport._setContentBounds] bounds is required"),e.console.assert(i instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=i.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),n;return this.homeFillsViewer?n=i>=1?i:1:n=i>=1?1:i,n/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),n=1/this.getHomeZoom(),r=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-r/2,n,r)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),n=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return n},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(i){e.console.assert(e.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation())},getBoundsNoRotate:function(i){var n=this.getCenter(i),r=1/this.getZoom(i),l=r/this.getAspectRatio();return new e.Rect(n.x-r/2,n.y-l/2,r,l)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var n=this.getBoundsNoRotate(i),r=this._containerInnerSize.x*this.getZoom(i);return n.x-=this._margins.left/r,n.y-=this._margins.top/r,n.width+=(this._margins.left+this._margins.right)/r,n.height+=(this._margins.top+this._margins.bottom)/r,n},getCenter:function(i){var n=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),r=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),l,a,o,u,h,g,m,T;return i?n:this.zoomPoint?(l=this.pixelFromPoint(this.zoomPoint,!0),a=this.getZoom(),o=1/a,u=o/this.getAspectRatio(),h=new e.Rect(n.x-o/2,n.y-u/2,o,u),g=this._pixelFromPoint(this.zoomPoint,h),m=g.minus(l),T=m.divide(this._containerInnerSize.x*a),r.plus(T)):r},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var n=new e.Rect(i.x,i.y,i.width,i.height);if(!this.wrapHorizontal){var r=this.visibilityRatio*n.width,l=n.x+n.width,a=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,o=this._contentBoundsNoRotate.x-l+r,u=a-n.x-r;r>this._contentBoundsNoRotate.width?n.x+=(o+u)/2:u<0?n.x+=u:o>0&&(n.x+=o)}if(!this.wrapVertical){var h=this.visibilityRatio*n.height,g=n.y+n.height,m=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,T=this._contentBoundsNoRotate.y-g+h,x=m-n.y-h;h>this._contentBoundsNoRotate.height?n.y+=(T+x)/2:x<0?n.y+=x:T>0&&(n.y+=T)}return n},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var n=this.getZoom(),r=this._applyZoomConstraints(n);n!==r&&this.zoomTo(r,this.zoomPoint,i);var l=this.getBoundsNoRotate(),a=this._applyBoundaryConstraints(l);return this._raiseConstraintsEvent(i),(l.x!==a.x||l.y!==a.y||i)&&this.fitBounds(a.rotate(-this.getRotation()),i),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,n){n=n||{};var r=n.immediately||!1,l=n.constraints||!1,a=this.getAspectRatio(),o=i.getCenter(),u=new e.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();u.getAspectRatio()>=a?u.height=u.width/a:u.width=u.height*a,u.x=o.x-u.width/2,u.y=o.y-u.height/2;var h=1/u.width;if(l){var g=u.getAspectRatio(),m=this._applyZoomConstraints(h);h!==m&&(h=m,u.width=1/h,u.x=o.x-u.width/2,u.height=u.width/g,u.y=o.y-u.height/2),u=this._applyBoundaryConstraints(u),o=u.getCenter(),this._raiseConstraintsEvent(r)}if(r)return this.panTo(o,!0),this.zoomTo(h,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var T=this.getBounds(),x=this.getZoom();if(x===0||Math.abs(h/x-1)<1e-8)return this.zoomTo(h,!0),this.panTo(o,r);u=u.rotate(-this.getRotation());var S=u.getTopLeft().times(h).minus(T.getTopLeft().times(x)).divide(h-x);return this.zoomTo(h,S,r)},fitBounds:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!1})},fitBoundsWithConstraints:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!0})},fitVertically:function(i){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,i)},fitHorizontally:function(i){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,i)},getConstrainedBounds:function(i){var n,r;return n=this.getBounds(i),r=this._applyBoundaryConstraints(n),r},panBy:function(i,n){var r=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(r.plus(i),n)},panTo:function(i,n){return n?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:n}),this},zoomBy:function(i,n,r){return this.zoomTo(this.zoomSpring.target.value*i,n,r)},zoomTo:function(i,n,r){var l=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,r?this._adjustCenterSpringsForZoomPoint(function(){l.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:n,immediately:r}),this},setRotation:function(i){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=e.positiveModulo(i,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i}),this)},getRotation:function(){return this.degrees},resize:function(i,n){var r=this.getBoundsNoRotate(),l=r,a;return this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),n&&(a=i.x/this.containerSize.x,l.width=r.width*a,l.height=l.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:n}),this.fitBounds(l,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var n=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,n},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var n=this.pixelFromPoint(this.zoomPoint,!0);i();var r=this.pixelFromPoint(this.zoomPoint,!0),l=r.minus(n),a=this.deltaPointsFromPixels(l,!0);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,n){return i.times(this._containerInnerSize.x*this.getZoom(n))},deltaPixelsFromPoints:function(i,n){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation()),n)},deltaPointsFromPixelsNoRotate:function(i,n){return i.divide(this._containerInnerSize.x*this.getZoom(n))},deltaPointsFromPixels:function(i,n){return this.deltaPointsFromPixelsNoRotate(i,n).rotate(-this.getRotation())},pixelFromPointNoRotate:function(i,n){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(n))},pixelFromPoint:function(i,n){return this._pixelFromPoint(i,this.getBoundsNoRotate(n))},_pixelFromPointNoRotate:function(i,n){return i.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,n){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(),this.getCenter(!0)),n)},pointFromPixelNoRotate:function(i,n){var r=this.getBoundsNoRotate(n);return i.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/r.width).plus(r.getTopLeft())},pointFromPixel:function(i,n){return this.pointFromPixelNoRotate(i,n).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(i,n){var r=this._contentBoundsNoRotate.width;return new e.Point(i*this._contentSizeNoRotate.x/r,n*this._contentSizeNoRotate.x/r)},viewportToImageCoordinates:function(i,n){if(i instanceof e.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(r===1){var l=this.viewer.world.getItemAt(0);return l.viewportToImageCoordinates(i,n,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,n){var r=this._contentBoundsNoRotate.width;return new e.Point(i/this._contentSizeNoRotate.x*r,n/this._contentSizeNoRotate.x*r)},imageToViewportCoordinates:function(i,n){if(i instanceof e.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(r===1){var l=this.viewer.world.getItemAt(0);return l.imageToViewportCoordinates(i,n,!0)}}var a=this._imageToViewportDelta(i,n);return a.x+=this._contentBoundsNoRotate.x,a.y+=this._contentBoundsNoRotate.y,a},imageToViewportRectangle:function(i,n,r,l){var a=i;if(a instanceof e.Rect||(a=new e.Rect(i,n,r,l)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(o===1){var u=this.viewer.world.getItemAt(0);return u.imageToViewportRectangle(i,n,r,l,!0)}}var h=this.imageToViewportCoordinates(a.x,a.y),g=this._imageToViewportDelta(a.width,a.height);return new e.Rect(h.x,h.y,g.x,g.y,a.degrees)},viewportToImageRectangle:function(i,n,r,l){var a=i;if(a instanceof e.Rect||(a=new e.Rect(i,n,r,l)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(o===1){var u=this.viewer.world.getItemAt(0);return u.viewportToImageRectangle(i,n,r,l,!0)}}var h=this.viewportToImageCoordinates(a.x,a.y),g=this._viewportToImageDelta(a.width,a.height);return new e.Rect(h.x,h.y,g.x,g.y,a.degrees)},viewerElementToImageCoordinates:function(i){var n=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(i){var n=this.imageToViewportCoordinates(i);return this.pixelFromPoint(n,!0)},windowToImageCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var n=this.imageToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return e.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return e.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var n=this.viewportToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(n===1){var r=this.viewer.world.getItemAt(0);return r.viewportToImageZoom(i)}}var l=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,o=this._contentBoundsNoRotate.width,u=a/l*o;return i*u},imageToViewportZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(n===1){var r=this.viewer.world.getItemAt(0);return r.imageToViewportZoom(i)}}var l=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,o=this._contentBoundsNoRotate.width,u=l/a/o;return i*u},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}}(s),function(e){e.TiledImage=function(d){var _=this;e.console.assert(d.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(d.drawer,"[TiledImage] options.drawer is required"),e.console.assert(d.viewer,"[TiledImage] options.viewer is required"),e.console.assert(d.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(d.source,"[TiledImage] options.source is required"),e.console.assert(!d.clip||d.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=d.tileCache,delete d.tileCache,this._drawer=d.drawer,delete d.drawer,this._imageLoader=d.imageLoader,delete d.imageLoader,d.clip instanceof e.Rect&&(this._clip=d.clip.clone()),delete d.clip;var L=d.x||0;delete d.x;var H=d.y||0;delete d.y,this.normHeight=d.source.dimensions.y/d.source.dimensions.x,this.contentAspectX=d.source.dimensions.x/d.source.dimensions.y;var M=1;d.width?(M=d.width,delete d.width,d.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete d.height)):d.height&&(M=d.height/this.normHeight,delete d.height);var V=d.fitBounds;delete d.fitBounds;var G=d.fitBoundsPlacement||s.Placement.CENTER;delete d.fitBoundsPlacement;var Z=d.degrees||0;delete d.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},d),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:L,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:H,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:M,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:Z,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),V&&this.fitBounds(V,G,!0),this._drawingHandler=function($){_.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:_},$))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(d){d!==this._fullyLoaded&&(this._fullyLoaded=d,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var d=this._xSpring.update(),_=this._ySpring.update(),L=this._scaleSpring.update(),H=this._degreesSpring.update();return d||_||L||H?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(d){return this.getBoundsNoRotate(d).rotate(this.getRotation(d),this._getRotationPoint(d))},getBoundsNoRotate:function(d){return d?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(d){var _=this.getBoundsNoRotate(d);if(this._clip){var L=d?this._worldWidthCurrent:this._worldWidthTarget,H=L/this.source.dimensions.x,M=this._clip.times(H);_=new e.Rect(_.x+M.x,_.y+M.y,M.width,M.height)}return _.rotate(this.getRotation(d),this._getRotationPoint(d))},getTileBounds:function(d,_,L){var H=this.source.getNumTiles(d),M=(H.x+_%H.x)%H.x,V=(H.y+L%H.y)%H.y,G=this.source.getTileBounds(d,M,V);return this.getFlip()&&(G.x=1-G.x-G.width),G.x+=(_-M)/H.x,G.y+=this._worldHeightCurrent/this._worldWidthCurrent*((L-V)/H.y),G},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var d=this.imageToWindowCoordinates(new e.Point(0,0)),_=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(_.x-d.x,_.y-d.y)},_viewportToImageDelta:function(d,_,L){var H=L?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(d*(this.source.dimensions.x/H),_*(this.source.dimensions.y*this.contentAspectX/H))},viewportToImageCoordinates:function(d,_,L){var H;return d instanceof e.Point?(L=_,H=d):H=new e.Point(d,_),H=H.rotate(-this.getRotation(L),this._getRotationPoint(L)),L?this._viewportToImageDelta(H.x-this._xSpring.current.value,H.y-this._ySpring.current.value):this._viewportToImageDelta(H.x-this._xSpring.target.value,H.y-this._ySpring.target.value)},_imageToViewportDelta:function(d,_,L){var H=L?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(d/this.source.dimensions.x*H,_/this.source.dimensions.y/this.contentAspectX*H)},imageToViewportCoordinates:function(d,_,L){d instanceof e.Point&&(L=_,_=d.y,d=d.x);var H=this._imageToViewportDelta(d,_);return L?(H.x+=this._xSpring.current.value,H.y+=this._ySpring.current.value):(H.x+=this._xSpring.target.value,H.y+=this._ySpring.target.value),H.rotate(this.getRotation(L),this._getRotationPoint(L))},imageToViewportRectangle:function(d,_,L,H,M){var V=d;V instanceof e.Rect?M=_:V=new e.Rect(d,_,L,H);var G=this.imageToViewportCoordinates(V.getTopLeft(),M),Z=this._imageToViewportDelta(V.width,V.height,M);return new e.Rect(G.x,G.y,Z.x,Z.y,V.degrees+this.getRotation(M))},viewportToImageRectangle:function(d,_,L,H,M){var V=d;d instanceof e.Rect?M=_:V=new e.Rect(d,_,L,H);var G=this.viewportToImageCoordinates(V.getTopLeft(),M),Z=this._viewportToImageDelta(V.width,V.height,M);return new e.Rect(G.x,G.y,Z.x,Z.y,V.degrees-this.getRotation(M))},viewerElementToImageCoordinates:function(d){var _=this.viewport.pointFromPixel(d,!0);return this.viewportToImageCoordinates(_)},imageToViewerElementCoordinates:function(d){var _=this.imageToViewportCoordinates(d);return this.viewport.pixelFromPoint(_,!0)},windowToImageCoordinates:function(d){var _=d.minus(s.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(_)},imageToWindowCoordinates:function(d){var _=this.imageToViewerElementCoordinates(d);return _.plus(s.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(d){var _=this._scaleSpring.current.value;return d=d.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((d.x-this._xSpring.current.value)/_,(d.y-this._ySpring.current.value)/_,d.width/_,d.height/_,d.degrees)},viewportToImageZoom:function(d){var _=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return _*d},imageToViewportZoom:function(d){var _=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return d/_},setPosition:function(d,_){var L=this._xSpring.target.value===d.x&&this._ySpring.target.value===d.y;if(_){if(L&&this._xSpring.current.value===d.x&&this._ySpring.current.value===d.y)return;this._xSpring.resetTo(d.x),this._ySpring.resetTo(d.y),this._needsDraw=!0}else{if(L)return;this._xSpring.springTo(d.x),this._ySpring.springTo(d.y),this._needsDraw=!0}L||this._raiseBoundsChange()},setWidth:function(d,_){this._setScale(d,_)},setHeight:function(d,_){this._setScale(d/this.normHeight,_)},setCroppingPolygons:function(d){var _=function(H){return H instanceof e.Point||typeof H.x=="number"&&typeof H.y=="number"},L=function(H){return H.map(function(M){try{if(_(M))return{x:M.x,y:M.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(d))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=d.map(function(H){return L(H)})}catch(H){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(H),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(d,_,L){_=_||e.Placement.CENTER;var H=e.Placement.properties[_],M=this.contentAspectX,V=0,G=0,Z=1,$=1;if(this._clip&&(M=this._clip.getAspectRatio(),Z=this._clip.width/this.source.dimensions.x,$=this._clip.height/this.source.dimensions.y,d.getAspectRatio()>M?(V=this._clip.x/this._clip.height*d.height,G=this._clip.y/this._clip.height*d.height):(V=this._clip.x/this._clip.width*d.width,G=this._clip.y/this._clip.width*d.width)),d.getAspectRatio()>M){var se=d.height/$,J=0;H.isHorizontallyCentered?J=(d.width-d.height*M)/2:H.isRight&&(J=d.width-d.height*M),this.setPosition(new e.Point(d.x-V+J,d.y-G),L),this.setHeight(se,L)}else{var fe=d.width/Z,ue=0;H.isVerticallyCentered?ue=(d.height-d.width/M)/2:H.isBottom&&(ue=d.height-d.width/M),this.setPosition(new e.Point(d.x-V,d.y-G+ue),L),this.setWidth(fe,L)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(d){e.console.assert(!d||d instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),d instanceof e.Rect?this._clip=d.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(d){this.flipped=!!d,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(d){d!==this.opacity&&(this.opacity=d,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(d){this._preload=!!d,this._needsDraw=!0},getRotation:function(d){return d?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(d,_){this._degreesSpring.target.value===d&&this._degreesSpring.isAtTargetValue()||(_?this._degreesSpring.resetTo(d):this._degreesSpring.springTo(d),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(d){return this.getBoundsNoRotate(d).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(d){d!==this.compositeOperation&&(this.compositeOperation=d,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(d,_){var L=this._scaleSpring.target.value===d;if(_){if(L&&this._scaleSpring.current.value===d)return;this._scaleSpring.resetTo(d),this._updateForScale(),this._needsDraw=!0}else{if(L)return;this._scaleSpring.springTo(d),this._updateForScale(),this._needsDraw=!0}L||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var d=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),_=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,L=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(_/this.minPixelRatio)/Math.log(2))));return L=Math.max(L,this.source.minLevel||0),d=Math.min(d,L),{lowestLevel:d,highestLevel:L}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var d=this.lastDrawn.pop();d.beingDrawn=!1}var _=this.viewport,L=this._viewportToTiledImageRectangle(_.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var H=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(L=L.intersection(H),L===null)return}for(var M=this._getLevelsInterval(),V=M.lowestLevel,G=M.highestLevel,Z=null,$=!1,se=e.now(),J=G;J>=V;J--){var fe=!1,ue=_.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(J),!0).x*this._scaleSpring.current.value;if(J===V||!$&&ue>=this.minPixelRatio)fe=!0,$=!0;else if(!$)continue;var ve=_.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(J),!1).x*this._scaleSpring.current.value,le=_.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,re=this.immediateRender?1:le,ee=Math.min(1,(ue-.5)/.5),ye=re/Math.abs(re-ve);if(Z=i(this,$,fe,J,ee,ye,L,se,Z),g(this.coverage,J))break}P(this,this.lastDrawn),Z&&!Z.context2D?(l(this,Z,se),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(d,_,L){var H,M;this.wrapHorizontal?(H=e.positiveModulo(_.x,1),M=e.positiveModulo(L.x,1)):(H=Math.max(0,_.x),M=Math.min(1,L.x));var V,G,Z=1/this.source.aspectRatio;this.wrapVertical?(V=e.positiveModulo(_.y,Z),G=e.positiveModulo(L.y,Z)):(V=Math.max(0,_.y),G=Math.min(Z,L.y));var $=this.source.getTileAtPoint(d,new e.Point(H,V)),se=this.source.getTileAtPoint(d,new e.Point(M,G)),J=this.source.getNumTiles(d);return this.wrapHorizontal&&($.x+=J.x*Math.floor(_.x),se.x+=J.x*Math.floor(L.x)),this.wrapVertical&&($.y+=J.y*Math.floor(_.y/Z),se.y+=J.y*Math.floor(L.y/Z)),{topLeft:$,bottomRight:se}}});function i(d,_,L,H,M,V,G,Z,$){var se=G.getBoundingBox().getTopLeft(),J=G.getBoundingBox().getBottomRight();d.viewer&&d.viewer.raiseEvent("update-level",{tiledImage:d,havedrawn:_,level:H,opacity:M,visibility:V,drawArea:G,topleft:se,bottomright:J,currenttime:Z,best:$}),x(d.coverage,H),x(d.loadingCoverage,H);var fe=d._getCornerTiles(H,se,J),ue=fe.topLeft,ve=fe.bottomRight,le=d.source.getNumTiles(H),re=d.viewport.pixelFromPoint(d.viewport.getCenter());d.getFlip()&&(ve.x+=1,d.wrapHorizontal||(ve.x=Math.min(ve.x,le.x-1)));for(var ee=ue.x;ee<=ve.x;ee++)for(var ye=ue.y;ye<=ve.y;ye++){var Y;if(d.getFlip()){var Pe=(le.x+ee%le.x)%le.x;Y=ee+le.x-Pe-Pe-1}else Y=ee;G.intersection(d.getTileBounds(H,Y,ye))!==null&&($=n(d,L,_,Y,ye,H,M,V,re,le,Z,$))}return $}function n(d,_,L,H,M,V,G,Z,$,se,J,fe){var ue=r(H,M,V,d,d.source,d.tilesMatrix,J,se,d._worldWidthCurrent,d._worldHeightCurrent),ve=L;d.viewer&&d.viewer.raiseEvent("update-tile",{tiledImage:d,tile:ue}),T(d.coverage,V,H,M,!1);var le=ue.loaded||ue.loading||m(d.loadingCoverage,V,H,M);if(T(d.loadingCoverage,V,H,M,le),!ue.exists||(_&&!ve&&(m(d.coverage,V,H,M)?T(d.coverage,V,H,M,!0):ve=!0),!ve))return fe;if(u(ue,d.source.tileOverlap,d.viewport,$,Z,d),!ue.loaded)if(ue.context2D)o(d,ue);else{var re=d._tileCache.getImageRecord(ue.cacheKey);if(re){var ee=re.getImage();o(d,ue,ee)}}if(ue.loaded){var ye=h(d,ue,H,M,V,G,J);ye&&(d._needsDraw=!0)}else ue.loading?d._tilesLoading++:le||(fe=S(fe,ue));return fe}function r(d,_,L,H,M,V,G,Z,$,se){var J,fe,ue,ve,le,re,ee,ye,Y;return V[L]||(V[L]={}),V[L][d]||(V[L][d]={}),(!V[L][d][_]||!V[L][d][_].flipped!=!H.flipped)&&(J=(Z.x+d%Z.x)%Z.x,fe=(Z.y+_%Z.y)%Z.y,ue=H.getTileBounds(L,d,_),ve=M.getTileBounds(L,J,fe,!0),le=M.tileExists(L,J,fe),re=M.getTileUrl(L,J,fe),H.loadTilesWithAjax?(ee=M.getTileAjaxHeaders(L,J,fe),e.isPlainObject(H.ajaxHeaders)&&(ee=e.extend({},H.ajaxHeaders,ee))):ee=null,ye=M.getContext2D?M.getContext2D(L,J,fe):void 0,Y=new e.Tile(L,d,_,ue,le,re,ye,H.loadTilesWithAjax,ee,ve),H.getFlip()?J===0&&(Y.isRightMost=!0):J===Z.x-1&&(Y.isRightMost=!0),fe===Z.y-1&&(Y.isBottomMost=!0),Y.flipped=H.flipped,V[L][d][_]=Y),Y=V[L][d][_],Y.lastTouchTime=G,Y}function l(d,_,L){_.loading=!0,d._imageLoader.addJob({src:_.url,loadWithAjax:_.loadWithAjax,ajaxHeaders:_.ajaxHeaders,crossOriginPolicy:d.crossOriginPolicy,ajaxWithCredentials:d.ajaxWithCredentials,callback:function(H,M,V){a(d,_,L,H,M,V)},abort:function(){_.loading=!1}})}function a(d,_,L,H,M,V){if(!H){e.console.log("Tile %s failed to load: %s - error: %s",_,_.url,M),d.viewer.raiseEvent("tile-load-failed",{tile:_,tiledImage:d,time:L,message:M,tileRequest:V}),_.loading=!1,_.exists=!1;return}if(L<d.lastResetTime){e.console.log("Ignoring tile %s loaded before reset: %s",_,_.url),_.loading=!1;return}var G=function(){var Z=d.source.getClosestLevel();o(d,_,H,Z,V)};d._midDraw?window.setTimeout(G,1):G()}function o(d,_,L,H,M){var V=0;function G(){return V++,Z}function Z(){V--,V===0&&(_.loading=!1,_.loaded=!0,_.context2D||d._tileCache.cacheTile({image:L,tile:_,cutoff:H,tiledImage:d}),d._needsDraw=!0)}d.viewer.raiseEvent("tile-loaded",{tile:_,tiledImage:d,tileRequest:M,image:L,getCompletionCallback:G}),G()()}function u(d,_,L,H,M,V){var G=d.bounds.getTopLeft();G.x*=V._scaleSpring.current.value,G.y*=V._scaleSpring.current.value,G.x+=V._xSpring.current.value,G.y+=V._ySpring.current.value;var Z=d.bounds.getSize();Z.x*=V._scaleSpring.current.value,Z.y*=V._scaleSpring.current.value;var $=L.pixelFromPointNoRotate(G,!0),se=L.pixelFromPointNoRotate(G,!1),J=L.deltaPixelsFromPointsNoRotate(Z,!0),fe=L.deltaPixelsFromPointsNoRotate(Z,!1),ue=se.plus(fe.divide(2)),ve=H.squaredDistanceTo(ue);_||(J=J.plus(new e.Point(1,1))),d.isRightMost&&V.wrapHorizontal&&(J.x+=.75),d.isBottomMost&&V.wrapVertical&&(J.y+=.75),d.position=$,d.size=J,d.squaredDistance=ve,d.visibility=M}function h(d,_,L,H,M,V,G){var Z=1e3*d.blendTime,$,se;if(_.blendStart||(_.blendStart=G),$=G-_.blendStart,se=Z?Math.min(1,$/Z):1,d.alwaysBlend&&(se*=V),_.opacity=se,d.lastDrawn.push(_),se===1)T(d.coverage,M,L,H,!0),d._hasOpaqueTile=!0;else if($<Z)return!0;return!1}function g(d,_,L,H){var M,V,G,Z;if(!d[_])return!1;if(L===void 0||H===void 0){M=d[_];for(G in M)if(Object.prototype.hasOwnProperty.call(M,G)){V=M[G];for(Z in V)if(Object.prototype.hasOwnProperty.call(V,Z)&&!V[Z])return!1}return!0}return d[_][L]===void 0||d[_][L][H]===void 0||d[_][L][H]===!0}function m(d,_,L,H){return L===void 0||H===void 0?g(d,_+1):g(d,_+1,2*L,2*H)&&g(d,_+1,2*L,2*H+1)&&g(d,_+1,2*L+1,2*H)&&g(d,_+1,2*L+1,2*H+1)}function T(d,_,L,H,M){if(!d[_]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",_);return}d[_][L]||(d[_][L]={}),d[_][L][H]=M}function x(d,_){d[_]={}}function S(d,_){return!d||_.visibility>d.visibility||_.visibility===d.visibility&&_.squaredDistance<d.squaredDistance?_:d}function P(d,_){if(!(d.opacity===0||_.length===0&&!d.placeholderFillStyle)){var L=_[0],H;L&&(H=d.opacity<1||d.compositeOperation&&d.compositeOperation!=="source-over"||!d._isBottomItem()&&L._hasTransparencyChannel());var M,V,G=d.viewport.getZoom(!0),Z=d.viewportToImageZoom(G);_.length>1&&Z>d.smoothTileEdgesMinZoom&&!d.iOSDevice&&d.getRotation(!0)%360===0&&e.supportsCanvas&&(H=!0,M=L.getScaleForEdgeSmoothing(),V=L.getTranslationForEdgeSmoothing(M,d._drawer.getCanvasSize(!1),d._drawer.getCanvasSize(!0)));var $;H&&(M||($=d.viewport.viewportToViewerElementRectangle(d.getClippedBounds(!0)).getIntegerBoundingBox(),d._drawer.viewer.viewport.getFlip()&&(d.viewport.degrees!==0||d.getRotation(!0)%360!==0)&&($.x=d._drawer.viewer.container.clientWidth-($.x+$.width)),$=$.times(e.pixelDensityRatio)),d._drawer._clear(!0,$)),M||(d.viewport.degrees!==0&&d._drawer._offsetForRotation({degrees:d.viewport.degrees,useSketch:H}),d.getRotation(!0)%360!==0&&d._drawer._offsetForRotation({degrees:d.getRotation(!0),point:d.viewport.pixelFromPointNoRotate(d._getRotationPoint(!0),!0),useSketch:H}),d.viewport.degrees===0&&d.getRotation(!0)%360===0&&d._drawer.viewer.viewport.getFlip()&&d._drawer._flip());var se=!1;if(d._clip){d._drawer.saveContext(H);var J=d.imageToViewportRectangle(d._clip,!0);J=J.rotate(-d.getRotation(!0),d._getRotationPoint(!0));var fe=d._drawer.viewportToDrawerRectangle(J);M&&(fe=fe.times(M)),V&&(fe=fe.translate(V)),d._drawer.setClip(fe,H),se=!0}if(d._croppingPolygons){d._drawer.saveContext(H);try{var ue=d._croppingPolygons.map(function(ee){return ee.map(function(ye){var Y=d.imageToViewportCoordinates(ye.x,ye.y,!0).rotate(-d.getRotation(!0),d._getRotationPoint(!0)),Pe=d._drawer.viewportCoordToDrawerCoord(Y);return M&&(Pe=Pe.times(M)),Pe})});d._drawer.clipWithPolygons(ue,H)}catch(ee){e.console.error(ee)}se=!0}if(d.placeholderFillStyle&&d._hasOpaqueTile===!1){var ve=d._drawer.viewportToDrawerRectangle(d.getBounds(!0));M&&(ve=ve.times(M)),V&&(ve=ve.translate(V));var le=null;typeof d.placeholderFillStyle=="function"?le=d.placeholderFillStyle(d,d._drawer.context):le=d.placeholderFillStyle,d._drawer.drawRectangle(ve,le,H)}for(var re=_.length-1;re>=0;re--)L=_[re],d._drawer.drawTile(L,d._drawingHandler,H,M,V),L.beingDrawn=!0,d.viewer&&d.viewer.raiseEvent("tile-drawn",{tiledImage:d,tile:L});se&&d._drawer.restoreContext(H),M||(d.getRotation(!0)%360!==0&&d._drawer._restoreRotationChanges(H),d.viewport.degrees!==0&&d._drawer._restoreRotationChanges(H)),H&&(M&&(d.viewport.degrees!==0&&d._drawer._offsetForRotation({degrees:d.viewport.degrees,useSketch:!1}),d.getRotation(!0)%360!==0&&d._drawer._offsetForRotation({degrees:d.getRotation(!0),point:d.viewport.pixelFromPointNoRotate(d._getRotationPoint(!0),!0),useSketch:!1})),d._drawer.blendSketch({opacity:d.opacity,scale:M,translate:V,compositeOperation:d.compositeOperation,bounds:$}),M&&(d.getRotation(!0)%360!==0&&d._drawer._restoreRotationChanges(!1),d.viewport.degrees!==0&&d._drawer._restoreRotationChanges(!1))),M||d.viewport.degrees===0&&d.getRotation(!0)%360===0&&d._drawer.viewer.viewport.getFlip()&&d._drawer._flip(),D(d,_)}}function D(d,_){if(d.debugMode)for(var L=_.length-1;L>=0;L--){var H=_[L];try{d._drawer.drawDebugInfo(H,_.length,L,d)}catch(M){e.console.error(M)}}}}(s),function(e){var i=function(r){e.console.assert(r,"[TileCache.cacheTile] options is required"),e.console.assert(r.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(r.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=r.tile,this.tiledImage=r.tiledImage},n=function(r){e.console.assert(r,"[ImageRecord] options is required"),e.console.assert(r.image,"[ImageRecord] options.image is required"),this._image=r.image,this._tiles=[]};n.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var r=document.createElement("canvas");r.width=this._image.width,r.height=this._image.height,this._renderedContext=r.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(r){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=r},addTile:function(r){e.console.assert(r,"[ImageRecord.addTile] tile is required"),this._tiles.push(r)},removeTile:function(r){for(var l=0;l<this._tiles.length;l++)if(this._tiles[l]===r){this._tiles.splice(l,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",r)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(r){r=r||{},this._maxImageCacheCount=r.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(r){e.console.assert(r,"[TileCache.cacheTile] options is required"),e.console.assert(r.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(r.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(r.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var l=r.cutoff||0,a=this._tilesLoaded.length,o=this._imagesLoaded[r.tile.cacheKey];if(o||(e.console.assert(r.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),o=this._imagesLoaded[r.tile.cacheKey]=new n({image:r.image}),this._imagesLoadedCount++),o.addTile(r.tile),r.tile.cacheImageRecord=o,this._imagesLoadedCount>this._maxImageCacheCount){for(var u=null,h=-1,g=null,m,T,x,S,P,D,d=this._tilesLoaded.length-1;d>=0;d--)if(D=this._tilesLoaded[d],m=D.tile,!(m.level<=l||m.beingDrawn)){if(!u){u=m,h=d,g=D;continue}S=m.lastTouchTime,T=u.lastTouchTime,P=m.level,x=u.level,(S<T||S===T&&P>x)&&(u=m,h=d,g=D)}u&&h>=0&&(this._unloadTile(g),a=h)}this._tilesLoaded[a]=new i({tile:r.tile,tiledImage:r.tiledImage})},clearTilesFor:function(r){e.console.assert(r,"[TileCache.clearTilesFor] tiledImage is required");for(var l,a=0;a<this._tilesLoaded.length;++a)l=this._tilesLoaded[a],l.tiledImage===r&&(this._unloadTile(l),this._tilesLoaded.splice(a,1),a--)},getImageRecord:function(r){return e.console.assert(r,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[r]},_unloadTile:function(r){e.console.assert(r,"[TileCache._unloadTile] tileRecord is required");var l=r.tile,a=r.tiledImage;l.unload(),l.cacheImageRecord=null;var o=this._imagesLoaded[l.cacheKey];o.removeTile(l),o.getTileCount()||(o.destroy(),delete this._imagesLoaded[l.cacheKey],this._imagesLoadedCount--),a.viewer.raiseEvent("tile-unloaded",{tile:l,tiledImage:a})}}}(s),function(e){e.World=function(i){var n=this;e.console.assert(i.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(r){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(i,n){if(e.console.assert(i,"[World.addItem] item is required"),e.console.assert(i instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),n=n||{},n.index!==void 0){var r=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(r,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return e.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return e.console.assert(i,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,n){e.console.assert(i,"[World.setItemIndex] item is required"),e.console.assert(n!==void 0,"[World.setItemIndex] index is required");var r=this.getIndexOfItem(i);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n===r||r===-1||(this._items.splice(r,1),this._items.splice(n,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:r,newIndex:n}))},removeItem:function(i){e.console.assert(i,"[World.removeItem] item is required");var n=e.indexOf(this._items,i);n!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,n;for(n=0;n<this._items.length;n++)i=this._items[n],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var r=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,n=0;n<r.length;n++)i=r[n],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,n=0;n<this._items.length;n++)i=this._items[n].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var n=i.immediately||!1,r=i.layout||e.DEFAULT_SETTINGS.collectionLayout,l=i.rows||e.DEFAULT_SETTINGS.collectionRows,a=i.columns||e.DEFAULT_SETTINGS.collectionColumns,o=i.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,u=i.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,h=o+u,g;!i.rows&&a?g=a:g=Math.ceil(this._items.length/l);var m=0,T=0,x,S,P,D,d;this.setAutoRefigureSizes(!1);for(var _=0;_<this._items.length;_++)_&&_%g===0&&(r==="horizontal"?(T+=h,m=0):(m+=h,T=0)),x=this._items[_],S=x.getBounds(),S.width>S.height?P=o:P=o*(S.width/S.height),D=P*(S.height/S.width),d=new e.Point(m+(o-P)/2,T+(o-D)/2),x.setPosition(d,n),x.setWidth(P,n),r==="horizontal"?m+=h:T+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,n=this._contentSize?this._contentSize.clone():null,r=this._contentFactor||0;if(!this._items.length)this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;else{var l=this._items[0],a=l.getBounds();this._contentFactor=l.getContentSize().x/a.width;for(var o=l.getClippedBounds().getBoundingBox(),u=o.x,h=o.y,g=o.x+o.width,m=o.y+o.height,T=1;T<this._items.length;T++)l=this._items[T],a=l.getBounds(),this._contentFactor=Math.max(this._contentFactor,l.getContentSize().x/a.width),o=l.getClippedBounds().getBoundingBox(),u=Math.min(u,o.x),h=Math.min(h,o.y),g=Math.max(g,o.x+o.width),m=Math.max(m,o.y+o.height);this._homeBounds=new e.Rect(u,h,g-u,m-h),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==r||!this._homeBounds.equals(i)||!this._contentSize.equals(n))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(s)})(dr);var Lh=dr.exports;const Oh=yn(Lh);function _n(t){return!!(t.altKey||t.ctrlKey||t.metaKey||["INPUT","SELECT","TEXTAREA"].includes(t.target.nodeName)&&t.target.type!=="range")}const Mh=.01,Dh={directives:{clickOutside:wn.directive},data(){return{filtersVisible:!1,loadingTimeout:null,tileSources:{},viewer:null,viewerState:{},zoomFactor:1.5}},computed:{filtersActive(){return Object.keys(this.$store.options.filters).length>0},saturation(){const t=this.$store.options.filters.saturate;return typeof t=="number"?t:1}},watch:{"$store.options.pages":function(t,s){const e=t.length!==s.length;this.loadImageInfo(e)}},mounted(){this.loadImageInfo(),this.updateFilterStyle(),this.$store.rootElement.addEventListener("keydown",this.onKeydown),this.$store.rootElement.addEventListener("keypress",this.onKeypress)},beforeUnmount(){this.viewer&&this.viewer.destroy(),this.$store.rootElement.removeEventListener("keydown",this.onKeydown),this.$store.rootElement.removeEventListener("keypress",this.onKeypress)},methods:{closeFilters(){this.filtersVisible=!1},initViewer(t){const s=[];let e=0,i,n=0;if(this.$store.options.pages.forEach((r,l)=>{let a=1;r<1?(a=0,i=l>0?this.$store.pageCount:1):i=r;const o=this.tileSources[i];if(!o)return;e||(e=o.width);const u=o.width/e;s.push({opacity:a,tileSource:o,width:u,x:n}),n+=u+Mh}),this.viewer){this.viewer.addOnceHandler("open",()=>{if(this.viewerState.isReset||t)this.resetScan();else{if(this.viewer.viewport.applyConstraints(!0),!this.$store.options.optionsResetOnPageChange)return;this.$store.options.optionsResetOnPageChange.forEach(r=>{if(r==="filters")this.resetFilters();else if(r==="pan"){const l=this.viewer.viewport.getBounds();if(l.x<=0&&l.y<=0)return;const a=this.$store.options.pages[0]?0:1;this.viewer.viewport.panTo({x:l.x>0?l.width/2+a:this.$store.options.pan.x,y:l.y>0?l.height/2:this.$store.options.pan.y}),this.$store.updateOptions({pan:{}})}else r==="rotation"?(this.viewer.viewport.setRotation(0),this.$store.updateOptions({rotation:null})):r==="zoom"&&(this.viewer.viewport.goHome(),this.$store.updateOptions({zoom:null}))})}}),this.viewer.open(s);return}this.viewer=Oh({animationTime:.4,element:this.$refs.image,immediateRender:!0,preload:!this.$store.isMobile(),preserveImageSizeOnResize:!0,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,tileSources:s,visibilityRatio:.2,...this.$store.options.viewer}),this.viewer.innerTracker.keyHandler=null,this.viewer.gestureSettingsMouse.clickToZoom=!1,this.viewer.addHandler("animation-finish",()=>{if(this.viewerState.isReset){this.removeScanOptions();return}const r=this.viewer.viewport.getCenter();this.$store.updateOptions({pan:{x:Math.round(r.x*1e3)/1e3,y:Math.round(r.y*1e3)/1e3},zoom:Math.round(this.viewer.viewport.getZoom()*1e3)/1e3})}),this.viewer.addHandler("canvas-click",()=>{document.body.click()}),this.viewer.addHandler("open",()=>{this.startLoadingWatch(),this.$store.options.pan.x!==void 0||this.$store.options.pan.y!==void 0||this.$store.options.zoom?((this.$store.options.pan.x!==void 0||this.$store.options.pan.y!==void 0)&&this.viewer.viewport.panTo({x:this.$store.options.pan.x,y:this.$store.options.pan.y},!0),this.$store.options.zoom&&this.viewer.viewport.zoomTo(this.$store.options.zoom,null,!0)):this.viewer.viewport.goHome(),this.$store.options.rotation!==null&&this.viewer.viewport.setRotation(this.$store.options.rotation)}),this.viewer.addHandler("pan",this.updateViewerState),this.viewer.addHandler("resize",this.updateViewerState),this.viewer.addHandler("zoom",this.updateViewerState),this.viewer.addHandler("tile-load-failed",r=>{this.$store.addError(`Error loading image: ${r.message}`)}),this.$api.expose(this.resetScan),this.$api.expose(this.viewer,"viewer")},loadImageInfo(t=!1){this.stopLoadingWatch();const s=[];this.$store.options.pages.forEach(e=>{if(e<1||this.tileSources[e])return;const{resource:i}=this.$store.canvases[e-1].images[0];if(i.service){const n=i.service["@id"],r=`${n}${n.slice(-1)==="/"?"":"/"}info.json`;s.push(this.$store.fetchJson(r).then(l=>({...l,page:e}),l=>{let a;l.response&&l.response.statusText?a=l.response.statusText:l.message&&(a=l.message),this.$store.addError(`Error loading info file for page ${e}${a?`: ${a}`:""}`)}))}else this.tileSources[e]={type:"image",url:i["@id"],width:i.width,height:i.height}}),s.length?Promise.all(s).then(e=>{e.forEach(i=>{i&&(this.tileSources[i.page]=i)}),this.initViewer(t)}):this.initViewer(t)},onKeydown(t){t.key==="Escape"&&(this.filtersVisible=!1),[45,48,96].includes(t.keyCode)&&(t.shiftKey?this.resetScan(t):this.viewer.viewport.goHome())},onKeypress(t){if(!_n(t))switch(t.key){case"r":case"R":this.rotateRight(t);break;case"i":this.filtersVisible=!this.filtersVisible,this.filtersVisible&&this.$nextTick(()=>{this.$refs.firstSlider.focus()});break;case"I":this.resetFilters();break;case"+":case"=":case"W":this.viewer.viewport.zoomBy(1.1),this.viewer.viewport.applyConstraints();break;case"-":case"_":case"S":this.viewer.viewport.zoomBy(.9),this.viewer.viewport.applyConstraints();break;case"w":this.viewer.innerTracker.keyDownHandler({keyCode:38});break;case"s":this.viewer.innerTracker.keyDownHandler({keyCode:40});break;case"a":this.viewer.innerTracker.keyDownHandler({keyCode:37});break;case"d":this.viewer.innerTracker.keyDownHandler({keyCode:39});break}},removeScanOptions(){this.$store.updateOptions({pan:{},zoom:null})},resetFilters(){this.$refs.image.style.cssText="",this.$store.updateOptions({filters:{}})},resetScan(t){t&&(this.viewer.viewport.setRotation(0),this.$store.updateOptions({rotation:null}),this.filtersActive&&this.resetFilters()),this.viewer.viewport.goHome(),this.removeScanOptions()},rotateRight(t){const{viewport:s}=this.viewer,e=t&&t.shiftKey?0:(s.getRotation()+90)%360;s.setRotation(e),this.$store.updateOptions({rotation:e||null})},setFilter(t,s){const e=s.target.valueAsNumber;e===1?delete this.$store.options.filters[t]:this.$store.options.filters[t]=e,this.$store.updateOptions({filters:this.$store.options.filters}),this.updateFilterStyle()},startLoadingWatch(){this.$store.loading=0;for(let t=this.viewer.world.getItemCount()-1;t>=0;t-=1){const s=this.viewer.world.getItemAt(t);if(s&&s._tilesLoading){this.$store.loading=1;break}}this.loadingTimeout=setTimeout(this.startLoadingWatch,200)},stopLoadingWatch(){clearTimeout(this.loadingTimeout)},updateFilterStyle(){if(!this.filtersActive)return;const t=[];Object.keys(this.$store.options.filters).forEach(i=>{t.push(`${i}(${this.$store.options.filters[i]})`)});const{image:s}=this.$refs,e=t.join(" ");s.style.cssText=`filter: ${e}`},updateViewerState(){const t=this.viewer.viewport.getZoom();this.viewerState.isMaxZoom=t>=this.viewer.viewport.getMaxZoom(),this.viewerState.isMinZoom=t<=this.viewer.viewport.getMinZoom();const s=this.viewer.viewport.getHomeBounds(),e=this.viewer.viewport.getBounds();this.viewerState.isReset=Math.abs(s.height-e.height)<1e-9&&Math.abs(s.width-e.width)<1e-9&&Math.abs(s.x-e.x)<1e-9&&Math.abs(s.y-e.y)<1e-9},zoomIn(){this.viewer.viewport.zoomBy(this.zoomFactor)},zoomOut(){this.viewer.viewport.zoomBy(1/this.zoomFactor)}}},kh={class:"tify-scan"},Fh={class:"tify-sr-only"},Ah=["title"],Bh=["title"],Ih={key:2,class:"tify-scan-buttons"},zh=["disabled","title"],Vh=["disabled","title"],Nh=["disabled","title"],Uh=["title"],Wh=["title","aria-controls","aria-expanded"],jh=["id"],Gh={class:"tify-sr-only"},qh=["value"],Zh=["value"],Kh=["value"],Xh=["disabled"],Yh={ref:"image",class:"tify-scan-image"};function Jh(t,s,e,i,n,r){const l=cr,a=ur,o=yh,u=dh,h=oh,g=eh,m=Kc,T=Uc,x=Ac,S=Lc,P=Ec,D=hn("click-outside");return O(),F("section",kh,[A("h2",Fh,q(t.$translate("Scan")),1),!t.$store.isCustomPageView&&!t.$store.isFirstPage?(O(),F("button",{key:0,type:"button",class:"tify-scan-page-button -previous",title:t.$translate("Previous page"),onClick:s[0]||(s[0]=d=>t.$store.goToPreviousPage())},[ie(l)],8,Ah)):oe("",!0),!t.$store.isCustomPageView&&!t.$store.isLastPage?(O(),F("button",{key:1,type:"button",class:"tify-scan-page-button -next",title:t.$translate("Next page"),onClick:s[1]||(s[1]=d=>t.$store.goToNextPage())},[ie(a)],8,Bh)):oe("",!0),n.viewer?(O(),F("div",Ih,[A("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMaxZoom,title:t.$translate("Zoom in"),onClick:s[2]||(s[2]=d=>r.zoomIn())},[ie(o)],8,zh),A("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isReset,title:t.$translate("Reset"),onClick:s[3]||(s[3]=d=>r.resetScan(!!d.shiftKey))},[ie(u)],8,Vh),A("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMinZoom,title:t.$translate("Zoom out"),onClick:s[4]||(s[4]=d=>r.zoomOut())},[ie(h)],8,Nh),A("button",{type:"button",class:Te(["tify-scan-button",{"-active":t.$store.options.rotation}]),title:t.$translate("Rotate"),onClick:s[5]||(s[5]=d=>r.rotateRight(d))},[ie(g)],10,Uh),ke((O(),F("div",{class:Te(["tify-scan-filters",{"-open":n.filtersVisible}])},[A("button",{type:"button",class:Te(["tify-scan-button",{"-active":r.filtersActive}]),title:t.$translate("Toggle image filters"),"aria-controls":t.$store.getId("filters"),"aria-expanded":n.filtersVisible?"true":"false",onClick:s[6]||(s[6]=d=>n.filtersVisible=!n.filtersVisible)},[ie(m)],10,Wh),ke(A("div",{id:t.$store.getId("filters"),class:"tify-scan-filters-popup"},[A("h3",Gh,q(t.$translate("Image filters")),1),A("p",null,[A("label",null,[ie(T),be(" "+q(t.$translate("Brightness"))+" ",1),A("b",null,q(Math.round((t.$store.options.filters.brightness||1)*100))+"Â %",1),A("input",{ref:"firstSlider",class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:t.$store.options.filters.brightness||1,onInput:s[7]||(s[7]=d=>r.setFilter("brightness",d))},null,40,qh)])]),A("p",null,[A("label",null,[ie(x),be(" "+q(t.$translate("Contrast"))+" ",1),A("b",null,q(Math.round((t.$store.options.filters.contrast||1)*100))+"Â %",1),A("input",{class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:t.$store.options.filters.contrast||1,onInput:s[8]||(s[8]=d=>r.setFilter("contrast",d))},null,40,Zh)])]),A("p",null,[A("label",null,[ie(S),be(" "+q(t.$translate("Saturation"))+" ",1),A("b",null,q(Math.round(r.saturation*100))+"Â %",1),A("input",{class:"tify-scan-range",max:"3",min:"0",step:".01",type:"range",value:r.saturation,onInput:s[9]||(s[9]=d=>r.setFilter("saturate",d))},null,40,Kh)])]),A("p",null,[A("button",{type:"button",class:"tify-scan-reset",disabled:!r.filtersActive,onClick:s[10]||(s[10]=d=>r.resetFilters())},[ie(P),be(" "+q(t.$translate("Reset")),1)],8,Xh)])],8,jh),[[Ke,n.filtersVisible]])],2)),[[D,r.closeFilters]])])):oe("",!0),A("div",Yh,null,512)])}const Qh=ae(Dh,[["render",Jh]]),$h={},ed={class:"tify-icon",viewBox:"0 0 24 24"},td=A("path",{d:"M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z"},null,-1),id=[td];function nd(t,s){return O(),F("svg",ed,id)}const sd=ae($h,[["render",nd]]),rd={},od={class:"tify-icon",viewBox:"0 0 24 24"},ad=A("path",{d:"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"},null,-1),ld=[ad];function ud(t,s){return O(),F("svg",od,ld)}const cd=ae(rd,[["render",ud]]),hd={},dd={class:"tify-icon",viewBox:"0 0 24 24"},fd=A("path",{d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"},null,-1),pd=[fd];function gd(t,s){return O(),F("svg",dd,pd)}const md=ae(hd,[["render",gd]]),vd={},yd={class:"tify-icon",viewBox:"0 0 24 24"},wd=A("path",{d:"M11 15H17V17H11V15M9 7H7V9H9V7M11 13H17V11H11V13M11 9H17V7H11V9M9 11H7V13H9V11M21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5M19 5H5V19H19V5M9 15H7V17H9V15Z"},null,-1),_d=[wd];function Td(t,s){return O(),F("svg",yd,_d)}const xd=ae(vd,[["render",Td]]),bd={},Ed={class:"tify-icon",viewBox:"0 0 24 24"},Sd=A("path",{d:"M13,5V11H14.17L12,13.17L9.83,11H11V5H13M15,3H9V9H5L12,16L19,9H15V3M19,18H5V20H19V18Z"},null,-1),Pd=[Sd];function Cd(t,s){return O(),F("svg",Ed,Pd)}const Rd=ae(bd,[["render",Cd]]),Hd={},Ld={class:"tify-icon",viewBox:"0 0 24 24"},Od=A("path",{d:"M13.5,4A1.5,1.5 0 0,0 12,5.5A1.5,1.5 0 0,0 13.5,7A1.5,1.5 0 0,0 15,5.5A1.5,1.5 0 0,0 13.5,4M13.14,8.77C11.95,8.87 8.7,11.46 8.7,11.46C8.5,11.61 8.56,11.6 8.72,11.88C8.88,12.15 8.86,12.17 9.05,12.04C9.25,11.91 9.58,11.7 10.13,11.36C12.25,10 10.47,13.14 9.56,18.43C9.2,21.05 11.56,19.7 12.17,19.3C12.77,18.91 14.38,17.8 14.54,17.69C14.76,17.54 14.6,17.42 14.43,17.17C14.31,17 14.19,17.12 14.19,17.12C13.54,17.55 12.35,18.45 12.19,17.88C12,17.31 13.22,13.4 13.89,10.71C14,10.07 14.3,8.67 13.14,8.77Z"},null,-1),Md=[Od];function Dd(t,s){return O(),F("svg",Ld,Md)}const kd=ae(Hd,[["render",Dd]]),Fd={},Ad={class:"tify-icon",viewBox:"0 0 24 24"},Bd=A("path",{d:"M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z"},null,-1),Id=[Bd];function zd(t,s){return O(),F("svg",Ad,Id)}const Vd=ae(Fd,[["render",zd]]),Nd={},Ud={class:"tify-icon",viewBox:"0 0 24 24"},Wd=A("path",{d:"M4,5H20V7H4V5M4,9H20V11H4V9M4,13H20V15H4V13M4,17H14V19H4V17Z"},null,-1),jd=[Wd];function Gd(t,s){return O(),F("svg",Ud,jd)}const qd=ae(Nd,[["render",Gd]]),Zd={},Kd={class:"tify-icon",viewBox:"0 0 24 24"},Xd=A("path",{d:"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"},null,-1),Yd=[Xd];function Jd(t,s){return O(),F("svg",Kd,Yd)}const Qd=ae(Zd,[["render",Jd]]),$d={},ef={class:"tify-icon",viewBox:"0 0 24 24"},tf=A("path",{d:"M12 16C13.1 16 14 16.9 14 18S13.1 20 12 20 10 19.1 10 18 10.9 16 12 16M12 10C13.1 10 14 10.9 14 12S13.1 14 12 14 10 13.1 10 12 10.9 10 12 10M12 4C13.1 4 14 4.9 14 6S13.1 8 12 8 10 7.1 10 6 10.9 4 12 4M6 16C7.1 16 8 16.9 8 18S7.1 20 6 20 4 19.1 4 18 4.9 16 6 16M6 10C7.1 10 8 10.9 8 12S7.1 14 6 14 4 13.1 4 12 4.9 10 6 10M6 4C7.1 4 8 4.9 8 6S7.1 8 6 8 4 7.1 4 6 4.9 4 6 4M18 16C19.1 16 20 16.9 20 18S19.1 20 18 20 16 19.1 16 18 16.9 16 18 16M18 10C19.1 10 20 10.9 20 12S19.1 14 18 14 16 13.1 16 12 16.9 10 18 10M18 4C19.1 4 20 4.9 20 6S19.1 8 18 8 16 7.1 16 6 16.9 4 18 4Z"},null,-1),nf=[tf];function sf(t,s){return O(),F("svg",ef,nf)}const rf=ae($d,[["render",sf]]),of={},af={class:"tify-icon",viewBox:"0 0 24 24"},lf=A("path",{d:"M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M16,6H18V18H16V6Z"},null,-1),uf=[lf];function cf(t,s){return O(),F("svg",af,uf)}const hf=ae(of,[["render",cf]]),df={},ff={class:"tify-icon",viewBox:"0 0 24 24"},pf=A("path",{d:"M16,18H18V6H16M6,18L14.5,12L6,6V18Z"},null,-1),gf=[pf];function mf(t,s){return O(),F("svg",ff,gf)}const vf=ae(df,[["render",mf]]),yf={},wf={class:"tify-icon",viewBox:"0 0 24 24"},_f=A("path",{d:"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"},null,-1),Tf=[_f];function xf(t,s){return O(),F("svg",wf,Tf)}const bf=ae(yf,[["render",xf]]),Ef={},Sf={class:"tify-icon",viewBox:"0 0 24 24"},Pf=A("path",{d:"M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z"},null,-1),Cf=[Pf];function Rf(t,s){return O(),F("svg",Sf,Cf)}const Hf=ae(Ef,[["render",Rf]]),Lf={},Of={class:"tify-header-button-group -pagination"},Mf=["disabled","title"],Df=["disabled","title"],kf=["disabled","title"],Ff=["disabled","title"],Af=["disabled","title"],Bf=["disabled","title"];function If(t,s){const e=Hf,i=bf,n=cr,r=ur,l=vf,a=hf;return O(),F("div",Of,[A("button",{type:"button",class:"tify-header-button",disabled:t.$store.isCustomPageView||t.$store.isFirstPage,title:t.$translate("First page"),onClick:s[0]||(s[0]=o=>t.$store.goToFirstPage())},[ie(e)],8,Mf),t.$store.manifest.structures?(O(),F("button",{key:0,type:"button",class:"tify-header-button",disabled:t.$store.isCustomPageView||t.$store.isFirstPage,title:t.$translate("Previous section"),onClick:s[1]||(s[1]=o=>t.$store.goToPreviousSection())},[ie(i)],8,Df)):oe("",!0),A("button",{type:"button",class:"tify-header-button",disabled:t.$store.isCustomPageView||t.$store.isFirstPage,title:t.$translate("Previous page"),onClick:s[2]||(s[2]=o=>t.$store.goToPreviousPage())},[ie(n)],8,kf),A("button",{type:"button",class:"tify-header-button",disabled:t.$store.isCustomPageView||t.$store.isLastPage,title:t.$translate("Next page"),onClick:s[3]||(s[3]=o=>t.$store.goToNextPage())},[ie(r)],8,Ff),t.$store.manifest.structures?(O(),F("button",{key:1,type:"button",class:"tify-header-button",disabled:t.$store.isCustomPageView||t.$store.isLastSection,title:t.$translate("Next section"),onClick:s[4]||(s[4]=o=>t.$store.goToNextSection())},[ie(l)],8,Af)):oe("",!0),A("button",{type:"button",class:"tify-header-button",disabled:t.$store.isCustomPageView||t.$store.isLastPage,title:t.$translate("Last page"),onClick:s[5]||(s[5]=o=>t.$store.goToLastPage())},[ie(a)],8,Bf)])}const zf=ae(Lf,[["render",If]]),Vf={},Nf={class:"tify-icon",viewBox:"0 0 24 24"},Uf=A("path",{d:"M6.5 20C8.2 20 10.65 20.65 12 21.5C13.35 20.65 15.8 20 17.5 20C19.15 20 20.85 20.3 22.25 21.05C22.35 21.1 22.4 21.1 22.5 21.1C22.75 21.1 23 20.85 23 20.6V6C22.4 5.55 21.75 5.25 21 5C19.89 4.65 18.67 4.5 17.5 4.5C15.55 4.5 13.45 4.9 12 6C10.55 4.9 8.45 4.5 6.5 4.5C5.33 4.5 4.11 4.65 3 5C2.25 5.25 1.6 5.55 1 6V20.6C1 20.85 1.25 21.1 1.5 21.1C1.6 21.1 1.65 21.1 1.75 21.05C3.15 20.3 4.85 20 6.5 20M12 19.5V8C13.35 7.15 15.8 6.5 17.5 6.5C18.7 6.5 19.9 6.65 21 7V18.5C19.9 18.15 18.7 18 17.5 18C15.8 18 13.35 18.65 12 19.5Z"},null,-1),Wf=[Uf];function jf(t,s){return O(),F("svg",Nf,Wf)}const Gf=ae(Vf,[["render",jf]]),qf={},Zf={class:"tify-icon",viewBox:"0 0 24 24"},Kf=A("path",{d:"M16,5V11H21V5M10,11H15V5H10M16,18H21V12H16M10,18H15V12H10M4,18H9V12H4M4,11H9V5H4V11Z"},null,-1),Xf=[Kf];function Yf(t,s){return O(),F("svg",Zf,Xf)}const Jf=ae(qf,[["render",Yf]]),Qf={directives:{clickOutside:wn.directive},data(){return{filter:"",filteredCanvases:[],highlightIndex:0,isOpen:!1}},computed:{currentPageLabel(){const t=this.$store.options.pages[0]||1,s=this.$store.options.pages[0]?this.$store.options.pages[0]-1:0,e=this.$store.convertValueToArray(this.$store.canvases[s].label)[0];return this.$store.getPageLabel(t,e)},currentPageTitleAttr(){const{pages:t}=this.$store.options,s=t[0]===0&&t.length>1?1:t[0],e=this.$translate("Physical page"),i=this.$translate("Logical page");return`${e}: ${s}
${i}: ${this.$store.convertValueToArray(this.$store.canvases[s-1].label)[0]}`}},watch:{filter(){this.updateFilteredCanvases(),this.$nextTick(()=>this.updateScroll())},isOpen(){this.isOpen&&(this.filter="",this.highlightIndex=this.$store.options.pages[0]-1)}},mounted(){this.updateFilteredCanvases(),this.$store.rootElement.addEventListener("keydown",this.onKeydown)},beforeUnmount(){this.$store.rootElement.removeEventListener("keydown",this.onKeydown)},methods:{closeDropdown(){this.isOpen=!1},onKeydown(t){if(!_n(t)){if(t.key==="Escape"){this.closeDropdown();return}t.key==="x"&&(this.toggleDropdown(),t.preventDefault())}},onKeyDownArrow(){this.highlightIndex<this.filteredCanvases.length-1&&(this.highlightIndex+=1,this.updateScroll())},onKeyUpArrow(){this.highlightIndex>0&&(this.highlightIndex-=1,this.updateScroll())},setPage(t){this.closeDropdown(),this.$store.setPage(t),this.$store.isMobile()&&this.$store.updateOptions({view:"scan"})},toggleDropdown(){this.isOpen=!this.isOpen,this.isOpen&&this.$nextTick(()=>{this.$refs.search.focus(),this.updateScroll()})},updateFilteredCanvases(){const t=[],s=this.filter.toLowerCase();let e=-1;this.$store.canvases.forEach((i,n)=>{const l=this.$store.convertValueToArray(i.label)[0].toLowerCase().includes(s),a=(n+1).toFixed().includes(s);if(l||a){const o=i;o.page=n+1,o.page===this.$store.options.pages[0]&&(e=t.length),t.push(o)}}),this.highlightIndex=e<0?0:e,this.filteredCanvases=t},updateScroll(){const{list:t}=this.$refs;if(t&&t.children[this.highlightIndex]){const{offsetTop:s}=t.children[this.highlightIndex];t.scrollTop=s-(t.offsetHeight/2-t.children[0].offsetHeight)}}}},$f={class:"tify-page-select"},ep=["title","aria-label","aria-controls","aria-expanded"],tp=["id"],ip={class:"tify-page-select-filter"},np=["aria-label"],sp={ref:"list",class:"tify-page-select-list"},rp=["onClick"];function op(t,s,e,i,n,r){const l=hn("click-outside");return ke((O(),F("div",$f,[A("button",{type:"button",class:"tify-page-select-button",title:r.currentPageTitleAttr,"aria-label":t.$translate("Current page"),"aria-controls":t.$store.getId("dropdown"),"aria-expanded":n.isOpen?"true":"false",onClick:s[0]||(s[0]=a=>r.toggleDropdown())},q(r.currentPageLabel),9,ep),ke(A("div",{id:t.$store.getId("dropdown"),key:"dropdown",class:"tify-page-select-dropdown",onClick:s[6]||(s[6]=vt(()=>{},["stop"]))},[A("div",ip,[ke(A("input",{ref:"search","onUpdate:modelValue":s[1]||(s[1]=a=>n.filter=a),"aria-label":t.$translate("Filter pages"),type:"text",class:"tify-page-select-input",onKeyup:s[2]||(s[2]=It(a=>n.filteredCanvases[n.highlightIndex]&&t.$store.setPage(n.filteredCanvases[n.highlightIndex].page),["enter"])),onKeydown:[s[3]||(s[3]=It(vt(a=>n.filter?n.filter="":r.closeDropdown(),["prevent"]),["esc"])),s[4]||(s[4]=It(vt(a=>r.onKeyUpArrow(),["prevent"]),["up"])),s[5]||(s[5]=It(vt(a=>r.onKeyDownArrow(),["prevent"]),["down"]))]},null,40,np),[[nr,n.filter]])]),A("ol",sp,[(O(!0),F(de,null,Ee(n.filteredCanvases,(a,o)=>(O(),F("li",{key:o,class:Te({"-current":t.$store.options.pages.includes(a.page),"-highlighted":n.highlightIndex===o})},[A("a",{href:"javascript:;",onClick:u=>r.setPage(a.page)},q(t.$store.getPageLabel(a.page,t.$store.convertValueToArray(a.label)[0])),9,rp)],2))),128))],512)],8,tp),[[Ke,n.isOpen]])])),[[l,r.closeDropdown]])}const ap=ae(Qf,[["render",op]]),lp={directives:{clickOutside:wn.directive},props:{fulltextEnabled:Boolean,tocEnabled:Boolean},data(){return{controlsVisible:!1,fullscreenActive:!1,screen:this.$store.rootElement.parentNode}},computed:{fullscreenSupported(){return document.fullscreenElement===null||document.webkitFullscreenElement===null},title(){const t=String.fromCharCode(160);return this.$store.convertValueToArray((this.$store.manifest||this.$store.collection||{}).label).join(`${t}Â· `).trim().replace(/(\S{1,10})\s+(\S{1,10})$/,`$1${t}$2`)}},created(){this.$api.expose(this.setView),this.$api.expose(this.toggleDoublePage),this.$api.expose(this.toggleFullscreen)},mounted(){this.$store.rootElement.addEventListener("keydown",this.onKeyDown),["","moz","webkit"].forEach(s=>{document.addEventListener(`${s}fullscreenchange`,this.toggleFullscreenActive)})},beforeUnmount(){this.$store.rootElement.removeEventListener("keydown",this.onKeyDown)},methods:{closeControlsPopup(){this.controlsVisible=!1},detectFullscreen(){let t;switch(null){case document.fullscreenElement:t=document.fullscreenElement;break;case document.webkitFullscreenElement:t=document.webkitFullscreenElement;break;default:t=!1}return t},onKeyDown(t){if(_n(t))return;if(t.key==="Escape"){this.controlsVisible=!1;return}switch(t.key){case"Backspace":this.$refs.switchViewSmall.offsetParent&&this.toggleView("scan");break;case"1":this.$store.manifest&&this.fulltextEnabled&&this.toggleView("fulltext");break;case"2":this.$store.manifest&&this.toggleView("thumbnails");break;case"3":this.$store.manifest&&this.tocEnabled&&this.toggleView("toc");break;case"4":this.toggleView("info");break;case"5":this.$store.manifest&&this.toggleView("export");break;case"6":this.$store.collection&&this.toggleView("collection");break;case"7":this.toggleView("help");break;case"b":this.$store.manifest&&this.toggleDoublePage();break;case"f":this.toggleFullscreen();break}if(!this.$store.manifest||this.$store.isCustomPageView)return;const{pages:s}=this.$store.options;switch(t.key){case"q":case",":s[0]>1&&this.$store.goToPreviousPage();break;case"e":case".":this.isLastPage||this.$store.goToNextPage();break;case"Q":s[0]>1&&this.$store.goToFirstPage();break;case"E":this.isLastPage||this.$store.goToLastPage();break}},setView(t){this.$store.updateOptions({view:t})},toggleControlsPopup(){this.controlsVisible=!this.controlsVisible},toggleDoublePage(t){const{pages:s}=this.$store.options;let e;if(s.length>1&&t!==!0||t===!1)e=[s[0]<1?1:s[0]];else if(s[0]<2)e=[0,1];else if(s[0]%2>0)e=[s[0]-1,s[0]];else{const i=s[0]<this.$store.pageCount?s[0]+1:0;e=[s[0],i]}return this.$store.updateOptions({pages:e}),e},toggleFullscreen(t){return this.fullscreenActive&&t!==!0||t===!1?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),!1):(this.screen.requestFullscreen?this.screen.requestFullscreen():this.screen.mozRequestFullScreen?this.screen.mozRequestFullScreen():this.screen.webkitRequestFullscreen&&this.screen.webkitRequestFullscreen(),!0)},toggleFullscreenActive(){this.fullscreenActive=!this.fullscreenActive},toggleView(t){this.closeControlsPopup();const s=t===this.$store.options.view&&this.$store.manifest&&!this.$store.isMobile()?"":t;return this.$store.updateOptions({view:s}),s}}},up={class:"tify-header"},cp={class:"tify-header-column -title"},hp=["title"],dp={key:0,class:"tify-header-column -pagination"},fp={class:"tify-header-button-group -page-select"},pp=["title"],gp={class:"tify-header-column -controls"},mp={ref:"switchViewSmall",class:"tify-header-button-group -toggle"},vp=["aria-controls","aria-expanded","aria-label","title"],yp=["id"],wp={class:"tify-header-button-group -view"},_p=["aria-controls","aria-expanded"],Tp=["aria-controls","aria-expanded"],xp=["aria-controls","aria-expanded"],bp=["aria-controls","aria-expanded"],Ep=["aria-controls","aria-expanded"],Sp=["aria-controls","aria-expanded"],Pp=["aria-controls","aria-expanded"],Cp={key:0,class:"tify-header-button-group -view"},Rp=["aria-controls","aria-expanded","title"],Hp=["title"],Lp=["title"];function Op(t,s,e,i,n,r){const l=ap,a=Jf,o=Gf,u=zf,h=rf,g=Qd,m=qd,T=Vd,x=kd,S=Rd,P=xd,D=md,d=cd,_=sd,L=hn("click-outside");return O(),F("header",up,[A("div",cp,[A("h1",{class:"tify-header-title",title:r.title},q(r.title),9,hp)]),t.$store.manifest?(O(),F("div",dp,[A("div",fp,[ie(l),A("button",{type:"button",class:Te(["tify-header-button",{"-active":t.$store.options.pages.length>1}]),title:t.$translate("Toggle double-page"),onClick:s[0]||(s[0]=(...H)=>r.toggleDoublePage&&r.toggleDoublePage(...H))},[t.$store.isCustomPageView?(O(),Re(a,{key:0})):(O(),Re(o,{key:1}))],10,pp)]),ie(u)])):oe("",!0),ke((O(),F("div",gp,[A("div",mp,[A("button",{type:"button","aria-controls":t.$store.getId("controls"),"aria-expanded":n.controlsVisible?"true":"false","aria-label":t.$translate("View"),class:"tify-header-button",title:t.$translate("View"),onClick:s[1]||(s[1]=(...H)=>r.toggleControlsPopup&&r.toggleControlsPopup(...H))},[ie(h)],8,vp)],512),A("div",{id:t.$store.getId("controls"),class:Te(["tify-header-popup",{"-visible":n.controlsVisible}])},[A("div",wp,[t.$store.manifest?(O(),F("button",{key:0,type:"button",class:Te(["tify-header-button -scan",{"-active":t.$store.options.view==="scan"}]),"aria-controls":t.$store.getId("scan"),"aria-expanded":t.$store.options.view==="scan"?"true":"false",onClick:s[2]||(s[2]=H=>r.toggleView("scan"))},[ie(g),be(" "+q(t.$translate("Scan")),1)],10,_p)):oe("",!0),e.fulltextEnabled?(O(),F("button",{key:1,type:"button",class:Te(["tify-header-button",{"-active":t.$store.options.view==="fulltext"}]),"aria-controls":t.$store.getId("fulltext"),"aria-expanded":t.$store.options.view==="fulltext"?"true":"false",onClick:s[3]||(s[3]=H=>r.toggleView("fulltext"))},[ie(m),be(" "+q(t.$translate("Fulltext")),1)],10,Tp)):oe("",!0),t.$store.manifest?(O(),F("button",{key:2,type:"button",class:Te(["tify-header-button",{"-active":t.$store.options.view==="thumbnails"}]),"aria-controls":t.$store.getId("thumbnails"),"aria-expanded":t.$store.options.view==="thumbnails"?"true":"false",onClick:s[4]||(s[4]=H=>r.toggleView("thumbnails"))},[ie(a),be(" "+q(t.$translate("Pages")),1)],10,xp)):oe("",!0),e.tocEnabled?(O(),F("button",{key:3,type:"button",class:Te(["tify-header-button",{"-active":t.$store.options.view==="toc"}]),"aria-controls":t.$store.getId("toc"),"aria-expanded":t.$store.options.view==="toc"?"true":"false",onClick:s[5]||(s[5]=H=>r.toggleView("toc"))},[ie(T),be(" "+q(t.$translate("Contents")),1)],10,bp)):oe("",!0),A("button",{type:"button",class:Te(["tify-header-button",{"-active":t.$store.options.view==="info"}]),"aria-controls":t.$store.getId("info"),"aria-expanded":t.$store.options.view==="info"?"true":"false",onClick:s[6]||(s[6]=H=>r.toggleView("info"))},[ie(x),be(" "+q(t.$translate("Info")),1)],10,Ep),t.$store.manifest?(O(),F("button",{key:4,type:"button",class:Te(["tify-header-button",{"-active":t.$store.options.view==="export"}]),"aria-controls":t.$store.getId("export"),"aria-expanded":t.$store.options.view==="export"?"true":"false",onClick:s[7]||(s[7]=H=>r.toggleView("export"))},[ie(S),be(" "+q(t.$translate("Export")),1)],10,Sp)):oe("",!0),t.$store.collection?(O(),F("button",{key:5,type:"button",class:Te(["tify-header-button",{"-active":t.$store.options.view==="collection"}]),"aria-controls":t.$store.getId("collection"),"aria-expanded":t.$store.options==="collection"?"true":"false",onClick:s[8]||(s[8]=H=>r.toggleView("collection"))},[ie(P),be(" "+q(t.$translate("Collection")),1)],10,Pp)):oe("",!0)]),r.fullscreenSupported?(O(),F("div",Cp,[A("button",{type:"button",class:Te(["tify-header-button -icon-only",{"-active":t.$store.options.view==="help"}]),"aria-controls":t.$store.getId("help"),"aria-expanded":t.$store.options.view==="help"?"true":"false",title:t.$translate("Help"),onClick:s[9]||(s[9]=H=>r.toggleView("help"))},[ie(D),be(" "+q(t.$translate("Help")),1)],10,Rp),n.fullscreenActive?(O(),F("button",{key:1,type:"button",class:"tify-header-button -icon-only",title:t.$translate("Exit fullscreen"),onClick:s[11]||(s[11]=(...H)=>r.toggleFullscreen&&r.toggleFullscreen(...H))},[ie(_),be(" "+q(t.$translate("Exit fullscreen")),1)],8,Lp)):(O(),F("button",{key:0,type:"button",class:"tify-header-button -icon-only",title:t.$translate("Fullscreen"),onClick:s[10]||(s[10]=(...H)=>r.toggleFullscreen&&r.toggleFullscreen(...H))},[ie(d),be(" "+q(t.$translate("Fullscreen")),1)],8,Hp))])):oe("",!0),t.$store.manifest?(O(),Re(u,{key:1})):oe("",!0)],10,yp)])),[[L,r.closeControlsPopup]])])}const Mp=ae(lp,[["render",Op]]);const Dp={props:{readyPromise:{type:Object,default:null}},data(){return{ready:!1}},computed:{hasOtherContent(){return this.$store.canvases.some(t=>"otherContent"in t)},hasToc(){return this.$store.manifest&&this.$store.manifest.structures&&this.$store.manifest.structures.length>0}},created(){this.$api.expose(this.setLanguage),this.$api.expose(this.$store.setPage)},mounted(){if(this.$store.rootElement=this.$el,!this.$store.options.manifestUrl){this.$store.addError('Missing option "manifestUrl"');return}this.updateBreakpoint(),new ResizeObserver(this.updateBreakpoint).observe(this.$el),Promise.all([this.$store.loadManifest(this.$store.options.manifestUrl),this.setLanguage(this.$store.options.language)]).then(()=>{this.$nextTick(()=>{this.ready=!0,this.readyPromise.resolve()})},t=>{this.readyPromise.reject(t)})},beforeUnmount(){clearTimeout(this.$store.urlUpdateTimeout),window.removeEventListener("popstate",this.$store.initOptions)},methods:{setLanguage(t){let s,e;const i=new Promise((r,l)=>{s=r,e=l});if(t==="en")return this.$store.options.language="en",this.$translate.setTranslation(null),s(t),i;if(this.$store.options.translationsDirUrl===null)return e(new Error("Could not determine translationsDirUrl")),i;const n=`${this.$store.options.translationsDirUrl}/${t}.json`;return this.$store.fetchJson(n).then(r=>{this.$store.options.language=t,this.$translate.setTranslation(r),s(t)},r=>{const l=r.response?r.response.statusText:r.message;this.$store.addError(`Error loading translation for "${t}": ${l}`),e(new Error(r))}),i},updateBreakpoint(){Object.keys(this.$store.options.breakpoints).forEach(t=>{this.$el.clientWidth<=this.$store.options.breakpoints[t]?this.$el.classList.add(`-${t}`):this.$el.classList.remove(`-${t}`)}),this.$el.clientHeight<520?this.$el.classList.add("-short"):this.$el.classList.remove("-short")}}},kp={class:"tify",tabindex:"-1"},Fp={key:1,class:"tify-main"},Ap=["aria-label"],Bp={key:3,class:"tify-error"},Ip=["aria-label"],zp={class:"tify-error-messages"};function Vp(t,s,e,i,n,r){const l=Mp,a=Qh,o=yc,u=lc,h=$u,g=Zu,m=vu,T=Pl,x=Qa,S=sr;return O(),F("article",kp,[n.ready&&(t.$store.collection||t.$store.manifest)?(O(),Re(l,{key:0,"fulltext-enabled":r.hasOtherContent,"toc-enabled":r.hasToc},null,8,["fulltext-enabled","toc-enabled"])):oe("",!0),n.ready?(O(),F("div",Fp,[t.$store.manifest?(O(),F(de,{key:0},[ie(a,{id:t.$store.getId("scan")},null,8,["id"]),r.hasOtherContent?ke((O(),Re(o,{key:0,id:t.$store.getId("fulltext")},null,8,["id"])),[[Ke,t.$store.options.view==="fulltext"]]):oe("",!0),ke(ie(u,{id:t.$store.getId("thumbnails")},null,8,["id"]),[[Ke,t.$store.options.view==="thumbnails"]]),r.hasToc?ke((O(),Re(h,{key:1,id:t.$store.getId("toc")},null,8,["id"])),[[Ke,t.$store.options.view==="toc"]]):oe("",!0),ke(ie(g,{id:t.$store.getId("export")},null,8,["id"]),[[Ke,t.$store.options.view==="export"]])],64)):oe("",!0),t.$store.collection||t.$store.manifest?ke((O(),Re(m,{key:1,id:t.$store.getId("info")},null,8,["id"])),[[Ke,t.$store.options.view==="info"]]):oe("",!0),t.$store.collection?ke((O(),Re(T,{key:2,id:t.$store.getId("collection")},null,8,["id"])),[[Ke,t.$store.options.view==="collection"]]):oe("",!0),ke(ie(x,{id:t.$store.getId("help")},null,8,["id"]),[[Ke,t.$store.options.view==="help"]])])):oe("",!0),t.$store.loading?(O(),F("div",{key:2,class:"tify-loading","aria-label":t.$translate("Loading")},null,8,Ap)):oe("",!0),t.$store.errors.length?(O(),F("section",Bp,[A("button",{type:"button",class:"tify-error-close","aria-label":t.$translate("Dismiss"),onClick:s[0]||(s[0]=P=>t.$store.clearErrors())},[ie(S)],8,Ip),A("div",zp,[(O(!0),F(de,null,Ee(t.$store.errors,P=>(O(),F("p",{key:P},q(P),1))),128))])])):oe("",!0)])}const Np=ae(Dp,[["render",Vp]]);function Up(t){return{expose(s,e){t[e||s.name.replace("bound ","")]=s}}}const Wp={install:(t,s)=>{t.config.globalProperties.$api=new Up(s.instance)}},jp={install:t=>{let s=null;t.config.globalProperties.$translate=(e,i)=>s&&s[e]?s[e]:i||e,t.config.globalProperties.$translate.setTranslation=e=>{s=e}}};function Gp(t){const s=`tify-${Math.floor(Math.random()*Date.now())}`,e=pi({collection:null,errors:[],loading:0,manifest:t.manifest||null,options:t.options||{},rootElement:t.rootElement||null,urlUpdateTimeout:null,canvases:Ze(()=>e.manifest&&e.manifest.sequences?e.manifest.sequences[0].canvases:[]),currentStructure:Ze(()=>{if(!Array.isArray(e.manifest.structures))return!1;const i=[];e.options.pages.forEach(a=>{a&&i.push(e.manifest.sequences[0].canvases[a-1]["@id"])});const{length:n}=e.manifest.structures;let r,l;for(let a=0;a<n;a+=1){const o=e.manifest.structures[a],{canvases:u}=o;if(u&&u.some(h=>i.includes(h))&&o.firstPage&&o.lastPage){const h=o.lastPage-o.firstPage;if((h<l||!l)&&(r=a,l=h,l===0))break}}return typeof r=="number"&&r>=0?e.manifest.structures[r]:!1}),isCustomPageView:Ze(()=>{const{pages:i}=e.options;return i?i.length>2||i.length===2&&(i[0]%2>0||i[1]!==i[0]+1)&&i[1]>0:!1}),isFirstPage:Ze(()=>e.options.pages[0]<2),isLastPage:Ze(()=>{const{pages:i}=e.options;return i[0]>=e.pageCount||i[i.length-1]>=e.pageCount}),isLastSection:Ze(()=>{const{pages:i}=e.options,n=i.length-1;return(i[n]?i[n]:i[n-1])>=e.sections[e.sections.length-1].firstPage}),pageCount:Ze(()=>e.canvases.length),sections:Ze(()=>{const i=[];return e.manifest.structures&&e.manifest.structures.forEach(n=>{if(!n.canvases){i.push({firstPage:1,lastPage:e.pageCount});return}const r=n.canvases[0],l=e.canvases.findIndex(u=>u["@id"]===r)+1,a=n.canvases[n.canvases.length-1],o=e.canvases.findIndex(u=>u["@id"]===a)+1;i.push({firstPage:l,lastPage:o})}),i}),structures:Ze(()=>{if(!e.manifest.structures)return[];const i=[],n=[],{canvases:r}=e.manifest.sequences[0],{length:l}=e.manifest.structures;for(let u=0;u<l;u+=1){const h=e.manifest.structures[u];if(h.viewingHint!=="top"){if(h.label?h.label=e.convertValueToArray(h.label)[0].trim():h.label="â",h.canvases){const g=h.canvases[0];h.firstPage=r.findIndex(x=>x["@id"]===g)+1;const m=h.canvases[h.canvases.length-1];h.lastPage=r.findIndex(x=>x["@id"]===m)+1;const T=r[h.firstPage-1];if(!T)continue;h.pageLabel=T.label}else r[0]&&(h.firstPage=1,h.lastPage=e.pageCount,h.pageLabel=r[0].label);h.pageCount=h.lastPage-h.firstPage+1,h.within&&n.push(h),i.push(h)}}const a=n.length;for(let u=0;u<l;u+=1){const h=[];for(let g=0;g<a;g+=1){const m=n[g];m.within===i[u]["@id"]&&h.push(m)}h.length&&(i[u].childStructures=h.sort((g,m)=>g.firstPage-m.firstPage))}return i.filter(u=>!u.within).sort((u,h)=>u.firstPage-h.firstPage)}),addError(i){e.errors.push(i)},clearErrors(){e.errors=[]},convertValueToArray(i){if(!e.options.language)throw new Error("language not set");if(!(i instanceof Array)){if(typeof i=="object"){if(i["@value"])return[lt(i["@value"])];if(i["@id"]){const a=lt(i["@id"]);return[{"@id":a,label:i.label?lt(i.label):a}]}return["(Invalid value)"]}return[lt(i)]}const n=[],r={};i.forEach(a=>{typeof a=="string"||a["@id"]&&a.label?n.push(a):a&&typeof a!="object"?n.push(lt(a)):a["@language"]&&a["@value"]&&(r.fallback||(r.fallback=a["@value"]),a["@language"].indexOf("en")===0?r.en=a["@value"]:e.options.language&&a["@language"]===e.options.language&&(r.preferred=a["@value"]))});const l=r.preferred||r.en||r.fallback||null;return l&&n.push(lt(l)),n},async fetchJson(i){e.loading+=1;const r=await(await fetch(i).catch(l=>(e.loading=0,Promise.reject(l)))).json().catch(l=>(e.loading=0,Promise.reject(l)));return e.loading>0&&(e.loading-=1),r},async fetchText(i){e.loading+=1;const r=await(await fetch(i).catch(l=>(e.loading=0,Promise.reject(l)))).text().catch(l=>(e.loading=0,Promise.reject(l)));return e.loading>0&&(e.loading-=1),r},getId(i){return s+(i?`-${i}`:"")},getPageLabel(i,n){return e.options.pageLabelFormat.replace("P",i).replace("L",n)},getStartPage(){const{startCanvas:i}=e.manifest.sequences[0],n=e.canvases.findIndex(r=>r["@id"]===i);return n>=0?n+1:1},goToFirstPage(){e.setPage(1)},goToNextPage(){let i=e.options.pages[0]+1;e.options.pages.length>1&&i%2>0&&i<e.pageCount&&(i+=1),e.setPage(i)},goToNextSection(){const{pages:i}=e.options,n=i.length-1,r=i[n]?i[n]:i[n-1];let l=0;for(;r>=this.sections[l].firstPage||r&&r>=this.sections[l].firstPage;)l+=1;e.setPage(this.sections[l].firstPage)},goToLastPage(){e.setPage(e.pageCount)},goToPreviousPage(){let i=e.options.pages[0]-1;e.options.pages.length>1&&i%2>0&&i>0&&(i-=1),e.setPage(i)},goToPreviousSection(){const{pages:i}=e.options,n=i[0]?i[0]:i[1];let r=this.sections.length-1;for(;n<=this.sections[r].firstPage||n&&n<=this.sections[r].firstPage;)r-=1;e.setPage(this.sections[r].firstPage)},initOptions(i){let n={};if(e.options.urlQueryKey)try{const r=new URLSearchParams(window.location.search);n=JSON.parse(r.get(e.options.urlQueryKey))||{}}catch{}n.view===""&&e.isMobile()&&(n.view="scan"),n.pages&&!ns(n.pages,e.pageCount)&&(e.addError("Invalid pages, reset to start page"),n.pages=null),e.options.childManifestUrl=n.childManifestUrl||e.options.childManifestUrl,e.options.filters=n.filters||e.options.filters,e.options.pages=i&&i.type==="popstate"?n.pages||[e.getStartPage()]:n.pages||e.options.pages||[e.getStartPage()],e.options.pan=n.panX||n.panY?{x:n.panX,y:n.panY}:n.pan||e.options.pan,e.options.rotation=parseInt(n.rotation,10)||e.options.rotation,e.options.view=n.view||n.view===""?n.view:e.options.view,e.options.zoom=parseFloat(n.zoom)||e.options.zoom},isMobile(){return e.rootElement.offsetWidth<e.options.breakpoints.medium},loadManifest(i,n={}){let r,l;const a=new Promise((o,u)=>{r=o,l=u});return e.fetchJson(i).then(async o=>{if(n.expectedType&&o["@type"]!==n.expectedType){const h=`Expected manifest of type ${n.expectedType}, but got ${o["@type"]}`;return e.addError(h),l(h),a}if(e.manifest=null,await Ls(),o["@type"]==="sc:Manifest")return e.manifest=o,e.initOptions(),window.addEventListener("popstate",e.initOptions),n.reset&&e.updateOptions({childManifestUrl:i,pages:[e.getStartPage()],pan:{},rotation:null,view:e.isMobile()?"scan":"collection",zoom:null}),r(),a;if(o["@type"]==="sc:Collection"){e.collection=o;const h=new URLSearchParams(window.location.search);let g={};try{g=JSON.parse(h.get(e.options.urlQueryKey))||{}}catch{}let m="";if(e.options.urlQueryParams.includes("childManifestUrl")&&g.childManifestUrl?m=g.childManifestUrl:e.collection.manifests&&e.options.childManifestAutoloaded&&(m=e.collection.manifests[0]["@id"]),m)await e.loadManifest(m,{expectedType:"sc:Manifest"}),e.updateOptions({childManifestUrl:m});else{const T=g.view||e.options.view;e.updateOptions({view:["collection","help","info"].includes(T)?T:"collection"})}return r(),a}const u="Please provide a valid IIIF Presentation API 2.x manifest";return e.addError(u),l(u),a},o=>{const h=`Error loading IIIF manifest: ${o.response&&(o.response.statusText||o.response.data)||o.message}`;return e.addError(h),l(h),a})},setPage(i){let n=i;if(Array.isArray(i)||(n=[i]),!ns(n,e.pageCount))throw new RangeError("Invalid pages");if(n.length===1&&e.options.pages&&e.options.pages[0]%2<1&&(e.options.pages[1]===e.options.pages[0]+1||e.options.pages[1]===0)){const r=n[0]%2>0?n[0]-1:n[0];n=[r,r===e.pageCount?0:r+1]}return e.updateOptions({pages:n}),n},updateOptions(i){Object.assign(e.options,i),clearTimeout(e.urlUpdateTimeout),e.options.urlQueryKey&&(e.urlUpdateTimeout=setTimeout(()=>{const n={};e.options.urlQueryParams.forEach(l=>{const a=e.options[l];a===null||l==="pages"&&a.length<2&&a[0]<2||typeof a=="object"&&!Object.keys(a).length?delete n[l]:n[l]=e.options[l]});const r=new URL(window.location);Object.keys(n).length?r.searchParams.set(e.options.urlQueryKey,JSON.stringify(n)):r.searchParams.delete(e.options.urlQueryKey),window.history&&(i.pages?(e.clearErrors(),window.history.pushState({},"",r)):window.history.replaceState({},"",r))},100))}});return e}const qp={install:(t,s={})=>{t.config.globalProperties.$store=new Gp(s)}};window.Tify=function(s={}){const e={breakpoints:{tiny:359,small:719,medium:959,large:1199},childManifestAutoloaded:!0,childManifestUrl:null,container:null,filters:{},language:"en",manifestUrl:null,optionsResetOnPageChange:["pan"],pageLabelFormat:"P : L",pages:null,pan:{},rotation:null,translationsDirUrl:null,urlQueryKey:null,urlQueryParams:["childManifestUrl","filters","pages","pan","rotation","view","zoom"],view:"",viewer:{},zoom:null};if(this.options={...e,...s},!this.options.translationsDirUrl){const a=[...document.getElementsByTagName("script")].find(o=>o.src.includes("/tify"));if(a){const{src:o}=a;this.options.translationsDirUrl=`${o.substring(0,o.lastIndexOf("/"))}/translations`}}let i=null;this.ready=new Promise((l,a)=>{i={resolve:l,reject:a}});const n=this;this.app=Da({render:()=>oa(Np,{readyPromise:i})}).use(Wp,{instance:n}).use(jp).use(qp,{options:this.options});let r=!1;this.mount=l=>{if(r)throw new Error("TIFY is already mounted");const a=typeof l=="string"?document.querySelector(l):l;if(!a)throw new Error("Container element not found");window.getComputedStyle(a).position==="static"&&(a.style.position="relative"),this.app.mount(a),r=!0},this.destroy=()=>{this.app.unmount()},this.options.container&&this.mount(this.options.container)};
