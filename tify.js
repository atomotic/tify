/*!
TIFY v0.28.1
(c) 2017-2023 GÃ¶ttingen State and University Library (https://www.sub.uni-goettingen.de/)
AGPL-3.0
https://tify.rocks/
*/
(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();function wn(t,r){const e=Object.create(null),i=t.split(",");for(let n=0;n<i.length;n++)e[i[n]]=!0;return r?n=>!!e[n.toLowerCase()]:n=>!!e[n]}const be={},jt=[],et=()=>{},Vr=()=>!1,Ur=/^on[^a-z]/,Oi=t=>Ur.test(t),_n=t=>t.startsWith("onUpdate:"),Fe=Object.assign,xn=(t,r)=>{const e=t.indexOf(r);e>-1&&t.splice(e,1)},Wr=Object.prototype.hasOwnProperty,we=(t,r)=>Wr.call(t,r),ce=Array.isArray,Gt=t=>ki(t)==="[object Map]",Ms=t=>ki(t)==="[object Set]",ve=t=>typeof t=="function",Le=t=>typeof t=="string",Tn=t=>typeof t=="symbol",Se=t=>t!==null&&typeof t=="object",Os=t=>Se(t)&&ve(t.then)&&ve(t.catch),ks=Object.prototype.toString,ki=t=>ks.call(t),jr=t=>ki(t).slice(8,-1),Fs=t=>ki(t)==="[object Object]",bn=t=>Le(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,xi=wn(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Fi=t=>{const r=Object.create(null);return e=>r[e]||(r[e]=t(e))},Gr=/-(\w)/g,lt=Fi(t=>t.replace(Gr,(r,e)=>e?e.toUpperCase():"")),qr=/\B([A-Z])/g,Bt=Fi(t=>t.replace(qr,"-$1").toLowerCase()),Ai=Fi(t=>t.charAt(0).toUpperCase()+t.slice(1)),ji=Fi(t=>t?`on${Ai(t)}`:""),oi=(t,r)=>!Object.is(t,r),Ti=(t,r)=>{for(let e=0;e<t.length;e++)t[e](r)},Ci=(t,r,e)=>{Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value:e})},Ji=t=>{const r=parseFloat(t);return isNaN(r)?t:r};let Kn;const Qi=()=>Kn||(Kn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function En(t){if(ce(t)){const r={};for(let e=0;e<t.length;e++){const i=t[e],n=Le(i)?Yr(i):En(i);if(n)for(const s in n)r[s]=n[s]}return r}else{if(Le(t))return t;if(Se(t))return t}}const Zr=/;(?![^(]*\))/g,Kr=/:([^]+)/,Xr=/\/\*[^]*?\*\//g;function Yr(t){const r={};return t.replace(Xr,"").split(Zr).forEach(e=>{if(e){const i=e.split(Kr);i.length>1&&(r[i[0].trim()]=i[1].trim())}}),r}function Ee(t){let r="";if(Le(t))r=t;else if(ce(t))for(let e=0;e<t.length;e++){const i=Ee(t[e]);i&&(r+=i+" ")}else if(Se(t))for(const e in t)t[e]&&(r+=e+" ");return r.trim()}const Jr="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Qr=wn(Jr);function As(t){return!!t||t===""}const X=t=>Le(t)?t:t==null?"":ce(t)||Se(t)&&(t.toString===ks||!ve(t.toString))?JSON.stringify(t,Bs,2):String(t),Bs=(t,r)=>r&&r.__v_isRef?Bs(t,r.value):Gt(r)?{[`Map(${r.size})`]:[...r.entries()].reduce((e,[i,n])=>(e[`${i} =>`]=n,e),{})}:Ms(r)?{[`Set(${r.size})`]:[...r.values()]}:Se(r)&&!ce(r)&&!Fs(r)?String(r):r;let Je;class $r{constructor(r=!1){this.detached=r,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Je,!r&&Je&&(this.index=(Je.scopes||(Je.scopes=[])).push(this)-1)}get active(){return this._active}run(r){if(this._active){const e=Je;try{return Je=this,r()}finally{Je=e}}}on(){Je=this}off(){Je=this.parent}stop(r){if(this._active){let e,i;for(e=0,i=this.effects.length;e<i;e++)this.effects[e].stop();for(e=0,i=this.cleanups.length;e<i;e++)this.cleanups[e]();if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!r){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0,this._active=!1}}}function eo(t,r=Je){r&&r.active&&r.effects.push(t)}function to(){return Je}const Pn=t=>{const r=new Set(t);return r.w=0,r.n=0,r},Is=t=>(t.w&Et)>0,zs=t=>(t.n&Et)>0,io=({deps:t})=>{if(t.length)for(let r=0;r<t.length;r++)t[r].w|=Et},no=t=>{const{deps:r}=t;if(r.length){let e=0;for(let i=0;i<r.length;i++){const n=r[i];Is(n)&&!zs(n)?n.delete(t):r[e++]=n,n.w&=~Et,n.n&=~Et}r.length=e}},$i=new WeakMap;let ti=0,Et=1;const en=30;let Qe;const Ot=Symbol(""),tn=Symbol("");class Sn{constructor(r,e=null,i){this.fn=r,this.scheduler=e,this.active=!0,this.deps=[],this.parent=void 0,eo(this,i)}run(){if(!this.active)return this.fn();let r=Qe,e=Tt;for(;r;){if(r===this)return;r=r.parent}try{return this.parent=Qe,Qe=this,Tt=!0,Et=1<<++ti,ti<=en?io(this):Xn(this),this.fn()}finally{ti<=en&&no(this),Et=1<<--ti,Qe=this.parent,Tt=e,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Qe===this?this.deferStop=!0:this.active&&(Xn(this),this.onStop&&this.onStop(),this.active=!1)}}function Xn(t){const{deps:r}=t;if(r.length){for(let e=0;e<r.length;e++)r[e].delete(t);r.length=0}}let Tt=!0;const Ns=[];function Jt(){Ns.push(Tt),Tt=!1}function Qt(){const t=Ns.pop();Tt=t===void 0?!0:t}function qe(t,r,e){if(Tt&&Qe){let i=$i.get(t);i||$i.set(t,i=new Map);let n=i.get(e);n||i.set(e,n=Pn()),Vs(n)}}function Vs(t,r){let e=!1;ti<=en?zs(t)||(t.n|=Et,e=!Is(t)):e=!t.has(Qe),e&&(t.add(Qe),Qe.deps.push(t))}function pt(t,r,e,i,n,s){const l=$i.get(t);if(!l)return;let a=[];if(r==="clear")a=[...l.values()];else if(e==="length"&&ce(t)){const o=Number(i);l.forEach((c,h)=>{(h==="length"||h>=o)&&a.push(c)})}else switch(e!==void 0&&a.push(l.get(e)),r){case"add":ce(t)?bn(e)&&a.push(l.get("length")):(a.push(l.get(Ot)),Gt(t)&&a.push(l.get(tn)));break;case"delete":ce(t)||(a.push(l.get(Ot)),Gt(t)&&a.push(l.get(tn)));break;case"set":Gt(t)&&a.push(l.get(Ot));break}if(a.length===1)a[0]&&nn(a[0]);else{const o=[];for(const c of a)c&&o.push(...c);nn(Pn(o))}}function nn(t,r){const e=ce(t)?t:[...t];for(const i of e)i.computed&&Yn(i);for(const i of e)i.computed||Yn(i)}function Yn(t,r){(t!==Qe||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const so=wn("__proto__,__v_isRef,__isVue"),Us=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Tn)),ro=Cn(),oo=Cn(!1,!0),ao=Cn(!0),Jn=lo();function lo(){const t={};return["includes","indexOf","lastIndexOf"].forEach(r=>{t[r]=function(...e){const i=xe(this);for(let s=0,l=this.length;s<l;s++)qe(i,"get",s+"");const n=i[r](...e);return n===-1||n===!1?i[r](...e.map(xe)):n}}),["push","pop","shift","unshift","splice"].forEach(r=>{t[r]=function(...e){Jt();const i=xe(this)[r].apply(this,e);return Qt(),i}}),t}function co(t){const r=xe(this);return qe(r,"has",t),r.hasOwnProperty(t)}function Cn(t=!1,r=!1){return function(i,n,s){if(n==="__v_isReactive")return!t;if(n==="__v_isReadonly")return t;if(n==="__v_isShallow")return r;if(n==="__v_raw"&&s===(t?r?So:Zs:r?qs:Gs).get(i))return i;const l=ce(i);if(!t){if(l&&we(Jn,n))return Reflect.get(Jn,n,s);if(n==="hasOwnProperty")return co}const a=Reflect.get(i,n,s);return(Tn(n)?Us.has(n):so(n))||(t||qe(i,"get",n),r)?a:ze(a)?l&&bn(n)?a:a.value:Se(a)?t?Ks(a):fi(a):a}}const uo=Ws(),ho=Ws(!0);function Ws(t=!1){return function(e,i,n,s){let l=e[i];if(Kt(l)&&ze(l)&&!ze(n))return!1;if(!t&&(!Ri(n)&&!Kt(n)&&(l=xe(l),n=xe(n)),!ce(e)&&ze(l)&&!ze(n)))return l.value=n,!0;const a=ce(e)&&bn(i)?Number(i)<e.length:we(e,i),o=Reflect.set(e,i,n,s);return e===xe(s)&&(a?oi(n,l)&&pt(e,"set",i,n):pt(e,"add",i,n)),o}}function fo(t,r){const e=we(t,r);t[r];const i=Reflect.deleteProperty(t,r);return i&&e&&pt(t,"delete",r,void 0),i}function po(t,r){const e=Reflect.has(t,r);return(!Tn(r)||!Us.has(r))&&qe(t,"has",r),e}function go(t){return qe(t,"iterate",ce(t)?"length":Ot),Reflect.ownKeys(t)}const js={get:ro,set:uo,deleteProperty:fo,has:po,ownKeys:go},mo={get:ao,set(t,r){return!0},deleteProperty(t,r){return!0}},vo=Fe({},js,{get:oo,set:ho}),Rn=t=>t,Bi=t=>Reflect.getPrototypeOf(t);function gi(t,r,e=!1,i=!1){t=t.__v_raw;const n=xe(t),s=xe(r);e||(r!==s&&qe(n,"get",r),qe(n,"get",s));const{has:l}=Bi(n),a=i?Rn:e?Dn:ai;if(l.call(n,r))return a(t.get(r));if(l.call(n,s))return a(t.get(s));t!==n&&t.get(r)}function mi(t,r=!1){const e=this.__v_raw,i=xe(e),n=xe(t);return r||(t!==n&&qe(i,"has",t),qe(i,"has",n)),t===n?e.has(t):e.has(t)||e.has(n)}function vi(t,r=!1){return t=t.__v_raw,!r&&qe(xe(t),"iterate",Ot),Reflect.get(t,"size",t)}function Qn(t){t=xe(t);const r=xe(this);return Bi(r).has.call(r,t)||(r.add(t),pt(r,"add",t,t)),this}function $n(t,r){r=xe(r);const e=xe(this),{has:i,get:n}=Bi(e);let s=i.call(e,t);s||(t=xe(t),s=i.call(e,t));const l=n.call(e,t);return e.set(t,r),s?oi(r,l)&&pt(e,"set",t,r):pt(e,"add",t,r),this}function es(t){const r=xe(this),{has:e,get:i}=Bi(r);let n=e.call(r,t);n||(t=xe(t),n=e.call(r,t)),i&&i.call(r,t);const s=r.delete(t);return n&&pt(r,"delete",t,void 0),s}function ts(){const t=xe(this),r=t.size!==0,e=t.clear();return r&&pt(t,"clear",void 0,void 0),e}function yi(t,r){return function(i,n){const s=this,l=s.__v_raw,a=xe(l),o=r?Rn:t?Dn:ai;return!t&&qe(a,"iterate",Ot),l.forEach((c,h)=>i.call(n,o(c),o(h),s))}}function wi(t,r,e){return function(...i){const n=this.__v_raw,s=xe(n),l=Gt(s),a=t==="entries"||t===Symbol.iterator&&l,o=t==="keys"&&l,c=n[t](...i),h=e?Rn:r?Dn:ai;return!r&&qe(s,"iterate",o?tn:Ot),{next(){const{value:g,done:m}=c.next();return m?{value:g,done:m}:{value:a?[h(g[0]),h(g[1])]:h(g),done:m}},[Symbol.iterator](){return this}}}}function wt(t){return function(...r){return t==="delete"?!1:this}}function yo(){const t={get(s){return gi(this,s)},get size(){return vi(this)},has:mi,add:Qn,set:$n,delete:es,clear:ts,forEach:yi(!1,!1)},r={get(s){return gi(this,s,!1,!0)},get size(){return vi(this)},has:mi,add:Qn,set:$n,delete:es,clear:ts,forEach:yi(!1,!0)},e={get(s){return gi(this,s,!0)},get size(){return vi(this,!0)},has(s){return mi.call(this,s,!0)},add:wt("add"),set:wt("set"),delete:wt("delete"),clear:wt("clear"),forEach:yi(!0,!1)},i={get(s){return gi(this,s,!0,!0)},get size(){return vi(this,!0)},has(s){return mi.call(this,s,!0)},add:wt("add"),set:wt("set"),delete:wt("delete"),clear:wt("clear"),forEach:yi(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=wi(s,!1,!1),e[s]=wi(s,!0,!1),r[s]=wi(s,!1,!0),i[s]=wi(s,!0,!0)}),[t,e,r,i]}const[wo,_o,xo,To]=yo();function Hn(t,r){const e=r?t?To:xo:t?_o:wo;return(i,n,s)=>n==="__v_isReactive"?!t:n==="__v_isReadonly"?t:n==="__v_raw"?i:Reflect.get(we(e,n)&&n in i?e:i,n,s)}const bo={get:Hn(!1,!1)},Eo={get:Hn(!1,!0)},Po={get:Hn(!0,!1)},Gs=new WeakMap,qs=new WeakMap,Zs=new WeakMap,So=new WeakMap;function Co(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ro(t){return t.__v_skip||!Object.isExtensible(t)?0:Co(jr(t))}function fi(t){return Kt(t)?t:Ln(t,!1,js,bo,Gs)}function Ho(t){return Ln(t,!1,vo,Eo,qs)}function Ks(t){return Ln(t,!0,mo,Po,Zs)}function Ln(t,r,e,i,n){if(!Se(t)||t.__v_raw&&!(r&&t.__v_isReactive))return t;const s=n.get(t);if(s)return s;const l=Ro(t);if(l===0)return t;const a=new Proxy(t,l===2?i:e);return n.set(t,a),a}function qt(t){return Kt(t)?qt(t.__v_raw):!!(t&&t.__v_isReactive)}function Kt(t){return!!(t&&t.__v_isReadonly)}function Ri(t){return!!(t&&t.__v_isShallow)}function Xs(t){return qt(t)||Kt(t)}function xe(t){const r=t&&t.__v_raw;return r?xe(r):t}function Ys(t){return Ci(t,"__v_skip",!0),t}const ai=t=>Se(t)?fi(t):t,Dn=t=>Se(t)?Ks(t):t;function Js(t){Tt&&Qe&&(t=xe(t),Vs(t.dep||(t.dep=Pn())))}function Qs(t,r){t=xe(t);const e=t.dep;e&&nn(e)}function ze(t){return!!(t&&t.__v_isRef===!0)}function Lo(t){return Do(t,!1)}function Do(t,r){return ze(t)?t:new Mo(t,r)}class Mo{constructor(r,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?r:xe(r),this._value=e?r:ai(r)}get value(){return Js(this),this._value}set value(r){const e=this.__v_isShallow||Ri(r)||Kt(r);r=e?r:xe(r),oi(r,this._rawValue)&&(this._rawValue=r,this._value=e?r:ai(r),Qs(this))}}function Oo(t){return ze(t)?t.value:t}const ko={get:(t,r,e)=>Oo(Reflect.get(t,r,e)),set:(t,r,e,i)=>{const n=t[r];return ze(n)&&!ze(e)?(n.value=e,!0):Reflect.set(t,r,e,i)}};function $s(t){return qt(t)?t:new Proxy(t,ko)}class Fo{constructor(r,e,i,n){this._setter=e,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new Sn(r,()=>{this._dirty||(this._dirty=!0,Qs(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!n,this.__v_isReadonly=i}get value(){const r=xe(this);return Js(r),(r._dirty||!r._cacheable)&&(r._dirty=!1,r._value=r.effect.run()),r._value}set value(r){this._setter(r)}}function Ao(t,r,e=!1){let i,n;const s=ve(t);return s?(i=t,n=et):(i=t.get,n=t.set),new Fo(i,n,s||!n,e)}function bt(t,r,e,i){let n;try{n=i?t(...i):t()}catch(s){Ii(s,r,e)}return n}function tt(t,r,e,i){if(ve(t)){const s=bt(t,r,e,i);return s&&Os(s)&&s.catch(l=>{Ii(l,r,e)}),s}const n=[];for(let s=0;s<t.length;s++)n.push(tt(t[s],r,e,i));return n}function Ii(t,r,e,i=!0){const n=r?r.vnode:null;if(r){let s=r.parent;const l=r.proxy,a=e;for(;s;){const c=s.ec;if(c){for(let h=0;h<c.length;h++)if(c[h](t,l,a)===!1)return}s=s.parent}const o=r.appContext.config.errorHandler;if(o){bt(o,null,10,[t,l,a]);return}}Bo(t,e,n,i)}function Bo(t,r,e,i=!0){console.error(t)}let li=!1,sn=!1;const Be=[];let at=0;const Zt=[];let ft=null,Ht=0;const er=Promise.resolve();let Mn=null;function tr(t){const r=Mn||er;return t?r.then(this?t.bind(this):t):r}function Io(t){let r=at+1,e=Be.length;for(;r<e;){const i=r+e>>>1;ci(Be[i])<t?r=i+1:e=i}return r}function On(t){(!Be.length||!Be.includes(t,li&&t.allowRecurse?at+1:at))&&(t.id==null?Be.push(t):Be.splice(Io(t.id),0,t),ir())}function ir(){!li&&!sn&&(sn=!0,Mn=er.then(sr))}function zo(t){const r=Be.indexOf(t);r>at&&Be.splice(r,1)}function No(t){ce(t)?Zt.push(...t):(!ft||!ft.includes(t,t.allowRecurse?Ht+1:Ht))&&Zt.push(t),ir()}function is(t,r=li?at+1:0){for(;r<Be.length;r++){const e=Be[r];e&&e.pre&&(Be.splice(r,1),r--,e())}}function nr(t){if(Zt.length){const r=[...new Set(Zt)];if(Zt.length=0,ft){ft.push(...r);return}for(ft=r,ft.sort((e,i)=>ci(e)-ci(i)),Ht=0;Ht<ft.length;Ht++)ft[Ht]();ft=null,Ht=0}}const ci=t=>t.id==null?1/0:t.id,Vo=(t,r)=>{const e=ci(t)-ci(r);if(e===0){if(t.pre&&!r.pre)return-1;if(r.pre&&!t.pre)return 1}return e};function sr(t){sn=!1,li=!0,Be.sort(Vo);const r=et;try{for(at=0;at<Be.length;at++){const e=Be[at];e&&e.active!==!1&&bt(e,null,14)}}finally{at=0,Be.length=0,nr(),li=!1,Mn=null,(Be.length||Zt.length)&&sr()}}function Uo(t,r,...e){if(t.isUnmounted)return;const i=t.vnode.props||be;let n=e;const s=r.startsWith("update:"),l=s&&r.slice(7);if(l&&l in i){const h=`${l==="modelValue"?"model":l}Modifiers`,{number:g,trim:m}=i[h]||be;m&&(n=e.map(T=>Le(T)?T.trim():T)),g&&(n=e.map(Ji))}let a,o=i[a=ji(r)]||i[a=ji(lt(r))];!o&&s&&(o=i[a=ji(Bt(r))]),o&&tt(o,t,6,n);const c=i[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,tt(c,t,6,n)}}function rr(t,r,e=!1){const i=r.emitsCache,n=i.get(t);if(n!==void 0)return n;const s=t.emits;let l={},a=!1;if(!ve(t)){const o=c=>{const h=rr(c,r,!0);h&&(a=!0,Fe(l,h))};!e&&r.mixins.length&&r.mixins.forEach(o),t.extends&&o(t.extends),t.mixins&&t.mixins.forEach(o)}return!s&&!a?(Se(t)&&i.set(t,null),null):(ce(s)?s.forEach(o=>l[o]=null):Fe(l,s),Se(t)&&i.set(t,l),l)}function zi(t,r){return!t||!Oi(r)?!1:(r=r.slice(2).replace(/Once$/,""),we(t,r[0].toLowerCase()+r.slice(1))||we(t,Bt(r))||we(t,r))}let Ye=null,or=null;function Hi(t){const r=Ye;return Ye=t,or=t&&t.type.__scopeId||null,r}function Wo(t,r=Ye,e){if(!r||t._n)return t;const i=(...n)=>{i._d&&fs(-1);const s=Hi(r);let l;try{l=t(...n)}finally{Hi(s),i._d&&fs(1)}return l};return i._n=!0,i._c=!0,i._d=!0,i}function Gi(t){const{type:r,vnode:e,proxy:i,withProxy:n,props:s,propsOptions:[l],slots:a,attrs:o,emit:c,render:h,renderCache:g,data:m,setupState:T,ctx:b,inheritAttrs:P}=t;let C,k;const d=Hi(t);try{if(e.shapeFlag&4){const S=n||i;C=ot(h.call(S,S,g,s,T,m,b)),k=o}else{const S=r;C=ot(S.length>1?S(s,{attrs:o,slots:a,emit:c}):S(s,null)),k=r.props?o:jo(o)}}catch(S){ri.length=0,Ii(S,t,1),C=ie(At)}let _=C;if(k&&P!==!1){const S=Object.keys(k),{shapeFlag:M}=_;S.length&&M&7&&(l&&S.some(_n)&&(k=Go(k,l)),_=Xt(_,k))}return e.dirs&&(_=Xt(_),_.dirs=_.dirs?_.dirs.concat(e.dirs):e.dirs),e.transition&&(_.transition=e.transition),C=_,Hi(d),C}const jo=t=>{let r;for(const e in t)(e==="class"||e==="style"||Oi(e))&&((r||(r={}))[e]=t[e]);return r},Go=(t,r)=>{const e={};for(const i in t)(!_n(i)||!(i.slice(9)in r))&&(e[i]=t[i]);return e};function qo(t,r,e){const{props:i,children:n,component:s}=t,{props:l,children:a,patchFlag:o}=r,c=s.emitsOptions;if(r.dirs||r.transition)return!0;if(e&&o>=0){if(o&1024)return!0;if(o&16)return i?ns(i,l,c):!!l;if(o&8){const h=r.dynamicProps;for(let g=0;g<h.length;g++){const m=h[g];if(l[m]!==i[m]&&!zi(c,m))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:i===l?!1:i?l?ns(i,l,c):!0:!!l;return!1}function ns(t,r,e){const i=Object.keys(r);if(i.length!==Object.keys(t).length)return!0;for(let n=0;n<i.length;n++){const s=i[n];if(r[s]!==t[s]&&!zi(e,s))return!0}return!1}function Zo({vnode:t,parent:r},e){for(;r&&r.subTree===t;)(t=r.vnode).el=e,r=r.parent}const Ko=t=>t.__isSuspense;function Xo(t,r){r&&r.pendingBranch?ce(t)?r.effects.push(...t):r.effects.push(t):No(t)}const _i={};function qi(t,r,e){return ar(t,r,e)}function ar(t,r,{immediate:e,deep:i,flush:n,onTrack:s,onTrigger:l}=be){var a;const o=to()===((a=Oe)==null?void 0:a.scope)?Oe:null;let c,h=!1,g=!1;if(ze(t)?(c=()=>t.value,h=Ri(t)):qt(t)?(c=()=>t,i=!0):ce(t)?(g=!0,h=t.some(S=>qt(S)||Ri(S)),c=()=>t.map(S=>{if(ze(S))return S.value;if(qt(S))return Dt(S);if(ve(S))return bt(S,o,2)})):ve(t)?r?c=()=>bt(t,o,2):c=()=>{if(!(o&&o.isUnmounted))return m&&m(),tt(t,o,3,[T])}:c=et,r&&i){const S=c;c=()=>Dt(S())}let m,T=S=>{m=d.onStop=()=>{bt(S,o,4)}},b;if(hi)if(T=et,r?e&&tt(r,o,3,[c(),g?[]:void 0,T]):c(),n==="sync"){const S=ja();b=S.__watcherHandles||(S.__watcherHandles=[])}else return et;let P=g?new Array(t.length).fill(_i):_i;const C=()=>{if(d.active)if(r){const S=d.run();(i||h||(g?S.some((M,I)=>oi(M,P[I])):oi(S,P)))&&(m&&m(),tt(r,o,3,[S,P===_i?void 0:g&&P[0]===_i?[]:P,T]),P=S)}else d.run()};C.allowRecurse=!!r;let k;n==="sync"?k=C:n==="post"?k=()=>je(C,o&&o.suspense):(C.pre=!0,o&&(C.id=o.uid),k=()=>On(C));const d=new Sn(c,k);r?e?C():P=d.run():n==="post"?je(d.run.bind(d),o&&o.suspense):d.run();const _=()=>{d.stop(),o&&o.scope&&xn(o.scope.effects,d)};return b&&b.push(_),_}function Yo(t,r,e){const i=this.proxy,n=Le(t)?t.includes(".")?lr(i,t):()=>i[t]:t.bind(i,i);let s;ve(r)?s=r:(s=r.handler,e=r);const l=Oe;Yt(this);const a=ar(n,s.bind(i),e);return l?Yt(l):kt(),a}function lr(t,r){const e=r.split(".");return()=>{let i=t;for(let n=0;n<e.length&&i;n++)i=i[e[n]];return i}}function Dt(t,r){if(!Se(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),ze(t))Dt(t.value,r);else if(ce(t))for(let e=0;e<t.length;e++)Dt(t[e],r);else if(Ms(t)||Gt(t))t.forEach(e=>{Dt(e,r)});else if(Fs(t))for(const e in t)Dt(t[e],r);return t}function Ve(t,r){const e=Ye;if(e===null)return t;const i=Wi(e)||e.proxy,n=t.dirs||(t.dirs=[]);for(let s=0;s<r.length;s++){let[l,a,o,c=be]=r[s];l&&(ve(l)&&(l={mounted:l,updated:l}),l.deep&&Dt(a),n.push({dir:l,instance:i,value:a,oldValue:void 0,arg:o,modifiers:c}))}return t}function Ct(t,r,e,i){const n=t.dirs,s=r&&r.dirs;for(let l=0;l<n.length;l++){const a=n[l];s&&(a.oldValue=s[l].value);let o=a.dir[i];o&&(Jt(),tt(o,e,8,[t.el,a,t,r]),Qt())}}const bi=t=>!!t.type.__asyncLoader,cr=t=>t.type.__isKeepAlive;function Jo(t,r){ur(t,"a",r)}function Qo(t,r){ur(t,"da",r)}function ur(t,r,e=Oe){const i=t.__wdc||(t.__wdc=()=>{let n=e;for(;n;){if(n.isDeactivated)return;n=n.parent}return t()});if(Ni(r,i,e),e){let n=e.parent;for(;n&&n.parent;)cr(n.parent.vnode)&&$o(i,r,e,n),n=n.parent}}function $o(t,r,e,i){const n=Ni(r,t,i,!0);hr(()=>{xn(i[r],n)},e)}function Ni(t,r,e=Oe,i=!1){if(e){const n=e[t]||(e[t]=[]),s=r.__weh||(r.__weh=(...l)=>{if(e.isUnmounted)return;Jt(),Yt(e);const a=tt(r,e,t,l);return kt(),Qt(),a});return i?n.unshift(s):n.push(s),s}}const gt=t=>(r,e=Oe)=>(!hi||t==="sp")&&Ni(t,(...i)=>r(...i),e),ea=gt("bm"),ta=gt("m"),ia=gt("bu"),na=gt("u"),sa=gt("bum"),hr=gt("um"),ra=gt("sp"),oa=gt("rtg"),aa=gt("rtc");function la(t,r=Oe){Ni("ec",t,r)}const dr="components",ca="directives";function fr(t,r){return pr(dr,t,!0,r)||t}const ua=Symbol.for("v-ndc");function kn(t){return pr(ca,t)}function pr(t,r,e=!0,i=!1){const n=Ye||Oe;if(n){const s=n.type;if(t===dr){const a=Na(s,!1);if(a&&(a===r||a===lt(r)||a===Ai(lt(r))))return s}const l=ss(n[t]||s[t],r)||ss(n.appContext[t],r);return!l&&i?s:l}}function ss(t,r){return t&&(t[r]||t[lt(r)]||t[Ai(lt(r))])}function Re(t,r,e,i){let n;const s=e&&e[i];if(ce(t)||Le(t)){n=new Array(t.length);for(let l=0,a=t.length;l<a;l++)n[l]=r(t[l],l,void 0,s&&s[l])}else if(typeof t=="number"){n=new Array(t);for(let l=0;l<t;l++)n[l]=r(l+1,l,void 0,s&&s[l])}else if(Se(t))if(t[Symbol.iterator])n=Array.from(t,(l,a)=>r(l,a,void 0,s&&s[a]));else{const l=Object.keys(t);n=new Array(l.length);for(let a=0,o=l.length;a<o;a++){const c=l[a];n[a]=r(t[c],c,a,s&&s[a])}}else n=[];return e&&(e[i]=n),n}const rn=t=>t?Pr(t)?Wi(t)||t.proxy:rn(t.parent):null,si=Fe(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>rn(t.parent),$root:t=>rn(t.root),$emit:t=>t.emit,$options:t=>Fn(t),$forceUpdate:t=>t.f||(t.f=()=>On(t.update)),$nextTick:t=>t.n||(t.n=tr.bind(t.proxy)),$watch:t=>Yo.bind(t)}),Zi=(t,r)=>t!==be&&!t.__isScriptSetup&&we(t,r),ha={get({_:t},r){const{ctx:e,setupState:i,data:n,props:s,accessCache:l,type:a,appContext:o}=t;let c;if(r[0]!=="$"){const T=l[r];if(T!==void 0)switch(T){case 1:return i[r];case 2:return n[r];case 4:return e[r];case 3:return s[r]}else{if(Zi(i,r))return l[r]=1,i[r];if(n!==be&&we(n,r))return l[r]=2,n[r];if((c=t.propsOptions[0])&&we(c,r))return l[r]=3,s[r];if(e!==be&&we(e,r))return l[r]=4,e[r];on&&(l[r]=0)}}const h=si[r];let g,m;if(h)return r==="$attrs"&&qe(t,"get",r),h(t);if((g=a.__cssModules)&&(g=g[r]))return g;if(e!==be&&we(e,r))return l[r]=4,e[r];if(m=o.config.globalProperties,we(m,r))return m[r]},set({_:t},r,e){const{data:i,setupState:n,ctx:s}=t;return Zi(n,r)?(n[r]=e,!0):i!==be&&we(i,r)?(i[r]=e,!0):we(t.props,r)||r[0]==="$"&&r.slice(1)in t?!1:(s[r]=e,!0)},has({_:{data:t,setupState:r,accessCache:e,ctx:i,appContext:n,propsOptions:s}},l){let a;return!!e[l]||t!==be&&we(t,l)||Zi(r,l)||(a=s[0])&&we(a,l)||we(i,l)||we(si,l)||we(n.config.globalProperties,l)},defineProperty(t,r,e){return e.get!=null?t._.accessCache[r]=0:we(e,"value")&&this.set(t,r,e.value,null),Reflect.defineProperty(t,r,e)}};function rs(t){return ce(t)?t.reduce((r,e)=>(r[e]=null,r),{}):t}let on=!0;function da(t){const r=Fn(t),e=t.proxy,i=t.ctx;on=!1,r.beforeCreate&&os(r.beforeCreate,t,"bc");const{data:n,computed:s,methods:l,watch:a,provide:o,inject:c,created:h,beforeMount:g,mounted:m,beforeUpdate:T,updated:b,activated:P,deactivated:C,beforeDestroy:k,beforeUnmount:d,destroyed:_,unmounted:S,render:M,renderTracked:I,renderTriggered:V,errorCaptured:q,serverPrefetch:K,expose:j,inheritAttrs:oe,components:te,directives:pe,filters:he}=r;if(c&&fa(c,i,null),l)for(const ae in l){const ne=l[ae];ve(ne)&&(i[ae]=ne.bind(e))}if(n){const ae=n.call(e,e);Se(ae)&&(t.data=fi(ae))}if(on=!0,s)for(const ae in s){const ne=s[ae],Te=ve(ne)?ne.bind(e,e):ve(ne.get)?ne.get.bind(e,e):et,$=!ve(ne)&&ve(ne.set)?ne.set.bind(e):et,De=ht({get:Te,set:$});Object.defineProperty(i,ae,{enumerable:!0,configurable:!0,get:()=>De.value,set:Ue=>De.value=Ue})}if(a)for(const ae in a)gr(a[ae],i,e,ae);if(o){const ae=ve(o)?o.call(e):o;Reflect.ownKeys(ae).forEach(ne=>{wa(ne,ae[ne])})}h&&os(h,t,"c");function le(ae,ne){ce(ne)?ne.forEach(Te=>ae(Te.bind(e))):ne&&ae(ne.bind(e))}if(le(ea,g),le(ta,m),le(ia,T),le(na,b),le(Jo,P),le(Qo,C),le(la,q),le(aa,I),le(oa,V),le(sa,d),le(hr,S),le(ra,K),ce(j))if(j.length){const ae=t.exposed||(t.exposed={});j.forEach(ne=>{Object.defineProperty(ae,ne,{get:()=>e[ne],set:Te=>e[ne]=Te})})}else t.exposed||(t.exposed={});M&&t.render===et&&(t.render=M),oe!=null&&(t.inheritAttrs=oe),te&&(t.components=te),pe&&(t.directives=pe)}function fa(t,r,e=et){ce(t)&&(t=an(t));for(const i in t){const n=t[i];let s;Se(n)?"default"in n?s=Ei(n.from||i,n.default,!0):s=Ei(n.from||i):s=Ei(n),ze(s)?Object.defineProperty(r,i,{enumerable:!0,configurable:!0,get:()=>s.value,set:l=>s.value=l}):r[i]=s}}function os(t,r,e){tt(ce(t)?t.map(i=>i.bind(r.proxy)):t.bind(r.proxy),r,e)}function gr(t,r,e,i){const n=i.includes(".")?lr(e,i):()=>e[i];if(Le(t)){const s=r[t];ve(s)&&qi(n,s)}else if(ve(t))qi(n,t.bind(e));else if(Se(t))if(ce(t))t.forEach(s=>gr(s,r,e,i));else{const s=ve(t.handler)?t.handler.bind(e):r[t.handler];ve(s)&&qi(n,s,t)}}function Fn(t){const r=t.type,{mixins:e,extends:i}=r,{mixins:n,optionsCache:s,config:{optionMergeStrategies:l}}=t.appContext,a=s.get(r);let o;return a?o=a:!n.length&&!e&&!i?o=r:(o={},n.length&&n.forEach(c=>Li(o,c,l,!0)),Li(o,r,l)),Se(r)&&s.set(r,o),o}function Li(t,r,e,i=!1){const{mixins:n,extends:s}=r;s&&Li(t,s,e,!0),n&&n.forEach(l=>Li(t,l,e,!0));for(const l in r)if(!(i&&l==="expose")){const a=pa[l]||e&&e[l];t[l]=a?a(t[l],r[l]):r[l]}return t}const pa={data:as,props:ls,emits:ls,methods:ii,computed:ii,beforeCreate:Ne,created:Ne,beforeMount:Ne,mounted:Ne,beforeUpdate:Ne,updated:Ne,beforeDestroy:Ne,beforeUnmount:Ne,destroyed:Ne,unmounted:Ne,activated:Ne,deactivated:Ne,errorCaptured:Ne,serverPrefetch:Ne,components:ii,directives:ii,watch:ma,provide:as,inject:ga};function as(t,r){return r?t?function(){return Fe(ve(t)?t.call(this,this):t,ve(r)?r.call(this,this):r)}:r:t}function ga(t,r){return ii(an(t),an(r))}function an(t){if(ce(t)){const r={};for(let e=0;e<t.length;e++)r[t[e]]=t[e];return r}return t}function Ne(t,r){return t?[...new Set([].concat(t,r))]:r}function ii(t,r){return t?Fe(Object.create(null),t,r):r}function ls(t,r){return t?ce(t)&&ce(r)?[...new Set([...t,...r])]:Fe(Object.create(null),rs(t),rs(r??{})):r}function ma(t,r){if(!t)return r;if(!r)return t;const e=Fe(Object.create(null),t);for(const i in r)e[i]=Ne(t[i],r[i]);return e}function mr(){return{app:null,config:{isNativeTag:Vr,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let va=0;function ya(t,r){return function(i,n=null){ve(i)||(i=Fe({},i)),n!=null&&!Se(n)&&(n=null);const s=mr(),l=new Set;let a=!1;const o=s.app={_uid:va++,_component:i,_props:n,_container:null,_context:s,_instance:null,version:Ga,get config(){return s.config},set config(c){},use(c,...h){return l.has(c)||(c&&ve(c.install)?(l.add(c),c.install(o,...h)):ve(c)&&(l.add(c),c(o,...h))),o},mixin(c){return s.mixins.includes(c)||s.mixins.push(c),o},component(c,h){return h?(s.components[c]=h,o):s.components[c]},directive(c,h){return h?(s.directives[c]=h,o):s.directives[c]},mount(c,h,g){if(!a){const m=ie(i,n);return m.appContext=s,h&&r?r(m,c):t(m,c,g),a=!0,o._container=c,c.__vue_app__=o,Wi(m.component)||m.component.proxy}},unmount(){a&&(t(null,o._container),delete o._container.__vue_app__)},provide(c,h){return s.provides[c]=h,o},runWithContext(c){Di=o;try{return c()}finally{Di=null}}};return o}}let Di=null;function wa(t,r){if(Oe){let e=Oe.provides;const i=Oe.parent&&Oe.parent.provides;i===e&&(e=Oe.provides=Object.create(i)),e[t]=r}}function Ei(t,r,e=!1){const i=Oe||Ye;if(i||Di){const n=i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:Di._context.provides;if(n&&t in n)return n[t];if(arguments.length>1)return e&&ve(r)?r.call(i&&i.proxy):r}}function _a(t,r,e,i=!1){const n={},s={};Ci(s,Ui,1),t.propsDefaults=Object.create(null),vr(t,r,n,s);for(const l in t.propsOptions[0])l in n||(n[l]=void 0);e?t.props=i?n:Ho(n):t.type.props?t.props=n:t.props=s,t.attrs=s}function xa(t,r,e,i){const{props:n,attrs:s,vnode:{patchFlag:l}}=t,a=xe(n),[o]=t.propsOptions;let c=!1;if((i||l>0)&&!(l&16)){if(l&8){const h=t.vnode.dynamicProps;for(let g=0;g<h.length;g++){let m=h[g];if(zi(t.emitsOptions,m))continue;const T=r[m];if(o)if(we(s,m))T!==s[m]&&(s[m]=T,c=!0);else{const b=lt(m);n[b]=ln(o,a,b,T,t,!1)}else T!==s[m]&&(s[m]=T,c=!0)}}}else{vr(t,r,n,s)&&(c=!0);let h;for(const g in a)(!r||!we(r,g)&&((h=Bt(g))===g||!we(r,h)))&&(o?e&&(e[g]!==void 0||e[h]!==void 0)&&(n[g]=ln(o,a,g,void 0,t,!0)):delete n[g]);if(s!==a)for(const g in s)(!r||!we(r,g))&&(delete s[g],c=!0)}c&&pt(t,"set","$attrs")}function vr(t,r,e,i){const[n,s]=t.propsOptions;let l=!1,a;if(r)for(let o in r){if(xi(o))continue;const c=r[o];let h;n&&we(n,h=lt(o))?!s||!s.includes(h)?e[h]=c:(a||(a={}))[h]=c:zi(t.emitsOptions,o)||(!(o in i)||c!==i[o])&&(i[o]=c,l=!0)}if(s){const o=xe(e),c=a||be;for(let h=0;h<s.length;h++){const g=s[h];e[g]=ln(n,o,g,c[g],t,!we(c,g))}}return l}function ln(t,r,e,i,n,s){const l=t[e];if(l!=null){const a=we(l,"default");if(a&&i===void 0){const o=l.default;if(l.type!==Function&&!l.skipFactory&&ve(o)){const{propsDefaults:c}=n;e in c?i=c[e]:(Yt(n),i=c[e]=o.call(null,r),kt())}else i=o}l[0]&&(s&&!a?i=!1:l[1]&&(i===""||i===Bt(e))&&(i=!0))}return i}function yr(t,r,e=!1){const i=r.propsCache,n=i.get(t);if(n)return n;const s=t.props,l={},a=[];let o=!1;if(!ve(t)){const h=g=>{o=!0;const[m,T]=yr(g,r,!0);Fe(l,m),T&&a.push(...T)};!e&&r.mixins.length&&r.mixins.forEach(h),t.extends&&h(t.extends),t.mixins&&t.mixins.forEach(h)}if(!s&&!o)return Se(t)&&i.set(t,jt),jt;if(ce(s))for(let h=0;h<s.length;h++){const g=lt(s[h]);cs(g)&&(l[g]=be)}else if(s)for(const h in s){const g=lt(h);if(cs(g)){const m=s[h],T=l[g]=ce(m)||ve(m)?{type:m}:Fe({},m);if(T){const b=ds(Boolean,T.type),P=ds(String,T.type);T[0]=b>-1,T[1]=P<0||b<P,(b>-1||we(T,"default"))&&a.push(g)}}}const c=[l,a];return Se(t)&&i.set(t,c),c}function cs(t){return t[0]!=="$"}function us(t){const r=t&&t.toString().match(/^\s*(function|class) (\w+)/);return r?r[2]:t===null?"null":""}function hs(t,r){return us(t)===us(r)}function ds(t,r){return ce(r)?r.findIndex(e=>hs(e,t)):ve(r)&&hs(r,t)?0:-1}const wr=t=>t[0]==="_"||t==="$stable",An=t=>ce(t)?t.map(ot):[ot(t)],Ta=(t,r,e)=>{if(r._n)return r;const i=Wo((...n)=>An(r(...n)),e);return i._c=!1,i},_r=(t,r,e)=>{const i=t._ctx;for(const n in t){if(wr(n))continue;const s=t[n];if(ve(s))r[n]=Ta(n,s,i);else if(s!=null){const l=An(s);r[n]=()=>l}}},xr=(t,r)=>{const e=An(r);t.slots.default=()=>e},ba=(t,r)=>{if(t.vnode.shapeFlag&32){const e=r._;e?(t.slots=xe(r),Ci(r,"_",e)):_r(r,t.slots={})}else t.slots={},r&&xr(t,r);Ci(t.slots,Ui,1)},Ea=(t,r,e)=>{const{vnode:i,slots:n}=t;let s=!0,l=be;if(i.shapeFlag&32){const a=r._;a?e&&a===1?s=!1:(Fe(n,r),!e&&a===1&&delete n._):(s=!r.$stable,_r(r,n)),l=r}else r&&(xr(t,r),l={default:1});if(s)for(const a in n)!wr(a)&&!(a in l)&&delete n[a]};function cn(t,r,e,i,n=!1){if(ce(t)){t.forEach((m,T)=>cn(m,r&&(ce(r)?r[T]:r),e,i,n));return}if(bi(i)&&!n)return;const s=i.shapeFlag&4?Wi(i.component)||i.component.proxy:i.el,l=n?null:s,{i:a,r:o}=t,c=r&&r.r,h=a.refs===be?a.refs={}:a.refs,g=a.setupState;if(c!=null&&c!==o&&(Le(c)?(h[c]=null,we(g,c)&&(g[c]=null)):ze(c)&&(c.value=null)),ve(o))bt(o,a,12,[l,h]);else{const m=Le(o),T=ze(o);if(m||T){const b=()=>{if(t.f){const P=m?we(g,o)?g[o]:h[o]:o.value;n?ce(P)&&xn(P,s):ce(P)?P.includes(s)||P.push(s):m?(h[o]=[s],we(g,o)&&(g[o]=h[o])):(o.value=[s],t.k&&(h[t.k]=o.value))}else m?(h[o]=l,we(g,o)&&(g[o]=l)):T&&(o.value=l,t.k&&(h[t.k]=l))};l?(b.id=-1,je(b,e)):b()}}}const je=Xo;function Pa(t){return Sa(t)}function Sa(t,r){const e=Qi();e.__VUE__=!0;const{insert:i,remove:n,patchProp:s,createElement:l,createText:a,createComment:o,setText:c,setElementText:h,parentNode:g,nextSibling:m,setScopeId:T=et,insertStaticContent:b}=t,P=(E,R,u,v=null,x=null,L=null,H=!1,B=null,A=!!R.dynamicChildren)=>{if(E===R)return;E&&!$t(E,R)&&(v=dt(E),Ue(E,x,L,!0),E=null),R.patchFlag===-2&&(A=!1,R.dynamicChildren=null);const{type:N,ref:Y,shapeFlag:Z}=R;switch(N){case Vi:C(E,R,u,v);break;case At:k(E,R,u,v);break;case Ki:E==null&&d(R,u,v,H);break;case fe:te(E,R,u,v,x,L,H,B,A);break;default:Z&1?M(E,R,u,v,x,L,H,B,A):Z&6?pe(E,R,u,v,x,L,H,B,A):(Z&64||Z&128)&&N.process(E,R,u,v,x,L,H,B,A,nt)}Y!=null&&x&&cn(Y,E&&E.ref,L,R||E,!R)},C=(E,R,u,v)=>{if(E==null)i(R.el=a(R.children),u,v);else{const x=R.el=E.el;R.children!==E.children&&c(x,R.children)}},k=(E,R,u,v)=>{E==null?i(R.el=o(R.children||""),u,v):R.el=E.el},d=(E,R,u,v)=>{[E.el,E.anchor]=b(E.children,R,u,v,E.el,E.anchor)},_=({el:E,anchor:R},u,v)=>{let x;for(;E&&E!==R;)x=m(E),i(E,u,v),E=x;i(R,u,v)},S=({el:E,anchor:R})=>{let u;for(;E&&E!==R;)u=m(E),n(E),E=u;n(R)},M=(E,R,u,v,x,L,H,B,A)=>{H=H||R.type==="svg",E==null?I(R,u,v,x,L,H,B,A):K(E,R,x,L,H,B,A)},I=(E,R,u,v,x,L,H,B)=>{let A,N;const{type:Y,props:Z,shapeFlag:W,transition:Q,dirs:J}=E;if(A=E.el=l(E.type,L,Z&&Z.is,Z),W&8?h(A,E.children):W&16&&q(E.children,A,null,v,x,L&&Y!=="foreignObject",H,B),J&&Ct(E,null,v,"created"),V(A,E,E.scopeId,H,v),Z){for(const ye in Z)ye!=="value"&&!xi(ye)&&s(A,ye,null,Z[ye],L,E.children,v,x,We);"value"in Z&&s(A,"value",null,Z.value),(N=Z.onVnodeBeforeMount)&&st(N,v,E)}J&&Ct(E,null,v,"beforeMount");const de=(!x||x&&!x.pendingBranch)&&Q&&!Q.persisted;de&&Q.beforeEnter(A),i(A,R,u),((N=Z&&Z.onVnodeMounted)||de||J)&&je(()=>{N&&st(N,v,E),de&&Q.enter(A),J&&Ct(E,null,v,"mounted")},x)},V=(E,R,u,v,x)=>{if(u&&T(E,u),v)for(let L=0;L<v.length;L++)T(E,v[L]);if(x){let L=x.subTree;if(R===L){const H=x.vnode;V(E,H,H.scopeId,H.slotScopeIds,x.parent)}}},q=(E,R,u,v,x,L,H,B,A=0)=>{for(let N=A;N<E.length;N++){const Y=E[N]=B?_t(E[N]):ot(E[N]);P(null,Y,R,u,v,x,L,H,B)}},K=(E,R,u,v,x,L,H)=>{const B=R.el=E.el;let{patchFlag:A,dynamicChildren:N,dirs:Y}=R;A|=E.patchFlag&16;const Z=E.props||be,W=R.props||be;let Q;u&&Rt(u,!1),(Q=W.onVnodeBeforeUpdate)&&st(Q,u,R,E),Y&&Ct(R,E,u,"beforeUpdate"),u&&Rt(u,!0);const J=x&&R.type!=="foreignObject";if(N?j(E.dynamicChildren,N,B,u,v,J,L):H||ne(E,R,B,null,u,v,J,L,!1),A>0){if(A&16)oe(B,R,Z,W,u,v,x);else if(A&2&&Z.class!==W.class&&s(B,"class",null,W.class,x),A&4&&s(B,"style",Z.style,W.style,x),A&8){const de=R.dynamicProps;for(let ye=0;ye<de.length;ye++){const p=de[ye],f=Z[p],y=W[p];(y!==f||p==="value")&&s(B,p,f,y,x,E.children,u,v,We)}}A&1&&E.children!==R.children&&h(B,R.children)}else!H&&N==null&&oe(B,R,Z,W,u,v,x);((Q=W.onVnodeUpdated)||Y)&&je(()=>{Q&&st(Q,u,R,E),Y&&Ct(R,E,u,"updated")},v)},j=(E,R,u,v,x,L,H)=>{for(let B=0;B<R.length;B++){const A=E[B],N=R[B],Y=A.el&&(A.type===fe||!$t(A,N)||A.shapeFlag&70)?g(A.el):u;P(A,N,Y,null,v,x,L,H,!0)}},oe=(E,R,u,v,x,L,H)=>{if(u!==v){if(u!==be)for(const B in u)!xi(B)&&!(B in v)&&s(E,B,u[B],null,H,R.children,x,L,We);for(const B in v){if(xi(B))continue;const A=v[B],N=u[B];A!==N&&B!=="value"&&s(E,B,N,A,H,R.children,x,L,We)}"value"in v&&s(E,"value",u.value,v.value)}},te=(E,R,u,v,x,L,H,B,A)=>{const N=R.el=E?E.el:a(""),Y=R.anchor=E?E.anchor:a("");let{patchFlag:Z,dynamicChildren:W,slotScopeIds:Q}=R;Q&&(B=B?B.concat(Q):Q),E==null?(i(N,u,v),i(Y,u,v),q(R.children,u,Y,x,L,H,B,A)):Z>0&&Z&64&&W&&E.dynamicChildren?(j(E.dynamicChildren,W,u,x,L,H,B),(R.key!=null||x&&R===x.subTree)&&Tr(E,R,!0)):ne(E,R,u,Y,x,L,H,B,A)},pe=(E,R,u,v,x,L,H,B,A)=>{R.slotScopeIds=B,E==null?R.shapeFlag&512?x.ctx.activate(R,u,v,H,A):he(R,u,v,x,L,H,A):_e(E,R,A)},he=(E,R,u,v,x,L,H)=>{const B=E.component=Fa(E,v,x);if(cr(E)&&(B.ctx.renderer=nt),Aa(B),B.asyncDep){if(x&&x.registerDep(B,le),!E.el){const A=B.subTree=ie(At);k(null,A,R,u)}return}le(B,E,R,u,x,L,H)},_e=(E,R,u)=>{const v=R.component=E.component;if(qo(E,R,u))if(v.asyncDep&&!v.asyncResolved){ae(v,R,u);return}else v.next=R,zo(v.update),v.update();else R.el=E.el,v.vnode=R},le=(E,R,u,v,x,L,H)=>{const B=()=>{if(E.isMounted){let{next:Y,bu:Z,u:W,parent:Q,vnode:J}=E,de=Y,ye;Rt(E,!1),Y?(Y.el=J.el,ae(E,Y,H)):Y=J,Z&&Ti(Z),(ye=Y.props&&Y.props.onVnodeBeforeUpdate)&&st(ye,Q,Y,J),Rt(E,!0);const p=Gi(E),f=E.subTree;E.subTree=p,P(f,p,g(f.el),dt(f),E,x,L),Y.el=p.el,de===null&&Zo(E,p.el),W&&je(W,x),(ye=Y.props&&Y.props.onVnodeUpdated)&&je(()=>st(ye,Q,Y,J),x)}else{let Y;const{el:Z,props:W}=R,{bm:Q,m:J,parent:de}=E,ye=bi(R);if(Rt(E,!1),Q&&Ti(Q),!ye&&(Y=W&&W.onVnodeBeforeMount)&&st(Y,de,R),Rt(E,!0),Z&&yt){const p=()=>{E.subTree=Gi(E),yt(Z,E.subTree,E,x,null)};ye?R.type.__asyncLoader().then(()=>!E.isUnmounted&&p()):p()}else{const p=E.subTree=Gi(E);P(null,p,u,v,E,x,L),R.el=p.el}if(J&&je(J,x),!ye&&(Y=W&&W.onVnodeMounted)){const p=R;je(()=>st(Y,de,p),x)}(R.shapeFlag&256||de&&bi(de.vnode)&&de.vnode.shapeFlag&256)&&E.a&&je(E.a,x),E.isMounted=!0,R=u=v=null}},A=E.effect=new Sn(B,()=>On(N),E.scope),N=E.update=()=>A.run();N.id=E.uid,Rt(E,!0),N()},ae=(E,R,u)=>{R.component=E;const v=E.vnode.props;E.vnode=R,E.next=null,xa(E,R.props,v,u),Ea(E,R.children,u),Jt(),is(),Qt()},ne=(E,R,u,v,x,L,H,B,A=!1)=>{const N=E&&E.children,Y=E?E.shapeFlag:0,Z=R.children,{patchFlag:W,shapeFlag:Q}=R;if(W>0){if(W&128){$(N,Z,u,v,x,L,H,B,A);return}else if(W&256){Te(N,Z,u,v,x,L,H,B,A);return}}Q&8?(Y&16&&We(N,x,L),Z!==N&&h(u,Z)):Y&16?Q&16?$(N,Z,u,v,x,L,H,B,A):We(N,x,L,!0):(Y&8&&h(u,""),Q&16&&q(Z,u,v,x,L,H,B,A))},Te=(E,R,u,v,x,L,H,B,A)=>{E=E||jt,R=R||jt;const N=E.length,Y=R.length,Z=Math.min(N,Y);let W;for(W=0;W<Z;W++){const Q=R[W]=A?_t(R[W]):ot(R[W]);P(E[W],Q,u,null,x,L,H,B,A)}N>Y?We(E,x,L,!0,!1,Z):q(R,u,v,x,L,H,B,A,Z)},$=(E,R,u,v,x,L,H,B,A)=>{let N=0;const Y=R.length;let Z=E.length-1,W=Y-1;for(;N<=Z&&N<=W;){const Q=E[N],J=R[N]=A?_t(R[N]):ot(R[N]);if($t(Q,J))P(Q,J,u,null,x,L,H,B,A);else break;N++}for(;N<=Z&&N<=W;){const Q=E[Z],J=R[W]=A?_t(R[W]):ot(R[W]);if($t(Q,J))P(Q,J,u,null,x,L,H,B,A);else break;Z--,W--}if(N>Z){if(N<=W){const Q=W+1,J=Q<Y?R[Q].el:v;for(;N<=W;)P(null,R[N]=A?_t(R[N]):ot(R[N]),u,J,x,L,H,B,A),N++}}else if(N>W)for(;N<=Z;)Ue(E[N],x,L,!0),N++;else{const Q=N,J=N,de=new Map;for(N=J;N<=W;N++){const ee=R[N]=A?_t(R[N]):ot(R[N]);ee.key!=null&&de.set(ee.key,N)}let ye,p=0;const f=W-J+1;let y=!1,w=0;const z=new Array(f);for(N=0;N<f;N++)z[N]=0;for(N=Q;N<=Z;N++){const ee=E[N];if(p>=f){Ue(ee,x,L,!0);continue}let ge;if(ee.key!=null)ge=de.get(ee.key);else for(ye=J;ye<=W;ye++)if(z[ye-J]===0&&$t(ee,R[ye])){ge=ye;break}ge===void 0?Ue(ee,x,L,!0):(z[ge-J]=N+1,ge>=w?w=ge:y=!0,P(ee,R[ge],u,null,x,L,H,B,A),p++)}const G=y?Ca(z):jt;for(ye=G.length-1,N=f-1;N>=0;N--){const ee=J+N,ge=R[ee],se=ee+1<Y?R[ee+1].el:v;z[N]===0?P(null,ge,u,se,x,L,H,B,A):y&&(ye<0||N!==G[ye]?De(ge,u,se,2):ye--)}}},De=(E,R,u,v,x=null)=>{const{el:L,type:H,transition:B,children:A,shapeFlag:N}=E;if(N&6){De(E.component.subTree,R,u,v);return}if(N&128){E.suspense.move(R,u,v);return}if(N&64){H.move(E,R,u,nt);return}if(H===fe){i(L,R,u);for(let Z=0;Z<A.length;Z++)De(A[Z],R,u,v);i(E.anchor,R,u);return}if(H===Ki){_(E,R,u);return}if(v!==2&&N&1&&B)if(v===0)B.beforeEnter(L),i(L,R,u),je(()=>B.enter(L),x);else{const{leave:Z,delayLeave:W,afterLeave:Q}=B,J=()=>i(L,R,u),de=()=>{Z(L,()=>{J(),Q&&Q()})};W?W(L,J,de):de()}else i(L,R,u)},Ue=(E,R,u,v=!1,x=!1)=>{const{type:L,props:H,ref:B,children:A,dynamicChildren:N,shapeFlag:Y,patchFlag:Z,dirs:W}=E;if(B!=null&&cn(B,null,u,E,!0),Y&256){R.ctx.deactivate(E);return}const Q=Y&1&&W,J=!bi(E);let de;if(J&&(de=H&&H.onVnodeBeforeUnmount)&&st(de,R,E),Y&6)Nt(E.component,u,v);else{if(Y&128){E.suspense.unmount(u,v);return}Q&&Ct(E,null,R,"beforeUnmount"),Y&64?E.type.remove(E,R,u,x,nt,v):N&&(L!==fe||Z>0&&Z&64)?We(N,R,u,!1,!0):(L===fe&&Z&384||!x&&Y&16)&&We(A,R,u),v&&Pt(E)}(J&&(de=H&&H.onVnodeUnmounted)||Q)&&je(()=>{de&&st(de,R,E),Q&&Ct(E,null,R,"unmounted")},u)},Pt=E=>{const{type:R,el:u,anchor:v,transition:x}=E;if(R===fe){mt(u,v);return}if(R===Ki){S(E);return}const L=()=>{n(u),x&&!x.persisted&&x.afterLeave&&x.afterLeave()};if(E.shapeFlag&1&&x&&!x.persisted){const{leave:H,delayLeave:B}=x,A=()=>H(u,L);B?B(E.el,L,A):A()}else L()},mt=(E,R)=>{let u;for(;E!==R;)u=m(E),n(E),E=u;n(R)},Nt=(E,R,u)=>{const{bum:v,scope:x,update:L,subTree:H,um:B}=E;v&&Ti(v),x.stop(),L&&(L.active=!1,Ue(H,E,R,u)),B&&je(B,R),je(()=>{E.isUnmounted=!0},R),R&&R.pendingBranch&&!R.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===R.pendingId&&(R.deps--,R.deps===0&&R.resolve())},We=(E,R,u,v=!1,x=!1,L=0)=>{for(let H=L;H<E.length;H++)Ue(E[H],R,u,v,x)},dt=E=>E.shapeFlag&6?dt(E.component.subTree):E.shapeFlag&128?E.suspense.next():m(E.anchor||E.el),St=(E,R,u)=>{E==null?R._vnode&&Ue(R._vnode,null,null,!0):P(R._vnode||null,E,R,null,null,null,u),is(),nr(),R._vnode=E},nt={p:P,um:Ue,m:De,r:Pt,mt:he,mc:q,pc:ne,pbc:j,n:dt,o:t};let vt,yt;return r&&([vt,yt]=r(nt)),{render:St,hydrate:vt,createApp:ya(St,vt)}}function Rt({effect:t,update:r},e){t.allowRecurse=r.allowRecurse=e}function Tr(t,r,e=!1){const i=t.children,n=r.children;if(ce(i)&&ce(n))for(let s=0;s<i.length;s++){const l=i[s];let a=n[s];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[s]=_t(n[s]),a.el=l.el),e||Tr(l,a)),a.type===Vi&&(a.el=l.el)}}function Ca(t){const r=t.slice(),e=[0];let i,n,s,l,a;const o=t.length;for(i=0;i<o;i++){const c=t[i];if(c!==0){if(n=e[e.length-1],t[n]<c){r[i]=n,e.push(i);continue}for(s=0,l=e.length-1;s<l;)a=s+l>>1,t[e[a]]<c?s=a+1:l=a;c<t[e[s]]&&(s>0&&(r[i]=e[s-1]),e[s]=i)}}for(s=e.length,l=e[s-1];s-- >0;)e[s]=l,l=r[l];return e}const Ra=t=>t.__isTeleport,fe=Symbol.for("v-fgt"),Vi=Symbol.for("v-txt"),At=Symbol.for("v-cmt"),Ki=Symbol.for("v-stc"),ri=[];let $e=null;function D(t=!1){ri.push($e=t?null:[])}function Ha(){ri.pop(),$e=ri[ri.length-1]||null}let ui=1;function fs(t){ui+=t}function br(t){return t.dynamicChildren=ui>0?$e||jt:null,Ha(),ui>0&&$e&&$e.push(t),t}function O(t,r,e,i,n,s){return br(F(t,r,e,i,n,s,!0))}function Ie(t,r,e,i,n){return br(ie(t,r,e,i,n,!0))}function un(t){return t?t.__v_isVNode===!0:!1}function $t(t,r){return t.type===r.type&&t.key===r.key}const Ui="__vInternal",Er=({key:t})=>t??null,Pi=({ref:t,ref_key:r,ref_for:e})=>(typeof t=="number"&&(t=""+t),t!=null?Le(t)||ze(t)||ve(t)?{i:Ye,r:t,k:r,f:!!e}:t:null);function F(t,r=null,e=null,i=0,n=null,s=t===fe?0:1,l=!1,a=!1){const o={__v_isVNode:!0,__v_skip:!0,type:t,props:r,key:r&&Er(r),ref:r&&Pi(r),scopeId:or,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:i,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Ye};return a?(Bn(o,e),s&128&&t.normalize(o)):e&&(o.shapeFlag|=Le(e)?8:16),ui>0&&!l&&$e&&(o.patchFlag>0||s&6)&&o.patchFlag!==32&&$e.push(o),o}const ie=La;function La(t,r=null,e=null,i=0,n=null,s=!1){if((!t||t===ua)&&(t=At),un(t)){const a=Xt(t,r,!0);return e&&Bn(a,e),ui>0&&!s&&$e&&(a.shapeFlag&6?$e[$e.indexOf(t)]=a:$e.push(a)),a.patchFlag|=-2,a}if(Va(t)&&(t=t.__vccOpts),r){r=Da(r);let{class:a,style:o}=r;a&&!Le(a)&&(r.class=Ee(a)),Se(o)&&(Xs(o)&&!ce(o)&&(o=Fe({},o)),r.style=En(o))}const l=Le(t)?1:Ko(t)?128:Ra(t)?64:Se(t)?4:ve(t)?2:0;return F(t,r,e,i,n,l,s,!0)}function Da(t){return t?Xs(t)||Ui in t?Fe({},t):t:null}function Xt(t,r,e=!1){const{props:i,ref:n,patchFlag:s,children:l}=t,a=r?Ma(i||{},r):i;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&Er(a),ref:r&&r.ref?e&&n?ce(n)?n.concat(Pi(r)):[n,Pi(r)]:Pi(r):n,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:l,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:r&&t.type!==fe?s===-1?16:s|16:s,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Xt(t.ssContent),ssFallback:t.ssFallback&&Xt(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function Pe(t=" ",r=0){return ie(Vi,null,t,r)}function re(t="",r=!1){return r?(D(),Ie(At,null,t)):ie(At,null,t)}function ot(t){return t==null||typeof t=="boolean"?ie(At):ce(t)?ie(fe,null,t.slice()):typeof t=="object"?_t(t):ie(Vi,null,String(t))}function _t(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Xt(t)}function Bn(t,r){let e=0;const{shapeFlag:i}=t;if(r==null)r=null;else if(ce(r))e=16;else if(typeof r=="object")if(i&65){const n=r.default;n&&(n._c&&(n._d=!1),Bn(t,n()),n._c&&(n._d=!0));return}else{e=32;const n=r._;!n&&!(Ui in r)?r._ctx=Ye:n===3&&Ye&&(Ye.slots._===1?r._=1:(r._=2,t.patchFlag|=1024))}else ve(r)?(r={default:r,_ctx:Ye},e=32):(r=String(r),i&64?(e=16,r=[Pe(r)]):e=8);t.children=r,t.shapeFlag|=e}function Ma(...t){const r={};for(let e=0;e<t.length;e++){const i=t[e];for(const n in i)if(n==="class")r.class!==i.class&&(r.class=Ee([r.class,i.class]));else if(n==="style")r.style=En([r.style,i.style]);else if(Oi(n)){const s=r[n],l=i[n];l&&s!==l&&!(ce(s)&&s.includes(l))&&(r[n]=s?[].concat(s,l):l)}else n!==""&&(r[n]=i[n])}return r}function st(t,r,e,i=null){tt(t,r,7,[e,i])}const Oa=mr();let ka=0;function Fa(t,r,e){const i=t.type,n=(r?r.appContext:t.appContext)||Oa,s={uid:ka++,vnode:t,type:i,parent:r,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,scope:new $r(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(n.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:yr(i,n),emitsOptions:rr(i,n),emit:null,emitted:null,propsDefaults:be,inheritAttrs:i.inheritAttrs,ctx:be,data:be,props:be,attrs:be,slots:be,refs:be,setupState:be,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=r?r.root:s,s.emit=Uo.bind(null,s),t.ce&&t.ce(s),s}let Oe=null,In,Ut,ps="__VUE_INSTANCE_SETTERS__";(Ut=Qi()[ps])||(Ut=Qi()[ps]=[]),Ut.push(t=>Oe=t),In=t=>{Ut.length>1?Ut.forEach(r=>r(t)):Ut[0](t)};const Yt=t=>{In(t),t.scope.on()},kt=()=>{Oe&&Oe.scope.off(),In(null)};function Pr(t){return t.vnode.shapeFlag&4}let hi=!1;function Aa(t,r=!1){hi=r;const{props:e,children:i}=t.vnode,n=Pr(t);_a(t,e,n,r),ba(t,i);const s=n?Ba(t,r):void 0;return hi=!1,s}function Ba(t,r){const e=t.type;t.accessCache=Object.create(null),t.proxy=Ys(new Proxy(t.ctx,ha));const{setup:i}=e;if(i){const n=t.setupContext=i.length>1?za(t):null;Yt(t),Jt();const s=bt(i,t,0,[t.props,n]);if(Qt(),kt(),Os(s)){if(s.then(kt,kt),r)return s.then(l=>{gs(t,l,r)}).catch(l=>{Ii(l,t,0)});t.asyncDep=s}else gs(t,s,r)}else Sr(t,r)}function gs(t,r,e){ve(r)?t.type.__ssrInlineRender?t.ssrRender=r:t.render=r:Se(r)&&(t.setupState=$s(r)),Sr(t,e)}let ms;function Sr(t,r,e){const i=t.type;if(!t.render){if(!r&&ms&&!i.render){const n=i.template||Fn(t).template;if(n){const{isCustomElement:s,compilerOptions:l}=t.appContext.config,{delimiters:a,compilerOptions:o}=i,c=Fe(Fe({isCustomElement:s,delimiters:a},l),o);i.render=ms(n,c)}}t.render=i.render||et}Yt(t),Jt(),da(t),Qt(),kt()}function Ia(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(r,e){return qe(t,"get","$attrs"),r[e]}}))}function za(t){const r=e=>{t.exposed=e||{}};return{get attrs(){return Ia(t)},slots:t.slots,emit:t.emit,expose:r}}function Wi(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy($s(Ys(t.exposed)),{get(r,e){if(e in r)return r[e];if(e in si)return si[e](t)},has(r,e){return e in r||e in si}}))}function Na(t,r=!0){return ve(t)?t.displayName||t.name:t.name||r&&t.__name}function Va(t){return ve(t)&&"__vccOpts"in t}const ht=(t,r)=>Ao(t,r,hi);function Ua(t,r,e){const i=arguments.length;return i===2?Se(r)&&!ce(r)?un(r)?ie(t,null,[r]):ie(t,r):ie(t,null,r):(i>3?e=Array.prototype.slice.call(arguments,2):i===3&&un(e)&&(e=[e]),ie(t,r,e))}const Wa=Symbol.for("v-scx"),ja=()=>Ei(Wa),Ga="3.3.4",qa="http://www.w3.org/2000/svg",Lt=typeof document<"u"?document:null,vs=Lt&&Lt.createElement("template"),Za={insert:(t,r,e)=>{r.insertBefore(t,e||null)},remove:t=>{const r=t.parentNode;r&&r.removeChild(t)},createElement:(t,r,e,i)=>{const n=r?Lt.createElementNS(qa,t):Lt.createElement(t,e?{is:e}:void 0);return t==="select"&&i&&i.multiple!=null&&n.setAttribute("multiple",i.multiple),n},createText:t=>Lt.createTextNode(t),createComment:t=>Lt.createComment(t),setText:(t,r)=>{t.nodeValue=r},setElementText:(t,r)=>{t.textContent=r},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Lt.querySelector(t),setScopeId(t,r){t.setAttribute(r,"")},insertStaticContent(t,r,e,i,n,s){const l=e?e.previousSibling:r.lastChild;if(n&&(n===s||n.nextSibling))for(;r.insertBefore(n.cloneNode(!0),e),!(n===s||!(n=n.nextSibling)););else{vs.innerHTML=i?`<svg>${t}</svg>`:t;const a=vs.content;if(i){const o=a.firstChild;for(;o.firstChild;)a.appendChild(o.firstChild);a.removeChild(o)}r.insertBefore(a,e)}return[l?l.nextSibling:r.firstChild,e?e.previousSibling:r.lastChild]}};function Ka(t,r,e){const i=t._vtc;i&&(r=(r?[r,...i]:[...i]).join(" ")),r==null?t.removeAttribute("class"):e?t.setAttribute("class",r):t.className=r}function Xa(t,r,e){const i=t.style,n=Le(e);if(e&&!n){if(r&&!Le(r))for(const s in r)e[s]==null&&hn(i,s,"");for(const s in e)hn(i,s,e[s])}else{const s=i.display;n?r!==e&&(i.cssText=e):r&&t.removeAttribute("style"),"_vod"in t&&(i.display=s)}}const ys=/\s*!important$/;function hn(t,r,e){if(ce(e))e.forEach(i=>hn(t,r,i));else if(e==null&&(e=""),r.startsWith("--"))t.setProperty(r,e);else{const i=Ya(t,r);ys.test(e)?t.setProperty(Bt(i),e.replace(ys,""),"important"):t[i]=e}}const ws=["Webkit","Moz","ms"],Xi={};function Ya(t,r){const e=Xi[r];if(e)return e;let i=lt(r);if(i!=="filter"&&i in t)return Xi[r]=i;i=Ai(i);for(let n=0;n<ws.length;n++){const s=ws[n]+i;if(s in t)return Xi[r]=s}return r}const _s="http://www.w3.org/1999/xlink";function Ja(t,r,e,i,n){if(i&&r.startsWith("xlink:"))e==null?t.removeAttributeNS(_s,r.slice(6,r.length)):t.setAttributeNS(_s,r,e);else{const s=Qr(r);e==null||s&&!As(e)?t.removeAttribute(r):t.setAttribute(r,s?"":e)}}function Qa(t,r,e,i,n,s,l){if(r==="innerHTML"||r==="textContent"){i&&l(i,n,s),t[r]=e??"";return}const a=t.tagName;if(r==="value"&&a!=="PROGRESS"&&!a.includes("-")){t._value=e;const c=a==="OPTION"?t.getAttribute("value"):t.value,h=e??"";c!==h&&(t.value=h),e==null&&t.removeAttribute(r);return}let o=!1;if(e===""||e==null){const c=typeof t[r];c==="boolean"?e=As(e):e==null&&c==="string"?(e="",o=!0):c==="number"&&(e=0,o=!0)}try{t[r]=e}catch{}o&&t.removeAttribute(r)}function Wt(t,r,e,i){t.addEventListener(r,e,i)}function $a(t,r,e,i){t.removeEventListener(r,e,i)}function el(t,r,e,i,n=null){const s=t._vei||(t._vei={}),l=s[r];if(i&&l)l.value=i;else{const[a,o]=tl(r);if(i){const c=s[r]=sl(i,n);Wt(t,a,c,o)}else l&&($a(t,a,l,o),s[r]=void 0)}}const xs=/(?:Once|Passive|Capture)$/;function tl(t){let r;if(xs.test(t)){r={};let i;for(;i=t.match(xs);)t=t.slice(0,t.length-i[0].length),r[i[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Bt(t.slice(2)),r]}let Yi=0;const il=Promise.resolve(),nl=()=>Yi||(il.then(()=>Yi=0),Yi=Date.now());function sl(t,r){const e=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=e.attached)return;tt(rl(i,e.value),r,5,[i])};return e.value=t,e.attached=nl(),e}function rl(t,r){if(ce(r)){const e=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{e.call(t),t._stopped=!0},r.map(i=>n=>!n._stopped&&i&&i(n))}else return r}const Ts=/^on[a-z]/,ol=(t,r,e,i,n=!1,s,l,a,o)=>{r==="class"?Ka(t,i,n):r==="style"?Xa(t,e,i):Oi(r)?_n(r)||el(t,r,e,i,l):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):al(t,r,i,n))?Qa(t,r,i,s,l,a,o):(r==="true-value"?t._trueValue=i:r==="false-value"&&(t._falseValue=i),Ja(t,r,i,n))};function al(t,r,e,i){return i?!!(r==="innerHTML"||r==="textContent"||r in t&&Ts.test(r)&&ve(e)):r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&t.tagName==="INPUT"||r==="type"&&t.tagName==="TEXTAREA"||Ts.test(r)&&Le(e)?!1:r in t}const bs=t=>{const r=t.props["onUpdate:modelValue"]||!1;return ce(r)?e=>Ti(r,e):r};function ll(t){t.target.composing=!0}function Es(t){const r=t.target;r.composing&&(r.composing=!1,r.dispatchEvent(new Event("input")))}const Cr={created(t,{modifiers:{lazy:r,trim:e,number:i}},n){t._assign=bs(n);const s=i||n.props&&n.props.type==="number";Wt(t,r?"change":"input",l=>{if(l.target.composing)return;let a=t.value;e&&(a=a.trim()),s&&(a=Ji(a)),t._assign(a)}),e&&Wt(t,"change",()=>{t.value=t.value.trim()}),r||(Wt(t,"compositionstart",ll),Wt(t,"compositionend",Es),Wt(t,"change",Es))},mounted(t,{value:r}){t.value=r??""},beforeUpdate(t,{value:r,modifiers:{lazy:e,trim:i,number:n}},s){if(t._assign=bs(s),t.composing||document.activeElement===t&&t.type!=="range"&&(e||i&&t.value.trim()===r||(n||t.type==="number")&&Ji(t.value)===r))return;const l=r??"";t.value!==l&&(t.value=l)}},cl=["ctrl","shift","alt","meta"],ul={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,r)=>cl.some(e=>t[`${e}Key`]&&!r.includes(e))},Mt=(t,r)=>(e,...i)=>{for(let n=0;n<r.length;n++){const s=ul[r[n]];if(s&&s(e,r))return}return t(e,...i)},hl={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ni=(t,r)=>e=>{if(!("key"in e))return;const i=Bt(e.key);if(r.some(n=>n===i||hl[n]===i))return t(e)},rt={beforeMount(t,{value:r},{transition:e}){t._vod=t.style.display==="none"?"":t.style.display,e&&r?e.beforeEnter(t):ei(t,r)},mounted(t,{value:r},{transition:e}){e&&r&&e.enter(t)},updated(t,{value:r,oldValue:e},{transition:i}){!r!=!e&&(i?r?(i.beforeEnter(t),ei(t,!0),i.enter(t)):i.leave(t,()=>{ei(t,!1)}):ei(t,r))},beforeUnmount(t,{value:r}){ei(t,r)}};function ei(t,r){t.style.display=r?t._vod:"none"}const dl=Fe({patchProp:ol},Za);let Ps;function fl(){return Ps||(Ps=Pa(dl))}const pl=(...t)=>{const r=fl().createApp(...t),{mount:e}=r;return r.mount=i=>{const n=gl(i);if(!n)return;const s=r._component;!ve(s)&&!s.render&&!s.template&&(s.template=n.innerHTML),n.innerHTML="";const l=e(n,!1,n instanceof SVGElement);return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),l},r};function gl(t){return Le(t)?document.querySelector(t):t}var zn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Rr={exports:{}};(function(t,r){(function(e,i){t.exports=i()})(zn,function(){var e="__v-click-outside",i=typeof window<"u",n=typeof navigator<"u",s=i&&("ontouchstart"in window||n&&navigator.msMaxTouchPoints>0)?["touchstart"]:["click"],l=function(h){var g=h.event,m=h.handler;(0,h.middleware)(g)&&m(g)},a=function(h,g){var m=function(d){var _=typeof d=="function";if(!_&&typeof d!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:_?d:d.handler,middleware:d.middleware||function(S){return S},events:d.events||s,isActive:d.isActive!==!1,detectIframe:d.detectIframe!==!1,capture:!!d.capture}}(g.value),T=m.handler,b=m.middleware,P=m.detectIframe,C=m.capture;if(m.isActive){if(h[e]=m.events.map(function(d){return{event:d,srcTarget:document.documentElement,handler:function(_){return function(S){var M=S.el,I=S.event,V=S.handler,q=S.middleware,K=I.path||I.composedPath&&I.composedPath();(K?K.indexOf(M)<0:!M.contains(I.target))&&l({event:I,handler:V,middleware:q})}({el:h,event:_,handler:T,middleware:b})},capture:C}}),P){var k={event:"blur",srcTarget:window,handler:function(d){return function(_){var S=_.el,M=_.event,I=_.handler,V=_.middleware;setTimeout(function(){var q=document.activeElement;q&&q.tagName==="IFRAME"&&!S.contains(q)&&l({event:M,handler:I,middleware:V})},0)}({el:h,event:d,handler:T,middleware:b})},capture:C};h[e]=[].concat(h[e],[k])}h[e].forEach(function(d){var _=d.event,S=d.srcTarget,M=d.handler;return setTimeout(function(){h[e]&&S.addEventListener(_,M,C)},0)})}},o=function(h){(h[e]||[]).forEach(function(g){return g.srcTarget.removeEventListener(g.event,g.handler,g.capture)}),delete h[e]},c=i?{beforeMount:a,updated:function(h,g){var m=g.value,T=g.oldValue;JSON.stringify(m)!==JSON.stringify(T)&&(o(h),a(h,{value:m}))},unmounted:o}:{};return{install:function(h){h.directive("click-outside",c)},directive:c}})})(Rr);var ml=Rr.exports;const vl=Nn(ml),ue=(t,r)=>{const e=t.__vccOpts||t;for(const[i,n]of r)e[i]=n;return e},yl={},wl={class:"tify-icon",viewBox:"0 0 24 24"},_l=F("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},null,-1),xl=[_l];function Tl(t,r){return D(),O("svg",wl,xl)}const Hr=ue(yl,[["render",Tl]]),it=fi({messages:[],add(t){this.messages.push(t)},clear(){this.messages=[]}});let dn;const Ke=fi({collection:{},manifest:{},options:{},translation:{}}),{collection:Ae,manifest:me,options:U,translation:fn}=Ke,Ge=ht(()=>Ke.manifest.sequences?Ke.manifest.sequences[0].canvases:[]),ct=ht(()=>Ge.value.length);function pn(){const{startCanvas:t}=Ke.manifest.sequences[0],r=Ge.value.findIndex(e=>e["@id"]===t);return r>=0?r+1:1}function Lr(t){if(!Array.isArray(t)||new Set(t).size!==t.length)return!1;for(let r=0,e=t.length;r<e;r+=1)if(!Number.isInteger(t[r])||r>0&&t[r]>0&&t[r]<=t[r-1]||t[r]<0||t[r]>ct.value)return!1;return!0}function Ce(t){Object.assign(Ke.options,t),clearTimeout(dn),Ke.options.urlQueryKey&&(dn=setTimeout(()=>{const r={};Ke.options.urlQueryParams.forEach(i=>{const n=Ke.options[i];n===null||i==="pages"&&n.length<2&&n[0]<2||typeof n=="object"&&!Object.keys(n).length?delete r[i]:r[i]=Ke.options[i]});const e=new URL(window.location);e.searchParams.set(Ke.options.urlQueryKey,JSON.stringify(r)),window.history&&(t.pages?(it.clear(),window.history.pushState({},"",e)):window.history.replaceState({},"",e))},100))}function bl(t){Object.assign(Ke.collection,t)}function Ss(t){Object.assign(Ke.manifest,t)}function Cs(t){Object.assign(Ke.translation,t)}function It(){return U.root.$el.offsetWidth<U.breakpoints.medium}function Mi(t,r,e=120){const i=t,n=e===!0?120:e;if(!n||n<0){i.scrollTop=r;return}const l=(r-t.scrollTop)/n/.1;setTimeout(()=>{i.scrollTop+=l,i.scrollTop!==r&&Mi(i,r,n-10)},10)}function gn(t,r,e=!0){const i=r.querySelectorAll(t);if(!i.length)return;let n=i[0];const s=i[i.length-1];Array.prototype.forEach.call(i,c=>{c.dataset.level>n.dataset.level&&(n=c)});const l=r.getBoundingClientRect(),a=n.getBoundingClientRect(),o=s.getBoundingClientRect();if(a.top<l.top){const c=a.top-l.top+r.scrollTop;Mi(r,c-50,e)}else if(o.bottom>l.bottom){const c=o.bottom-l.bottom+r.scrollTop;Mi(r,c+50,e)}}const Xe=Lo(0);async function pi(...t){const[r,e]=t;if({}.TEST)return new Promise((s,l)=>{r==="/de.json"?s({}):l(new Error)});Xe.value+=1;const n=await(await fetch(r,e).catch(s=>(Xe.value=0,Promise.reject(s)))).json().catch(s=>(Xe.value=0,Promise.reject(s)));return Xe.value>0&&(Xe.value-=1),n}async function El(...t){const[r,e]=t;Xe.value+=1;const n=await(await fetch(r,e).catch(s=>(Xe.value=0,Promise.reject(s)))).text().catch(s=>(Xe.value=0,Promise.reject(s)));return Xe.value>0&&(Xe.value-=1),n}function mn(t){let r={};if(U.urlQueryKey)try{const e=new URLSearchParams(window.location.search);r=JSON.parse(e.get(U.urlQueryKey))||{}}catch{}r.view===""&&It()&&(r.view="scan"),r.pages&&!Lr(r.pages)&&(it.add("Invalid pages, reset to start page"),r.pages=null),U.childManifestUrl=r.childManifestUrl||U.childManifestUrl,U.filters=r.filters||U.filters,U.pages=t&&t.type==="popstate"?r.pages||[pn()]:r.pages||U.pages||[pn()],U.pan=r.panX||r.panY?{x:r.panX,y:r.panY}:r.pan||U.pan,U.rotation=parseInt(r.rotation,10)||U.rotation,U.view=r.view||r.view===""?r.view:U.view,U.zoom=parseFloat(r.zoom)||U.zoom}function Rs(t){let r,e;const i=new Promise((s,l)=>{r=s,e=l});if(t==="en")return U.language="en",Cs(null),r(t),i;U.translationsDirUrl===null&&e(new Error("Could not determine translationsDirUrl"));const n=`${U.translationsDirUrl}/${t}.json`;return pi(n).then(s=>{U.language=t,Cs(s),r(t)},s=>{const l=s.response?s.response.statusText:s.message;it.add(`Error loading translation for "${t}": ${l}`),e(new Error(s))}),i}function He(t,r){return fn[t]?fn[t]:r||t}const Pl={computed:{copyrightHtml(){return He("$copyright",'Copyright &copy; 2017&ndash;2022 <a href="https://www.uni-goettingen.de/en/">GÃ¶ttingen University</a>&nbsp;/ <a href="https://www.sub.uni-goettingen.de/en/">GÃ¶ttingen State and University Library</a>')},env(){return{version:"0.28.1",license:"AGPL-3.0",bugsUrl:"https://github.com/tify-iiif-viewer/tify/issues",contributorsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.28.1/CONTRIBUTORS.md",docsUrl:"https://github.com/tify-iiif-viewer/tify/blob/v0.28.1/doc",docsLanguages:["de","en"],repositoryUrl:"https://github.com/tify-iiif-viewer/tify"}},infoHtml(){return He("$info",'TIFY is a slim and mobile-friendly IIIF document viewer, released under the <a href="https://www.gnu.org/licenses/agpl-3.0.html.en">GNU Affero General Public License 3.0</a>.')},userGuideUrl(){const t=this.env.docsLanguages.includes(U.language)?U.language:"en";return`${this.env.docsUrl}/user-guide.${t}.md`}},methods:{translate:He}},Sl={class:"tify-help",tabindex:"0"},Cl={class:"tify-sr-only"},Rl=["innerHTML"],Hl=["href"],Ll=["href"],Dl=["href"],Ml=["href"],Ol={class:"tify-help-footer"},kl=["innerHTML"];function Fl(t,r,e,i,n,s){return D(),O("section",Sl,[F("h2",Cl,X(s.translate("Help")),1),F("h3",null,X(s.translate("About TIFY")),1),F("p",{innerHTML:s.infoHtml},null,8,Rl),F("ul",null,[F("li",null,[F("a",{href:s.userGuideUrl},X(s.translate("User guide")),9,Hl)]),F("li",null,[F("a",{href:s.env.repositoryUrl},X(s.translate("Source code")),9,Ll)]),F("li",null,[F("a",{href:s.env.contributorsUrl},X(s.translate("Contributors")),9,Dl)]),F("li",null,[F("a",{href:s.env.bugsUrl},X(s.translate("Report a bug")),9,Ml)])]),F("footer",Ol,[F("p",null,[Pe(X(s.translate("Version"))+" ",1),F("b",null,X(s.env.version),1),Pe(" Â· "),F("span",{innerHTML:s.copyrightHtml},null,8,kl)])])])}const Al=ue(Pl,[["render",Fl]]),Bl={},Il={class:"tify-icon",viewBox:"0 0 24 24"},zl=F("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},null,-1),Nl=[zl];function Vl(t,r){return D(),O("svg",Il,Nl)}const Dr=ue(Bl,[["render",Vl]]),Ul={},Wl={class:"tify-icon",viewBox:"0 0 24 24"},jl=F("path",{d:"M19,13H5V11H19V13Z"},null,-1),Gl=[jl];function ql(t,r){return D(),O("svg",Wl,Gl)}const Mr=ue(Ul,[["render",ql]]),Zl=`tify-${Math.floor(Math.random()*Date.now())}`;function zt(t){return Zl+(t?`-${t}`:"")}var Or={exports:{}};(function(t){(function(r){if(typeof e!="function"){var e=function(b){return b};e.nonNative=!0}const i=e("plaintext"),n=e("html"),s=e("comment"),l=/<(\w*)>/g,a=/<\/?([^\s\/>]+)/;function o(b,P,C){b=b||"",P=P||[],C=C||"";let k=h(P,C);return g(b,k)}function c(b,P){b=b||[],P=P||"";let C=h(b,P);return function(d){return g(d||"",C)}}o.init_streaming_mode=c;function h(b,P){return b=m(b),{allowable_tags:b,tag_replacement:P,state:i,tag_buffer:"",depth:0,in_quote_char:""}}function g(b,P){if(typeof b!="string")throw new TypeError("'html' parameter must be a string");let C=P.allowable_tags,k=P.tag_replacement,d=P.state,_=P.tag_buffer,S=P.depth,M=P.in_quote_char,I="";for(let V=0,q=b.length;V<q;V++){let K=b[V];if(d===i)switch(K){case"<":d=n,_+=K;break;default:I+=K;break}else if(d===n)switch(K){case"<":if(M)break;S++;break;case">":if(M)break;if(S){S--;break}M="",d=i,_+=">",C.has(T(_))?I+=_:I+=k,_="";break;case'"':case"'":K===M?M="":M=M||K,_+=K;break;case"-":_==="<!-"&&(d=s),_+=K;break;case" ":case`
`:if(_==="<"){d=i,I+="< ",_="";break}_+=K;break;default:_+=K;break}else if(d===s)switch(K){case">":_.slice(-2)=="--"&&(d=i),_="";break;default:_+=K;break}}return P.state=d,P.tag_buffer=_,P.depth=S,P.in_quote_char=M,I}function m(b){let P=new Set;if(typeof b=="string"){let C;for(;C=l.exec(b);)P.add(C[1])}else!e.nonNative&&typeof b[e.iterator]=="function"?P=new Set(b):typeof b.forEach=="function"&&b.forEach(P.add,P);return P}function T(b){let P=a.exec(b);return P?P[1].toLowerCase():null}t.exports?t.exports=o:r.striptags=o})(zn)})(Or);var Kl=Or.exports;const Xl=Nn(Kl);function xt(t){const r=["a","b","br","i","img","p","span"],e={a:["href"],img:["alt","src"]};let i=Xl(t,r);const n=/<(\w+)((\s+.+?(\s*=\s*(?:".*?"|'.*?'|.*?|[\^'">\s]+))?)+\s*|\s*)>/g;return i=i.replace(n,(s,l,a)=>{if(!a)return`<${l}>`;const o=/(?:([^\s]+)=(?:"(.*?)"|'(.*?)'))|([^\s]+)/g,c=[];return a.replace(o,(h,g)=>{h!==g&&e[l]&&e[l].indexOf(g)>-1&&c.push(h)}),c.length>0?`<${l} ${c.join(" ")}>`:`<${l}>`}),i}function ke(t){if(!U.language)throw new Error("language not set");if(!(t instanceof Array)){if(typeof t=="object"){if(t["@value"])return[xt(t["@value"])];if(t["@id"]){const n=xt(t["@id"]);return[{"@id":n,label:t.label?xt(t.label):n}]}return["(Invalid value)"]}return[xt(t)]}const r=[],e={};t.forEach(n=>{typeof n=="string"||n["@id"]&&n.label?r.push(n):n&&typeof n!="object"?r.push(xt(n)):n["@language"]&&n["@value"]&&(e.fallback||(e.fallback=n["@value"]),n["@language"].indexOf("en")===0?e.en=n["@value"]:U.language&&n["@language"]===U.language&&(e.preferred=n["@value"]))});const i=e.preferred||e.en||e.fallback||null;return i&&r.push(xt(i)),r}function di(t,r){return U.pageLabelFormat.replace("P",t).replace("L",r)}function Vn(t,r={}){let e,i;const n=new Promise((s,l)=>{e=s,i=l});return pi(t).then(async s=>{if(r.expectedType&&s["@type"]!==r.expectedType){const a=`Expected manifest of type ${r.expectedType}, but got ${s["@type"]}`;return it.add(a),i(a),n}if(Ss(null),await tr(),s["@type"]==="sc:Manifest")return Ss(s),mn(),window.addEventListener("popstate",mn),r.reset&&Ce({childManifestUrl:t,pages:[pn()],pan:{},rotation:null,view:It()?"scan":"collection",zoom:null}),e(),n;if(s["@type"]==="sc:Collection"){bl(s);const a=new URLSearchParams(window.location.search);let o={};try{o=JSON.parse(a.get(U.urlQueryKey))||{}}catch{}let c="";if(U.urlQueryParams.includes("childManifestUrl")&&o.childManifestUrl?c=o.childManifestUrl:Ae.manifests&&U.childManifestAutoloaded&&(c=Ae.manifests[0]["@id"]),c)await Vn(c,{expectedType:"sc:Manifest"}),Ce({childManifestUrl:c});else{const h=o.view||U.view;Ce({view:["collection","help","info"].includes(h)?h:"collection"})}return e(),n}const l="Please provide a valid IIIF Presentation API 2.x manifest";return it.add(l),i(l),n},s=>{const a=`Error loading IIIF manifest: ${s.response&&(s.response.statusText||s.response.data)||s.message}`;return it.add(a),i(a),n})}const Yl={name:"CollectionNode",props:{item:{type:Object,default:()=>{}}},data(){return{children:null,expanded:!1,id:zt(`collection-node-${Math.floor(Math.random()*1e12)}`),manifest:me}},computed:{label(){return this.item.label?ke(this.item.label).join(`${String.fromCharCode(160)}Â· `):""}},methods:{loadManifest:Vn,toggleChildren(){if(this.expanded){this.expanded=!1;return}if(this.children){this.expanded=!0;return}if(this.item.children){this.children=this.item.children,this.expanded=!0;return}pi(this.item["@id"]).then(t=>{this.children=t.manifests||t.collections||[],this.expanded=!0},t=>{const r=t.response&&(t.response.statusText||t.response.data)||t.message;it.add(`Error loading IIIF manifest: ${r}`),this.children=!1})},translate:He}},Jl=["aria-controls","aria-expanded"],Ql={class:"tify-sr-only"},$l={class:"tify-sr-only"},ec=["id"],tc={key:1,class:"tify-collection-error"};function ic(t,r,e,i,n,s){const l=Mr,a=Dr,o=fr("collection-node",!0);return D(),O("li",{class:Ee(["tify-collection-item",{"-current":n.manifest["@id"]===e.item["@id"]}])},[e.item["@type"]==="sc:Collection"?(D(),O("button",{key:0,type:"button","aria-controls":n.id,"aria-expanded":n.expanded?"true":"false",class:"tify-collection-link -has-children",onClick:r[0]||(r[0]=c=>s.toggleChildren())},[n.expanded?(D(),O(fe,{key:0},[ie(l),F("span",Ql,X(s.translate("Collapse")),1)],64)):(D(),O(fe,{key:1},[ie(a),F("span",$l,X(s.translate("Expand")),1)],64)),Pe(" "+X(s.label),1)],8,Jl)):(D(),O("a",{key:1,href:"javascript:;",class:"tify-collection-link",onClick:r[1]||(r[1]=c=>s.loadManifest(e.item["@id"],{expectedType:e.item["@type"],reset:!0},this))},X(s.label),1)),n.expanded?(D(),O(fe,{key:2},[n.expanded?(D(),O("ol",{key:0,id:n.id,class:"tify-collection-list"},[(D(!0),O(fe,null,Re(n.children,c=>(D(),Ie(o,{key:c["@id"],item:c},null,8,["item"]))),128))],8,ec)):n.children===!1?(D(),O("p",tc,X(s.translate("Could not load child manifest")),1)):re("",!0)],64)):re("",!0)],2)}const nc=ue(Yl,[["render",ic]]),sc={data(){return{filter:""}},computed:{filteredItems(){const t=this.filter.trim().toLowerCase().split(/\s+/);return this.items.filter(r=>{const e=r.label.toLowerCase();return t.every(i=>e.includes(i))})},items(){return Ae.manifests&&Ae.collections?[{"@id":"tify-collection-manifests","@type":"sc:Collection",label:He("Documents"),children:Ae.manifests},{"@id":"tify-collection-collections","@type":"sc:Collection",label:He("Collections"),children:Ae.collections}]:Ae.manifests||Ae.collections}},methods:{translate:He}},rc={class:"tify-collection",tabindex:"0"},oc={class:"tify-sr-only"},ac={key:0,class:"tify-collection-controls"},lc=["aria-label","placeholder"],cc=["disabled"],uc={key:1,class:"tify-collection-list"},hc={key:2,class:"tify-collection-no-results"};function dc(t,r,e,i,n,s){const l=nc;return D(),O("section",rc,[F("h2",oc,X(s.translate("Collection")),1),s.items.length>5?(D(),O("p",ac,[Ve(F("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>n.filter=a),"aria-label":s.translate("Filter collection"),class:"tify-collection-filter",placeholder:s.translate("Filter collection"),type:"text",onKeydown:[r[1]||(r[1]=ni(Mt(a=>n.filter?n.filter="":a.target.blur(),["prevent"]),["esc"])),r[2]||(r[2]=Mt(()=>{},["stop"]))]},null,40,lc),[[Cr,n.filter]]),F("button",{type:"button",class:"tify-collection-reset",disabled:!n.filter,onClick:r[3]||(r[3]=a=>n.filter="")},X(s.translate("Reset")),9,cc)])):re("",!0),s.filteredItems.length?(D(),O("ol",uc,[(D(!0),O(fe,null,Re(s.filteredItems,a=>(D(),Ie(l,{key:a["@id"],item:a},null,8,["item"]))),128))])):(D(),O("p",hc,X(s.translate("No results")),1))])}const fc=ue(sc,[["render",dc]]),pc={},gc={class:"tify-icon",viewBox:"0 0 24 24"},mc=F("path",{d:"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"},null,-1),vc=[mc];function yc(t,r){return D(),O("svg",gc,vc)}const wc=ue(pc,[["render",yc]]),_c={},xc={class:"tify-icon",viewBox:"0 0 24 24"},Tc=F("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},null,-1),bc=[Tc];function Ec(t,r){return D(),O("svg",xc,bc)}const Pc=ue(_c,[["render",Ec]]);function Un(t,r=["https:","http:"]){let e;try{e=new URL(t)}catch{return!1}return r.includes(e.protocol)}const Sc={props:{metadata:{type:Array,default:()=>[]}},data(){return{infoItems:[]}},watch:{metadata(){this.updateInfoItems()}},mounted(){this.updateInfoItems()},methods:{cleanLabel(t){const r=t.replace("_"," ");return r.charAt(0).toUpperCase()+r.substr(1)},convertValueToArray:ke,updateInfoItems(){this.$nextTick(()=>{this.$refs.contents&&this.$refs.contents.forEach((t,r)=>{const e=t.offsetHeight;this.infoItems[r]={collapsed:!0,exceedsHeight:!0},this.$nextTick(()=>{const i=t.offsetHeight,n=e>=i;this.infoItems[r]={collapsed:n,exceedsHeight:n}})})})},isValidUrl:Un,translate:He}},Cc={class:"tify-info-metadata"},Rc={class:"tify-info-value"},Hc=["href"],Lc=["innerHTML"],Dc=["onClick"];function Mc(t,r,e,i,n,s){const l=Pc,a=wc;return D(),O("div",Cc,[(D(!0),O(fe,null,Re(e.metadata,(o,c)=>(D(),O("div",{key:c},[F("h4",null,[(D(!0),O(fe,null,Re(s.convertValueToArray(o.label),(h,g)=>(D(),O("div",{key:g},X(s.cleanLabel(h)),1))),128))]),F("div",{ref_for:!0,ref:"contents",class:Ee(["tify-info-content",{"-collapsed":n.infoItems[c]&&n.infoItems[c].collapsed}])},[F("div",Rc,[(D(!0),O(fe,null,Re(s.convertValueToArray(o.value),h=>(D(),O(fe,null,[s.isValidUrl(h)?(D(),O("div",{key:"url-"+h},[F("a",{href:h},X(h),9,Hc)])):(D(),O("div",{key:"html-"+h,innerHTML:h},null,8,Lc))],64))),256))]),n.infoItems[c]&&n.infoItems[c].exceedsHeight?(D(),O("button",{key:0,type:"button",class:"tify-info-toggle",onClick:h=>n.infoItems[c].collapsed=!n.infoItems[c].collapsed},[n.infoItems[c].collapsed?(D(),O(fe,{key:0},[ie(l),Pe(" "+X(s.translate("Expand")),1)],64)):(D(),O(fe,{key:1},[ie(a),Pe(" "+X(s.translate("Collapse")),1)],64))],8,Dc)):re("",!0)],2)]))),128))])}const Oc=ue(Sc,[["render",Mc]]),Wn=ht(()=>{if(!me||!Array.isArray(me.structures))return!1;const t=[];U.pages.forEach(n=>{n&&t.push(me.sequences[0].canvases[n-1]["@id"])});const{length:r}=me.structures;let e,i;for(let n=0;n<r;n+=1){const s=me.structures[n],{canvases:l}=s;if(l&&l.some(a=>t.indexOf(a)>-1)&&s.firstPage&&s.lastPage){const a=s.lastPage-s.firstPage;if((a<i||!i)&&(e=n,i=a,i===0))break}}return typeof e=="number"&&e>=0?me.structures[e]:!1}),kc=ht(()=>{const{label:t}=Wn.value;return t}),Fc=ht(()=>{const{metadata:t}=Wn.value;return t}),Si=ht(()=>{if(!me.structures)return[];const t=[],r=[],{canvases:e}=me.sequences[0],{length:i}=me.structures;for(let l=0;l<i;l+=1){const a=me.structures[l];if(a.viewingHint!=="top"){if(a.label?a.label=ke(a.label)[0].trim():a.label="â",a.canvases){const o=a.canvases[0];a.firstPage=e.findIndex(g=>g["@id"]===o)+1;const c=a.canvases[a.canvases.length-1];a.lastPage=e.findIndex(g=>g["@id"]===c)+1;const h=e[a.firstPage-1];if(!h)continue;a.pageLabel=h.label}else e[0]&&(a.firstPage=1,a.lastPage=ct.value,a.pageLabel=e[0].label);a.pageCount=a.lastPage-a.firstPage+1,a.within&&r.push(a),t.push(a)}}const n=r.length;for(let l=0;l<i;l+=1){const a=[];for(let o=0;o<n;o+=1){const c=r[o];c.within===t[l]["@id"]&&a.push(c)}a.length&&(t[l].childStructures=a.sort((o,c)=>o.firstPage-c.firstPage))}return t.filter(l=>!l.within).sort((l,a)=>l.firstPage-a.firstPage)}),Ac={data(){return{currentStructure:Wn,currentStructureLabel:kc,currentStructureMetadata:Fc,collectionDataShown:!1,options:U}},computed:{collection(){return Ae},license(){return me.license?ke(this.manifest.license):[]},logoId(){return me.logo["@id"]||me.logo},manifest(){return this.collectionDataShown?Ae:me||Ae},related(){return me.related?ke(me.related):[]}},methods:{convertValueToArray:ke,isValidUrl:Un,translate:He}},Bc={class:"tify-info",tabindex:"0"},Ic={class:"tify-sr-only"},zc={key:0,class:"tify-info-header"},Nc={key:1,class:"tify-info-section -title"},Vc={class:"tify-info-heading"},Uc={key:2,class:"tify-info-section -metadata"},Wc={key:3,class:"tify-info-section -metadata -structure"},jc={key:0,class:"tify-info-structure"},Gc={key:4,class:"tify-info-section -description"},qc=["innerHTML"],Zc={key:5,class:"tify-info-section -license"},Kc=["href"],Xc=["href"],Yc={key:6,class:"tify-info-section -related"},Jc=["href"],Qc=["href"],$c={key:7,class:"tify-info-section -attribution"},eu=["innerHTML"],tu={key:8,class:"tify-info-section -logo"},iu=["href"],nu=["src","alt"],su=["src","alt"];function ru(t,r,e,i,n,s){const l=Oc;return D(),O("section",Bc,[F("h2",Ic,X(s.translate("Info")),1),s.collection["@id"]&&s.manifest["@id"]?(D(),O("div",zc,[F("button",{type:"button",class:Ee(["tify-info-button",{"-active":!n.collectionDataShown}]),onClick:r[0]||(r[0]=a=>n.collectionDataShown=!1)},X(s.translate("Document")),3),F("button",{type:"button",class:Ee(["tify-info-button",{"-active":n.collectionDataShown}]),onClick:r[1]||(r[1]=a=>n.collectionDataShown=!0)},X(s.translate("Collection")),3)])):re("",!0),s.manifest.label?(D(),O("div",Nc,[F("h3",Vc,X(s.translate("Title")),1),(D(!0),O(fe,null,Re(s.convertValueToArray(s.manifest.label),a=>(D(),O("div",{key:a},X(a),1))),128))])):re("",!0),s.manifest.metadata&&s.manifest.metadata.length?(D(),O("div",Uc,[F("h3",null,X(s.translate("Metadata")),1),n.options.view==="info"?(D(),Ie(l,{key:0,metadata:s.manifest.metadata},null,8,["metadata"])):re("",!0)])):re("",!0),s.manifest.structures&&(n.currentStructureLabel||n.currentStructureMetadata)?(D(),O("div",Wc,[F("h3",null,X(s.translate("Current Element")),1),n.currentStructureLabel?(D(),O("p",jc,X(n.currentStructureLabel),1)):re("",!0),n.options.view==="info"&&n.currentStructureMetadata?(D(),Ie(l,{key:1,class:"tify-info-section -metadata",metadata:n.currentStructureMetadata},null,8,["metadata"])):re("",!0)])):re("",!0),s.manifest.description?(D(),O("div",Gc,[F("h3",null,X(s.translate("Description")),1),(D(!0),O(fe,null,Re(s.convertValueToArray(s.manifest.description),(a,o)=>(D(),O("div",{key:o,innerHTML:a},null,8,qc))),128))])):re("",!0),s.license.length?(D(),O("div",Zc,[F("h3",null,X(s.translate("License")),1),(D(!0),O(fe,null,Re(s.license,(a,o)=>(D(),O("div",{key:o},[typeof a=="string"?(D(),O(fe,{key:0},[s.isValidUrl(a)?(D(),O("a",{key:0,href:a},X(a),9,Kc)):(D(),O(fe,{key:1},[Pe(X(a),1)],64))],64)):(D(),O(fe,{key:1},[s.isValidUrl(a["@id"])?(D(),O("a",{key:0,href:a["@id"]},X(a.label||a["@id"]),9,Xc)):(D(),O(fe,{key:1},[Pe(X(a.label||a["@id"]),1)],64))],64))]))),128))])):re("",!0),s.related.length?(D(),O("div",Yc,[F("h3",null,X(s.translate("Related Resources")),1),(D(!0),O(fe,null,Re(s.related,(a,o)=>(D(),O("div",{key:o},[typeof a=="string"?(D(),O("a",{key:0,href:a},X(a),9,Jc)):(D(),O("a",{key:1,href:a["@id"]},X(a.label||a["@id"]),9,Qc))]))),128))])):re("",!0),s.manifest.attribution?(D(),O("div",$c,[F("h3",null,X(s.translate("Provided by")),1),(D(!0),O(fe,null,Re(s.convertValueToArray(s.manifest.attribution),(a,o)=>(D(),O("div",{key:o,innerHTML:a},null,8,eu))),128))])):re("",!0),s.manifest.logo?(D(),O("div",tu,[s.logoId&&s.manifest.logo.service&&s.manifest.logo.service["@id"]?(D(),O("a",{key:0,href:s.manifest.logo.service["@id"]},[F("img",{class:"tify-info-logo",src:s.logoId,alt:s.translate("Logo")},null,8,nu)],8,iu)):(D(),O("img",{key:1,class:"tify-info-logo",src:s.logoId,alt:s.translate("Logo")},null,8,su))])):re("",!0)])}const ou=ue(Ac,[["render",ru]]),kr=ht(()=>{if(!U.pages)return!1;const{pages:t}=U;return t.length>2||t.length===2&&(t[0]%2>0||t[1]!==t[0]+1)&&t[1]>0});function ut(t){let r=t;if(Array.isArray(t)||(r=[t]),!Lr(r))throw new RangeError("Invalid pages");if(r.length===1&&U.pages&&U.pages[0]%2<1&&(U.pages[1]===U.pages[0]+1||U.pages[1]===0)){const e=r[0]%2>0?r[0]-1:r[0];r=[e,e===ct.value?0:e+1]}return Ce({pages:r}),r}const Fr=ht(()=>U.pages[0]<2),Ar=ht(()=>{const{pages:t}=U;return t[0]>=ct.value||t[t.length-1]>=ct.value});function Hs(){ut(1)}function vn(){const{pages:t}=U;let r=t[0]+1;t.length>1&&r%2>0&&r<ct.value&&(r+=1),ut(r)}function Ls(){ut(ct.value)}function yn(){const{pages:t}=U;let r=t[0]-1;t.length>1&&r%2>0&&r>0&&(r-=1),ut(r)}const au={name:"TocList",props:{level:{type:Number,default:0},structures:{type:Array,default:()=>[]},parentStructure:{type:Object,default:()=>{}},purpose:{type:String,default:""}},data(){return{expandedStructures:[],id:zt(`toc-list-${Math.floor(Math.random()*1e12)}`)}},methods:{checkIfPagesInStructure(t){const{pages:r}=U;return r.some(e=>e>=t.firstPage&&e<=t.lastPage)},convertValueToArray:ke,setPage(t){ut(t),It()&&Ce({view:"scan"})},toggleAllChildren(t=null){if(this.$refs.children){for(let r=this.structures.length-1;r>=0;r-=1)this.toggleChildren(r,t);this.$refs.children.forEach(r=>{r.toggleAllChildren(t)})}},toggleChildren(t,r=null){this.structures[t].childStructures&&(this.expandedStructures[t]=r!==null?r:!this.expandedStructures[t])},translate:He}},lu={class:"tify-toc-list"},cu=["data-level"],uu=["title","aria-controls","aria-expanded","onClick"],hu=["href"],du=["onClick"],fu={class:"tify-toc-label"},pu={class:"tify-toc-page"};function gu(t,r,e,i,n,s){const l=Mr,a=Dr,o=fr("toc-list",!0);return D(),O("ul",lu,[(D(!0),O(fe,null,Re(e.structures,(c,h)=>(D(),O("li",{key:h,class:Ee(["tify-toc-structure",{"-current":s.checkIfPagesInStructure(c),"-expanded":n.expandedStructures[h]}]),"data-level":e.level},[c.childStructures?(D(),O("button",{key:0,type:"button",class:"tify-toc-toggle",title:s.translate(n.expandedStructures[h]?"Collapse":"Expand"),"aria-controls":`${n.id}-${h}`,"aria-expanded":n.expandedStructures[h]?"true":"false",onClick:g=>s.toggleChildren(h)},[n.expandedStructures[h]?(D(),Ie(l,{key:0})):(D(),Ie(a,{key:1}))],8,uu)):re("",!0),e.purpose==="pdf"?(D(),O("a",{key:1,class:"tify-toc-link",download:"",href:s.convertValueToArray(c.rendering)[0]["@id"]},X(c.label)+" ("+X(c.pageCount)+"Â "+X(s.translate(c.pageCount===1?"page":"pages"))+") ",9,hu)):(D(),O("a",{key:2,class:"tify-toc-link -dots",href:"javascript:;",onClick:g=>s.setPage(c.firstPage)},[F("span",fu,X(c.label),1),F("span",pu,X(c.pageLabel),1)],8,du)),c.childStructures?Ve((D(),Ie(o,{key:3,id:`${n.id}-${h}`,ref_for:!0,ref:"children",level:e.level+1,"parent-structure":c,purpose:e.purpose,structures:c.childStructures},null,8,["id","level","parent-structure","purpose","structures"])),[[rt,n.expandedStructures[h]]]):re("",!0)],10,cu))),128))])}const Br=ue(au,[["render",gu]]),mu=[{label:"BibTex",profile:"http://www.bibtex.org/Format/",type:"literature"},{label:"EndNote",profile:"http://endnote.com/",type:"literature"},{label:"RIS",profile:"http://referencemanager.com/sites/rm/files/m/direct_export_ris.pdf",type:"literature"},{label:"METS",profile:"http://www.loc.gov/standards/mets/profile_docs/mets.profile.v2-0.xsd",type:"other"},{label:"MODS",format:"application/mods+xml",type:"other"}],vu={data(){return{collection:Ae,literatureItems:[],manifest:me,options:U,otherItems:[],perElementPdfLinksVisible:!1,structures:Si}},computed:{canvases(){return Ge.value},pages(){return U.pages.filter(t=>t>0)},hasElementPdfLinks(){return!Array.isArray(me.structures)||!me.structures[0]||!me.structures[0].rendering?!1:ke(me.structures[0].rendering).some(r=>r.format&&r.format==="application/pdf")},imageUrls(){const t={};return U.pages.forEach(r=>{if(!r)return;const{resource:e}=this.canvases[r-1].images[0];if(e.service){const i=e.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",n=e.service["@id"];t[r]=`${n}${n.slice(-1)==="/"?"":"/"}full/full/0/${i}.jpg`}else t[r]=e["@id"]}),t},renderings(){return ke(me.rendering)}},created(){const{seeAlso:t}=me;if(!t)return;JSON.parse(JSON.stringify(Array.isArray(t)?t:[t])).forEach(e=>{const i=typeof e=="object"?e:{"@id":e};let n=!1;mu.some(s=>{const l=e.format&&s.format===e.format,a=e.profile&&s.profile===e.profile;return l||a?(i.label=s.label,s.type==="literature"&&(n=!0),!0):!1}),n?this.literatureItems.push(i):this.otherItems.push(i)})},methods:{convertValueToArray:ke,getId:zt,getPageLabel:di,translate:He}},yu={class:"tify-export",tabindex:"0"},wu={class:"tify-sr-only"},_u={class:"tify-export-section -links"},xu=["href","download"],Tu={key:0,class:"tify-export-section -renderings"},bu=["href"],Eu={key:0,class:"tify-export-container"},Pu=["aria-controls","aria-expanded"],Su={class:"tify-sr-only"},Cu=["id"],Ru={key:1,class:"tify-export-section -literature"},Hu=["href"],Lu={class:"tify-export-section -other"},Du={key:0},Mu=["href"],Ou=["href"],ku=["href"];function Fu(t,r,e,i,n,s){const l=Hr,a=Br;return D(),O("section",yu,[F("h2",wu,X(s.translate("Export")),1),F("div",_u,[F("h3",null,X(s.translate("Download Individual Images")),1),F("ul",null,[(D(!0),O(fe,null,Re(s.pages,o=>(D(),O("li",{key:o},[F("a",{href:s.imageUrls[o],download:`${o}.jpg`},X(s.translate("Page"))+" "+X(s.getPageLabel(o,s.convertValueToArray(s.canvases[o-1].label)[0])),9,xu)]))),128))])]),n.manifest.rendering?(D(),O("div",Tu,[F("h3",null,X(s.translate("Renderings")),1),F("ul",null,[(D(!0),O(fe,null,Re(s.renderings,o=>(D(),O("li",{key:o["@id"]},[F("a",{href:o["@id"]},X(o.label),9,bu)]))),128))]),s.hasElementPdfLinks?(D(),O("div",Eu,[F("button",{type:"button",class:Ee(["tify-export-toggle",{"-close":n.perElementPdfLinksVisible}]),"aria-controls":s.getId("export-pdf-list"),"aria-expanded":n.perElementPdfLinksVisible?"true":"false",onClick:r[0]||(r[0]=o=>n.perElementPdfLinksVisible=!n.perElementPdfLinksVisible)},[n.perElementPdfLinksVisible?(D(),O(fe,{key:1},[ie(l),F("span",Su,X(s.translate("Close PDF list")),1)],64)):(D(),O(fe,{key:0},[Pe(X(s.translate("PDFs for each element")),1)],64))],10,Pu),n.perElementPdfLinksVisible?(D(),O("div",{key:0,id:s.getId("export-pdf-list"),class:"tify-export-toc"},[F("h4",null,X(s.translate("PDFs for each element")),1),ie(a,{ref:"children",purpose:"pdf",level:0,structures:n.structures},null,8,["structures"])],8,Cu)):re("",!0)])):re("",!0)])):re("",!0),n.literatureItems.length?(D(),O("div",Ru,[F("h3",null,X(s.translate("Literature Management")),1),F("ul",null,[(D(!0),O(fe,null,Re(n.literatureItems,o=>(D(),O("li",{key:o["@id"]},[F("a",{href:o["@id"],download:""},X(o.label),9,Hu)]))),128))])])):re("",!0),F("div",Lu,[F("h3",null,X(s.translate("Other Formats")),1),F("ul",null,[n.options.childManifestUrl?(D(),O("li",Du,[F("a",{href:n.options.childManifestUrl,download:"manifest.json"},X(s.translate("IIIF manifest (current document)")),9,Mu)])):re("",!0),F("li",null,[F("a",{href:n.options.manifestUrl,download:"manifest.json"},X(s.translate(n.collection?"IIIF manifest (collection)":"IIIF manifest")),9,Ou)]),(D(!0),O(fe,null,Re(n.otherItems,o=>(D(),O("li",{key:o["@id"]},[F("a",{href:o["@id"],download:""},X(o.label||o["@id"]),9,ku)]))),128))])])])}const Au=ue(vu,[["render",Fu]]),Ds=".tify-toc-structure.-current",Bu={data(){return{isInited:!1,options:U,structures:Si}},computed:{hasChildStructures(){return Si.value&&Si.value.some(t=>t.childStructures)}},watch:{"options.pages":function(){this.$nextTick(()=>gn(Ds,this.$el))},"options.view":{handler(t){t==="toc"&&this.$nextTick(this.init)},immediate:!0}},methods:{init(){this.isInited=!0,this.$nextTick(()=>gn(Ds,this.$el,!1))},translate:He}},Iu={class:"tify-toc",tabindex:"0"},zu={class:"tify-sr-only"},Nu={key:0,class:"tify-toc-header"};function Vu(t,r,e,i,n,s){const l=Br;return D(),O("section",Iu,[F("h2",zu,X(s.translate("Table of Contents")),1),s.hasChildStructures?(D(),O("div",Nu,[F("button",{type:"button",class:"tify-toc-toggle-all",onClick:r[0]||(r[0]=a=>t.$refs.children.toggleAllChildren(!0))},X(s.translate("Expand all")),1),F("button",{type:"button",class:"tify-toc-toggle-all",onClick:r[1]||(r[1]=a=>t.$refs.children.toggleAllChildren(!1))},X(s.translate("Collapse all")),1)])):re("",!0),n.isInited?(D(),Ie(l,{key:1,ref:"children",level:0,structures:n.structures},null,8,["structures"])):re("",!0)])}const Uu=ue(Bu,[["render",Vu]]),Wu=750,ju={data(){return{itemHeight:0,itemVMargin:0,items:[{label:""}],itemsPerRow:0,knownImages:[],lastScrollTop:0,options:U,resizeTimeout:null,style:{},thumbnailWidth:0,touchTimeout:null}},watch:{"options.pages":function(t){this.$nextTick(()=>{const r=".tify-thumbnails-item.-current";t.length>2||t.length>1&&t[1]!==t[0]+1||(this.$refs.container.querySelector(r)?gn(r,this.$el):this.scrollToCurrentPage())})},"options.view":{handler(t){t==="thumbnails"&&this.$nextTick(this.init)},immediate:!0}},mounted(){this.style.flex=this.$el.style.flex},methods:{getPageLabel:di,init(){this.updateDimensions(),this.scrollToCurrentPage(!1),new ResizeObserver(this.onResize).observe(this.$el)},onResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{U.view==="thumbnails"&&this.updateDimensions()},200)},updateDimensions(){const t=this.$refs.container.querySelector(".tify-thumbnails-item"),r=t.currentStyle||window.getComputedStyle(t),e=parseInt(r.marginTop,10)+parseFloat(r.marginBottom,10);this.itemHeight=t.offsetHeight+e,this.itemVerticalMargin=e;const i=parseInt(r.marginLeft,10)+parseFloat(r.marginRight,10),n=t.offsetWidth+i;this.thumbnailWidth=t.offsetWidth,this.itemsPerRow=Math.floor(this.$refs.container.clientWidth/n);const l=Math.ceil(Ge.value.length/this.itemsPerRow)*this.itemHeight;this.$refs.container.style.height=`${l}px`,this.redrawThumbnails(),this.scrollToCurrentPage(!1)},redrawThumbnails(){const t=this.$el.scrollTop,r=Math.floor(t/this.itemHeight)*this.itemsPerRow+1,i=Math.ceil(this.$el.offsetHeight/this.itemHeight)*this.itemsPerRow,n=r+this.itemsPerRow+i,s=Math.min(Ge.value.length,n),l=[];for(let a=r-1;a<s;a+=1){const{resource:o}=Ge.value[a].images[0];if(o.service){const c=o.service["@context"]==="http://iiif.io/api/image/2/context.json"?"default":"native",h=o.service["@id"];l.push({label:ke(Ge.value[a].label)[0],imgUrl:`${h}${h.slice(-1)==="/"?"":"/"}full/${this.thumbnailWidth},/0/${c}.jpg`,page:a+1})}else l.push({label:ke(Ge.value[a].label)[0],imgUrl:o["@id"],page:a+1})}this.items=l,this.$nextTick(()=>{const a=Math.floor(r/this.itemsPerRow);this.$refs.container.style.paddingTop=`${a*this.itemHeight}px`})},scrollToCurrentPage(t=!0){const e=Math.floor((U.pages[0]-1)/this.itemsPerRow)*this.itemHeight+(this.itemVMargin-50);t?Mi(this.$el,e):this.$el.scrollTop=e},setPageAndSwitchView(t,r=!1){if(r){const e=U.pages.slice(0),i=e.indexOf(t);i<0?(e.push(t),e.sort((n,s)=>n-s),e[0]===0&&e.shift()):e.length>1&&e.splice(i,1),Ce({pages:e});return}ut(t),It()&&Ce({view:"scan"})},touchStartTogglePage(t){this.lastScrollTop=this.$el.scrollTop,this.touchTimeout=setTimeout(()=>{this.$el.scrollTop===this.lastScrollTop&&this.setPageAndSwitchView(t,!0)},Wu)},touchEnd(){clearTimeout(this.touchTimeout)},translate:He}},Gu={class:"tify-sr-only"},qu={ref:"container",class:"tify-thumbnails-list"},Zu=["onClick","onTouchstart"],Ku=["src"],Xu={class:"tify-thumbnails-page"};function Yu(t,r,e,i,n,s){return D(),O("section",{class:"tify-thumbnails",tabindex:"0",onScroll:r[1]||(r[1]=(...l)=>s.redrawThumbnails&&s.redrawThumbnails(...l))},[F("h2",Gu,X(s.translate("Pages")),1),F("div",qu,[(D(!0),O(fe,null,Re(n.items,l=>(D(),O("a",{key:l.page,class:Ee(["tify-thumbnails-item",{"-current":n.options.pages.indexOf(l.page)>-1}]),href:"javascript:;",onClick:Mt(a=>s.setPageAndSwitchView(l.page,a.ctrlKey),["prevent"]),onTouchstart:a=>s.touchStartTogglePage(l.page),onTouchend:r[0]||(r[0]=(...a)=>s.touchEnd&&s.touchEnd(...a))},[F("img",{alt:"",src:l.imgUrl},null,8,Ku),F("span",Xu,X(s.getPageLabel(l.page,l.label)),1)],42,Zu))),128))],512)],32)}const Ju=ue(ju,[["render",Yu]]),Qu={data(){return{canvases:Ge,fulltextAvailable:!1,fulltexts:[],options:U}},computed:{pages(){return U.pages.filter(t=>!!t)}},watch:{"options.pages":function(){this.loadFulltexts()}},mounted(){this.loadFulltexts()},methods:{getPageLabel:di,loadFulltexts(){this.fulltextAvailable=!1,this.fulltexts=[],U.pages.forEach(t=>{if(t<1||this.fulltexts[t])return;const r=me.sequences[0].canvases[t-1];if(!("otherContent"in r))return;const e=r.otherContent[0]["@id"];pi(e).then(i=>{const{resources:n}=i;Array.isArray(n)&&n.forEach((s,l)=>{const a=s.resource;if(a)if(this.fulltexts[t]||(this.fulltexts[t]=[]),a&&a.chars){const o=xt(a.chars);o&&(this.fulltextAvailable=!0),this.fulltexts[t][l]=o}else a["@id"]&&this.loadRemoteFulltext(t,l,a["@id"])})},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load annotations: ${n}`)})})},loadRemoteFulltext(t,r,e){Un(e)&&El(e).then(i=>{const n=xt(i);n&&(this.fulltextAvailable=!0),this.fulltexts[t]||(this.fulltexts[t]=[]),this.fulltexts[t][r]=n},i=>{const n=i.response?i.response.statusText:i.message;console.warn(`Could not load fulltext: ${n}`)})},translate:He}},$u={class:"tify-fulltext",tabindex:"0"},eh={class:"tify-sr-only"},th={key:0,class:"tify-fulltext-texts"},ih=["innerHTML"],nh={key:1,class:"tify-fulltext-none"};function sh(t,r,e,i,n,s){return D(),O("section",$u,[F("h2",eh,X(s.translate("Fulltext")),1),n.fulltextAvailable?(D(),O("div",th,[(D(!0),O(fe,null,Re(s.pages,l=>(D(),O("div",{key:l,class:"tify-fulltext-page"},[F("h3",null,X(s.translate("Page"))+" "+X(s.getPageLabel(l,n.canvases[l-1].label)),1),(D(!0),O(fe,null,Re(n.fulltexts[l],(a,o)=>(D(),O("div",{key:`${l}-${o}`,class:"tify-fulltext-text",innerHTML:a},null,8,ih))),128))]))),128))])):(D(),O("div",nh,X(s.translate("Fulltext not available for this page")),1))])}const rh=ue(Qu,[["render",sh]]),oh={},ah={class:"tify-icon",viewBox:"0 0 24 24"},lh=F("path",{d:"M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z"},null,-1),ch=[lh];function uh(t,r){return D(),O("svg",ah,ch)}const hh=ue(oh,[["render",uh]]),dh={},fh={class:"tify-icon",viewBox:"0 0 24 24"},ph=F("path",{d:"M17.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,9A1.5,1.5 0 0,1 19,10.5A1.5,1.5 0 0,1 17.5,12M14.5,8A1.5,1.5 0 0,1 13,6.5A1.5,1.5 0 0,1 14.5,5A1.5,1.5 0 0,1 16,6.5A1.5,1.5 0 0,1 14.5,8M9.5,8A1.5,1.5 0 0,1 8,6.5A1.5,1.5 0 0,1 9.5,5A1.5,1.5 0 0,1 11,6.5A1.5,1.5 0 0,1 9.5,8M6.5,12A1.5,1.5 0 0,1 5,10.5A1.5,1.5 0 0,1 6.5,9A1.5,1.5 0 0,1 8,10.5A1.5,1.5 0 0,1 6.5,12M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A1.5,1.5 0 0,0 13.5,19.5C13.5,19.11 13.35,18.76 13.11,18.5C12.88,18.23 12.73,17.88 12.73,17.5A1.5,1.5 0 0,1 14.23,16H16A5,5 0 0,0 21,11C21,6.58 16.97,3 12,3Z"},null,-1),gh=[ph];function mh(t,r){return D(),O("svg",fh,gh)}const vh=ue(dh,[["render",mh]]),yh={},wh={class:"tify-icon",viewBox:"0 0 24 24"},_h=F("path",{d:"M12,18V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"},null,-1),xh=[_h];function Th(t,r){return D(),O("svg",wh,xh)}const bh=ue(yh,[["render",Th]]),Eh={},Ph={class:"tify-icon",viewBox:"0 0 24 24"},Sh=F("path",{d:"M3.55 19.09L4.96 20.5L6.76 18.71L5.34 17.29M12 6C8.69 6 6 8.69 6 12S8.69 18 12 18 18 15.31 18 12C18 8.68 15.31 6 12 6M20 13H23V11H20M17.24 18.71L19.04 20.5L20.45 19.09L18.66 17.29M20.45 5L19.04 3.6L17.24 5.39L18.66 6.81M13 1H11V4H13M6.76 5.39L4.96 3.6L3.55 5L5.34 6.81L6.76 5.39M1 13H4V11H1M13 20H11V23H13"},null,-1),Ch=[Sh];function Rh(t,r){return D(),O("svg",Ph,Ch)}const Hh=ue(Eh,[["render",Rh]]),Lh={},Dh={class:"tify-icon",viewBox:"0 0 24 24"},Mh=F("path",{d:"M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"},null,-1),Oh=[Mh];function kh(t,r){return D(),O("svg",Dh,Oh)}const Fh=ue(Lh,[["render",kh]]),Ah={},Bh={class:"tify-icon",viewBox:"0 0 24 24"},Ih=F("path",{d:"M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z"},null,-1),zh=[Ih];function Nh(t,r){return D(),O("svg",Bh,zh)}const Vh=ue(Ah,[["render",Nh]]),Uh={},Wh={class:"tify-icon",viewBox:"0 0 24 24"},jh=F("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M5,8V10H13V8H5Z"},null,-1),Gh=[jh];function qh(t,r){return D(),O("svg",Wh,Gh)}const Zh=ue(Uh,[["render",qh]]),Kh={},Xh={class:"tify-icon",viewBox:"0 0 24 24"},Yh=F("path",{d:"M19,12H17V15H14V17H19V12M7,9H10V7H5V12H7V9M21,3H3A2,2 0 0,0 1,5V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V5A2,2 0 0,0 21,3M21,19H3V5H21V19Z"},null,-1),Jh=[Yh];function Qh(t,r){return D(),O("svg",Xh,Jh)}const $h=ue(Kh,[["render",Qh]]),ed={},td={class:"tify-icon",viewBox:"0 0 24 24"},id=F("path",{d:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M8,5V8H5V10H8V13H10V10H13V8H10V5H8Z"},null,-1),nd=[id];function sd(t,r){return D(),O("svg",td,nd)}const rd=ue(ed,[["render",sd]]),od={},ad={class:"tify-icon",viewBox:"0 0 24 24"},ld=F("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},null,-1),cd=[ld];function ud(t,r){return D(),O("svg",ad,cd)}const Ir=ue(od,[["render",ud]]),hd={},dd={class:"tify-icon",viewBox:"0 0 24 24"},fd=F("path",{d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"},null,-1),pd=[fd];function gd(t,r){return D(),O("svg",dd,pd)}const zr=ue(hd,[["render",gd]]);var Nr={exports:{}};(function(t){//! openseadragon 3.0.0
//! Built on 2021-12-15
//! Git commit: v3.0.0-0-3eded36
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function r(e){return new r.Viewer(e)}(function(e){e.version={versionStr:"3.0.0",major:parseInt("3",10),minor:parseInt("0",10),revision:parseInt("0",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,s=Object.prototype.hasOwnProperty;e.isFunction=function(l){return e.type(l)==="function"},e.isArray=Array.isArray||function(l){return e.type(l)==="array"},e.isWindow=function(l){return l&&typeof l=="object"&&"setInterval"in l},e.type=function(l){return l==null?String(l):i[n.call(l)]||"object"},e.isPlainObject=function(l){if(!l||r.type(l)!=="object"||l.nodeType||e.isWindow(l)||l.constructor&&!s.call(l,"constructor")&&!s.call(l.constructor.prototype,"isPrototypeOf"))return!1;var a;for(var o in l)a=o;return a===void 0||s.call(l,a)},e.isEmptyObject=function(l){for(var a in l)return!1;return!0},e.freezeObject=function(l){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(a){return a},e.freezeObject(l)},e.supportsCanvas=function(){var l=document.createElement("canvas");return!!(e.isFunction(l.getContext)&&l.getContext("2d"))}(),e.isCanvasTainted=function(l){var a=!1;try{l.getContext("2d").getImageData(0,0,1,1)}catch{a=!0}return a},e.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),e.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),e.supportsEventListenerOptions=function(){var l=0;if(e.supportsAddEventListener)try{var a={get capture(){return l++,!1},get once(){return l++,!1},get passive(){return l++,!1}};window.addEventListener("test",null,a),window.removeEventListener("test",null,a)}catch{l=0}return l>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var l=document.createElement("canvas").getContext("2d"),a=window.devicePixelRatio||1,o=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1;return Math.max(a,1)/o}else return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(r),function(e){e.extend=function(){var o,c,h,g,m,T,b=arguments[0]||{},P=arguments.length,C=!1,k=1;for(typeof b=="boolean"&&(C=b,b=arguments[1]||{},k=2),typeof b!="object"&&!r.isFunction(b)&&(b={}),P===k&&(b=this,--k);k<P;k++)if(o=arguments[k],o!==null||o!==void 0)for(c in o)h=b[c],g=o[c],b!==g&&(C&&g&&(r.isPlainObject(g)||(m=r.isArray(g)))?(m?(m=!1,T=h&&r.isArray(h)?h:[]):T=h&&r.isPlainObject(h)?h:{},b[c]=r.extend(C,T,g)):g!==void 0&&(b[c]=g));return b};var i=function(){if(typeof navigator!="object")return!1;var o=navigator.userAgent;return typeof o!="string"?!1:o.indexOf("iPhone")!==-1||o.indexOf("iPad")!==-1||o.indexOf("iPod")!==-1};e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(o,c){return function(){var h=arguments;return h===void 0&&(h=[]),c.apply(o,h)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},_viewers:new Map,getViewer:function(o){return e._viewers.get(this.getElement(o))},getElement:function(o){return typeof o=="string"&&(o=document.getElementById(o)),o},getElementPosition:function(o){var c=new e.Point,h,g;for(o=e.getElement(o),h=e.getElementStyle(o).position==="fixed",g=a(o,h);g;)c.x+=o.offsetLeft,c.y+=o.offsetTop,h&&(c=c.plus(e.getPageScroll())),o=g,h=e.getElementStyle(o).position==="fixed",g=a(o,h);return c},getElementOffset:function(o){o=e.getElement(o);var c=o&&o.ownerDocument,h,g,m={top:0,left:0};return c?(h=c.documentElement,typeof o.getBoundingClientRect<"u"&&(m=o.getBoundingClientRect()),g=c===c.window?c:c.nodeType===9?c.defaultView||c.parentWindow:!1,new e.Point(m.left+(g.pageXOffset||h.scrollLeft)-(h.clientLeft||0),m.top+(g.pageYOffset||h.scrollTop)-(h.clientTop||0))):new e.Point},getElementSize:function(o){return o=e.getElement(o),new e.Point(o.clientWidth,o.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(o){return o=e.getElement(o),o.currentStyle}:function(o){return o=e.getElement(o),window.getComputedStyle(o,"")},getCssPropertyWithVendorPrefix:function(o){var c={};return e.getCssPropertyWithVendorPrefix=function(h){if(c[h]!==void 0)return c[h];var g=document.createElement("div").style,m=null;if(g[h]!==void 0)m=h;else for(var T=["Webkit","Moz","MS","O","webkit","moz","ms","o"],b=e.capitalizeFirstLetter(h),P=0;P<T.length;P++){var C=T[P]+b;if(g[C]!==void 0){m=C;break}}return c[h]=m,m},e.getCssPropertyWithVendorPrefix(o)},capitalizeFirstLetter:function(o){return o.charAt(0).toUpperCase()+o.slice(1)},positiveModulo:function(o,c){var h=o%c;return h<0&&(h+=c),h},pointInElement:function(o,c){o=e.getElement(o);var h=e.getElementOffset(o),g=e.getElementSize(o);return c.x>=h.x&&c.x<h.x+g.x&&c.y<h.y+g.y&&c.y>=h.y},getMousePosition:function(o){if(typeof o.pageX=="number")e.getMousePosition=function(c){var h=new e.Point;return h.x=c.pageX,h.y=c.pageY,h};else if(typeof o.clientX=="number")e.getMousePosition=function(c){var h=new e.Point;return h.x=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,h.y=c.clientY+document.body.scrollTop+document.documentElement.scrollTop,h};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(o)},getPageScroll:function(){var o=document.documentElement||{},c=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(c.scrollLeft||c.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(o.scrollLeft||o.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(o){if(typeof window.scrollTo<"u")e.setPageScroll=function(g){window.scrollTo(g.x,g.y)};else{var c=e.getPageScroll();if(c.x===o.x&&c.y===o.y)return;document.body.scrollLeft=o.x,document.body.scrollTop=o.y;var h=e.getPageScroll();if(h.x!==c.x&&h.y!==c.y){e.setPageScroll=function(g){document.body.scrollLeft=g.x,document.body.scrollTop=g.y};return}if(document.documentElement.scrollLeft=o.x,document.documentElement.scrollTop=o.y,h=e.getPageScroll(),h.x!==c.x&&h.y!==c.y){e.setPageScroll=function(g){document.documentElement.scrollLeft=g.x,document.documentElement.scrollTop=g.y};return}e.setPageScroll=function(g){}}e.setPageScroll(o)},getWindowSize:function(){var o=document.documentElement||{},c=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(o.clientWidth||o.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(c.clientWidth||c.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(o){o=e.getElement(o);var c=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(c[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(c[1].style,{display:"table-row"}),e.extend(c[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),c[0].appendChild(c[1]),c[1].appendChild(c[2]),c[2].appendChild(o),c[0]},makeNeutralElement:function(o){var c=document.createElement(o),h=c.style;return h.background="transparent none",h.border="none",h.margin="0px",h.padding="0px",h.position="static",c},now:function(){return Date.now?e.now=Date.now:e.now=function(){return new Date().getTime()},e.now()},makeTransparentImage:function(o){var c=e.makeNeutralElement("img");return c.src=o,c},setElementOpacity:function(o,c,h){var g,m;o=e.getElement(o),h&&!e.Browser.alpha&&(c=Math.round(c)),e.Browser.opacity?o.style.opacity=c<1?c:"":c<1?(g=Math.round(100*c),m="alpha(opacity="+g+")",o.style.filter=m):o.style.filter=""},setElementTouchActionNone:function(o){o=e.getElement(o),typeof o.style.touchAction<"u"?o.style.touchAction="none":typeof o.style.msTouchAction<"u"&&(o.style.msTouchAction="none")},setElementPointerEvents:function(o,c){o=e.getElement(o),typeof o.style.pointerEvents<"u"&&(o.style.pointerEvents=c)},setElementPointerEventsNone:function(o){e.setElementPointerEvents(o,"none")},addClass:function(o,c){o=e.getElement(o),o.className?(" "+o.className+" ").indexOf(" "+c+" ")===-1&&(o.className+=" "+c):o.className=c},indexOf:function(o,c,h){return Array.prototype.indexOf?this.indexOf=function(g,m,T){return g.indexOf(m,T)}:this.indexOf=function(g,m,T){var b,P=T||0,C;if(!g)throw new TypeError;if(C=g.length,C===0||P>=C)return-1;for(P<0&&(P=C-Math.abs(P)),b=P;b<C;b++)if(g[b]===m)return b;return-1},this.indexOf(o,c,h)},removeClass:function(o,c){var h,g=[],m;for(o=e.getElement(o),h=o.className.split(/\s+/),m=0;m<h.length;m++)h[m]&&h[m]!==c&&g.push(h[m]);o.className=g.join(" ")},normalizeEventListenerOptions:function(o){var c;return typeof o<"u"?typeof o=="boolean"?c=e.supportsEventListenerOptions?{capture:o}:o:c=e.supportsEventListenerOptions?o:typeof o.capture<"u"?o.capture:!1:c=e.supportsEventListenerOptions?{capture:!1}:!1,c},addEvent:function(){if(e.supportsAddEventListener)return function(o,c,h,g){g=e.normalizeEventListenerOptions(g),o=e.getElement(o),o.addEventListener(c,h,g)};if(document.documentElement.attachEvent&&document.attachEvent)return function(o,c,h){o=e.getElement(o),o.attachEvent("on"+c,h)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(o,c,h,g){g=e.normalizeEventListenerOptions(g),o=e.getElement(o),o.removeEventListener(c,h,g)};if(document.documentElement.detachEvent&&document.detachEvent)return function(o,c,h){o=e.getElement(o),o.detachEvent("on"+c,h)};throw new Error("No known event model.")}(),cancelEvent:function(o){o.preventDefault()},eventIsCanceled:function(o){return o.defaultPrevented},stopEvent:function(o){o.stopPropagation()},createCallback:function(o,c){var h=[],g;for(g=2;g<arguments.length;g++)h.push(arguments[g]);return function(){var m=h.concat([]),T;for(T=0;T<arguments.length;T++)m.push(arguments[T]);return c.apply(o,m)}},getUrlParameter:function(o){var c=l[o];return c||null},getUrlProtocol:function(o){var c=o.match(/^([a-z]+:)\/\//i);return c===null?window.location.protocol:c[1].toLowerCase()},createAjaxRequest:function(o){var c;try{c=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{c=!1}if(c)window.XMLHttpRequest?e.createAjaxRequest=function(h){return h?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:e.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return e.createAjaxRequest(o)},makeAjaxRequest:function(o,c,h){var g,m,T;e.isPlainObject(o)&&(c=o.success,h=o.error,g=o.withCredentials,m=o.headers,T=o.responseType||null,o=o.url);var b=e.getUrlProtocol(o),P=e.createAjaxRequest(b==="file:");if(!e.isFunction(c))throw new Error("makeAjaxRequest requires a success callback");P.onreadystatechange=function(){P.readyState===4&&(P.onreadystatechange=function(){},P.status>=200&&P.status<300||P.status===0&&b!=="http:"&&b!=="https:"?c(P):(e.console.log("AJAX request returned %d: %s",P.status,o),e.isFunction(h)&&h(P)))};try{if(P.open("GET",o,!0),T&&(P.responseType=T),m)for(var C in m)Object.prototype.hasOwnProperty.call(m,C)&&m[C]&&P.setRequestHeader(C,m[C]);g&&(P.withCredentials=!0),P.send(null)}catch(k){e.console.log("%s while making AJAX request: %s",k.name,k.message),P.onreadystatechange=function(){},e.isFunction(h)&&h(P,k)}return P},jsonp:function(o){var c,h=o.url,g=document.head||document.getElementsByTagName("head")[0]||document.documentElement,m=o.callbackName||"openseadragon"+e.now(),T=window[m],b="$1"+m+"$2",P=o.param||"callback",C=o.callback;h=h.replace(/(=)\?(&|$)|\?\?/i,b),h+=(/\?/.test(h)?"&":"?")+P+"="+m,window[m]=function(k){if(T)window[m]=T;else try{delete window[m]}catch{}C&&e.isFunction(C)&&C(k)},c=document.createElement("script"),(o.async!==void 0||o.async!==!1)&&(c.async="async"),o.scriptCharset&&(c.charset=o.scriptCharset),c.src=h,c.onload=c.onreadystatechange=function(k,d){(d||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,g&&c.parentNode&&g.removeChild(c),c=void 0)},g.insertBefore(c,g.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(o){if(window.DOMParser)e.parseXml=function(c){var h=null,g;return g=new DOMParser,h=g.parseFromString(c,"text/xml"),h};else if(window.ActiveXObject)e.parseXml=function(c){var h=null;return h=new ActiveXObject("Microsoft.XMLDOM"),h.async=!1,h.loadXML(c),h};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(o)},parseJSON:function(o){return e.parseJSON=window.JSON.parse,e.parseJSON(o)},imageFormatSupported:function(o){return o=o||"",!!s[o.toLowerCase()]},setImageFormatsSupported:function(o){e.extend(s,o)}});var n=function(o){};e.console=window.console||{log:n,debug:n,info:n,warn:n,error:n,assert:n},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var s={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},l={};(function(){var o=navigator.appVersion,c=navigator.userAgent,h;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(c.substring(c.indexOf("MSIE")+5,c.indexOf(";",c.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(c.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(c.substring(c.indexOf("Edge")+5))):c.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(c.substring(c.indexOf("Edg")+4))):c.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(c.substring(c.indexOf("Firefox")+8))):c.indexOf("Safari")>=0?(e.Browser.vendor=c.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(c.substring(c.substring(0,c.indexOf("Safari")).lastIndexOf("/")+1,c.indexOf("Safari")))):(h=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),h.exec(c)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(o);break}var g=window.location.search.substring(1),m=g.split("&"),T,b,P;for(P=0;P<m.length;P++)if(T=m[P],b=T.indexOf("="),b>0){var C=T.substring(0,b),k=T.substring(b+1);try{l[C]=decodeURIComponent(k)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",C,k)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(o){var c=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,h=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame;if(c&&h)e.requestAnimationFrame=function(){return c.apply(o,arguments)},e.cancelAnimationFrame=function(){return h.apply(o,arguments)};else{var g=[],m=[],T=0,b;e.requestAnimationFrame=function(P){return g.push([++T,P]),b||(b=setInterval(function(){if(g.length){var C=e.now(),k=m;for(m=g,g=k;m.length;)m.shift()[1](C)}else clearInterval(b),b=void 0},1e3/50)),T},e.cancelAnimationFrame=function(P){var C,k;for(C=0,k=g.length;C<k;C+=1)if(g[C][0]===P){g.splice(C,1);return}for(C=0,k=m.length;C<k;C+=1)if(m[C][0]===P){m.splice(C,1);return}}}}(window);function a(o,c){return c&&o!==document.body?document.body:o.offsetParent}}(r),function(e,i){t.exports?t.exports=i():e.OpenSeadragon=i()}(zn,function(){return r}),function(e){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(n){return n.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(n){return n.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(n){return n.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(n){return n.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},e.extend(e,i)}(r),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(i,n,s,l){var a=this;l=l||1;var o=0,c=function(h){o++,o===l&&a.removeHandler(i,c),n(h)};this.addHandler(i,c,s)},addHandler:function(i,n,s){var l=this.events[i];l||(this.events[i]=l=[]),n&&e.isFunction(n)&&(l[l.length]={handler:n,userData:s||null})},removeHandler:function(i,n){var s=this.events[i],l=[],a;if(s&&e.isArray(s)){for(a=0;a<s.length;a++)s[a].handler!==n&&l.push(s[a]);this.events[i]=l}},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var n in this.events)this.events[n]=[]},getHandler:function(i){var n=this.events[i];return!n||!n.length?null:(n=n.length===1?[n[0]]:Array.apply(null,n),function(s,l){var a,o=n.length;for(a=0;a<o;a++)n[a]&&(l.eventSource=s,l.userData=n[a].userData,n[a].handler(l))})},raiseEvent:function(i,n){var s=this.getHandler(i);s&&(n||(n={}),s(this,n))}}}(r),function(e){var i={};e.MouseTracker=function(p){var f=arguments;e.isPlainObject(p)||(p={element:f[0],clickTimeThreshold:f[1],clickDistThreshold:f[2]}),this.hash=Math.random(),this.element=e.getElement(p.element),this.clickTimeThreshold=p.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=p.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=p.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=p.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=p.userData||null,this.stopDelay=p.stopDelay||50,this.preProcessEventHandler=p.preProcessEventHandler||null,this.contextMenuHandler=p.contextMenuHandler||null,this.enterHandler=p.enterHandler||null,this.leaveHandler=p.leaveHandler||null,this.exitHandler=p.exitHandler||null,this.overHandler=p.overHandler||null,this.outHandler=p.outHandler||null,this.pressHandler=p.pressHandler||null,this.nonPrimaryPressHandler=p.nonPrimaryPressHandler||null,this.releaseHandler=p.releaseHandler||null,this.nonPrimaryReleaseHandler=p.nonPrimaryReleaseHandler||null,this.moveHandler=p.moveHandler||null,this.scrollHandler=p.scrollHandler||null,this.clickHandler=p.clickHandler||null,this.dblClickHandler=p.dblClickHandler||null,this.dragHandler=p.dragHandler||null,this.dragEndHandler=p.dragEndHandler||null,this.pinchHandler=p.pinchHandler||null,this.stopHandler=p.stopHandler||null,this.keyDownHandler=p.keyDownHandler||null,this.keyUpHandler=p.keyUpHandler||null,this.keyHandler=p.keyHandler||null,this.focusHandler=p.focusHandler||null,this.blurHandler=p.blurHandler||null;var y=this;i[this.hash]={click:function(w){_(y,w)},dblclick:function(w){S(y,w)},keydown:function(w){M(y,w)},keyup:function(w){I(y,w)},keypress:function(w){V(y,w)},focus:function(w){q(y,w)},blur:function(w){K(y,w)},contextmenu:function(w){j(y,w)},wheel:function(w){oe(y,w)},mousewheel:function(w){te(y,w)},DOMMouseScroll:function(w){te(y,w)},MozMousePixelScroll:function(w){te(y,w)},losecapture:function(w){he(y,w)},mouseenter:function(w){Pt(y,w)},mouseleave:function(w){mt(y,w)},mouseover:function(w){Nt(y,w)},mouseout:function(w){We(y,w)},mousedown:function(w){dt(y,w)},mouseup:function(w){St(y,w)},mousemove:function(w){yt(y,w)},touchstart:function(w){_e(y,w)},touchend:function(w){le(y,w)},touchmove:function(w){ae(y,w)},touchcancel:function(w){ne(y,w)},gesturestart:function(w){Te(y,w)},gesturechange:function(w){$(y,w)},gotpointercapture:function(w){De(y,w)},lostpointercapture:function(w){Ue(y,w)},pointerenter:function(w){Pt(y,w)},pointerleave:function(w){mt(y,w)},pointerover:function(w){Nt(y,w)},pointerout:function(w){We(y,w)},pointerdown:function(w){dt(y,w)},pointerup:function(w){St(y,w)},pointermove:function(w){yt(y,w)},pointercancel:function(w){u(y,w)},pointerupcaptured:function(w){nt(y,w)},pointermovecaptured:function(w){E(y,w)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),p.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){o(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(p){return p?a(this):o(this),this},getActivePointersListByType:function(p){var f=i[this.hash],y,w=f.activePointersLists.length,z;for(y=0;y<w;y++)if(f.activePointersLists[y].type===p)return f.activePointersLists[y];return z=new e.MouseTracker.GesturePointList(p),f.activePointersLists.push(z),z},getActivePointerCount:function(){var p=i[this.hash],f,y=p.activePointersLists.length,w=0;for(f=0;f<y;f++)w+=p.activePointersLists[f].getLength();return w},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var n=function(){try{return window.self!==window.top}catch{return!0}}();function s(p){try{return p.addEventListener&&p.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=function(){var p=[],f=0,y=0,w=function(ge,se){return ge.hash.toString()+se.type+se.id.toString()},z=function(){var ge,se=p.length,Ze,Me,Vt=e.now(),Gn,qn,Zn;for(Gn=Vt-y,y=Vt,ge=0;ge<se;ge++)Ze=p[ge],Me=Ze.gPoint,Me.direction=Math.atan2(Me.currentPos.y-Ze.lastPos.y,Me.currentPos.x-Ze.lastPos.x),qn=Ze.lastPos.distanceTo(Me.currentPos),Ze.lastPos=Me.currentPos,Zn=1e3*qn/(Gn+1),Me.speed=.75*Zn+.25*Me.speed},G=function(ge,se){var Ze=w(ge,se);p.push({guid:Ze,gPoint:se,lastPos:se.currentPos}),p.length===1&&(y=e.now(),f=window.setInterval(z,50))},ee=function(ge,se){var Ze=w(ge,se),Me,Vt=p.length;for(Me=0;Me<Vt;Me++)if(p[Me].guid===Ze){p.splice(Me,1),Vt--,Vt===0&&window.clearInterval(f);break}};return{addPoint:G,removePoint:ee}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=function(){var p=document.createElement("div");return e.isFunction(p.setPointerCapture)&&e.isFunction(p.releasePointerCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var p=document.createElement("div");return e.isFunction(p.setCapture)&&e.isFunction(p.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(p){this._gPoints=[],this.type=p,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(p){return this._gPoints.push(p)},removeById:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].id===p){this._gPoints.splice(f,1);break}return this._gPoints.length},getByIndex:function(p){return p<this._gPoints.length?this._gPoints[p]:null},getById:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].id===p)return this._gPoints[f];return null},getPrimary:function(p){var f,y=this._gPoints.length;for(f=0;f<y;f++)if(this._gPoints[f].isPrimary)return this._gPoints[f];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(e.console.warn("GesturePointList.removeContact() Implausible contacts value"),this.contacts=0)}};function l(p){var f=i[p.hash],y,w,z,G,ee,ge=f.activePointersLists.length;for(y=0;y<ge;y++)if(z=f.activePointersLists[y],z.getLength()>0){for(ee=[],G=z.asArray(),w=0;w<G.length;w++)ee.push(G[w]);for(w=0;w<ee.length;w++)x(p,z,ee[w])}for(y=0;y<ge;y++)f.activePointersLists.pop();f.sentDragEvent=!1}function a(p){var f=i[p.hash],y,w;if(!f.tracking){for(w=0;w<e.MouseTracker.subscribeEvents.length;w++)y=e.MouseTracker.subscribeEvents[w],e.addEvent(p.element,y,f[y],y===e.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);l(p),f.tracking=!0}}function o(p){var f=i[p.hash],y,w;if(f.tracking){for(w=0;w<e.MouseTracker.subscribeEvents.length;w++)y=e.MouseTracker.subscribeEvents[w],e.removeEvent(p.element,y,f[y],!1);l(p),f.tracking=!1}}function c(p,f){var y=i[p.hash];if(f==="pointerevent")return{upName:"pointerup",upHandler:y.pointerupcaptured,moveName:"pointermove",moveHandler:y.pointermovecaptured};if(f==="mouse")return{upName:"pointerup",upHandler:y.pointerupcaptured,moveName:"pointermove",moveHandler:y.pointermovecaptured};if(f==="touch")return{upName:"touchend",upHandler:y.touchendcaptured,moveName:"touchmove",moveHandler:y.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function h(p,f){var y;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{p.element.setPointerCapture(f.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else p.element.setCapture(!0);else y=c(p,e.MouseTracker.havePointerEvents?"pointerevent":f.type),n&&s(window.top)&&e.addEvent(window.top,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0);B(p,f,!0)}function g(p,f){var y,w,z;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(w=p.getActivePointersListByType(f.type),z=w.getById(f.id),!z||!z.captured)return;try{p.element.releasePointerCapture(f.id)}catch{}}else p.element.releaseCapture();else y=c(p,e.MouseTracker.havePointerEvents?"pointerevent":f.type),n&&s(window.top)&&e.removeEvent(window.top,y.upName,y.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,y.moveName,y.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,y.upName,y.upHandler,!0);B(p,f,!1)}function m(p){return e.MouseTracker.havePointerEvents?p.pointerId:e.MouseTracker.mousePointerId}function T(p){return e.MouseTracker.havePointerEvents?p.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function b(p){return e.MouseTracker.havePointerEvents?p.isPrimary:!0}function P(p){return e.getMousePosition(p)}function C(p,f){return k(P(p),f)}function k(p,f){var y=e.getElementOffset(f);return p.minus(y)}function d(p,f){return new e.Point((p.x+f.x)/2,(p.y+f.y)/2)}function _(p,f){var y={originalEvent:f,eventType:"click",pointerType:"mouse",isEmulated:!1};H(p,y),y.preventDefault&&!y.defaultPrevented&&e.cancelEvent(f),y.stopPropagation&&e.stopEvent(f)}function S(p,f){var y={originalEvent:f,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};H(p,y),y.preventDefault&&!y.defaultPrevented&&e.cancelEvent(f),y.stopPropagation&&e.stopEvent(f)}function M(p,f){var y=null,w={originalEvent:f,eventType:"keydown",pointerType:"",isEmulated:!1};H(p,w),p.keyDownHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.keyDownHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function I(p,f){var y=null,w={originalEvent:f,eventType:"keyup",pointerType:"",isEmulated:!1};H(p,w),p.keyUpHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.keyUpHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function V(p,f){var y=null,w={originalEvent:f,eventType:"keypress",pointerType:"",isEmulated:!1};H(p,w),p.keyHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,keyCode:f.keyCode?f.keyCode:f.charCode,ctrl:f.ctrlKey,shift:f.shiftKey,alt:f.altKey,meta:f.metaKey,originalEvent:f,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.keyHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function q(p,f){var y={originalEvent:f,eventType:"focus",pointerType:"",isEmulated:!1};H(p,y),p.focusHandler&&!y.preventGesture&&p.focusHandler({eventSource:p,originalEvent:f,userData:p.userData})}function K(p,f){var y={originalEvent:f,eventType:"blur",pointerType:"",isEmulated:!1};H(p,y),p.blurHandler&&!y.preventGesture&&p.blurHandler({eventSource:p,originalEvent:f,userData:p.userData})}function j(p,f){var y=null,w={originalEvent:f,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};H(p,w),p.contextMenuHandler&&!w.preventGesture&&!w.defaultPrevented&&(y={eventSource:p,position:k(P(f),p.element),originalEvent:w.originalEvent,preventDefault:w.preventDefault||w.defaultPrevented,userData:p.userData},p.contextMenuHandler(y)),(y&&y.preventDefault||w.preventDefault&&!w.defaultPrevented)&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function oe(p,f){pe(p,f,f)}function te(p,f){var y={target:f.target||f.srcElement,type:"wheel",shiftKey:f.shiftKey||!1,clientX:f.clientX,clientY:f.clientY,pageX:f.pageX?f.pageX:f.clientX,pageY:f.pageY?f.pageY:f.clientY,deltaMode:f.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?y.deltaY=-f.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:y.deltaY=f.detail,pe(p,y,f)}function pe(p,f,y){var w=0,z,G=null;w=f.deltaY<0?1:-1,z={originalEvent:f,eventType:"wheel",pointerType:"mouse",isEmulated:f!==y},H(p,z),p.scrollHandler&&!z.preventGesture&&!z.defaultPrevented&&(G={eventSource:p,pointerType:"mouse",position:C(f,p.element),scroll:w,shift:f.shiftKey,isTouchEvent:!1,originalEvent:y,preventDefault:z.preventDefault||z.defaultPrevented,userData:p.userData},p.scrollHandler(G)),z.stopPropagation&&e.stopEvent(y),(G&&G.preventDefault||z.preventDefault&&!z.defaultPrevented)&&e.cancelEvent(y)}function he(p,f){var y={id:e.MouseTracker.mousePointerId,type:"mouse"},w={originalEvent:f,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};H(p,w),f.target===p.element&&B(p,y,!1),w.stopPropagation&&e.stopEvent(f)}function _e(p,f){var y,w,z=f.changedTouches.length,G,ee=p.getActivePointersListByType("touch");y=e.now(),ee.getLength()>f.touches.length-z&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var ge={originalEvent:f,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(H(p,ge),w=0;w<z;w++)G={id:f.changedTouches[w].identifier,type:"touch",isPrimary:ee.getLength()===0,currentPos:P(f.changedTouches[w]),currentTime:y},A(p,ge,G),W(p,ge,G,0),B(p,G,!0);ge.preventDefault&&!ge.defaultPrevented&&e.cancelEvent(f),ge.stopPropagation&&e.stopEvent(f)}function le(p,f){var y,w,z=f.changedTouches.length,G;y=e.now();var ee={originalEvent:f,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(H(p,ee),w=0;w<z;w++)G={id:f.changedTouches[w].identifier,type:"touch",currentPos:P(f.changedTouches[w]),currentTime:y},Q(p,ee,G,0),B(p,G,!1),N(p,ee,G);ee.preventDefault&&!ee.defaultPrevented&&e.cancelEvent(f),ee.stopPropagation&&e.stopEvent(f)}function ae(p,f){var y,w,z=f.changedTouches.length,G;y=e.now();var ee={originalEvent:f,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(H(p,ee),w=0;w<z;w++)G={id:f.changedTouches[w].identifier,type:"touch",currentPos:P(f.changedTouches[w]),currentTime:y},J(p,ee,G);ee.preventDefault&&!ee.defaultPrevented&&e.cancelEvent(f),ee.stopPropagation&&e.stopEvent(f)}function ne(p,f){var y=f.changedTouches.length,w,z,G={originalEvent:f,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(H(p,G),w=0;w<y;w++)z={id:f.changedTouches[w].identifier,type:"touch"},de(p,G,z);G.stopPropagation&&e.stopEvent(f)}function Te(p,f){return e.eventIsCanceled(f)||f.preventDefault(),!1}function $(p,f){return e.eventIsCanceled(f)||f.preventDefault(),!1}function De(p,f){var y={originalEvent:f,eventType:"gotpointercapture",pointerType:T(f),isEmulated:!1};H(p,y),f.target===p.element&&B(p,{id:f.pointerId,type:T(f)},!0),y.stopPropagation&&e.stopEvent(f)}function Ue(p,f){var y={originalEvent:f,eventType:"lostpointercapture",pointerType:T(f),isEmulated:!1};H(p,y),f.target===p.element&&B(p,{id:f.pointerId,type:T(f)},!1),y.stopPropagation&&e.stopEvent(f)}function Pt(p,f){var y={id:m(f),type:T(f),isPrimary:b(f),currentPos:P(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerenter",pointerType:y.type,isEmulated:!1};H(p,w),A(p,w,y)}function mt(p,f){var y={id:m(f),type:T(f),isPrimary:b(f),currentPos:P(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerleave",pointerType:y.type,isEmulated:!1};H(p,w),N(p,w,y)}function Nt(p,f){var y={id:m(f),type:T(f),isPrimary:b(f),currentPos:P(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerover",pointerType:y.type,isEmulated:!1};H(p,w),Y(p,w,y),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function We(p,f){var y={id:m(f),type:T(f),isPrimary:b(f),currentPos:P(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointerout",pointerType:y.type,isEmulated:!1};H(p,w),Z(p,w,y),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function dt(p,f){var y={id:m(f),type:T(f),isPrimary:b(f),currentPos:P(f),currentTime:e.now()},w=e.MouseTracker.havePointerEvents&&y.type==="touch"&&e.Browser.vendor!==e.BROWSERS.IE,z={originalEvent:f,eventType:"pointerdown",pointerType:y.type,isEmulated:!1};H(p,z),W(p,z,y,f.button),z.preventDefault&&!z.defaultPrevented&&e.cancelEvent(f),z.stopPropagation&&e.stopEvent(f),z.shouldCapture&&(w?B(p,y,!0):h(p,y))}function St(p,f){vt(p,f)}function nt(p,f){var y=p.getActivePointersListByType(T(f));y.getById(f.pointerId)&&vt(p,f),e.stopEvent(f)}function vt(p,f){var y;y={id:m(f),type:T(f),isPrimary:b(f),currentPos:P(f),currentTime:e.now()};var w={originalEvent:f,eventType:"pointerup",pointerType:y.type,isEmulated:!1};H(p,w),Q(p,w,y,f.button),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f),w.shouldReleaseCapture&&(f.target===p.element?g(p,y):B(p,y,!1))}function yt(p,f){R(p,f)}function E(p,f){var y=p.getActivePointersListByType(T(f));y.getById(f.pointerId)&&R(p,f),e.stopEvent(f)}function R(p,f){var y={id:m(f),type:T(f),isPrimary:b(f),currentPos:P(f),currentTime:e.now()},w={originalEvent:f,eventType:"pointermove",pointerType:y.type,isEmulated:!1};H(p,w),J(p,w,y),w.preventDefault&&!w.defaultPrevented&&e.cancelEvent(f),w.stopPropagation&&e.stopEvent(f)}function u(p,f){var y={id:f.pointerId,type:T(f)},w={originalEvent:f,eventType:"pointercancel",pointerType:y.type,isEmulated:!1};H(p,w),de(p,w,y),w.stopPropagation&&e.stopEvent(f)}function v(p,f){return f.speed=0,f.direction=0,f.contactPos=f.currentPos,f.contactTime=f.currentTime,f.lastPos=f.currentPos,f.lastTime=f.currentTime,p.add(f)}function x(p,f,y){var w,z=f.getById(y.id);return z?(z.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),g(p,z)),(f.type==="mouse"||f.type==="pen")&&f.contacts>0&&f.removeContact(),w=f.removeById(y.id)):w=f.getLength(),w}function L(p,f){switch(f.eventType){case"pointermove":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break;case"pointerdown":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"pointerup":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasGestureHandlers,f.stopPropagation=!1;break;case"wheel":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!1,f.preventGesture=!p.hasScrollHandler,f.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":f.isStoppable=!0,f.isCancelable=!1,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break;case"click":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!!p.clickHandler,f.preventGesture=!1,f.stopPropagation=!1;break;case"dblclick":f.isStoppable=!0,f.isCancelable=!0,f.preventDefault=!!p.dblClickHandler,f.preventGesture=!1,f.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:f.isStoppable=!1,f.isCancelable=!1,f.preventDefault=!1,f.preventGesture=!1,f.stopPropagation=!1;break}}function H(p,f){f.eventSource=p,f.eventPhase=f.originalEvent&&typeof f.originalEvent.eventPhase<"u"?f.originalEvent.eventPhase:0,f.defaultPrevented=e.eventIsCanceled(f.originalEvent),f.shouldCapture=!1,f.shouldReleaseCapture=!1,f.userData=p.userData,L(p,f),p.preProcessEventHandler&&p.preProcessEventHandler(f)}function B(p,f,y){var w=p.getActivePointersListByType(f.type),z=w.getById(f.id);z?y&&!z.captured?(z.captured=!0,w.captureCount++):!y&&z.captured&&(z.captured=!1,w.captureCount--,w.captureCount<0&&(w.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function A(p,f,y){var w=p.getActivePointersListByType(y.type),z;z=w.getById(y.id),z?(z.insideElement=!0,z.lastPos=z.currentPos,z.lastTime=z.currentTime,z.currentPos=y.currentPos,z.currentTime=y.currentTime,y=z):(y.captured=!1,y.insideElementPressed=!1,y.insideElement=!0,v(w,y)),p.enterHandler&&p.enterHandler({eventSource:p,pointerType:y.type,position:k(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function N(p,f,y){var w=p.getActivePointersListByType(y.type),z,G;z=w.getById(y.id),z?(z.captured?(z.insideElement=!1,z.lastPos=z.currentPos,z.lastTime=z.currentTime,z.currentPos=y.currentPos,z.currentTime=y.currentTime):x(p,w,z),y=z):(y.captured=!1,y.insideElementPressed=!1),(p.leaveHandler||p.exitHandler)&&(G={eventSource:p,pointerType:y.type,position:y.currentPos&&k(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData},p.leaveHandler&&p.leaveHandler(G),p.exitHandler&&p.exitHandler(G))}function Y(p,f,y){var w,z;w=p.getActivePointersListByType(y.type),z=w.getById(y.id),z?y=z:(y.captured=!1,y.insideElementPressed=!1),p.overHandler&&p.overHandler({eventSource:p,pointerType:y.type,position:k(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function Z(p,f,y){var w,z;w=p.getActivePointersListByType(y.type),z=w.getById(y.id),z?y=z:(y.captured=!1,y.insideElementPressed=!1),p.outHandler&&p.outHandler({eventSource:p,pointerType:y.type,position:y.currentPos&&k(y.currentPos,p.element),buttons:w.buttons,pointers:p.getActivePointerCount(),insideElementPressed:y.insideElementPressed,buttonDownAny:w.buttons!==0,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData})}function W(p,f,y,w){var z=i[p.hash],G=p.getActivePointersListByType(y.type),ee;if(typeof f.originalEvent.buttons<"u"?G.buttons=f.originalEvent.buttons:w===0?G.buttons|=1:w===1?G.buttons|=4:w===2?G.buttons|=2:w===3?G.buttons|=8:w===4?G.buttons|=16:w===5&&(G.buttons|=32),w!==0){f.shouldCapture=!1,f.shouldReleaseCapture=!1,p.nonPrimaryPressHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,p.nonPrimaryPressHandler({eventSource:p,pointerType:y.type,position:k(y.currentPos,p.element),button:w,buttons:G.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}));return}if(ee=G.getById(y.id),ee)ee.insideElementPressed=!0,ee.insideElement=!0,ee.originalTarget=f.originalEvent.target,ee.contactPos=y.currentPos,ee.contactTime=y.currentTime,ee.lastPos=ee.currentPos,ee.lastTime=ee.currentTime,ee.currentPos=y.currentPos,ee.currentTime=y.currentTime,y=ee;else{e.console.warn("pointerdown event on untracked pointer"),y.captured=!1,y.insideElementPressed=!0,y.insideElement=!0,y.originalTarget=f.originalEvent.target,v(G,y);return}G.addContact(),!f.preventGesture&&!f.defaultPrevented?(f.shouldCapture=!0,f.shouldReleaseCapture=!1,f.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(p,y),G.contacts===1?p.pressHandler&&!f.preventGesture&&p.pressHandler({eventSource:p,pointerType:y.type,position:k(y.contactPos,p.element),buttons:G.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}):G.contacts===2&&p.pinchHandler&&y.type==="touch"&&(z.pinchGPoints=G.asArray(),z.lastPinchDist=z.currentPinchDist=z.pinchGPoints[0].currentPos.distanceTo(z.pinchGPoints[1].currentPos),z.lastPinchCenter=z.currentPinchCenter=d(z.pinchGPoints[0].currentPos,z.pinchGPoints[1].currentPos))):(f.shouldCapture=!1,f.shouldReleaseCapture=!1)}function Q(p,f,y,w){var z=i[p.hash],G=p.getActivePointersListByType(y.type),ee,ge,se,Ze=!1,Me;if(typeof f.originalEvent.buttons<"u"?G.buttons=f.originalEvent.buttons:w===0?G.buttons^=-2:w===1?G.buttons^=-5:w===2?G.buttons^=-3:w===3?G.buttons^=-9:w===4?G.buttons^=-17:w===5&&(G.buttons^=-33),f.shouldCapture=!1,w!==0){f.shouldReleaseCapture=!1,p.nonPrimaryReleaseHandler&&!f.preventGesture&&!f.defaultPrevented&&(f.preventDefault=!0,p.nonPrimaryReleaseHandler({eventSource:p,pointerType:y.type,position:k(y.currentPos,p.element),button:w,buttons:G.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}));return}se=G.getById(y.id),se?(G.removeContact(),se.captured&&(Ze=!0),se.lastPos=se.currentPos,se.lastTime=se.currentTime,se.currentPos=y.currentPos,se.currentTime=y.currentTime,se.insideElement||x(p,G,se),ee=se.currentPos,ge=se.currentTime):(e.console.warn("updatePointerUp(): pointerup on untracked gPoint"),y.captured=!1,y.insideElementPressed=!1,y.insideElement=!0,v(G,y),se=y),!f.preventGesture&&!f.defaultPrevented&&(Ze?(f.shouldReleaseCapture=!0,f.preventDefault=!0,(p.dragHandler||p.dragEndHandler||p.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(p,se),G.contacts===0?(p.releaseHandler&&p.releaseHandler({eventSource:p,pointerType:se.type,position:k(ee,p.element),buttons:G.buttons,insideElementPressed:se.insideElementPressed,insideElementReleased:se.insideElement,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),p.dragEndHandler&&z.sentDragEvent&&p.dragEndHandler({eventSource:p,pointerType:se.type,position:k(se.currentPos,p.element),speed:se.speed,direction:se.direction,shift:f.originalEvent.shiftKey,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),z.sentDragEvent=!1,(p.clickHandler||p.dblClickHandler)&&se.insideElement&&(Me=ge-se.contactTime<=p.clickTimeThreshold&&se.contactPos.distanceTo(ee)<=p.clickDistThreshold,p.clickHandler&&p.clickHandler({eventSource:p,pointerType:se.type,position:k(se.currentPos,p.element),quick:Me,shift:f.originalEvent.shiftKey,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,originalTarget:se.originalTarget,userData:p.userData}),p.dblClickHandler&&Me&&(G.clicks++,G.clicks===1?(z.lastClickPos=ee,z.dblClickTimeOut=setTimeout(function(){G.clicks=0},p.dblClickTimeThreshold)):G.clicks===2&&(clearTimeout(z.dblClickTimeOut),G.clicks=0,z.lastClickPos.distanceTo(ee)<=p.dblClickDistThreshold&&p.dblClickHandler({eventSource:p,pointerType:se.type,position:k(se.currentPos,p.element),shift:f.originalEvent.shiftKey,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),z.lastClickPos=null)))):G.contacts===2&&p.pinchHandler&&se.type==="touch"&&(z.pinchGPoints=G.asArray(),z.lastPinchDist=z.currentPinchDist=z.pinchGPoints[0].currentPos.distanceTo(z.pinchGPoints[1].currentPos),z.lastPinchCenter=z.currentPinchCenter=d(z.pinchGPoints[0].currentPos,z.pinchGPoints[1].currentPos))):(f.shouldReleaseCapture=!1,p.releaseHandler&&(p.releaseHandler({eventSource:p,pointerType:se.type,position:k(ee,p.element),buttons:G.buttons,insideElementPressed:se.insideElementPressed,insideElementReleased:se.insideElement,isTouchEvent:se.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0)))}function J(p,f,y){var w=i[p.hash],z=p.getActivePointersListByType(y.type),G,ee,ge;if(typeof f.originalEvent.buttons<"u"&&(z.buttons=f.originalEvent.buttons),G=z.getById(y.id),G)G.lastPos=G.currentPos,G.lastTime=G.currentTime,G.currentPos=y.currentPos,G.currentTime=y.currentTime;else return;f.shouldCapture=!1,f.shouldReleaseCapture=!1,p.stopHandler&&y.type==="mouse"&&(clearTimeout(p.stopTimeOut),p.stopTimeOut=setTimeout(function(){ye(p,f.originalEvent,y.type)},p.stopDelay)),z.contacts===0?p.moveHandler&&p.moveHandler({eventSource:p,pointerType:y.type,position:k(y.currentPos,p.element),buttons:z.buttons,isTouchEvent:y.type==="touch",originalEvent:f.originalEvent,userData:p.userData}):z.contacts===1?(p.moveHandler&&(G=z.asArray()[0],p.moveHandler({eventSource:p,pointerType:G.type,position:k(G.currentPos,p.element),buttons:z.buttons,isTouchEvent:G.type==="touch",originalEvent:f.originalEvent,userData:p.userData})),p.dragHandler&&!f.preventGesture&&!f.defaultPrevented&&(G=z.asArray()[0],ge=G.currentPos.minus(G.lastPos),p.dragHandler({eventSource:p,pointerType:G.type,position:k(G.currentPos,p.element),buttons:z.buttons,delta:ge,speed:G.speed,direction:G.direction,shift:f.originalEvent.shiftKey,isTouchEvent:G.type==="touch",originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0,w.sentDragEvent=!0)):z.contacts===2&&(p.moveHandler&&(ee=z.asArray(),p.moveHandler({eventSource:p,pointerType:ee[0].type,position:k(d(ee[0].currentPos,ee[1].currentPos),p.element),buttons:z.buttons,isTouchEvent:ee[0].type==="touch",originalEvent:f.originalEvent,userData:p.userData})),p.pinchHandler&&y.type==="touch"&&!f.preventGesture&&!f.defaultPrevented&&(ge=w.pinchGPoints[0].currentPos.distanceTo(w.pinchGPoints[1].currentPos),ge!==w.currentPinchDist&&(w.lastPinchDist=w.currentPinchDist,w.currentPinchDist=ge,w.lastPinchCenter=w.currentPinchCenter,w.currentPinchCenter=d(w.pinchGPoints[0].currentPos,w.pinchGPoints[1].currentPos),p.pinchHandler({eventSource:p,pointerType:"touch",gesturePoints:w.pinchGPoints,lastCenter:k(w.lastPinchCenter,p.element),center:k(w.currentPinchCenter,p.element),lastDistance:w.lastPinchDist,distance:w.currentPinchDist,shift:f.originalEvent.shiftKey,originalEvent:f.originalEvent,userData:p.userData}),f.preventDefault=!0)))}function de(p,f,y){var w=p.getActivePointersListByType(y.type),z;z=w.getById(y.id),z&&x(p,w,z)}function ye(p,f,y){p.stopHandler&&p.stopHandler({eventSource:p,pointerType:y,position:C(f,p.element),buttons:p.getActivePointersListByType(y).buttons,isTouchEvent:y==="touch",originalEvent:f,userData:p.userData})}}(r),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(i,n,s){var l=i.parentNode;typeof n=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=typeof n.attachToViewer>"u"?!0:n.attachToViewer,this.autoFade=typeof n.autoFade>"u"?!0:n.autoFade,this.element=i,this.anchor=n.anchor,this.container=s,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof n.top=="number"?n.top+"px":n.top,this.wrapper.style.left=typeof n.left=="number"?n.left+"px":n.left,this.wrapper.style.height=typeof n.height=="number"?n.height+"px":n.height,this.wrapper.style.width=typeof n.width=="number"?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):l.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?e.setElementOpacity(this.element,i,!0):e.setElementOpacity(this.wrapper,i,!0)}}}(r),function(e){e.ControlDock=function(n){var s=["topleft","topright","bottomright","bottomleft"],l,a;for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},n),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),a=0;a<s.length;a++)l=s[a],this.controls[l]=e.makeNeutralElement("div"),this.controls[l].style.position="absolute",l.match("left")&&(this.controls[l].style.left="0px"),l.match("right")&&(this.controls[l].style.right="0px"),l.match("top")&&(this.controls[l].style.top="0px"),l.match("bottom")&&(this.controls[l].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,s){n=e.getElement(n);var l=null;if(!(i(this,n)>=0)){switch(s.anchor){case e.ControlAnchor.TOP_RIGHT:l=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:l=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:l=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:l=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:l=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case e.ControlAnchor.NONE:l=this.container,n.style.margin="0px",n.style.padding="0px";break}this.controls.push(new e.Control(n,s,l)),n.style.display="inline-block"}},removeControl:function(n){n=e.getElement(n);var s=i(this,n);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var n;for(n=this.controls.length-1;n>=0;n--)if(this.controls[n].isVisible())return!0;return!1},setControlsEnabled:function(n){var s;for(s=this.controls.length-1;s>=0;s--)this.controls[s].setVisible(n);return this}};function i(n,s){var l=n.controls,a;for(a=l.length-1;a>=0;a--)if(l[a].element===s)return a;return-1}}(r),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(r),function(e){var i={},n=1;e.Viewer=function(u){var v=arguments,x=this,L;if(e.isPlainObject(u)||(u={id:v[0],xmlPath:v.length>1?v[1]:void 0,prefixUrl:v.length>2?v[2]:void 0,controls:v.length>3?v[3]:void 0,overlays:v.length>4?v[4]:void 0}),u.config&&(e.extend(!0,u,u.config),delete u.config),e.extend(!0,this,{id:u.id,hash:u.hash||n++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,u),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&e.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(H){var B=e.getString("Errors.OpenFailed",H.eventSource,H.message);x._showMessage(B)}),e.ControlDock.call(this,u),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(H){H.width="100%",H.height="100%",H.overflow="hidden",H.position="absolute",H.top="0px",H.left="0px"}(this.canvas.style),e.setElementTouchActionNone(this.canvas),u.tabIndex!==""&&(this.canvas.tabIndex=u.tabIndex===void 0?0:u.tabIndex),this.container.className="openseadragon-container",function(H){H.width="100%",H.height="100%",H.position="relative",H.overflow="hidden",H.left="0px",H.top="0px",H.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,C),keyDownHandler:e.delegate(this,k),keyHandler:e.delegate(this,d),clickHandler:e.delegate(this,_),dblClickHandler:e.delegate(this,S),dragHandler:e.delegate(this,M),dragEndHandler:e.delegate(this,I),enterHandler:e.delegate(this,V),leaveHandler:e.delegate(this,q),pressHandler:e.delegate(this,K),releaseHandler:e.delegate(this,j),nonPrimaryPressHandler:e.delegate(this,oe),nonPrimaryReleaseHandler:e.delegate(this,te),scrollHandler:e.delegate(this,he),pinchHandler:e.delegate(this,pe)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,_e),leaveHandler:e.delegate(this,le)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=s(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(H){x.source=x.world.getItemAt(0).source,i[x.hash].forceRedraw=!0,x._updateRequestId||(x._updateRequestId=c(x,ae))}),this.world.addHandler("remove-item",function(H){x.world.getItemCount()?x.source=x.world.getItemAt(0).source:x.source=null,i[x.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(H){x.viewport&&x.viewport._setContentBounds(x.world.getHomeBounds(),x.world.getContentFactor())}),this.world.addHandler("item-index-change",function(H){x.source=x.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:u.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(L=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(L,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(L=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(L,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),L=0;L<this.customControls.length;L++)this.addControl(this.customControls[L].id,{anchor:this.customControls[L].anchor});e.requestAnimationFrame(function(){g(x)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(u){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(u)},openTileSource:function(u){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(u)},open:function(u,v){var x=this;if(this.close(),!u)return this;if(this.sequenceMode&&e.isArray(u))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof v<"u"&&!isNaN(v)&&(this.initialPage=v),this.tileSources=u,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(u)||(u=[u]),!u.length)return this;this._opening=!0;for(var L=u.length,H=0,B=0,A,N=function(){if(H+B===L)if(H){(x._firstOpen||!x.preserveViewport)&&(x.viewport.goHome(!0),x.viewport.update()),x._firstOpen=!1;var W=u[0];if(W.tileSource&&(W=W.tileSource),x.overlays&&!x.preserveOverlays)for(var Q=0;Q<x.overlays.length;Q++)x.currentOverlays[Q]=a(x,x.overlays[Q]);x._drawOverlays(),x._opening=!1,x.raiseEvent("open",{source:W})}else x._opening=!1,x.raiseEvent("open-failed",A)},Y=function(W){(!e.isPlainObject(W)||!W.tileSource)&&(W={tileSource:W}),W.index!==void 0&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete W.index),W.collectionImmediately===void 0&&(W.collectionImmediately=!0);var Q=W.success;W.success=function(de){if(H++,W.tileSource.overlays)for(var ye=0;ye<W.tileSource.overlays.length;ye++)x.addOverlay(W.tileSource.overlays[ye]);Q&&Q(de),N()};var J=W.error;W.error=function(de){B++,A||(A=de),J&&J(de),N()},x.addTiledImage(W)},Z=0;Z<u.length;Z++)Y(u[Z]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(u){return this.innerTracker.setTracking(u),this.outerTracker.setTracking(u),this.raiseEvent("mouse-enabled",{enabled:u}),this},areControlsEnabled:function(){var u=this.controls.length,v;for(v=0;v<this.controls.length;v++)u=u&&this.controls[v].isVisible();return u},setControlsEnabled:function(u){return u?T(this):g(this),this.raiseEvent("controls-enabled",{enabled:u}),this},setDebugMode:function(u){for(var v=0;v<this.world.getItemCount();v++)this.world.getItemAt(v).debugMode=u;this.debugMode=u,this.forceRedraw()},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(u){var v=document.body,x=v.style,L=document.documentElement.style,H=this,B,A;if(u===this.isFullPage())return this;var N={fullPage:u,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",N),N.preventDefaultAction)return this;if(u){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=x.margin,this.docMargin=L.margin,x.margin="0",L.margin="0",this.bodyPadding=x.padding,this.docPadding=L.padding,x.padding="0",L.padding="0",this.bodyWidth=x.width,this.docWidth=L.width,x.width="100%",L.width="100%",this.bodyHeight=x.height,this.docHeight=L.height,x.height="100%",L.height="100%",this.bodyDisplay=x.display,x.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,B=v.childNodes.length,A=0;A<B;A++)this.previousBody.push(v.childNodes[0]),v.removeChild(v.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,v.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),v.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,e.delegate(this,_e)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,x.margin=this.bodyMargin,L.margin=this.docMargin,x.padding=this.bodyPadding,L.padding=this.docPadding,x.width=this.bodyWidth,L.width=this.docWidth,x.height=this.bodyHeight,L.height=this.docHeight,x.display=this.bodyDisplay,v.removeChild(this.element),B=this.previousBody.length,A=0;A<B;A++)v.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(v.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var Y=0,Z=function(){e.setPageScroll(H.pageScroll);var W=e.getPageScroll();Y++,Y<10&&(W.x!==H.pageScroll.x||W.y!==H.pageScroll.y)&&e.requestAnimationFrame(Z)};e.requestAnimationFrame(Z),i[this.hash].fullPage=!1,e.delegate(this,le)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:u}),this},setFullScreen:function(u){var v=this;if(!e.supportsFullScreen)return this.setFullPage(u);if(e.isFullScreen()===u)return this;var x={fullScreen:u,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",x),x.preventDefaultAction)return this;if(u){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var L=function(){var H=e.isFullScreen();H||(e.removeEvent(document,e.fullScreenEventName,L),e.removeEvent(document,e.fullScreenErrorEventName,L),v.setFullPage(!1),v.isFullPage()&&(v.element.style.width=v.fullPageStyleWidth,v.element.style.height=v.fullPageStyleHeight)),v.navigator&&v.viewport&&setTimeout(function(){v.navigator.update(v.viewport)}),v.raiseEvent("full-screen",{fullScreen:H})};e.addEvent(document,e.fullScreenEventName,L),e.addEvent(document,e.fullScreenErrorEventName,L),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},setVisible:function(u){return this.container.style.visibility=u?"":"hidden",this.raiseEvent("visible",{visible:u}),this},addTiledImage:function(u){e.console.assert(u,"[Viewer.addTiledImage] options is required"),e.console.assert(u.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!u.replace||u.index>-1&&u.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var v=this;u.replace&&(u.replaceItem=v.world.getItemAt(u.index)),this._hideMessage(),u.placeholderFillStyle===void 0&&(u.placeholderFillStyle=this.placeholderFillStyle),u.opacity===void 0&&(u.opacity=this.opacity),u.preload===void 0&&(u.preload=this.preload),u.compositeOperation===void 0&&(u.compositeOperation=this.compositeOperation),u.crossOriginPolicy===void 0&&(u.crossOriginPolicy=u.tileSource.crossOriginPolicy!==void 0?u.tileSource.crossOriginPolicy:this.crossOriginPolicy),u.ajaxWithCredentials===void 0&&(u.ajaxWithCredentials=this.ajaxWithCredentials),u.loadTilesWithAjax===void 0&&(u.loadTilesWithAjax=this.loadTilesWithAjax),u.ajaxHeaders===void 0||u.ajaxHeaders===null?u.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(u.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(u.ajaxHeaders=e.extend({},this.ajaxHeaders,u.ajaxHeaders));var x={options:u};function L(A){for(var N=0;N<v._loadQueue.length;N++)if(v._loadQueue[N]===x){v._loadQueue.splice(N,1);break}v._loadQueue.length===0&&H(x),v.raiseEvent("add-item-failed",A),u.error&&u.error(A)}function H(A){v.collectionMode&&(v.world.arrange({immediately:A.options.collectionImmediately,rows:v.collectionRows,columns:v.collectionColumns,layout:v.collectionLayout,tileSize:v.collectionTileSize,tileMargin:v.collectionTileMargin}),v.world.setAutoRefigureSizes(!0))}if(e.isArray(u.tileSource)){setTimeout(function(){L({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:u.tileSource,options:u})});return}this._loadQueue.push(x);function B(){for(var A,N,Y;v._loadQueue.length&&(A=v._loadQueue[0],!!A.tileSource);){if(v._loadQueue.splice(0,1),A.options.replace){var Z=v.world.getIndexOfItem(A.options.replaceItem);Z!==-1&&(A.options.index=Z),v.world.removeItem(A.options.replaceItem)}N=new e.TiledImage({viewer:v,source:A.tileSource,viewport:v.viewport,drawer:v.drawer,tileCache:v.tileCache,imageLoader:v.imageLoader,x:A.options.x,y:A.options.y,width:A.options.width,height:A.options.height,fitBounds:A.options.fitBounds,fitBoundsPlacement:A.options.fitBoundsPlacement,clip:A.options.clip,placeholderFillStyle:A.options.placeholderFillStyle,opacity:A.options.opacity,preload:A.options.preload,degrees:A.options.degrees,flipped:A.options.flipped,compositeOperation:A.options.compositeOperation,springStiffness:v.springStiffness,animationTime:v.animationTime,minZoomImageRatio:v.minZoomImageRatio,wrapHorizontal:v.wrapHorizontal,wrapVertical:v.wrapVertical,immediateRender:v.immediateRender,blendTime:v.blendTime,alwaysBlend:v.alwaysBlend,minPixelRatio:v.minPixelRatio,smoothTileEdgesMinZoom:v.smoothTileEdgesMinZoom,iOSDevice:v.iOSDevice,crossOriginPolicy:A.options.crossOriginPolicy,ajaxWithCredentials:A.options.ajaxWithCredentials,loadTilesWithAjax:A.options.loadTilesWithAjax,ajaxHeaders:A.options.ajaxHeaders,debugMode:v.debugMode}),v.collectionMode&&v.world.setAutoRefigureSizes(!1),v.navigator&&(Y=e.extend({},A.options,{replace:!1,originalTiledImage:N,tileSource:A.tileSource}),v.navigator.addTiledImage(Y)),v.world.addItem(N,{index:A.options.index}),v._loadQueue.length===0&&H(A),v.world.getItemCount()===1&&!v.preserveViewport&&v.viewport.goHome(!0),A.options.success&&A.options.success({item:N})}}l(this,u.tileSource,u,function(A){x.tileSource=A,B()},function(A){A.options=u,L(A),B()})},addSimpleImage:function(u){e.console.assert(u,"[Viewer.addSimpleImage] options is required"),e.console.assert(u.url,"[Viewer.addSimpleImage] options.url is required");var v=e.extend({},u,{tileSource:{type:"image",url:u.url}});delete v.url,this.addTiledImage(v)},addLayer:function(u){var v=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var x=e.extend({},u,{success:function(L){v.raiseEvent("add-layer",{options:u,drawer:L.item})},error:function(L){v.raiseEvent("add-layer-failed",L)}});return this.addTiledImage(x),this},getLayerAtLevel:function(u){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(u)},getLevelOfLayer:function(u){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(u)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(u,v){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(u,v)},removeLayer:function(u){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(u)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var u=e.delegate(this,b),v=e.delegate(this,P),x=e.delegate(this,this.goToNextPage),L=e.delegate(this,this.goToPreviousPage),H=this.navImages,B=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(B=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:$(this.prefixUrl,H.previous.REST),srcGroup:$(this.prefixUrl,H.previous.GROUP),srcHover:$(this.prefixUrl,H.previous.HOVER),srcDown:$(this.prefixUrl,H.previous.DOWN),onRelease:L,onFocus:u,onBlur:v}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:$(this.prefixUrl,H.next.REST),srcGroup:$(this.prefixUrl,H.next.GROUP),srcHover:$(this.prefixUrl,H.next.HOVER),srcDown:$(this.prefixUrl,H.next.DOWN),onRelease:x,onFocus:u,onBlur:v}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),B&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var u=e.delegate(this,De),v=e.delegate(this,Pt),x=e.delegate(this,We),L=e.delegate(this,Ue),H=e.delegate(this,dt),B=e.delegate(this,nt),A=e.delegate(this,vt),N=e.delegate(this,yt),Y=e.delegate(this,E),Z=e.delegate(this,R),W=e.delegate(this,b),Q=e.delegate(this,P),J=this.navImages,de=[],ye=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(ye=!1),this.showZoomControl&&(de.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:$(this.prefixUrl,J.zoomIn.REST),srcGroup:$(this.prefixUrl,J.zoomIn.GROUP),srcHover:$(this.prefixUrl,J.zoomIn.HOVER),srcDown:$(this.prefixUrl,J.zoomIn.DOWN),onPress:u,onRelease:v,onClick:x,onEnter:u,onExit:v,onFocus:W,onBlur:Q})),de.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:$(this.prefixUrl,J.zoomOut.REST),srcGroup:$(this.prefixUrl,J.zoomOut.GROUP),srcHover:$(this.prefixUrl,J.zoomOut.HOVER),srcDown:$(this.prefixUrl,J.zoomOut.DOWN),onPress:L,onRelease:v,onClick:H,onEnter:L,onExit:v,onFocus:W,onBlur:Q}))),this.showHomeControl&&de.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:$(this.prefixUrl,J.home.REST),srcGroup:$(this.prefixUrl,J.home.GROUP),srcHover:$(this.prefixUrl,J.home.HOVER),srcDown:$(this.prefixUrl,J.home.DOWN),onRelease:B,onFocus:W,onBlur:Q})),this.showFullPageControl&&de.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:$(this.prefixUrl,J.fullpage.REST),srcGroup:$(this.prefixUrl,J.fullpage.GROUP),srcHover:$(this.prefixUrl,J.fullpage.HOVER),srcDown:$(this.prefixUrl,J.fullpage.DOWN),onRelease:A,onFocus:W,onBlur:Q})),this.showRotationControl&&(de.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:$(this.prefixUrl,J.rotateleft.REST),srcGroup:$(this.prefixUrl,J.rotateleft.GROUP),srcHover:$(this.prefixUrl,J.rotateleft.HOVER),srcDown:$(this.prefixUrl,J.rotateleft.DOWN),onRelease:N,onFocus:W,onBlur:Q})),de.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:$(this.prefixUrl,J.rotateright.REST),srcGroup:$(this.prefixUrl,J.rotateright.GROUP),srcHover:$(this.prefixUrl,J.rotateright.HOVER),srcDown:$(this.prefixUrl,J.rotateright.DOWN),onRelease:Y,onFocus:W,onBlur:Q}))),this.showFlipControl&&de.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:$(this.prefixUrl,J.flip.REST),srcGroup:$(this.prefixUrl,J.flip.GROUP),srcHover:$(this.prefixUrl,J.flip.HOVER),srcDown:$(this.prefixUrl,J.flip.DOWN),onRelease:Z,onFocus:W,onBlur:Q})),ye?(this.buttonGroup=new e.ButtonGroup({buttons:de,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,St)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=de),this},currentPage:function(){return this._sequenceIndex},goToPage:function(u){return this.tileSources&&u>=0&&u<this.tileSources.length&&(this._sequenceIndex=u,this._updateSequenceButtons(u),this.open(this.tileSources[u]),this.referenceStrip&&this.referenceStrip.setFocus(u),this.raiseEvent("page",{page:u})),this},addOverlay:function(u,v,x,L){var H;if(e.isPlainObject(u)?H=u:H={element:u,location:v,placement:x,onDraw:L},u=e.getElement(H.element),o(this.currentOverlays,u)>=0)return this;var B=a(this,H);return this.currentOverlays.push(B),B.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:u,location:H.location,placement:H.placement}),this},updateOverlay:function(u,v,x){var L;return u=e.getElement(u),L=o(this.currentOverlays,u),L>=0&&(this.currentOverlays[L].update(v,x),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:u,location:v,placement:x})),this},removeOverlay:function(u){var v;return u=e.getElement(u),v=o(this.currentOverlays,u),v>=0&&(this.currentOverlays[v].destroy(),this.currentOverlays.splice(v,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:u})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(u){var v;return u=e.getElement(u),v=o(this.currentOverlays,u),v>=0?this.currentOverlays[v]:null},_updateSequenceButtons:function(u){this.nextButton&&(!this.tileSources||this.tileSources.length-1===u?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(u>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(u){this._hideMessage();var v=e.makeNeutralElement("div");v.appendChild(document.createTextNode(u)),this.messageDiv=e.makeCenteredNode(v),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var u=this.messageDiv;u&&(u.parentNode.removeChild(u),delete this.messageDiv)},gestureSettingsByDeviceType:function(u){switch(u){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var u,v=this.currentOverlays.length;for(u=0;u<v;u++)this.currentOverlays[u].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var u=e.pixelDensityRatio,v=e.getCurrentPixelDensityRatio();u!==v&&(e.pixelDensityRatio=v,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var u=this._sequenceIndex-1;this.navPrevNextWrap&&u<0&&(u+=this.tileSources.length),this.goToPage(u)},goToNextPage:function(){var u=this._sequenceIndex+1;this.navPrevNextWrap&&u>=this.tileSources.length&&(u=0),this.goToPage(u)}});function s(u){return u=e.getElement(u),new e.Point(u.clientWidth===0?1:u.clientWidth,u.clientHeight===0?1:u.clientHeight)}function l(u,v,x,L,H){var B=u;if(e.type(v)==="string"){if(v.match(/^\s*<.*>\s*$/))v=e.parseXml(v);else if(v.match(/^\s*[{[].*[}\]]\s*$/))try{var A=e.parseJSON(v);v=A}catch{}}function N(Y,Z){Y.ready?L(Y):(Y.addHandler("ready",function(){L(Y)}),Y.addHandler("open-failed",function(W){H({message:W.message,source:Z})}))}setTimeout(function(){if(e.type(v)==="string")v=new e.TileSource({url:v,crossOriginPolicy:x.crossOriginPolicy!==void 0?x.crossOriginPolicy:u.crossOriginPolicy,ajaxWithCredentials:u.ajaxWithCredentials,ajaxHeaders:x.ajaxHeaders?x.ajaxHeaders:u.ajaxHeaders,useCanvas:u.useCanvas,success:function(Q){L(Q.tileSource)}}),v.addHandler("open-failed",function(Q){H(Q)});else if(e.isPlainObject(v)||v.nodeType)if(v.crossOriginPolicy===void 0&&(x.crossOriginPolicy!==void 0||u.crossOriginPolicy!==void 0)&&(v.crossOriginPolicy=x.crossOriginPolicy!==void 0?x.crossOriginPolicy:u.crossOriginPolicy),v.ajaxWithCredentials===void 0&&(v.ajaxWithCredentials=u.ajaxWithCredentials),v.useCanvas===void 0&&(v.useCanvas=u.useCanvas),e.isFunction(v.getTileUrl)){var Y=new e.TileSource(v);Y.getTileUrl=v.getTileUrl,L(Y)}else{var Z=e.TileSource.determineType(B,v);if(!Z){H({message:"Unable to load TileSource",source:v});return}var W=Z.prototype.configure.apply(B,[v]);N(new Z(W),v)}else N(v,v)})}function a(u,v){if(v instanceof e.Overlay)return v;var x=null;if(v.element)x=e.getElement(v.element);else{var L=v.id?v.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);x=e.getElement(v.id),x||(x=document.createElement("a"),x.href="#/overlay/"+L),x.id=L,e.addClass(x,v.className?v.className:"openseadragon-overlay")}var H=v.location,B=v.width,A=v.height;if(!H){var N=v.x,Y=v.y;if(v.px!==void 0){var Z=u.viewport.imageToViewportRectangle(new e.Rect(v.px,v.py,B||0,A||0));N=Z.x,Y=Z.y,B=B!==void 0?Z.width:void 0,A=A!==void 0?Z.height:void 0}H=new e.Point(N,Y)}var W=v.placement;return W&&e.type(W)==="string"&&(W=e.Placement[v.placement.toUpperCase()]),new e.Overlay({element:x,location:H,placement:W,onDraw:v.onDraw,checkResize:v.checkResize,width:B,height:A,rotationMode:v.rotationMode})}function o(u,v){var x;for(x=u.length-1;x>=0;x--)if(u[x].element===v)return x;return-1}function c(u,v){return e.requestAnimationFrame(function(){v(u)})}function h(u){e.requestAnimationFrame(function(){m(u)})}function g(u){u.autoHideControls&&(u.controlsShouldFade=!0,u.controlsFadeBeginTime=e.now()+u.controlsFadeDelay,window.setTimeout(function(){h(u)},u.controlsFadeDelay))}function m(u){var v,x,L,H;if(u.controlsShouldFade){for(v=e.now(),x=v-u.controlsFadeBeginTime,L=1-x/u.controlsFadeLength,L=Math.min(1,L),L=Math.max(0,L),H=u.controls.length-1;H>=0;H--)u.controls[H].autoFade&&u.controls[H].setOpacity(L);L>0&&h(u)}}function T(u){var v;for(u.controlsShouldFade=!1,v=u.controls.length-1;v>=0;v--)u.controls[v].setOpacity(1)}function b(){T(this)}function P(){g(this)}function C(u){var v={tracker:u.eventSource,position:u.position,originalEvent:u.originalEvent,preventDefault:u.preventDefault};this.raiseEvent("canvas-contextmenu",v),u.preventDefault=v.preventDefault}function k(u){var v={originalEvent:u.originalEvent,preventDefaultAction:!1,preventVerticalPan:u.preventVerticalPan,preventHorizontalPan:u.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!u.ctrl&&!u.alt&&!u.meta)switch(u.keyCode){case 38:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 40:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 37:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 39:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;default:u.preventDefault=!1;break}else u.preventDefault=!1}function d(u){var v={originalEvent:u.originalEvent,preventDefaultAction:!1,preventVerticalPan:u.preventVerticalPan,preventHorizontalPan:u.preventHorizontalPan};if(this.raiseEvent("canvas-key",v),!v.preventDefaultAction&&!u.ctrl&&!u.alt&&!u.meta)switch(u.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 119:case 87:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 115:case 83:v.preventVerticalPan||(u.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 97:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 100:v.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),u.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),u.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),u.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:u.preventDefault=!1;break}else u.preventDefault=!1}function _(u){var v,x=document.activeElement===this.canvas;x||this.canvas.focus(),this.viewport.flipped&&(u.position.x=this.viewport.getContainerSize().x-u.position.x);var L={tracker:u.eventSource,position:u.position,quick:u.quick,shift:u.shift,originalEvent:u.originalEvent,originalTarget:u.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",L),!L.preventDefaultAction&&this.viewport&&u.quick&&(v=this.gestureSettingsByDeviceType(u.pointerType),v.clickToZoom&&(this.viewport.zoomBy(u.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(u.position,!0):null),this.viewport.applyConstraints()))}function S(u){var v,x={tracker:u.eventSource,position:u.position,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",x),!x.preventDefaultAction&&this.viewport&&(v=this.gestureSettingsByDeviceType(u.pointerType),v.dblClickToZoom&&(this.viewport.zoomBy(u.shift?1/this.zoomPerClick:this.zoomPerClick,v.zoomToRefPoint?this.viewport.pointFromPixel(u.position,!0):null),this.viewport.applyConstraints()))}function M(u){var v,x={tracker:u.eventSource,pointerType:u.pointerType,position:u.position,delta:u.delta,speed:u.speed,direction:u.direction,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",x),v=this.gestureSettingsByDeviceType(u.pointerType),v.dragToPan&&!x.preventDefaultAction&&this.viewport){if(this.panHorizontal||(u.delta.x=0),this.panVertical||(u.delta.y=0),this.viewport.flipped&&(u.delta.x=-u.delta.x),this.constrainDuringPan){var L=this.viewport.deltaPointsFromPixels(u.delta.negate());this.viewport.centerSpringX.target.value+=L.x,this.viewport.centerSpringY.target.value+=L.y;var H=this.viewport.getBounds(),B=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=L.x,this.viewport.centerSpringY.target.value-=L.y,H.x!==B.x&&(u.delta.x=0),H.y!==B.y&&(u.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(u.delta.negate()),v.flickEnabled&&!this.constrainDuringPan)}}function I(u){var v={tracker:u.eventSource,pointerType:u.pointerType,position:u.position,speed:u.speed,direction:u.direction,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",v),!v.preventDefaultAction&&this.viewport){var x=this.gestureSettingsByDeviceType(u.pointerType);if(x.flickEnabled&&u.speed>=x.flickMinSpeed){var L=0;this.panHorizontal&&(L=x.flickMomentum*u.speed*Math.cos(u.direction));var H=0;this.panVertical&&(H=x.flickMomentum*u.speed*Math.sin(u.direction));var B=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),A=this.viewport.pointFromPixel(new e.Point(B.x-L,B.y-H));this.viewport.panTo(A,!1)}this.viewport.applyConstraints()}}function V(u){this.raiseEvent("canvas-enter",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function q(u){this.raiseEvent("canvas-exit",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function K(u){this.raiseEvent("canvas-press",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElementReleased,originalEvent:u.originalEvent})}function j(u){this.raiseEvent("canvas-release",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElementReleased,originalEvent:u.originalEvent})}function oe(u){this.raiseEvent("canvas-nonprimary-press",{tracker:u.eventSource,position:u.position,pointerType:u.pointerType,button:u.button,buttons:u.buttons,originalEvent:u.originalEvent})}function te(u){this.raiseEvent("canvas-nonprimary-release",{tracker:u.eventSource,position:u.position,pointerType:u.pointerType,button:u.button,buttons:u.buttons,originalEvent:u.originalEvent})}function pe(u){var v,x,L,H,B={tracker:u.eventSource,pointerType:u.pointerType,gesturePoints:u.gesturePoints,lastCenter:u.lastCenter,center:u.center,lastDistance:u.lastDistance,distance:u.distance,shift:u.shift,originalEvent:u.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",B),this.viewport&&(v=this.gestureSettingsByDeviceType(u.pointerType),v.pinchToZoom&&(!B.preventDefaultPanAction||!B.preventDefaultZoomAction)&&(x=this.viewport.pointFromPixel(u.center,!0),B.preventDefaultZoomAction||this.viewport.zoomBy(u.distance/u.lastDistance,x,!0),v.zoomToRefPoint&&!B.preventDefaultPanAction&&(L=this.viewport.pointFromPixel(u.lastCenter,!0),H=L.minus(x),this.panHorizontal||(H.x=0),this.panVertical||(H.y=0),this.viewport.panBy(H,!0)),this.viewport.applyConstraints()),v.pinchRotate&&!B.preventDefaultRotateAction)){var A=Math.atan2(u.gesturePoints[0].currentPos.y-u.gesturePoints[1].currentPos.y,u.gesturePoints[0].currentPos.x-u.gesturePoints[1].currentPos.x),N=Math.atan2(u.gesturePoints[0].lastPos.y-u.gesturePoints[1].lastPos.y,u.gesturePoints[0].lastPos.x-u.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(A-N)*(180/Math.PI))}}function he(u){var v,x,L,H,B;H=e.now(),B=H-this._lastScrollTime,B>this.minScrollDeltaTime?(this._lastScrollTime=H,v={tracker:u.eventSource,position:u.position,scroll:u.scroll,shift:u.shift,originalEvent:u.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",v),!v.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(u.position.x=this.viewport.getContainerSize().x-u.position.x),x=this.gestureSettingsByDeviceType(u.pointerType),x.scrollToZoom&&(L=Math.pow(this.zoomPerScroll,u.scroll),this.viewport.zoomBy(L,x.zoomToRefPoint?this.viewport.pointFromPixel(u.position,!0):null),this.viewport.applyConstraints())),u.preventDefault=v.preventDefault):u.preventDefault=!0}function _e(u){i[this.hash].mouseInside=!0,T(this),this.raiseEvent("container-enter",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function le(u){u.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||g(this)),this.raiseEvent("container-exit",{tracker:u.eventSource,pointerType:u.pointerType,position:u.position,buttons:u.buttons,pointers:u.pointers,insideElementPressed:u.insideElementPressed,buttonDownAny:u.buttonDownAny,originalEvent:u.originalEvent})}function ae(u){ne(u),u.isOpen()?u._updateRequestId=c(u,ae):u._updateRequestId=!1}function ne(u){if(!(u._opening||!i[u.hash])){if(u.autoResize){var v=s(u.container),x=i[u.hash].prevContainerSize;if(!v.equals(x)){var L=u.viewport;if(u.preserveImageSizeOnResize){var H=x.x/v.x,B=L.getZoom()*H,A=L.getCenter();L.resize(v,!1),L.zoomTo(B,null,!0),L.panTo(A,!0)}else{var N=L.getBounds();L.resize(v,!0),L.fitBoundsWithConstraints(N,!0)}i[u.hash].prevContainerSize=v,i[u.hash].forceRedraw=!0}}var Y=u.viewport.update(),Z=u.world.update()||Y;Y&&u.raiseEvent("viewport-change"),u.referenceStrip&&(Z=u.referenceStrip.update(u.viewport)||Z),!i[u.hash].animating&&Z&&(u.raiseEvent("animation-start"),T(u)),(Z||i[u.hash].forceRedraw||u.world.needsDraw())&&(Te(u),u._drawOverlays(),u.navigator&&u.navigator.update(u.viewport),i[u.hash].forceRedraw=!1,Z&&u.raiseEvent("animation")),i[u.hash].animating&&!Z&&(u.raiseEvent("animation-finish"),i[u.hash].mouseInside||g(u)),i[u.hash].animating=Z}}function Te(u){u.imageLoader.clear(),u.drawer.clear(),u.world.draw(),u.raiseEvent("update-viewport",{})}function $(u,v){return u?u+v:v}function De(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,mt(this)}function Ue(){i[this.hash].lastZoomTime=e.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,mt(this)}function Pt(){i[this.hash].zooming=!1}function mt(u){e.requestAnimationFrame(e.delegate(u,Nt))}function Nt(){var u,v,x;i[this.hash].zooming&&this.viewport&&(u=e.now(),v=u-i[this.hash].lastZoomTime,x=Math.pow(i[this.hash].zoomFactor,v/1e3),this.viewport.zoomBy(x),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=u,mt(this))}function We(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function dt(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function St(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function nt(){this.viewport&&this.viewport.goHome()}function vt(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function yt(){if(this.viewport){var u=this.viewport.getRotation();this.viewport.flipped?u=e.positiveModulo(u+this.rotationIncrement,360):u=e.positiveModulo(u-this.rotationIncrement,360),this.viewport.setRotation(u)}}function E(){if(this.viewport){var u=this.viewport.getRotation();this.viewport.flipped?u=e.positiveModulo(u-this.rotationIncrement,360):u=e.positiveModulo(u+this.rotationIncrement,360),this.viewport.setRotation(u)}}function R(){this.viewport.toggleFlip()}}(r),function(e){e.Navigator=function(c){var h=c.viewer,g=this,m,T;c.id?(this.element=document.getElementById(c.id),c.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(c.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),c.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:c.autoFade},c.position&&(c.position==="BOTTOM_RIGHT"?c.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:c.position==="BOTTOM_LEFT"?c.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:c.position==="TOP_RIGHT"?c.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:c.position==="TOP_LEFT"?c.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:c.position==="ABSOLUTE"&&(c.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,c.controlOptions.top=c.top,c.controlOptions.left=c.left,c.controlOptions.height=c.height,c.controlOptions.width=c.width))),this.element.id=c.id,this.element.className+=" navigator",c=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},c,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:c.autoResize,minZoomImageRatio:1,background:c.background,opacity:c.opacity,borderColor:c.borderColor,displayRegionColor:c.displayRegionColor}),c.minPixelRatio=this.minPixelRatio=h.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),c.controlOptions.anchor!==e.ControlAnchor.NONE&&function(C,k){C.margin="0px",C.border=k+"px solid "+c.borderColor,C.padding="0px",C.background=c.background,C.opacity=c.opacity,C.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(C,k){C.position="relative",C.top="0px",C.left="0px",C.fontSize="0px",C.overflow="hidden",C.border=k+"px solid "+c.displayRegionColor,C.margin="0px",C.padding="0px",C.background="transparent",C.float="left",C.cssFloat="left",C.styleFloat="left",C.zIndex=999999999,C.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),h.addControl(this.element,c.controlOptions),this._resizeWithViewer=c.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&c.controlOptions.anchor!==e.ControlAnchor.NONE,c.width&&c.height?(this.setWidth(c.width),this.setHeight(c.height)):this._resizeWithViewer&&(m=e.getElementSize(h.element),this.element.style.height=Math.round(m.y*c.sizeRatio)+"px",this.element.style.width=Math.round(m.x*c.sizeRatio)+"px",this.oldViewerSize=m,T=e.getElementSize(this.element),this.elementArea=T.x*T.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[c]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function b(C){a(g.displayRegionContainer,C),a(g.displayRegion,-C),g.viewport.setRotation(C)}if(c.navigatorRotate){var P=c.viewer.viewport?c.viewer.viewport.getRotation():c.viewer.degrees||0;b(P),c.viewer.addHandler("rotate",function(C){b(C.degrees)})}this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,n),clickHandler:e.delegate(this,i),releaseHandler:e.delegate(this,s),scrollHandler:e.delegate(this,l),preProcessEventHandler:function(C){C.eventType==="wheel"&&(C.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){g.viewport&&g.viewport.goHome(!0)}),h.world.addHandler("item-index-change",function(C){window.setTimeout(function(){var k=g.world.getItemAt(C.previousIndex);g.world.setItemIndex(k,C.newIndex)},1)}),h.world.addHandler("remove-item",function(C){var k=C.item,d=g._getMatchingItem(k);d&&g.world.removeItem(d)}),this.update(h.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var c=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);c.equals(this.oldContainerSize)||(this.viewport.resize(c,!0),this.viewport.goHome(!0),this.oldContainerSize=c,this.drawer.clear(),this.world.draw())}},setWidth:function(c){this.width=c,this.element.style.width=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1},setHeight:function(c){this.height=c,this.element.style.height=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1},setFlip:function(c){return this.viewport.setFlip(c),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(c){o(this.displayRegion,c),o(this.canvas,c),o(this.element,c)},update:function(c){var h,g,m,T,b,P;if(h=e.getElementSize(this.viewer.element),this._resizeWithViewer&&h.x&&h.y&&!h.equals(this.oldViewerSize)&&(this.oldViewerSize=h,this.maintainSizeRatio||!this.elementArea?(g=h.x*this.sizeRatio,m=h.y*this.sizeRatio):(g=Math.sqrt(this.elementArea*(h.x/h.y)),m=this.elementArea/g),this.element.style.width=Math.round(g)+"px",this.element.style.height=Math.round(m)+"px",this.elementArea||(this.elementArea=g*m),this.updateSize()),c&&this.viewport){T=c.getBoundsNoRotate(!0),b=this.viewport.pixelFromPointNoRotate(T.getTopLeft(),!1),P=this.viewport.pixelFromPointNoRotate(T.getBottomRight(),!1).minus(this.totalBorderWidths);var C=this.displayRegion.style;C.display=this.world.getItemCount()?"block":"none",C.top=Math.round(b.y)+"px",C.left=Math.round(b.x)+"px";var k=Math.abs(b.x-P.x),d=Math.abs(b.y-P.y);C.width=Math.round(Math.max(k,0))+"px",C.height=Math.round(Math.max(d,0))+"px"}},addTiledImage:function(c){var h=this,g=c.originalTiledImage;delete c.original;var m=e.extend({},c,{success:function(T){var b=T.item;b._originalForNavigator=g,h._matchBounds(b,g,!0),h._matchOpacity(b,g),h._matchCompositeOperation(b,g);function P(){h._matchBounds(b,g)}function C(){h._matchOpacity(b,g)}function k(){h._matchCompositeOperation(b,g)}g.addHandler("bounds-change",P),g.addHandler("clip-change",P),g.addHandler("opacity-change",C),g.addHandler("composite-operation-change",k)}});return e.Viewer.prototype.addTiledImage.apply(this,[m])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(c){for(var h=this.world.getItemCount(),g,m=0;m<h;m++)if(g=this.world.getItemAt(m),g._originalForNavigator===c)return g;return null},_matchBounds:function(c,h,g){var m=h.getBoundsNoRotate();c.setPosition(m.getTopLeft(),g),c.setWidth(m.width,g),c.setRotation(h.getRotation(),g),c.setClip(h.getClip()),c.setFlip(h.getFlip())},_matchOpacity:function(c,h){c.setOpacity(h.opacity)},_matchCompositeOperation:function(c,h){c.setCompositeOperation(h.compositeOperation)}});function i(c){var h={tracker:c.eventSource,position:c.position,quick:c.quick,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",h),!h.preventDefaultAction&&c.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x);var g=this.viewport.pointFromPixel(c.position);this.panVertical?this.panHorizontal||(g.x=this.viewer.viewport.getCenter(!0).x):g.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(g),this.viewer.viewport.applyConstraints()}}function n(c){var h={tracker:c.eventSource,position:c.position,delta:c.delta,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",h),!h.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(c.delta.x=0),this.panVertical||(c.delta.y=0),this.viewer.viewport.flipped&&(c.delta.x=-c.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(c.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(c){c.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function l(c){var h={tracker:c.eventSource,position:c.position,scroll:c.scroll,shift:c.shift,originalEvent:c.originalEvent,preventDefault:c.preventDefault};this.viewer.raiseEvent("navigator-scroll",h),c.preventDefault=h.preventDefault}function a(c,h){o(c,"rotate("+h+"deg)")}function o(c,h){c.style.webkitTransform=h,c.style.mozTransform=h,c.style.msTransform=h,c.style.oTransform=h,c.style.transform=h}}(r),function(e){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var s=n.split("."),l=null,a=arguments,o=i,c;for(c=0;c<s.length-1;c++)o=o[s[c]]||{};return l=o[s[c]],typeof l!="string"&&(e.console.log("Untranslated source string:",n),l=""),l.replace(/\{\d+\}/g,function(h){var g=parseInt(h.match(/\d+/),10)+1;return g<a.length?a[g]:""})},setString:function(n,s){var l=n.split("."),a=i,o;for(o=0;o<l.length-1;o++)a[l[o]]||(a[l[o]]={}),a=a[l[o]];a[l[o]]=s}})}(r),function(e){e.Point=function(i,n){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(i){return new e.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new e.Point(this.x-i.x,this.y-i.y)},times:function(i){return new e.Point(this.x*i,this.y*i)},divide:function(i){return new e.Point(this.x/i,this.y/i)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new e.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof e.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,n){n=n||new e.Point(0,0);var s,l;if(i%90===0){var a=e.positiveModulo(i,360);switch(a){case 0:s=1,l=0;break;case 90:s=0,l=1;break;case 180:s=-1,l=0;break;case 270:s=0,l=-1;break}}else{var o=i*Math.PI/180;s=Math.cos(o),l=Math.sin(o)}var c=s*(this.x-n.x)-l*(this.y-n.y)+n.x,h=l*(this.x-n.x)+s*(this.y-n.y)+n.y;return new e.Point(c,h)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(r),function(e){e.TileSource=function(n,s,l,a,o,c){var h=this,g=arguments,m,T;if(e.isPlainObject(n)?m=n:m={width:g[0],height:g[1],tileSize:g[2],tileOverlap:g[3],minLevel:g[4],maxLevel:g[5]},e.EventSource.call(this),e.extend(!0,this,m),!this.success){for(T=0;T<arguments.length;T++)if(e.isFunction(arguments[T])){this.success=arguments[T];break}}this.success&&this.addHandler("ready",function(b){h.success(b)}),e.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=m.width&&m.height?m.width/m.height:1,this.dimensions=new e.Point(m.width,m.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=m.tileOverlap?m.tileOverlap:0,this.minLevel=m.minLevel?m.minLevel:0,this.maxLevel=m.maxLevel!==void 0&&m.maxLevel!==null?m.maxLevel:m.width&&m.height?Math.ceil(Math.log(Math.max(m.width,m.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(n){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(n){return this._tileWidth?this._tileWidth:this.getTileSize(n)},getTileHeight:function(n){return this._tileHeight?this._tileHeight:this.getTileSize(n)},setMaxLevel:function(n){this.maxLevel=n,this._memoizeLevelScale()},getLevelScale:function(n){return this._memoizeLevelScale(),this.getLevelScale(n)},_memoizeLevelScale:function(){var n={},s;for(s=0;s<=this.maxLevel;s++)n[s]=1/Math.pow(2,this.maxLevel-s);this.getLevelScale=function(l){return n[l]}},getNumTiles:function(n){var s=this.getLevelScale(n),l=Math.ceil(s*this.dimensions.x/this.getTileWidth(n)),a=Math.ceil(s*this.dimensions.y/this.getTileHeight(n));return new e.Point(l,a)},getPixelRatio:function(n){var s=this.dimensions.times(this.getLevelScale(n)),l=1/s.x*e.pixelDensityRatio,a=1/s.y*e.pixelDensityRatio;return new e.Point(l,a)},getClosestLevel:function(){var n,s;for(n=this.minLevel+1;n<=this.maxLevel&&(s=this.getNumTiles(n),!(s.x>1||s.y>1));n++);return n-1},getTileAtPoint:function(n,s){var l=s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/this.aspectRatio;e.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point.");var a=this.dimensions.x*this.getLevelScale(n),o=s.x*a,c=s.y*a,h=Math.floor(o/this.getTileWidth(n)),g=Math.floor(c/this.getTileHeight(n));s.x>=1&&(h=this.getNumTiles(n).x-1);var m=1e-15;return s.y>=1/this.aspectRatio-m&&(g=this.getNumTiles(n).y-1),new e.Point(h,g)},getTileBounds:function(n,s,l,a){var o=this.dimensions.times(this.getLevelScale(n)),c=this.getTileWidth(n),h=this.getTileHeight(n),g=s===0?0:c*s-this.tileOverlap,m=l===0?0:h*l-this.tileOverlap,T=c+(s===0?1:2)*this.tileOverlap,b=h+(l===0?1:2)*this.tileOverlap,P=1/o.x;return T=Math.min(T,o.x-g),b=Math.min(b,o.y-m),a?new e.Rect(0,0,T,b):new e.Rect(g*P,m*P,T*P,b*P)},getImageInfo:function(n){var s=this,l,a,o,c,h,g,m;n&&(h=n.split("/"),g=h[h.length-1],m=g.lastIndexOf("."),m>-1&&(h[h.length-1]=g.slice(0,m))),a=function(T){typeof T=="string"&&(T=e.parseXml(T));var b=e.TileSource.determineType(s,T,n);if(!b){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n});return}c=b.prototype.configure.apply(s,[T,n]),c.ajaxWithCredentials===void 0&&(c.ajaxWithCredentials=s.ajaxWithCredentials),o=new b(c),s.ready=!0,s.raiseEvent("ready",{tileSource:o})},n.match(/\.js$/)?(l=n.split("/").pop().replace(".js",""),e.jsonp({url:n,async:!1,callbackName:l,callback:a})):e.makeAjaxRequest({url:n,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(T){var b=i(T);a(b)},error:function(T,b){var P;try{P="HTTP "+T.status+" attempting to load TileSource"}catch{var C;typeof b>"u"||!b.toString?C="Unknown error":C=b.toString(),P=C+" attempting to load TileSource"}s.raiseEvent("open-failed",{message:P,source:n})}})},supports:function(n,s){return!1},configure:function(n,s){throw new Error("Method not implemented.")},getTileUrl:function(n,s,l){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(n,s,l){return{}},tileExists:function(n,s,l){var a=this.getNumTiles(n);return n>=this.minLevel&&n<=this.maxLevel&&s>=0&&l>=0&&s<a.x&&l<a.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function i(n){var s=n.responseText,l=n.status,a,o;if(n){if(n.status!==200&&n.status!==0)throw l=n.status,a=l===404?"Not Found":n.statusText,new Error(e.getString("Errors.Status",l,a))}else throw new Error(e.getString("Errors.Security"));if(s.match(/\s*<.*/))try{o=n.responseXML&&n.responseXML.documentElement?n.responseXML:e.parseXml(s)}catch{o=n.responseText}else if(s.match(/\s*[{[].*/))try{o=e.parseJSON(s)}catch{o=s}else o=s;return o}e.TileSource.determineType=function(n,s,l){var a;for(a in r)if(a.match(/.+TileSource$/)&&e.isFunction(r[a])&&e.isFunction(r[a].prototype.supports)&&r[a].prototype.supports.call(n,s,l))return r[a];return e.console.error("No TileSource was able to open %s %s",l,s),null}}(r),function(e){e.DziTileSource=function(s,l,a,o,c,h,g,m,T){var b,P,C,k;if(e.isPlainObject(s)?k=s:k={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=k.tilesUrl,this.fileFormat=k.fileFormat,this.displayRects=k.displayRects,this.displayRects)for(b=this.displayRects.length-1;b>=0;b--)for(P=this.displayRects[b],C=P.minLevel;C<=P.maxLevel;C++)this._levelRects[C]||(this._levelRects[C]=[]),this._levelRects[C].push(P);e.TileSource.apply(this,[k])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(s,l){var a;return s.Image?a=s.Image.xmlns:s.documentElement&&(s.documentElement.localName==="Image"||s.documentElement.tagName==="Image")&&(a=s.documentElement.namespaceURI),a=(a||"").toLowerCase(),a.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||a.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,l){var a;return e.isPlainObject(s)?a=n(this,s):a=i(this,s),l&&!a.tilesUrl&&(a.tilesUrl=l.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),l.search(/\.(dzi|xml|js)\?/)!==-1?a.queryParams=l.match(/\?.*/):a.queryParams=""),a},getTileUrl:function(s,l,a){return[this.tilesUrl,s,"/",l,"_",a,".",this.fileFormat,this.queryParams].join("")},tileExists:function(s,l,a){var o=this._levelRects[s],c,h,g,m,T,b,P;if(this.minLevel&&s<this.minLevel||this.maxLevel&&s>this.maxLevel)return!1;if(!o||!o.length)return!0;for(P=o.length-1;P>=0;P--)if(c=o[P],!(s<c.minLevel||s>c.maxLevel)&&(h=this.getLevelScale(s),g=c.x*h,m=c.y*h,T=g+c.width*h,b=m+c.height*h,g=Math.floor(g/this._tileWidth),m=Math.floor(m/this._tileWidth),T=Math.ceil(T/this._tileWidth),b=Math.ceil(b/this._tileWidth),g<=l&&l<T&&m<=a&&a<b))return!0;return!1}});function i(s,l){if(!l||!l.documentElement)throw new Error(e.getString("Errors.Xml"));var a=l.documentElement,o=a.localName||a.tagName,c=l.documentElement.namespaceURI,h=null,g=[],m,T,b,P,C;if(o==="Image")try{if(P=a.getElementsByTagName("Size")[0],P===void 0&&(P=a.getElementsByTagNameNS(c,"Size")[0]),h={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(P.getAttribute("Height"),10),Width:parseInt(P.getAttribute("Width"),10)}}},!e.imageFormatSupported(h.Image.Format))throw new Error(e.getString("Errors.ImageFormat",h.Image.Format.toUpperCase()));for(m=a.getElementsByTagName("DisplayRect"),m===void 0&&(m=a.getElementsByTagNameNS(c,"DisplayRect")[0]),C=0;C<m.length;C++)T=m[C],b=T.getElementsByTagName("Rect")[0],b===void 0&&(b=T.getElementsByTagNameNS(c,"Rect")[0]),g.push({Rect:{X:parseInt(b.getAttribute("X"),10),Y:parseInt(b.getAttribute("Y"),10),Width:parseInt(b.getAttribute("Width"),10),Height:parseInt(b.getAttribute("Height"),10),MinLevel:parseInt(T.getAttribute("MinLevel"),10),MaxLevel:parseInt(T.getAttribute("MaxLevel"),10)}});return g.length&&(h.Image.DisplayRect=g),n(s,h)}catch(_){throw _ instanceof Error?_:new Error(e.getString("Errors.Dzi"))}else{if(o==="Collection")throw new Error(e.getString("Errors.Dzc"));if(o==="Error"){var k=a.getElementsByTagName("Message")[0],d=k.firstChild.nodeValue;throw new Error(d)}}throw new Error(e.getString("Errors.Dzi"))}function n(s,l){var a=l.Image,o=a.Url,c=a.Format,h=a.Size,g=a.DisplayRect||[],m=parseInt(h.Width,10),T=parseInt(h.Height,10),b=parseInt(a.TileSize,10),P=parseInt(a.Overlap,10),C=[],k,d;for(d=0;d<g.length;d++)k=g[d].Rect,C.push(new e.DisplayRect(parseInt(k.X,10),parseInt(k.Y,10),parseInt(k.Width,10),parseInt(k.Height,10),parseInt(k.MinLevel,10),parseInt(k.MaxLevel,10)));return e.extend(!0,{width:m,height:T,tileSize:b,tileOverlap:P,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:c,displayRects:C},l)}}(r),function(e){e.IIIFTileSource=function(a){if(e.extend(!0,this,a),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(a.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=a.version,this.tile_width&&this.tile_height)a.tileWidth=this.tile_width,a.tileHeight=this.tile_height;else if(this.tile_width)a.tileSize=this.tile_width;else if(this.tile_height)a.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)a.tileWidth=this.tiles[0].width,a.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var o=0;o<this.tiles.length;o++)for(var c=0;c<this.tiles[o].scaleFactors.length;c++){var h=this.tiles[o].scaleFactors[c];this.scale_factors.push(h),a.tileSizePerScaleFactor[h]={width:this.tiles[o].width,height:this.tiles[o].height||this.tiles[o].width}}}else if(i(a)){for(var g=Math.min(this.height,this.width),m=[256,512,1024],T=[],b=0;b<m.length;b++)m[b]<=g&&T.push(m[b]);T.length>0?a.tileSize=Math.max.apply(null,T):a.tileSize=g}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,a.levels=n(this),e.extend(!0,a,{width:a.levels[a.levels.length-1].width,height:a.levels[a.levels.length-1].height,tileSize:Math.max(a.height,a.width),tileOverlap:0,minLevel:0,maxLevel:a.levels.length-1}),this.levels=a.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!a.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)a.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var P=Math.max.apply(null,this.scale_factors);a.maxLevel=Math.round(Math.log(P)*Math.LOG2E)}e.TileSource.apply(this,[a])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(a,o){return a.protocol&&a.protocol==="http://iiif.io/api/image"||a["@context"]&&(a["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||a["@context"]==="http://iiif.io/api/image/1/context.json")||a.profile&&a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||a.identifier&&a.width&&a.height?!0:!!(a.documentElement&&a.documentElement.tagName==="info"&&a.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(a,o){if(e.isPlainObject(a)){if(!a["@context"])a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=o.replace("/info.json",""),a.version=1;else{var h=a["@context"];if(Array.isArray(h)){for(var g=0;g<h.length;g++)if(typeof h[g]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(h[g])||h[g]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){h=h[g];break}}switch(h){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":a.version=1;break;case"http://iiif.io/api/image/2/context.json":a.version=2;break;case"http://iiif.io/api/image/3/context.json":a.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!a["@id"]&&a.id&&(a["@id"]=a.id),a.preferredFormats){for(var m=0;m<a.preferredFormats.length;m++)if(r.imageFormatSupported(a.preferredFormats[m])){a.tileFormat=a.preferredFormats[m];break}}return a}else{var c=s(a);return c["@context"]="http://iiif.io/api/image/1.0/context.json",c["@id"]=o.replace("/info.xml",""),c.version=1,c}},getTileWidth:function(a){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,a);var o=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[o]?this.tileSizePerScaleFactor[o].width:this._tileWidth},getTileHeight:function(a){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,a);var o=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[o]?this.tileSizePerScaleFactor[o].height:this._tileHeight},getLevelScale:function(a){if(this.emulateLegacyImagePyramid){var o=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(o=this.levels[a].width/this.levels[this.maxLevel].width),o}return e.TileSource.prototype.getLevelScale.call(this,a)},getNumTiles:function(a){if(this.emulateLegacyImagePyramid){var o=this.getLevelScale(a);return o?new e.Point(1,1):new e.Point(0,0)}return e.TileSource.prototype.getNumTiles.call(this,a)},getTileAtPoint:function(a,o){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,a,o)},getTileUrl:function(a,o,c){if(this.emulateLegacyImagePyramid){var h=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(h=this.levels[a].url),h}var g="0",m=Math.pow(.5,this.maxLevel-a),T=Math.ceil(this.width*m),b=Math.ceil(this.height*m),P,C,k,d,_,S,M,I,V,q,K,j,oe,te;return P=this.getTileWidth(a),C=this.getTileHeight(a),k=Math.ceil(P/m),d=Math.ceil(C/m),this.version===1?oe="native."+this.tileFormat:oe="default."+this.tileFormat,T<P&&b<C?(this.version===2&&T===this.width?q="full":this.version===3&&T===this.width&&b===this.height?q="max":this.version===3?q=T+","+b:q=T+",",_="full"):(S=o*k,M=c*d,I=Math.min(k,this.width-S),V=Math.min(d,this.height-M),o===0&&c===0&&I===this.width&&V===this.height?_="full":_=[S,M,I,V].join(","),K=Math.ceil(I*m),j=Math.ceil(V*m),this.version===2&&K===this.width?q="full":this.version===3&&K===this.width&&j===this.height?q="max":this.version===3?q=K+","+j:q=K+","),te=[this["@id"],_,q,g,oe].join("/"),te},__testonly__:{canBeTiled:i,constructLevels:n}});function i(a){var o=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],c=Array.isArray(a.profile)?a.profile[0]:a.profile,h=o.indexOf(c)!==-1,g=!1;return a.version===2&&a.profile.length>1&&a.profile[1].supports&&(g=a.profile[1].supports.indexOf("sizeByW")!==-1),a.version===3&&a.extraFeatures&&(g=a.extraFeatures.indexOf("sizeByWh")!==-1),!h||g}function n(a){for(var o=[],c=0;c<a.sizes.length;c++)o.push({url:a["@id"]+"/full/"+a.sizes[c].width+","+(a.version===3?a.sizes[c].height:"")+"/0/default."+a.tileFormat,width:a.sizes[c].width,height:a.sizes[c].height});return o.sort(function(h,g){return h.width-g.width})}function s(a){if(!a||!a.documentElement)throw new Error(e.getString("Errors.Xml"));var o=a.documentElement,c=o.tagName,h=null;if(c==="info")try{return h={},l(o,h),h}catch(g){throw g instanceof Error?g:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function l(a,o,c){var h,g;if(a.nodeType===3&&c)g=a.nodeValue.trim(),g.match(/^\d*$/)&&(g=Number(g)),o[c]?(e.isArray(o[c])||(o[c]=[o[c]]),o[c].push(g)):o[c]=g;else if(a.nodeType===1)for(h=0;h<a.childNodes.length;h++)l(a.childNodes[h],o,a.nodeName)}}(r),function(e){e.OsmTileSource=function(i,n,s,l,a){var o;e.isPlainObject(i)?o=i:o={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!o.width||!o.height)&&(o.width=65572864,o.height=65572864),o.tileSize||(o.tileSize=256,o.tileOverlap=0),o.tilesUrl||(o.tilesUrl="http://tile.openstreetmap.org/"),o.minLevel=8,e.TileSource.apply(this,[o])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="openstreetmaps"},configure:function(i,n){return i},getTileUrl:function(i,n,s){return this.tilesUrl+(i-8)+"/"+n+"/"+s+".png"}})}(r),function(e){e.TmsTileSource=function(i,n,s,l,a){var o;e.isPlainObject(i)?o=i:o={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var c=Math.ceil(o.width/256)*256,h=Math.ceil(o.height/256)*256,g;c>h?g=c/256:g=h/256,o.maxLevel=Math.ceil(Math.log(g)/Math.log(2))-1,o.tileSize=256,o.width=c,o.height=h,e.TileSource.apply(this,[o])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="tiledmapservice"},configure:function(i,n){return i},getTileUrl:function(i,n,s){var l=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+n+"/"+(l-s)+".png"}})}(r),function(e){e.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var n={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(n.x,10)>i.tileSize||parseInt(n.y,10)>i.tileSize;)n.x=Math.floor(n.x/2),n.y=Math.floor(n.y/2),i.imageSizes.push({x:n.x,y:n.y}),i.gridSize.push(this._getGridSize(n.x,n.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,r.TileSource.apply(this,[i])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(i,n,s){return{x:Math.ceil(i/s),y:Math.ceil(n/s)}},_calculateAbsoluteTileNumber:function(i,n,s){for(var l=0,a={},o=0;o<i;o++)a=this.gridSize[o],l+=a.x*a.y;return a=this.gridSize[i],l+=a.x*s+n,l},supports:function(i,n){return i.type&&i.type==="zoomifytileservice"},configure:function(i,n){return i},getTileUrl:function(i,n,s){var l=0,a=this._calculateAbsoluteTileNumber(i,n,s);return l=Math.floor(a/256),this.tilesUrl+"TileGroup"+l+"/"+i+"-"+n+"-"+s+"."+this.fileFormat}})}(r),function(e){e.LegacyTileSource=function(l){var a,o,c;e.isArray(l)&&(a={type:"legacy-image-pyramid",levels:l}),a.levels=i(a.levels),a.levels.length>0?(o=a.levels[a.levels.length-1].width,c=a.levels[a.levels.length-1].height):(o=0,c=0,e.console.error("No supported image formats found")),e.extend(!0,a,{width:o,height:c,tileSize:Math.max(c,o),tileOverlap:0,minLevel:0,maxLevel:a.levels.length>0?a.levels.length-1:0}),e.TileSource.apply(this,[a]),this.levels=a.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(l,a){return l.type&&l.type==="legacy-image-pyramid"||l.documentElement&&l.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(l,a){var o;return e.isPlainObject(l)?o=s(this,l):o=n(this,l),o},getLevelScale:function(l){var a=NaN;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(a=this.levels[l].width/this.levels[this.maxLevel].width),a},getNumTiles:function(l){var a=this.getLevelScale(l);return a?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(l,a,o){var c=null;return this.levels.length>0&&l>=this.minLevel&&l<=this.maxLevel&&(c=this.levels[l].url),c}});function i(l){var a=[],o,c;for(c=0;c<l.length;c++)o=l[c],o.height&&o.width&&o.url?a.push({url:o.url,width:Number(o.width),height:Number(o.height)}):e.console.error("Unsupported image format: %s",o.url?o.url:"<no URL>");return a.sort(function(h,g){return h.height-g.height})}function n(l,a){if(!a||!a.documentElement)throw new Error(e.getString("Errors.Xml"));var o=a.documentElement,c=o.tagName,h=null,g=[],m,T;if(c==="image")try{for(h={type:o.getAttribute("type"),levels:[]},g=o.getElementsByTagName("level"),T=0;T<g.length;T++)m=g[T],h.levels.push({url:m.getAttribute("url"),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10)});return s(l,h)}catch(b){throw b instanceof Error?b:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(c==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(c==="error")throw new Error("Error: "+a)}throw new Error("Unknown element "+c)}function s(l,a){return a.levels}}(r),function(e){e.ImageTileSource=function(i){i=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),e.TileSource.apply(this,[i])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(i,n){return i.type&&i.type==="image"},configure:function(i,n){return i},getImageInfo:function(i){var n=this._image=new Image,s=this;this.crossOriginPolicy&&(n.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(n.useCredentials=this.ajaxWithCredentials),e.addEvent(n,"load",function(){s.width=n.naturalWidth,s.height=n.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new e.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),e.addEvent(n,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),n.src=i},getLevelScale:function(i){var n=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(n=this.levels[i].width/this.levels[this.maxLevel].width),n},getNumTiles:function(i){var n=this.getLevelScale(i);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(i,n,s){var l=null;return i>=this.minLevel&&i<=this.maxLevel&&(l=this.levels[i].url),l},getContext2D:function(i,n,s){var l=null;return i>=this.minLevel&&i<=this.maxLevel&&(l=this.levels[i].context2D),l},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,i;var n=this._image.naturalWidth,s=this._image.naturalHeight,l=document.createElement("canvas"),a=l.getContext("2d");if(l.width=n,l.height=s,a.drawImage(this._image,0,0,n,s),i[0].context2D=a,delete this._image,e.isCanvasTainted(l))return i;for(;n>=2&&s>=2;){n=Math.floor(n/2),s=Math.floor(s/2);var o=document.createElement("canvas"),c=o.getContext("2d");o.width=n,o.height=s,c.drawImage(l,0,0,n,s),i.splice(0,0,{context2D:c,width:n,height:s}),l=o,a=c}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0}})}(r),function(e){e.TileSourceCollection=function(i,n,s,l){e.console.error("TileSourceCollection is deprecated; use World instead")}}(r),function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(c){var h=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},c),this.element=c.element||e.makeNeutralElement("div"),c.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(g){g.insideElementPressed?(a(h,e.ButtonState.DOWN),h.raiseEvent("enter",{originalEvent:g.originalEvent})):g.buttonDownAny||a(h,e.ButtonState.HOVER)},focusHandler:function(g){h.tracker.enterHandler(g),h.raiseEvent("focus",{originalEvent:g.originalEvent})},leaveHandler:function(g){o(h,e.ButtonState.GROUP),g.insideElementPressed&&h.raiseEvent("exit",{originalEvent:g.originalEvent})},blurHandler:function(g){h.tracker.leaveHandler(g),h.raiseEvent("blur",{originalEvent:g.originalEvent})},pressHandler:function(g){a(h,e.ButtonState.DOWN),h.raiseEvent("press",{originalEvent:g.originalEvent})},releaseHandler:function(g){g.insideElementPressed&&g.insideElementReleased?(o(h,e.ButtonState.HOVER),h.raiseEvent("release",{originalEvent:g.originalEvent})):g.insideElementPressed?o(h,e.ButtonState.GROUP):a(h,e.ButtonState.HOVER)},clickHandler:function(g){g.quick&&h.raiseEvent("click",{originalEvent:g.originalEvent})},keyHandler:function(g){g.keyCode===13?(h.raiseEvent("click",{originalEvent:g.originalEvent}),h.raiseEvent("release",{originalEvent:g.originalEvent}),g.preventDefault=!0):g.preventDefault=!1}}),o(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){a(this,e.ButtonState.GROUP)},notifyGroupExit:function(){o(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(c){e.requestAnimationFrame(function(){n(c)})}function n(c){var h,g,m;c.shouldFade&&(h=e.now(),g=h-c.fadeBeginTime,m=1-g/c.fadeLength,m=Math.min(1,m),m=Math.max(0,m),c.imgGroup&&e.setElementOpacity(c.imgGroup,m,!0),m>0&&i(c))}function s(c){c.shouldFade=!0,c.fadeBeginTime=e.now()+c.fadeDelay,window.setTimeout(function(){i(c)},c.fadeDelay)}function l(c){c.shouldFade=!1,c.imgGroup&&e.setElementOpacity(c.imgGroup,1,!0)}function a(c,h){c.element.disabled||(h>=e.ButtonState.GROUP&&c.currentState===e.ButtonState.REST&&(l(c),c.currentState=e.ButtonState.GROUP),h>=e.ButtonState.HOVER&&c.currentState===e.ButtonState.GROUP&&(c.imgHover&&(c.imgHover.style.visibility=""),c.currentState=e.ButtonState.HOVER),h>=e.ButtonState.DOWN&&c.currentState===e.ButtonState.HOVER&&(c.imgDown&&(c.imgDown.style.visibility=""),c.currentState=e.ButtonState.DOWN))}function o(c,h){c.element.disabled||(h<=e.ButtonState.HOVER&&c.currentState===e.ButtonState.DOWN&&(c.imgDown&&(c.imgDown.style.visibility="hidden"),c.currentState=e.ButtonState.HOVER),h<=e.ButtonState.GROUP&&c.currentState===e.ButtonState.HOVER&&(c.imgHover&&(c.imgHover.style.visibility="hidden"),c.currentState=e.ButtonState.GROUP),h<=e.ButtonState.REST&&c.currentState===e.ButtonState.GROUP&&(s(c),c.currentState=e.ButtonState.REST))}}(r),function(e){e.ButtonGroup=function(i){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var n=this.buttons.concat([]),s=this,l;if(this.element=i.element||e.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",l=0;l<n.length;l++)this.element.appendChild(n[l].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var o;for(o=0;o<s.buttons.length;o++)s.buttons[o].notifyGroupEnter()},leaveHandler:function(a){var o;if(!a.insideElementPressed)for(o=0;o<s.buttons.length;o++)s.buttons[o].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(r),function(e){e.Rect=function(i,n,s,l,a){this.x=typeof i=="number"?i:0,this.y=typeof n=="number"?n:0,this.width=typeof s=="number"?s:0,this.height=typeof l=="number"?l:0,this.degrees=typeof a=="number"?a:0,this.degrees=e.positiveModulo(this.degrees,360);var o,c;this.degrees>=270?(o=this.getTopRight(),this.x=o.x,this.y=o.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=270):this.degrees>=180?(o=this.getBottomRight(),this.x=o.x,this.y=o.y,this.degrees-=180):this.degrees>=90&&(o=this.getBottomLeft(),this.x=o.x,this.y=o.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=90)},e.Rect.fromSummits=function(i,n,s){var l=i.distanceTo(n),a=i.distanceTo(s),o=n.minus(i),c=Math.atan(o.y/o.x);return o.x<0?c+=Math.PI:o.y<0&&(c+=2*Math.PI),new e.Rect(i.x,i.y,l,a,c/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(i){return i instanceof e.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new e.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new e.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var n=this.getBoundingBox(),s=i.getBoundingBox(),l=Math.min(n.x,s.x),a=Math.min(n.y,s.y),o=Math.max(n.x+n.width,s.x+s.width),c=Math.max(n.y+n.height,s.y+s.height);return new e.Rect(l,a,o-l,c-a)},intersection:function(i){var n=1e-10,s=[],l=this.getTopLeft();i.containsPoint(l,n)&&s.push(l);var a=this.getTopRight();i.containsPoint(a,n)&&s.push(a);var o=this.getBottomLeft();i.containsPoint(o,n)&&s.push(o);var c=this.getBottomRight();i.containsPoint(c,n)&&s.push(c);var h=i.getTopLeft();this.containsPoint(h,n)&&s.push(h);var g=i.getTopRight();this.containsPoint(g,n)&&s.push(g);var m=i.getBottomLeft();this.containsPoint(m,n)&&s.push(m);var T=i.getBottomRight();this.containsPoint(T,n)&&s.push(T);for(var b=this._getSegments(),P=i._getSegments(),C=0;C<b.length;C++)for(var k=b[C],d=0;d<P.length;d++){var _=P[d],S=M(k[0],k[1],_[0],_[1]);S&&s.push(S)}function M(te,pe,he,_e){var le=pe.minus(te),ae=_e.minus(he),ne=-ae.x*le.y+le.x*ae.y;if(ne===0)return null;var Te=(le.x*(te.y-he.y)-le.y*(te.x-he.x))/ne,$=(ae.x*(te.y-he.y)-ae.y*(te.x-he.x))/ne;return-n<=Te&&Te<=1-n&&-n<=$&&$<=1-n?new e.Point(te.x+$*le.x,te.y+$*le.y):null}if(s.length===0)return null;for(var I=s[0].x,V=s[0].x,q=s[0].y,K=s[0].y,j=1;j<s.length;j++){var oe=s[j];oe.x<I&&(I=oe.x),oe.x>V&&(V=oe.x),oe.y<q&&(q=oe.y),oe.y>K&&(K=oe.y)}return new e.Rect(I,q,V-I,K-q)},_getSegments:function(){var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),l=this.getBottomRight();return[[i,n],[n,l],[l,s],[s,i]]},rotate:function(i,n){if(i=e.positiveModulo(i,360),i===0)return this.clone();n=n||this.getCenter();var s=this.getTopLeft().rotate(i,n),l=this.getTopRight().rotate(i,n),a=l.minus(s);a=a.apply(function(c){var h=1e-15;return Math.abs(c)<h?0:c});var o=Math.atan(a.y/a.x);return a.x<0?o+=Math.PI:a.y<0&&(o+=2*Math.PI),new e.Rect(s.x,s.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),l=this.getBottomRight(),a=Math.min(i.x,n.x,s.x,l.x),o=Math.max(i.x,n.x,s.x,l.x),c=Math.min(i.y,n.y,s.y,l.y),h=Math.max(i.y,n.y,s.y,l.y);return new e.Rect(a,c,o-a,h-c)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),n=Math.floor(i.x),s=Math.floor(i.y),l=Math.ceil(i.width+i.x-n),a=Math.ceil(i.height+i.y-s);return new e.Rect(n,s,l,a)},containsPoint:function(i,n){n=n||0;var s=this.getTopLeft(),l=this.getTopRight(),a=this.getBottomLeft(),o=l.minus(s),c=a.minus(s);return(i.x-s.x)*o.x+(i.y-s.y)*o.y>=-n&&(i.x-l.x)*o.x+(i.y-l.y)*o.y<=n&&(i.x-s.x)*c.x+(i.y-s.y)*c.y>=-n&&(i.x-a.x)*c.x+(i.y-a.y)*c.y<=n},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(r),function(e){var i={};e.ReferenceStrip=function(m){var T=this,b=m.viewer,P=e.getElementSize(b.element),C,k,d;for(m.id||(m.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=m.id,this.element.className="referencestrip"),m=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},m,{element:this.element}),e.extend(this,m),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,k=this.element.style,k.marginTop="0px",k.marginRight="0px",k.marginBottom="0px",k.marginLeft="0px",k.left="0px",k.bottom="0px",k.border="0px",k.background="#000",k.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=b,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,n),dragHandler:e.delegate(this,s),scrollHandler:e.delegate(this,l),enterHandler:e.delegate(this,o),leaveHandler:e.delegate(this,c),keyDownHandler:e.delegate(this,h),keyHandler:e.delegate(this,g),preProcessEventHandler:function(_){_.eventType==="wheel"&&(_.preventDefault=!0)}}),m.width&&m.height?(this.element.style.width=m.width+"px",this.element.style.height=m.height+"px",b.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):m.scroll==="horizontal"?(this.element.style.width=P.x*m.sizeRatio*b.tileSources.length+12*b.tileSources.length+"px",this.element.style.height=P.y*m.sizeRatio+"px",b.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=P.y*m.sizeRatio*b.tileSources.length+12*b.tileSources.length+"px",this.element.style.width=P.x*m.sizeRatio+"px",b.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=P.x*this.sizeRatio+8,this.panelHeight=P.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<b.tileSources.length;d++)C=e.makeNeutralElement("div"),C.id=this.element.id+"-"+d,C.style.width=T.panelWidth+"px",C.style.height=T.panelHeight+"px",C.style.display="inline",C.style.float="left",C.style.cssFloat="left",C.style.styleFloat="left",C.style.padding="2px",e.setElementTouchActionNone(C),e.setElementPointerEventsNone(C),this.element.appendChild(C),C.activePanel=!1,this.panels.push(C);a(this,this.scroll==="vertical"?P.y:P.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(m){var T=this.element.querySelector("#"+this.element.id+"-"+m),b=e.getElementSize(this.viewer.canvas),P=Number(this.element.style.width.replace("px","")),C=Number(this.element.style.height.replace("px","")),k=-Number(this.element.style.marginLeft.replace("px","")),d=-Number(this.element.style.marginTop.replace("px","")),_;this.currentSelected!==T&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=T,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(_=Number(m)*(this.panelWidth+3),_>k+b.x-this.panelWidth?(_=Math.min(_,P-b.x),this.element.style.marginLeft=-_+"px",a(this,b.x,-_)):_<k&&(_=Math.max(0,_-b.x/2),this.element.style.marginLeft=-_+"px",a(this,b.x,-_))):(_=Number(m)*(this.panelHeight+3),_>d+b.y-this.panelHeight?(_=Math.min(_,C-b.y),this.element.style.marginTop=-_+"px",a(this,b.y,-_)):_<d&&(_=Math.max(0,_-b.y/2),this.element.style.marginTop=-_+"px",a(this,b.y,-_))),this.currentPage=m,o.call(this,{eventSource:this.tracker}))},update:function(){return i[this.id].animating?(e.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var m in this.miniViewers)this.miniViewers[m].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function n(m){if(m.quick){var T;this.scroll==="horizontal"?T=Math.floor(m.position.x/this.panelWidth):T=Math.floor(m.position.y/this.panelHeight),this.viewer.goToPage(T)}this.element.focus()}function s(m){if(this.dragging=!0,this.element){var T=Number(this.element.style.marginLeft.replace("px","")),b=Number(this.element.style.marginTop.replace("px","")),P=Number(this.element.style.width.replace("px","")),C=Number(this.element.style.height.replace("px","")),k=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-m.delta.x>0?T>-(P-k.x)&&(this.element.style.marginLeft=T+m.delta.x*2+"px",a(this,k.x,T+m.delta.x*2)):-m.delta.x<0&&T<0&&(this.element.style.marginLeft=T+m.delta.x*2+"px",a(this,k.x,T+m.delta.x*2)):-m.delta.y>0?b>-(C-k.y)&&(this.element.style.marginTop=b+m.delta.y*2+"px",a(this,k.y,b+m.delta.y*2)):-m.delta.y<0&&b<0&&(this.element.style.marginTop=b+m.delta.y*2+"px",a(this,k.y,b+m.delta.y*2))}}function l(m){if(this.element){var T=Number(this.element.style.marginLeft.replace("px","")),b=Number(this.element.style.marginTop.replace("px","")),P=Number(this.element.style.width.replace("px","")),C=Number(this.element.style.height.replace("px","")),k=e.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?m.scroll>0?T>-(P-k.x)&&(this.element.style.marginLeft=T-m.scroll*60+"px",a(this,k.x,T-m.scroll*60)):m.scroll<0&&T<0&&(this.element.style.marginLeft=T-m.scroll*60+"px",a(this,k.x,T-m.scroll*60)):m.scroll<0?b>k.y-C&&(this.element.style.marginTop=b+m.scroll*60+"px",a(this,k.y,b+m.scroll*60)):m.scroll>0&&b<0&&(this.element.style.marginTop=b+m.scroll*60+"px",a(this,k.y,b+m.scroll*60)),m.preventDefault=!0}}function a(m,T,b){var P,C,k,d,_,S;for(m.scroll==="horizontal"?P=m.panelWidth:P=m.panelHeight,C=Math.ceil(T/P)+5,k=Math.ceil((Math.abs(b)+T)/P)+1,C=k-C,C=C<0?0:C,_=C;_<k&&_<m.panels.length;_++)if(S=m.panels[_],!S.activePanel){var M,I=m.viewer.tileSources[_];I.referenceStripThumbnailUrl?M={type:"image",url:I.referenceStripThumbnailUrl}:M=I,d=new e.Viewer({id:S.id,tileSources:[M],element:S,navigatorSizeRatio:m.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:m.viewer.loadTilesWithAjax,ajaxHeaders:m.viewer.ajaxHeaders,useCanvas:m.useCanvas}),e.setElementPointerEventsNone(d.canvas),e.setElementPointerEventsNone(d.container),d.innerTracker.setTracking(!1),d.outerTracker.setTracking(!1),m.miniViewers[S.id]=d,S.activePanel=!0}}function o(m){var T=m.eventSource.element;this.scroll==="horizontal"?T.style.marginBottom="0px":T.style.marginLeft="0px"}function c(m){var T=m.eventSource.element;this.scroll==="horizontal"?T.style.marginBottom="-"+e.getElementSize(T).y/2+"px":T.style.marginLeft="-"+e.getElementSize(T).x/2+"px"}function h(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 38:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 40:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 37:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 39:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}function g(m){if(!m.ctrl&&!m.alt&&!m.meta)switch(m.keyCode){case 61:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 45:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 48:case 119:case 87:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;case 115:case 83:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 97:l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),m.preventDefault=!0;break;case 100:l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),m.preventDefault=!0;break;default:m.preventDefault=!1;break}else m.preventDefault=!1}}(r),function(e){e.DisplayRect=function(i,n,s,l,a,o){e.Rect.apply(this,[i,n,s,l]),this.minLevel=a,this.maxLevel=o},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(r),function(e){e.Spring=function(n){var s=arguments;typeof n!="object"&&(n={initial:s.length&&typeof s[0]=="number"?s[0]:void 0,springStiffness:s.length>1?s[1].springStiffness:5,animationTime:s.length>1?s[1].animationTime:1.5}),e.console.assert(typeof n.springStiffness=="number"&&n.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof n.animationTime=="number"&&n.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),n.exponential&&(this._exponential=!0,delete n.exponential),e.extend(!0,this,n),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=n,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(n){e.console.assert(!this._exponential||n!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=n,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(n){this.start.value+=n,this.target.value+=n,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(n){this._exponential=n,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();var n,s;this._exponential?(n=this.start._logValue,s=this.target._logValue):(n=this.start.value,s=this.target.value);var l=this.current.time>=this.target.time?s:n+(s-n)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),a=this.current.value;return this._exponential?this.current.value=Math.exp(l):this.current.value=l,a!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(n,s){return(1-Math.exp(n*-s))/(1-Math.exp(-n))}}(r),function(e){function i(s){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},s),this.image=null}i.prototype={errorMsg:null,start:function(){var s=this,l=this.abort;this.image=new Image,this.image.onload=function(){s.finish(!0)},this.image.onabort=this.image.onerror=function(){s.errorMsg="Image load aborted",s.finish(!1)},this.jobId=window.setTimeout(function(){s.errorMsg="Image load exceeded timeout ("+s.timeout+" ms)",s.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(a){var o;try{o=new window.Blob([a.response])}catch(m){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(m.name==="TypeError"&&c){var h=new c;h.append(a.response),o=h.getBlob()}}o.size===0&&(s.errorMsg="Empty image response.",s.finish(!1));var g=(window.URL||window.webkitURL).createObjectURL(o);s.image.src=g},error:function(a){s.errorMsg="Image load aborted - XHR error",s.finish(!1)}}),this.abort=function(){s.request.abort(),typeof l=="function"&&l()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(s){this.image.onload=this.image.onerror=this.image.onabort=null,s||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(s){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},s)},e.ImageLoader.prototype={addJob:function(s){var l=this,a=function(h){n(l,h,s.callback)},o={src:s.src,loadWithAjax:s.loadWithAjax,ajaxHeaders:s.loadWithAjax?s.ajaxHeaders:null,crossOriginPolicy:s.crossOriginPolicy,ajaxWithCredentials:s.ajaxWithCredentials,callback:a,abort:s.abort,timeout:this.timeout},c=new i(o);!this.jobLimit||this.jobsInProgress<this.jobLimit?(c.start(),this.jobsInProgress++):this.jobQueue.push(c)},clear:function(){for(var s=0;s<this.jobQueue.length;s++){var l=this.jobQueue[s];typeof l.abort=="function"&&l.abort()}this.jobQueue=[]}};function n(s,l,a){var o;s.jobsInProgress--,(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&s.jobQueue.length>0&&(o=s.jobQueue.shift(),o.start(),s.jobsInProgress++),a(l.image,l.errorMsg,l.request)}}(r),function(e){e.Tile=function(i,n,s,l,a,o,c,h,g,m){this.level=i,this.x=n,this.y=s,this.bounds=l,this.sourceBounds=m,this.exists=a,this.url=o,this.context2D=c,this.loadWithAjax=h,this.ajaxHeaders=g,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)},drawCanvas:function(i,n,s,l){var a=this.position.times(e.pixelDensityRatio),o=this.size.times(e.pixelDensityRatio),c;if(!this.context2D&&!this.cacheImageRecord){e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(c=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!c){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof s=="number"&&s!==1&&(a=a.times(s),o=o.times(s)),l instanceof e.Point&&(a=a.plus(l)),i.globalAlpha===1&&this._hasTransparencyChannel()&&i.clearRect(a.x,a.y,o.x,o.y),n({context:i,tile:this,rendered:c});var h,g;this.sourceBounds?(h=Math.min(this.sourceBounds.width,c.canvas.width),g=Math.min(this.sourceBounds.height,c.canvas.height)):(h=c.canvas.width,g=c.canvas.height),i.translate(a.x+o.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(c.canvas,0,0,h,g,-o.x/2,a.y,o.x,o.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,n,s){var l=Math.max(1,Math.ceil((s.x-n.x)/2)),a=Math.max(1,Math.ceil((s.y-n.y)/2));return new e.Point(l,a).minus(this.position.times(e.pixelDensityRatio).times(i||1).apply(function(o){return o%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(r),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(i,n,s){var l;e.isPlainObject(i)?l=i:l={element:i,location:n,placement:s},this.element=l.element,this.style=l.element.style,this._init(l)},e.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?e.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,n){var s=e.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?i.x-=n.x/2:s.isRight&&(i.x-=n.x),s.isVerticallyCentered?i.y-=n.y/2:s.isBottom&&(i.y-=n.y))},destroy:function(){var i=this.element,n=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(n.display="none",document.body.appendChild(i))),this.onDraw=null,n.top="",n.left="",n.position="",this.width!==null&&(n.width=""),this.height!==null&&(n.height="");var s=e.getCssPropertyWithVendorPrefix("transformOrigin"),l=e.getCssPropertyWithVendorPrefix("transform");s&&l&&(n[s]="",n[l]="")},drawHTML:function(i,n){var s=this.element;s.parentNode!==i&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,i.appendChild(s),this.style.position="absolute",this.size=e.getElementSize(s));var l=this._getOverlayPositionAndSize(n),a=l.position,o=this.size=l.size,c=l.rotate;if(this.onDraw)this.onDraw(a,o,this.element);else{var h=this.style;h.left=a.x+"px",h.top=a.y+"px",this.width!==null&&(h.width=o.x+"px"),this.height!==null&&(h.height=o.y+"px");var g=e.getCssPropertyWithVendorPrefix("transformOrigin"),m=e.getCssPropertyWithVendorPrefix("transform");g&&m&&(c?(h[g]=this._getTransformOrigin(),h[m]="rotate("+c+"deg)"):(h[g]="",h[m]="")),h.display="block"}},_getOverlayPositionAndSize:function(i){var n=i.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(i);this.adjust(n,s);var l=0;if(i.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var a=new e.Rect(n.x,n.y,s.x,s.y),o=this._getBoundingBox(a,i.degrees);n=o.getTopLeft(),s=o.getSize()}else l=i.degrees;return{position:n,size:s,rotate:l}},_getSizeInPixels:function(i){var n=this.size.x,s=this.size.y;if(this.width!==null||this.height!==null){var l=i.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);this.width!==null&&(n=l.x),this.height!==null&&(s=l.y)}if(this.checkResize&&(this.width===null||this.height===null)){var a=this.size=e.getElementSize(this.element);this.width===null&&(n=a.x),this.height===null&&(s=a.y)}return new e.Point(n,s)},_getBoundingBox:function(i,n){var s=this._getPlacementPoint(i);return i.rotate(n,s).getBoundingBox()},_getPlacementPoint:function(i){var n=new e.Point(i.x,i.y),s=e.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?n.x+=i.width/2:s.isRight&&(n.x+=i.width),s.isVerticallyCentered?n.y+=i.height/2:s.isBottom&&(n.y+=i.height)),n},_getTransformOrigin:function(){var i="",n=e.Placement.properties[this.placement];return n&&(n.isLeft?i="left":n.isRight&&(i="right"),n.isTop?i+=" top":n.isBottom&&(i+=" bottom")),i},update:function(i,n){var s=e.isPlainObject(i)?i:{location:i,placement:n};this._init({location:s.location||this.location,placement:s.placement!==void 0?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==void 0?s.width:this.width,height:s.height!==void 0?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(i){e.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,s=this.height;if(n===null||s===null){var l=i.deltaPointsFromPixelsNoRotate(this.size,!0);n===null&&(n=l.x),s===null&&(s=l.y)}var a=this.location.clone();return this.adjust(a,new e.Point(n,s)),this._adjustBoundsForRotation(i,new e.Rect(a.x,a.y,n,s))},_adjustBoundsForRotation:function(i,n){if(!i||i.degrees===0||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return n;var s=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new e.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return n.rotate(-i.degrees,this._getPlacementPoint(n))}}}(r),function(e){e.Drawer=function(i){e.console.assert(i.viewer,"[Drawer] options.viewer is required");var n=arguments;if(e.isPlainObject(i)||(i={source:n[0],viewport:n[1],element:n[2]}),e.console.assert(i.viewport,"[Drawer] options.viewport is required"),e.console.assert(i.element,"[Drawer] options.element is required"),i.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,i.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(i.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var s=this._calculateCanvasSize();this.canvas.width=s.x,this.canvas.height=s.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(i,n,s,l){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,n,s,l),this},updateOverlay:function(i,n,s){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,n,s),this},removeOverlay:function(i){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var n=this.viewport.pixelFromPointNoRotate(i,!0);return new e.Point(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},clipWithPolygons:function(i,n){if(this.useCanvas){var s=this._getContext(n);s.beginPath(),i.forEach(function(l){l.forEach(function(a,o){s[o===0?"moveTo":"lineTo"](a.x,a.y)})}),s.clip()}},setOpacity:function(i){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var n=this.viewer.world,s=0;s<n.getItemCount();s++)n.getItemAt(s).setOpacity(i);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,n=0,s=0;s<i.getItemCount();s++){var l=i.getItemAt(s).getOpacity();l>n&&(n=l)}return n},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var n=this._calculateSketchCanvasSize();this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,n){if(this.useCanvas){var s=this._getContext(i);if(n)s.clearRect(n.x,n.y,n.width,n.height);else{var l=s.canvas;s.clearRect(0,0,l.width,l.height)}}},viewportToDrawerRectangle:function(i){var n=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,s.x*e.pixelDensityRatio,s.y*e.pixelDensityRatio)},drawTile:function(i,n,s,l,a){if(e.console.assert(i,"[Drawer.drawTile] tile is required"),e.console.assert(n,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var o=this._getContext(s);l=l||1,i.drawCanvas(o,n,l,a)}else i.drawHTML(this.canvas)},_getContext:function(i){var n=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var s=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var l=this;this.viewer.addHandler("rotate",function a(){if(l.viewport.getRotation()!==0){l.viewer.removeHandler("rotate",a);var o=l._calculateSketchCanvasSize();l.sketchCanvas.width=o.x,l.sketchCanvas.height=o.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}n=this.sketchContext}return n},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,n){if(this.useCanvas){var s=this._getContext(n);s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip()}},drawRectangle:function(i,n,s){if(this.useCanvas){var l=this._getContext(s);l.save(),l.fillStyle=n,l.fillRect(i.x,i.y,i.width,i.height),l.restore()}},blendSketch:function(i,n,s,l){var a=i;if(e.isPlainObject(a)||(a={opacity:i,scale:n,translate:s,compositeOperation:l}),!(!this.useCanvas||!this.sketchCanvas)){i=a.opacity,l=a.compositeOperation;var o=a.bounds;if(this.context.save(),this.context.globalAlpha=i,l&&(this.context.globalCompositeOperation=l),o)o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height);else{n=a.scale||1,s=a.translate;var c=s instanceof e.Point?s:new e.Point(0,0),h=0,g=0;if(s){var m=this.sketchCanvas.width-this.canvas.width,T=this.sketchCanvas.height-this.canvas.height;h=Math.round(m/2),g=Math.round(T/2)}this.context.drawImage(this.sketchCanvas,c.x-h*n,c.y-g*n,(this.canvas.width+2*h)*n,(this.canvas.height+2*g)*n,-h,-g,this.canvas.width+2*h,this.canvas.height+2*g)}this.context.restore()}},drawDebugInfo:function(i,n,s,l){if(this.useCanvas){var a=this.viewer.world.getIndexOfItem(l)%this.debugGridColor.length,o=this.context;o.save(),o.lineWidth=2*e.pixelDensityRatio,o.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor[a],o.fillStyle=this.debugGridColor[a],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),l.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:l.getRotation(!0),point:l.viewport.pixelFromPointNoRotate(l._getRotationPoint(!0),!0)}),l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),o.strokeRect(i.position.x*e.pixelDensityRatio,i.position.y*e.pixelDensityRatio,i.size.x*e.pixelDensityRatio,i.size.y*e.pixelDensityRatio);var c=(i.position.x+i.size.x/2)*e.pixelDensityRatio,h=(i.position.y+i.size.y/2)*e.pixelDensityRatio;o.translate(c,h),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-c,-h),i.x===0&&i.y===0&&(o.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*e.pixelDensityRatio,(i.position.y-30)*e.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*e.pixelDensityRatio,(i.position.y-20)*e.pixelDensityRatio)),o.fillText("Level: "+i.level,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+20)*e.pixelDensityRatio),o.fillText("Column: "+i.x,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+30)*e.pixelDensityRatio),o.fillText("Row: "+i.y,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+40)*e.pixelDensityRatio),o.fillText("Order: "+s+" of "+n,(i.position.x+10)*e.pixelDensityRatio,(i.position.y+50)*e.pixelDensityRatio),o.fillText("Size: "+i.size.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+60)*e.pixelDensityRatio),o.fillText("Position: "+i.position.toString(),(i.position.x+10)*e.pixelDensityRatio,(i.position.y+70)*e.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),l.getRotation(!0)%360!==0&&this._restoreRotationChanges(),l.viewport.degrees===0&&l.getRotation(!0)%360===0&&l._drawer.viewer.viewport.getFlip()&&l._drawer._flip(),o.restore()}},debugRect:function(i){if(this.useCanvas){var n=this.context;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,i.width*e.pixelDensityRatio,i.height*e.pixelDensityRatio),n.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var n=this._getContext(i).canvas;return new e.Point(n.width,n.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.save(),s.translate(n.x,n.y),this.viewer.viewport.flipped?(s.rotate(Math.PI/180*-i.degrees),s.scale(-1,1)):s.rotate(Math.PI/180*i.degrees),s.translate(-n.x,-n.y)},_flip:function(i){i=i||{};var n=i.point?i.point.times(e.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.translate(n.x,0),s.scale(-1,1),s.translate(-n.x,0)},_restoreRotationChanges:function(i){var n=this._getContext(i);n.restore()},_calculateCanvasSize:function(){var i=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*i),y:Math.round(n.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var n=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:n,y:n}}}}(r),function(e){e.Viewport=function(i){var n=arguments;n.length&&n[0]instanceof e.Point&&(i={containerSize:n[0],contentSize:n[1],config:n[2]}),i.config&&(e.extend(!0,i,i.config),delete i.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},i),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(i){return e.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(i instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,n)},_setContentBounds:function(i,n){e.console.assert(i,"[Viewport._setContentBounds] bounds is required"),e.console.assert(i instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=i.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),n;return this.homeFillsViewer?n=i>=1?i:1:n=i>=1?1:i,n/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),n=1/this.getHomeZoom(),s=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-s/2,n,s)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),n=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return n},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(i){e.console.assert(e.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation())},getBoundsNoRotate:function(i){var n=this.getCenter(i),s=1/this.getZoom(i),l=s/this.getAspectRatio();return new e.Rect(n.x-s/2,n.y-l/2,s,l)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var n=this.getBoundsNoRotate(i),s=this._containerInnerSize.x*this.getZoom(i);return n.x-=this._margins.left/s,n.y-=this._margins.top/s,n.width+=(this._margins.left+this._margins.right)/s,n.height+=(this._margins.top+this._margins.bottom)/s,n},getCenter:function(i){var n=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),l,a,o,c,h,g,m,T;return i?n:this.zoomPoint?(l=this.pixelFromPoint(this.zoomPoint,!0),a=this.getZoom(),o=1/a,c=o/this.getAspectRatio(),h=new e.Rect(n.x-o/2,n.y-c/2,o,c),g=this._pixelFromPoint(this.zoomPoint,h),m=g.minus(l),T=m.divide(this._containerInnerSize.x*a),s.plus(T)):s},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var n=new e.Rect(i.x,i.y,i.width,i.height);if(!this.wrapHorizontal){var s=this.visibilityRatio*n.width,l=n.x+n.width,a=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,o=this._contentBoundsNoRotate.x-l+s,c=a-n.x-s;s>this._contentBoundsNoRotate.width?n.x+=(o+c)/2:c<0?n.x+=c:o>0&&(n.x+=o)}if(!this.wrapVertical){var h=this.visibilityRatio*n.height,g=n.y+n.height,m=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,T=this._contentBoundsNoRotate.y-g+h,b=m-n.y-h;h>this._contentBoundsNoRotate.height?n.y+=(T+b)/2:b<0?n.y+=b:T>0&&(n.y+=T)}return n},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var n=this.getZoom(),s=this._applyZoomConstraints(n);n!==s&&this.zoomTo(s,this.zoomPoint,i);var l=this.getBoundsNoRotate(),a=this._applyBoundaryConstraints(l);return this._raiseConstraintsEvent(i),(l.x!==a.x||l.y!==a.y||i)&&this.fitBounds(a.rotate(-this.getRotation()),i),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,n){n=n||{};var s=n.immediately||!1,l=n.constraints||!1,a=this.getAspectRatio(),o=i.getCenter(),c=new e.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=a?c.height=c.width/a:c.width=c.height*a,c.x=o.x-c.width/2,c.y=o.y-c.height/2;var h=1/c.width;if(l){var g=c.getAspectRatio(),m=this._applyZoomConstraints(h);h!==m&&(h=m,c.width=1/h,c.x=o.x-c.width/2,c.height=c.width/g,c.y=o.y-c.height/2),c=this._applyBoundaryConstraints(c),o=c.getCenter(),this._raiseConstraintsEvent(s)}if(s)return this.panTo(o,!0),this.zoomTo(h,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var T=this.getBounds(),b=this.getZoom();if(b===0||Math.abs(h/b-1)<1e-8)return this.zoomTo(h,!0),this.panTo(o,s);c=c.rotate(-this.getRotation());var P=c.getTopLeft().times(h).minus(T.getTopLeft().times(b)).divide(h-b);return this.zoomTo(h,P,s)},fitBounds:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!1})},fitBoundsWithConstraints:function(i,n){return this._fitBounds(i,{immediately:n,constraints:!0})},fitVertically:function(i){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,i)},fitHorizontally:function(i){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,i)},getConstrainedBounds:function(i){var n,s;return n=this.getBounds(i),s=this._applyBoundaryConstraints(n),s},panBy:function(i,n){var s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(i),n)},panTo:function(i,n){return n?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:n}),this},zoomBy:function(i,n,s){return this.zoomTo(this.zoomSpring.target.value*i,n,s)},zoomTo:function(i,n,s){var l=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s?this._adjustCenterSpringsForZoomPoint(function(){l.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:n,immediately:s}),this},setRotation:function(i){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=e.positiveModulo(i,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i}),this)},getRotation:function(){return this.degrees},resize:function(i,n){var s=this.getBoundsNoRotate(),l=s,a;return this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),n&&(a=i.x/this.containerSize.x,l.width=s.width*a,l.height=l.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:n}),this.fitBounds(l,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var n=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,n},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var n=this.pixelFromPoint(this.zoomPoint,!0);i();var s=this.pixelFromPoint(this.zoomPoint,!0),l=s.minus(n),a=this.deltaPointsFromPixels(l,!0);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,n){return i.times(this._containerInnerSize.x*this.getZoom(n))},deltaPixelsFromPoints:function(i,n){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation()),n)},deltaPointsFromPixelsNoRotate:function(i,n){return i.divide(this._containerInnerSize.x*this.getZoom(n))},deltaPointsFromPixels:function(i,n){return this.deltaPointsFromPixelsNoRotate(i,n).rotate(-this.getRotation())},pixelFromPointNoRotate:function(i,n){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(n))},pixelFromPoint:function(i,n){return this._pixelFromPoint(i,this.getBoundsNoRotate(n))},_pixelFromPointNoRotate:function(i,n){return i.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,n){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(),this.getCenter(!0)),n)},pointFromPixelNoRotate:function(i,n){var s=this.getBoundsNoRotate(n);return i.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(i,n){return this.pointFromPixelNoRotate(i,n).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new e.Point(i*this._contentSizeNoRotate.x/s,n*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(i,n){if(i instanceof e.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1){var l=this.viewer.world.getItemAt(0);return l.viewportToImageCoordinates(i,n,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,n){var s=this._contentBoundsNoRotate.width;return new e.Point(i/this._contentSizeNoRotate.x*s,n/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(i,n){if(i instanceof e.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(s===1){var l=this.viewer.world.getItemAt(0);return l.imageToViewportCoordinates(i,n,!0)}}var a=this._imageToViewportDelta(i,n);return a.x+=this._contentBoundsNoRotate.x,a.y+=this._contentBoundsNoRotate.y,a},imageToViewportRectangle:function(i,n,s,l){var a=i;if(a instanceof e.Rect||(a=new e.Rect(i,n,s,l)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(o===1){var c=this.viewer.world.getItemAt(0);return c.imageToViewportRectangle(i,n,s,l,!0)}}var h=this.imageToViewportCoordinates(a.x,a.y),g=this._imageToViewportDelta(a.width,a.height);return new e.Rect(h.x,h.y,g.x,g.y,a.degrees)},viewportToImageRectangle:function(i,n,s,l){var a=i;if(a instanceof e.Rect||(a=new e.Rect(i,n,s,l)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(o===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageRectangle(i,n,s,l,!0)}}var h=this.viewportToImageCoordinates(a.x,a.y),g=this._viewportToImageDelta(a.width,a.height);return new e.Rect(h.x,h.y,g.x,g.y,a.degrees)},viewerElementToImageCoordinates:function(i){var n=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(n)},imageToViewerElementCoordinates:function(i){var n=this.imageToViewportCoordinates(i);return this.pixelFromPoint(n,!0)},windowToImageCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var n=this.imageToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return e.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return e.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(i){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var n=this.viewportToViewerElementCoordinates(i);return n.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageZoom(i)}}var l=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,o=this._contentBoundsNoRotate.width,c=a/l*o;return i*c},imageToViewportZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(n===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportZoom(i)}}var l=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,o=this._contentBoundsNoRotate.width,c=l/a/o;return i*c},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}}(r),function(e){e.TiledImage=function(d){var _=this;e.console.assert(d.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(d.drawer,"[TiledImage] options.drawer is required"),e.console.assert(d.viewer,"[TiledImage] options.viewer is required"),e.console.assert(d.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(d.source,"[TiledImage] options.source is required"),e.console.assert(!d.clip||d.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=d.tileCache,delete d.tileCache,this._drawer=d.drawer,delete d.drawer,this._imageLoader=d.imageLoader,delete d.imageLoader,d.clip instanceof e.Rect&&(this._clip=d.clip.clone()),delete d.clip;var S=d.x||0;delete d.x;var M=d.y||0;delete d.y,this.normHeight=d.source.dimensions.y/d.source.dimensions.x,this.contentAspectX=d.source.dimensions.x/d.source.dimensions.y;var I=1;d.width?(I=d.width,delete d.width,d.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete d.height)):d.height&&(I=d.height/this.normHeight,delete d.height);var V=d.fitBounds;delete d.fitBounds;var q=d.fitBoundsPlacement||r.Placement.CENTER;delete d.fitBoundsPlacement;var K=d.degrees||0;delete d.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},d),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:S,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:M,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:I,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:K,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),V&&this.fitBounds(V,q,!0),this._drawingHandler=function(j){_.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:_},j))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(d){d!==this._fullyLoaded&&(this._fullyLoaded=d,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var d=this._xSpring.update(),_=this._ySpring.update(),S=this._scaleSpring.update(),M=this._degreesSpring.update();return d||_||S||M?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(d){return this.getBoundsNoRotate(d).rotate(this.getRotation(d),this._getRotationPoint(d))},getBoundsNoRotate:function(d){return d?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(d){var _=this.getBoundsNoRotate(d);if(this._clip){var S=d?this._worldWidthCurrent:this._worldWidthTarget,M=S/this.source.dimensions.x,I=this._clip.times(M);_=new e.Rect(_.x+I.x,_.y+I.y,I.width,I.height)}return _.rotate(this.getRotation(d),this._getRotationPoint(d))},getTileBounds:function(d,_,S){var M=this.source.getNumTiles(d),I=(M.x+_%M.x)%M.x,V=(M.y+S%M.y)%M.y,q=this.source.getTileBounds(d,I,V);return this.getFlip()&&(q.x=1-q.x-q.width),q.x+=(_-I)/M.x,q.y+=this._worldHeightCurrent/this._worldWidthCurrent*((S-V)/M.y),q},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var d=this.imageToWindowCoordinates(new e.Point(0,0)),_=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(_.x-d.x,_.y-d.y)},_viewportToImageDelta:function(d,_,S){var M=S?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(d*(this.source.dimensions.x/M),_*(this.source.dimensions.y*this.contentAspectX/M))},viewportToImageCoordinates:function(d,_,S){var M;return d instanceof e.Point?(S=_,M=d):M=new e.Point(d,_),M=M.rotate(-this.getRotation(S),this._getRotationPoint(S)),S?this._viewportToImageDelta(M.x-this._xSpring.current.value,M.y-this._ySpring.current.value):this._viewportToImageDelta(M.x-this._xSpring.target.value,M.y-this._ySpring.target.value)},_imageToViewportDelta:function(d,_,S){var M=S?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(d/this.source.dimensions.x*M,_/this.source.dimensions.y/this.contentAspectX*M)},imageToViewportCoordinates:function(d,_,S){d instanceof e.Point&&(S=_,_=d.y,d=d.x);var M=this._imageToViewportDelta(d,_);return S?(M.x+=this._xSpring.current.value,M.y+=this._ySpring.current.value):(M.x+=this._xSpring.target.value,M.y+=this._ySpring.target.value),M.rotate(this.getRotation(S),this._getRotationPoint(S))},imageToViewportRectangle:function(d,_,S,M,I){var V=d;V instanceof e.Rect?I=_:V=new e.Rect(d,_,S,M);var q=this.imageToViewportCoordinates(V.getTopLeft(),I),K=this._imageToViewportDelta(V.width,V.height,I);return new e.Rect(q.x,q.y,K.x,K.y,V.degrees+this.getRotation(I))},viewportToImageRectangle:function(d,_,S,M,I){var V=d;d instanceof e.Rect?I=_:V=new e.Rect(d,_,S,M);var q=this.viewportToImageCoordinates(V.getTopLeft(),I),K=this._viewportToImageDelta(V.width,V.height,I);return new e.Rect(q.x,q.y,K.x,K.y,V.degrees-this.getRotation(I))},viewerElementToImageCoordinates:function(d){var _=this.viewport.pointFromPixel(d,!0);return this.viewportToImageCoordinates(_)},imageToViewerElementCoordinates:function(d){var _=this.imageToViewportCoordinates(d);return this.viewport.pixelFromPoint(_,!0)},windowToImageCoordinates:function(d){var _=d.minus(r.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(_)},imageToWindowCoordinates:function(d){var _=this.imageToViewerElementCoordinates(d);return _.plus(r.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(d){var _=this._scaleSpring.current.value;return d=d.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((d.x-this._xSpring.current.value)/_,(d.y-this._ySpring.current.value)/_,d.width/_,d.height/_,d.degrees)},viewportToImageZoom:function(d){var _=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return _*d},imageToViewportZoom:function(d){var _=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return d/_},setPosition:function(d,_){var S=this._xSpring.target.value===d.x&&this._ySpring.target.value===d.y;if(_){if(S&&this._xSpring.current.value===d.x&&this._ySpring.current.value===d.y)return;this._xSpring.resetTo(d.x),this._ySpring.resetTo(d.y),this._needsDraw=!0}else{if(S)return;this._xSpring.springTo(d.x),this._ySpring.springTo(d.y),this._needsDraw=!0}S||this._raiseBoundsChange()},setWidth:function(d,_){this._setScale(d,_)},setHeight:function(d,_){this._setScale(d/this.normHeight,_)},setCroppingPolygons:function(d){var _=function(M){return M instanceof e.Point||typeof M.x=="number"&&typeof M.y=="number"},S=function(M){return M.map(function(I){try{if(_(I))return{x:I.x,y:I.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(d))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=d.map(function(M){return S(M)})}catch(M){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(M),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(d,_,S){_=_||e.Placement.CENTER;var M=e.Placement.properties[_],I=this.contentAspectX,V=0,q=0,K=1,j=1;if(this._clip&&(I=this._clip.getAspectRatio(),K=this._clip.width/this.source.dimensions.x,j=this._clip.height/this.source.dimensions.y,d.getAspectRatio()>I?(V=this._clip.x/this._clip.height*d.height,q=this._clip.y/this._clip.height*d.height):(V=this._clip.x/this._clip.width*d.width,q=this._clip.y/this._clip.width*d.width)),d.getAspectRatio()>I){var oe=d.height/j,te=0;M.isHorizontallyCentered?te=(d.width-d.height*I)/2:M.isRight&&(te=d.width-d.height*I),this.setPosition(new e.Point(d.x-V+te,d.y-q),S),this.setHeight(oe,S)}else{var pe=d.width/K,he=0;M.isVerticallyCentered?he=(d.height-d.width/I)/2:M.isBottom&&(he=d.height-d.width/I),this.setPosition(new e.Point(d.x-V,d.y-q+he),S),this.setWidth(pe,S)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(d){e.console.assert(!d||d instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),d instanceof e.Rect?this._clip=d.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(d){this.flipped=!!d,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(d){d!==this.opacity&&(this.opacity=d,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(d){this._preload=!!d,this._needsDraw=!0},getRotation:function(d){return d?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(d,_){this._degreesSpring.target.value===d&&this._degreesSpring.isAtTargetValue()||(_?this._degreesSpring.resetTo(d):this._degreesSpring.springTo(d),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(d){return this.getBoundsNoRotate(d).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(d){d!==this.compositeOperation&&(this.compositeOperation=d,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(d,_){var S=this._scaleSpring.target.value===d;if(_){if(S&&this._scaleSpring.current.value===d)return;this._scaleSpring.resetTo(d),this._updateForScale(),this._needsDraw=!0}else{if(S)return;this._scaleSpring.springTo(d),this._updateForScale(),this._needsDraw=!0}S||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var d=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),_=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,S=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(_/this.minPixelRatio)/Math.log(2))));return S=Math.max(S,this.source.minLevel||0),d=Math.min(d,S),{lowestLevel:d,highestLevel:S}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var d=this.lastDrawn.pop();d.beingDrawn=!1}var _=this.viewport,S=this._viewportToTiledImageRectangle(_.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var M=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(S=S.intersection(M),S===null)return}for(var I=this._getLevelsInterval(),V=I.lowestLevel,q=I.highestLevel,K=null,j=!1,oe=e.now(),te=q;te>=V;te--){var pe=!1,he=_.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(te),!0).x*this._scaleSpring.current.value;if(te===V||!j&&he>=this.minPixelRatio)pe=!0,j=!0;else if(!j)continue;var _e=_.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(te),!1).x*this._scaleSpring.current.value,le=_.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,ae=this.immediateRender?1:le,ne=Math.min(1,(he-.5)/.5),Te=ae/Math.abs(ae-_e);if(K=i(this,j,pe,te,ne,Te,S,oe,K),g(this.coverage,te))break}C(this,this.lastDrawn),K&&!K.context2D?(l(this,K,oe),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(d,_,S){var M,I;this.wrapHorizontal?(M=e.positiveModulo(_.x,1),I=e.positiveModulo(S.x,1)):(M=Math.max(0,_.x),I=Math.min(1,S.x));var V,q,K=1/this.source.aspectRatio;this.wrapVertical?(V=e.positiveModulo(_.y,K),q=e.positiveModulo(S.y,K)):(V=Math.max(0,_.y),q=Math.min(K,S.y));var j=this.source.getTileAtPoint(d,new e.Point(M,V)),oe=this.source.getTileAtPoint(d,new e.Point(I,q)),te=this.source.getNumTiles(d);return this.wrapHorizontal&&(j.x+=te.x*Math.floor(_.x),oe.x+=te.x*Math.floor(S.x)),this.wrapVertical&&(j.y+=te.y*Math.floor(_.y/K),oe.y+=te.y*Math.floor(S.y/K)),{topLeft:j,bottomRight:oe}}});function i(d,_,S,M,I,V,q,K,j){var oe=q.getBoundingBox().getTopLeft(),te=q.getBoundingBox().getBottomRight();d.viewer&&d.viewer.raiseEvent("update-level",{tiledImage:d,havedrawn:_,level:M,opacity:I,visibility:V,drawArea:q,topleft:oe,bottomright:te,currenttime:K,best:j}),b(d.coverage,M),b(d.loadingCoverage,M);var pe=d._getCornerTiles(M,oe,te),he=pe.topLeft,_e=pe.bottomRight,le=d.source.getNumTiles(M),ae=d.viewport.pixelFromPoint(d.viewport.getCenter());d.getFlip()&&(_e.x+=1,d.wrapHorizontal||(_e.x=Math.min(_e.x,le.x-1)));for(var ne=he.x;ne<=_e.x;ne++)for(var Te=he.y;Te<=_e.y;Te++){var $;if(d.getFlip()){var De=(le.x+ne%le.x)%le.x;$=ne+le.x-De-De-1}else $=ne;q.intersection(d.getTileBounds(M,$,Te))!==null&&(j=n(d,S,_,$,Te,M,I,V,ae,le,K,j))}return j}function n(d,_,S,M,I,V,q,K,j,oe,te,pe){var he=s(M,I,V,d,d.source,d.tilesMatrix,te,oe,d._worldWidthCurrent,d._worldHeightCurrent),_e=S;d.viewer&&d.viewer.raiseEvent("update-tile",{tiledImage:d,tile:he}),T(d.coverage,V,M,I,!1);var le=he.loaded||he.loading||m(d.loadingCoverage,V,M,I);if(T(d.loadingCoverage,V,M,I,le),!he.exists||(_&&!_e&&(m(d.coverage,V,M,I)?T(d.coverage,V,M,I,!0):_e=!0),!_e))return pe;if(c(he,d.source.tileOverlap,d.viewport,j,K,d),!he.loaded)if(he.context2D)o(d,he);else{var ae=d._tileCache.getImageRecord(he.cacheKey);if(ae){var ne=ae.getImage();o(d,he,ne)}}if(he.loaded){var Te=h(d,he,M,I,V,q,te);Te&&(d._needsDraw=!0)}else he.loading?d._tilesLoading++:le||(pe=P(pe,he));return pe}function s(d,_,S,M,I,V,q,K,j,oe){var te,pe,he,_e,le,ae,ne,Te,$;return V[S]||(V[S]={}),V[S][d]||(V[S][d]={}),(!V[S][d][_]||!V[S][d][_].flipped!=!M.flipped)&&(te=(K.x+d%K.x)%K.x,pe=(K.y+_%K.y)%K.y,he=M.getTileBounds(S,d,_),_e=I.getTileBounds(S,te,pe,!0),le=I.tileExists(S,te,pe),ae=I.getTileUrl(S,te,pe),M.loadTilesWithAjax?(ne=I.getTileAjaxHeaders(S,te,pe),e.isPlainObject(M.ajaxHeaders)&&(ne=e.extend({},M.ajaxHeaders,ne))):ne=null,Te=I.getContext2D?I.getContext2D(S,te,pe):void 0,$=new e.Tile(S,d,_,he,le,ae,Te,M.loadTilesWithAjax,ne,_e),M.getFlip()?te===0&&($.isRightMost=!0):te===K.x-1&&($.isRightMost=!0),pe===K.y-1&&($.isBottomMost=!0),$.flipped=M.flipped,V[S][d][_]=$),$=V[S][d][_],$.lastTouchTime=q,$}function l(d,_,S){_.loading=!0,d._imageLoader.addJob({src:_.url,loadWithAjax:_.loadWithAjax,ajaxHeaders:_.ajaxHeaders,crossOriginPolicy:d.crossOriginPolicy,ajaxWithCredentials:d.ajaxWithCredentials,callback:function(M,I,V){a(d,_,S,M,I,V)},abort:function(){_.loading=!1}})}function a(d,_,S,M,I,V){if(!M){e.console.log("Tile %s failed to load: %s - error: %s",_,_.url,I),d.viewer.raiseEvent("tile-load-failed",{tile:_,tiledImage:d,time:S,message:I,tileRequest:V}),_.loading=!1,_.exists=!1;return}if(S<d.lastResetTime){e.console.log("Ignoring tile %s loaded before reset: %s",_,_.url),_.loading=!1;return}var q=function(){var K=d.source.getClosestLevel();o(d,_,M,K,V)};d._midDraw?window.setTimeout(q,1):q()}function o(d,_,S,M,I){var V=0;function q(){return V++,K}function K(){V--,V===0&&(_.loading=!1,_.loaded=!0,_.context2D||d._tileCache.cacheTile({image:S,tile:_,cutoff:M,tiledImage:d}),d._needsDraw=!0)}d.viewer.raiseEvent("tile-loaded",{tile:_,tiledImage:d,tileRequest:I,image:S,getCompletionCallback:q}),q()()}function c(d,_,S,M,I,V){var q=d.bounds.getTopLeft();q.x*=V._scaleSpring.current.value,q.y*=V._scaleSpring.current.value,q.x+=V._xSpring.current.value,q.y+=V._ySpring.current.value;var K=d.bounds.getSize();K.x*=V._scaleSpring.current.value,K.y*=V._scaleSpring.current.value;var j=S.pixelFromPointNoRotate(q,!0),oe=S.pixelFromPointNoRotate(q,!1),te=S.deltaPixelsFromPointsNoRotate(K,!0),pe=S.deltaPixelsFromPointsNoRotate(K,!1),he=oe.plus(pe.divide(2)),_e=M.squaredDistanceTo(he);_||(te=te.plus(new e.Point(1,1))),d.isRightMost&&V.wrapHorizontal&&(te.x+=.75),d.isBottomMost&&V.wrapVertical&&(te.y+=.75),d.position=j,d.size=te,d.squaredDistance=_e,d.visibility=I}function h(d,_,S,M,I,V,q){var K=1e3*d.blendTime,j,oe;if(_.blendStart||(_.blendStart=q),j=q-_.blendStart,oe=K?Math.min(1,j/K):1,d.alwaysBlend&&(oe*=V),_.opacity=oe,d.lastDrawn.push(_),oe===1)T(d.coverage,I,S,M,!0),d._hasOpaqueTile=!0;else if(j<K)return!0;return!1}function g(d,_,S,M){var I,V,q,K;if(!d[_])return!1;if(S===void 0||M===void 0){I=d[_];for(q in I)if(Object.prototype.hasOwnProperty.call(I,q)){V=I[q];for(K in V)if(Object.prototype.hasOwnProperty.call(V,K)&&!V[K])return!1}return!0}return d[_][S]===void 0||d[_][S][M]===void 0||d[_][S][M]===!0}function m(d,_,S,M){return S===void 0||M===void 0?g(d,_+1):g(d,_+1,2*S,2*M)&&g(d,_+1,2*S,2*M+1)&&g(d,_+1,2*S+1,2*M)&&g(d,_+1,2*S+1,2*M+1)}function T(d,_,S,M,I){if(!d[_]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",_);return}d[_][S]||(d[_][S]={}),d[_][S][M]=I}function b(d,_){d[_]={}}function P(d,_){return!d||_.visibility>d.visibility||_.visibility===d.visibility&&_.squaredDistance<d.squaredDistance?_:d}function C(d,_){if(!(d.opacity===0||_.length===0&&!d.placeholderFillStyle)){var S=_[0],M;S&&(M=d.opacity<1||d.compositeOperation&&d.compositeOperation!=="source-over"||!d._isBottomItem()&&S._hasTransparencyChannel());var I,V,q=d.viewport.getZoom(!0),K=d.viewportToImageZoom(q);_.length>1&&K>d.smoothTileEdgesMinZoom&&!d.iOSDevice&&d.getRotation(!0)%360===0&&e.supportsCanvas&&(M=!0,I=S.getScaleForEdgeSmoothing(),V=S.getTranslationForEdgeSmoothing(I,d._drawer.getCanvasSize(!1),d._drawer.getCanvasSize(!0)));var j;M&&(I||(j=d.viewport.viewportToViewerElementRectangle(d.getClippedBounds(!0)).getIntegerBoundingBox(),d._drawer.viewer.viewport.getFlip()&&(d.viewport.degrees!==0||d.getRotation(!0)%360!==0)&&(j.x=d._drawer.viewer.container.clientWidth-(j.x+j.width)),j=j.times(e.pixelDensityRatio)),d._drawer._clear(!0,j)),I||(d.viewport.degrees!==0&&d._drawer._offsetForRotation({degrees:d.viewport.degrees,useSketch:M}),d.getRotation(!0)%360!==0&&d._drawer._offsetForRotation({degrees:d.getRotation(!0),point:d.viewport.pixelFromPointNoRotate(d._getRotationPoint(!0),!0),useSketch:M}),d.viewport.degrees===0&&d.getRotation(!0)%360===0&&d._drawer.viewer.viewport.getFlip()&&d._drawer._flip());var oe=!1;if(d._clip){d._drawer.saveContext(M);var te=d.imageToViewportRectangle(d._clip,!0);te=te.rotate(-d.getRotation(!0),d._getRotationPoint(!0));var pe=d._drawer.viewportToDrawerRectangle(te);I&&(pe=pe.times(I)),V&&(pe=pe.translate(V)),d._drawer.setClip(pe,M),oe=!0}if(d._croppingPolygons){d._drawer.saveContext(M);try{var he=d._croppingPolygons.map(function(ne){return ne.map(function(Te){var $=d.imageToViewportCoordinates(Te.x,Te.y,!0).rotate(-d.getRotation(!0),d._getRotationPoint(!0)),De=d._drawer.viewportCoordToDrawerCoord($);return I&&(De=De.times(I)),De})});d._drawer.clipWithPolygons(he,M)}catch(ne){e.console.error(ne)}oe=!0}if(d.placeholderFillStyle&&d._hasOpaqueTile===!1){var _e=d._drawer.viewportToDrawerRectangle(d.getBounds(!0));I&&(_e=_e.times(I)),V&&(_e=_e.translate(V));var le=null;typeof d.placeholderFillStyle=="function"?le=d.placeholderFillStyle(d,d._drawer.context):le=d.placeholderFillStyle,d._drawer.drawRectangle(_e,le,M)}for(var ae=_.length-1;ae>=0;ae--)S=_[ae],d._drawer.drawTile(S,d._drawingHandler,M,I,V),S.beingDrawn=!0,d.viewer&&d.viewer.raiseEvent("tile-drawn",{tiledImage:d,tile:S});oe&&d._drawer.restoreContext(M),I||(d.getRotation(!0)%360!==0&&d._drawer._restoreRotationChanges(M),d.viewport.degrees!==0&&d._drawer._restoreRotationChanges(M)),M&&(I&&(d.viewport.degrees!==0&&d._drawer._offsetForRotation({degrees:d.viewport.degrees,useSketch:!1}),d.getRotation(!0)%360!==0&&d._drawer._offsetForRotation({degrees:d.getRotation(!0),point:d.viewport.pixelFromPointNoRotate(d._getRotationPoint(!0),!0),useSketch:!1})),d._drawer.blendSketch({opacity:d.opacity,scale:I,translate:V,compositeOperation:d.compositeOperation,bounds:j}),I&&(d.getRotation(!0)%360!==0&&d._drawer._restoreRotationChanges(!1),d.viewport.degrees!==0&&d._drawer._restoreRotationChanges(!1))),I||d.viewport.degrees===0&&d.getRotation(!0)%360===0&&d._drawer.viewer.viewport.getFlip()&&d._drawer._flip(),k(d,_)}}function k(d,_){if(d.debugMode)for(var S=_.length-1;S>=0;S--){var M=_[S];try{d._drawer.drawDebugInfo(M,_.length,S,d)}catch(I){e.console.error(I)}}}}(r),function(e){var i=function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage},n=function(s){e.console.assert(s,"[ImageRecord] options is required"),e.console.assert(s.image,"[ImageRecord] options.image is required"),this._image=s.image,this._tiles=[]};n.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var s=document.createElement("canvas");s.width=this._image.width,s.height=this._image.height,this._renderedContext=s.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(s){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=s},addTile:function(s){e.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var l=0;l<this._tiles.length;l++)if(this._tiles[l]===s){this._tiles.splice(l,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(s){s=s||{},this._maxImageCacheCount=s.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var l=s.cutoff||0,a=this._tilesLoaded.length,o=this._imagesLoaded[s.tile.cacheKey];if(o||(e.console.assert(s.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),o=this._imagesLoaded[s.tile.cacheKey]=new n({image:s.image}),this._imagesLoadedCount++),o.addTile(s.tile),s.tile.cacheImageRecord=o,this._imagesLoadedCount>this._maxImageCacheCount){for(var c=null,h=-1,g=null,m,T,b,P,C,k,d=this._tilesLoaded.length-1;d>=0;d--)if(k=this._tilesLoaded[d],m=k.tile,!(m.level<=l||m.beingDrawn)){if(!c){c=m,h=d,g=k;continue}P=m.lastTouchTime,T=c.lastTouchTime,C=m.level,b=c.level,(P<T||P===T&&C>b)&&(c=m,h=d,g=k)}c&&h>=0&&(this._unloadTile(g),a=h)}this._tilesLoaded[a]=new i({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){e.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var l,a=0;a<this._tilesLoaded.length;++a)l=this._tilesLoaded[a],l.tiledImage===s&&(this._unloadTile(l),this._tilesLoaded.splice(a,1),a--)},getImageRecord:function(s){return e.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){e.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var l=s.tile,a=s.tiledImage;l.unload(),l.cacheImageRecord=null;var o=this._imagesLoaded[l.cacheKey];o.removeTile(l),o.getTileCount()||(o.destroy(),delete this._imagesLoaded[l.cacheKey],this._imagesLoadedCount--),a.viewer.raiseEvent("tile-unloaded",{tile:l,tiledImage:a})}}}(r),function(e){e.World=function(i){var n=this;e.console.assert(i.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(i,n){if(e.console.assert(i,"[World.addItem] item is required"),e.console.assert(i instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),n=n||{},n.index!==void 0){var s=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(s,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return e.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return e.console.assert(i,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,n){e.console.assert(i,"[World.setItemIndex] item is required"),e.console.assert(n!==void 0,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(i);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n===s||s===-1||(this._items.splice(s,1),this._items.splice(n,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:s,newIndex:n}))},removeItem:function(i){e.console.assert(i,"[World.removeItem] item is required");var n=e.indexOf(this._items,i);n!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,n;for(n=0;n<this._items.length;n++)i=this._items[n],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,n=0;n<s.length;n++)i=s[n],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,n=0;n<this._items.length;n++)i=this._items[n].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var n=i.immediately||!1,s=i.layout||e.DEFAULT_SETTINGS.collectionLayout,l=i.rows||e.DEFAULT_SETTINGS.collectionRows,a=i.columns||e.DEFAULT_SETTINGS.collectionColumns,o=i.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,c=i.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,h=o+c,g;!i.rows&&a?g=a:g=Math.ceil(this._items.length/l);var m=0,T=0,b,P,C,k,d;this.setAutoRefigureSizes(!1);for(var _=0;_<this._items.length;_++)_&&_%g===0&&(s==="horizontal"?(T+=h,m=0):(m+=h,T=0)),b=this._items[_],P=b.getBounds(),P.width>P.height?C=o:C=o*(P.width/P.height),k=C*(P.height/P.width),d=new e.Point(m+(o-C)/2,T+(o-k)/2),b.setPosition(d,n),b.setWidth(C,n),s==="horizontal"?m+=h:T+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,n=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(!this._items.length)this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;else{var l=this._items[0],a=l.getBounds();this._contentFactor=l.getContentSize().x/a.width;for(var o=l.getClippedBounds().getBoundingBox(),c=o.x,h=o.y,g=o.x+o.width,m=o.y+o.height,T=1;T<this._items.length;T++)l=this._items[T],a=l.getBounds(),this._contentFactor=Math.max(this._contentFactor,l.getContentSize().x/a.width),o=l.getClippedBounds().getBoundingBox(),c=Math.min(c,o.x),h=Math.min(h,o.y),g=Math.max(g,o.x+o.width),m=Math.max(m,o.y+o.height);this._homeBounds=new e.Rect(c,h,g-c,m-h),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==s||!this._homeBounds.equals(i)||!this._contentSize.equals(n))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(r)})(Nr);var md=Nr.exports;const vd=Nn(md);function Ft(t,r){U.root[r||t.name.replace("bound ","")]=t}function jn(t){return!!(t.altKey||t.ctrlKey||t.metaKey||["INPUT","SELECT","TEXTAREA"].includes(t.target.nodeName)&&t.target.type!=="range")}const yd=.01,wd={data(){return{filtersVisible:!1,loadingTimeout:null,options:U,tileSources:{},viewer:null,viewerState:{},zoomFactor:1.5,isLastPage:Ar,customPageViewActive:kr,isFirstPage:Fr}},computed:{filtersActive(){return Object.keys(U.filters).length>0},saturation(){const t=U.filters.saturate;return typeof t=="number"?t:1}},watch:{"options.pages":function(t,r){const e=t.length!==r.length;this.loadImageInfo(e)}},mounted(){this.loadImageInfo(),this.updateFilterStyle(),U.root.$el.addEventListener("keydown",this.onKeydown),U.root.$el.addEventListener("keypress",this.onKeypress)},beforeUnmount(){this.viewer&&this.viewer.destroy(),U.root.$el.removeEventListener("keydown",this.onKeydown),U.root.$el.removeEventListener("keypress",this.onKeypress)},methods:{closeFilters(){this.filtersVisible=!1},getId:zt,goToNextPage:vn,goToPreviousPage:yn,initViewer(t){const r=[];let e=0,i,n=0;if(U.pages.forEach((s,l)=>{let a=1;s<1?(a=0,i=l>0?ct.value:1):i=s;const o=this.tileSources[i];if(!o)return;e||(e=o.width);const c=o.width/e;r.push({opacity:a,tileSource:o,width:c,x:n}),n+=c+yd}),this.viewer){this.viewer.addOnceHandler("open",()=>{if(this.viewerState.isReset||t)this.resetScan();else{if(this.viewer.viewport.applyConstraints(!0),!U.optionsResetOnPageChange)return;U.optionsResetOnPageChange.forEach(s=>{if(s==="filters")this.resetFilters();else if(s==="pan"){const l=this.viewer.viewport.getBounds();if(l.x<=0&&l.y<=0)return;const a=U.pages[0]?0:1;this.viewer.viewport.panTo({x:l.x>0?l.width/2+a:U.pan.x,y:l.y>0?l.height/2:U.pan.y}),Ce({pan:{}})}else s==="rotation"?(this.viewer.viewport.setRotation(0),Ce({rotation:null})):s==="zoom"&&(this.viewer.viewport.goHome(),Ce({zoom:null}))})}}),this.viewer.open(r);return}this.viewer=vd({animationTime:.4,element:this.$refs.image,immediateRender:!0,preload:!It(),preserveImageSizeOnResize:!0,preserveViewport:!0,showNavigationControl:!1,showZoomControl:!1,tileSources:r,visibilityRatio:.2,...U.viewer}),this.viewer.innerTracker.keyHandler=null,this.viewer.gestureSettingsMouse.clickToZoom=!1,this.viewer.addHandler("animation-finish",()=>{if(this.viewerState.isReset){this.removeScanOptions();return}const s=this.viewer.viewport.getCenter();Ce({pan:{x:Math.round(s.x*1e3)/1e3,y:Math.round(s.y*1e3)/1e3},zoom:Math.round(this.viewer.viewport.getZoom()*1e3)/1e3})}),this.viewer.addHandler("canvas-click",()=>{document.body.click()}),this.viewer.addHandler("open",()=>{this.startLoadingWatch(),U.pan.x!==void 0||U.pan.y!==void 0||U.zoom?((U.pan.x!==void 0||U.pan.y!==void 0)&&this.viewer.viewport.panTo({x:U.pan.x,y:U.pan.y},!0),U.zoom&&this.viewer.viewport.zoomTo(U.zoom,null,!0)):this.viewer.viewport.goHome(),U.rotation!==null&&this.viewer.viewport.setRotation(U.rotation)}),this.viewer.addHandler("pan",this.updateViewerState),this.viewer.addHandler("resize",this.updateViewerState),this.viewer.addHandler("zoom",this.updateViewerState),this.viewer.addHandler("tile-load-failed",s=>{it.add(`Error loading image: ${s.message}`)}),Ft(this.resetScan),Ft(this.viewer,"viewer")},loadImageInfo(t=!1){this.stopLoadingWatch();const r=[];U.pages.forEach(e=>{if(e<1||this.tileSources[e])return;const{resource:i}=Ge.value[e-1].images[0];if(i.service){const n=i.service["@id"],s=`${n}${n.slice(-1)==="/"?"":"/"}info.json`;r.push(pi(s).then(l=>({...l,page:e}),l=>{let a;l.response&&l.response.statusText?a=l.response.statusText:l.message&&(a=l.message),it.add(`Error loading info file for page ${e}${a?`: ${a}`:""}`)}))}else this.tileSources[e]={type:"image",url:i["@id"],width:i.width,height:i.height}}),r.length?Promise.all(r).then(e=>{e.forEach(i=>{i&&(this.tileSources[i.page]=i)}),this.initViewer(t)}):this.initViewer(t)},onKeydown(t){t.key==="Escape"&&(this.filtersVisible=!1),[45,48,96].indexOf(t.keyCode)>-1&&(t.shiftKey?this.resetScan(t):this.viewer.viewport.goHome())},onKeypress(t){if(!jn(t))switch(t.key){case"r":case"R":this.rotateRight(t);break;case"i":this.filtersVisible=!this.filtersVisible,this.filtersVisible&&this.$nextTick(()=>{this.$refs.firstSlider.focus()});break;case"I":this.resetFilters();break;case"+":case"=":case"W":this.viewer.viewport.zoomBy(1.1),this.viewer.viewport.applyConstraints();break;case"-":case"_":case"S":this.viewer.viewport.zoomBy(.9),this.viewer.viewport.applyConstraints();break;case"w":this.viewer.innerTracker.keyDownHandler({keyCode:38});break;case"s":this.viewer.innerTracker.keyDownHandler({keyCode:40});break;case"a":this.viewer.innerTracker.keyDownHandler({keyCode:37});break;case"d":this.viewer.innerTracker.keyDownHandler({keyCode:39});break}},removeScanOptions(){Ce({pan:{},zoom:null})},resetFilters(){this.$refs.image.style.cssText="",Ce({filters:{}})},resetScan(t){t&&(this.viewer.viewport.setRotation(0),Ce({rotation:null}),this.filtersActive&&this.resetFilters()),this.viewer.viewport.goHome(),this.removeScanOptions()},rotateRight(t){const{viewport:r}=this.viewer,e=t&&t.shiftKey?0:(r.getRotation()+90)%360;r.setRotation(e),Ce({rotation:e||null})},setFilter(t,r){const e=r.target.valueAsNumber;e===1?delete U.filters[t]:U.filters[t]=e,Ce({filters:U.filters}),this.updateFilterStyle()},startLoadingWatch(){Xe.value=0;for(let t=this.viewer.world.getItemCount()-1;t>=0;t-=1){const r=this.viewer.world.getItemAt(t);if(r&&r._tilesLoading){Xe.value=1;break}}this.loadingTimeout=setTimeout(this.startLoadingWatch,200)},stopLoadingWatch(){clearTimeout(this.loadingTimeout)},updateFilterStyle(){if(!this.filtersActive)return;const t=[];Object.keys(U.filters).forEach(i=>{t.push(`${i}(${U.filters[i]})`)});const{image:r}=this.$refs,e=t.join(" ");r.style.cssText=`filter: ${e}`},updateViewerState(){const t=this.viewer.viewport.getZoom();this.viewerState.isMaxZoom=t>=this.viewer.viewport.getMaxZoom(),this.viewerState.isMinZoom=t<=this.viewer.viewport.getMinZoom();const r=this.viewer.viewport.getHomeBounds(),e=this.viewer.viewport.getBounds();this.viewerState.isReset=Math.abs(r.height-e.height)<1e-9&&Math.abs(r.width-e.width)<1e-9&&Math.abs(r.x-e.x)<1e-9&&Math.abs(r.y-e.y)<1e-9},translate:He,zoomIn(){this.viewer.viewport.zoomBy(this.zoomFactor)},zoomOut(){this.viewer.viewport.zoomBy(1/this.zoomFactor)}}},_d={class:"tify-scan"},xd={class:"tify-sr-only"},Td=["title"],bd=["title"],Ed={key:2,class:"tify-scan-buttons"},Pd=["disabled","title"],Sd=["disabled","title"],Cd=["disabled","title"],Rd=["title"],Hd=["title","aria-controls","aria-expanded"],Ld=["id"],Dd={class:"tify-sr-only"},Md=["value"],Od=["value"],kd=["value"],Fd=["disabled"],Ad={ref:"image",class:"tify-scan-image"};function Bd(t,r,e,i,n,s){const l=zr,a=Ir,o=rd,c=$h,h=Zh,g=Vh,m=Fh,T=Hh,b=bh,P=vh,C=hh,k=kn("click-outside");return D(),O("section",_d,[F("h2",xd,X(s.translate("Scan")),1),!n.customPageViewActive&&!n.isFirstPage?(D(),O("button",{key:0,type:"button",class:"tify-scan-page-button -previous",title:s.translate("Previous page"),onClick:r[0]||(r[0]=(...d)=>s.goToPreviousPage&&s.goToPreviousPage(...d))},[ie(l)],8,Td)):re("",!0),!n.customPageViewActive&&!n.isLastPage?(D(),O("button",{key:1,type:"button",class:"tify-scan-page-button -next",title:s.translate("Next page"),onClick:r[1]||(r[1]=(...d)=>s.goToNextPage&&s.goToNextPage(...d))},[ie(a)],8,bd)):re("",!0),n.viewer?(D(),O("div",Ed,[F("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMaxZoom,title:s.translate("Zoom in"),onClick:r[2]||(r[2]=(...d)=>s.zoomIn&&s.zoomIn(...d))},[ie(o)],8,Pd),F("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isReset,title:s.translate("Reset"),onClick:r[3]||(r[3]=d=>s.resetScan(!!d.shiftKey))},[ie(c)],8,Sd),F("button",{type:"button",class:"tify-scan-button",disabled:n.viewerState.isMinZoom,title:s.translate("Zoom out"),onClick:r[4]||(r[4]=(...d)=>s.zoomOut&&s.zoomOut(...d))},[ie(h)],8,Cd),F("button",{type:"button",class:Ee(["tify-scan-button",{"-active":n.options.rotation}]),title:s.translate("Rotate"),onClick:r[5]||(r[5]=d=>s.rotateRight(d))},[ie(g)],10,Rd),Ve((D(),O("div",{class:Ee(["tify-scan-filters",{"-open":n.filtersVisible}])},[F("button",{type:"button",class:Ee(["tify-scan-button",{"-active":s.filtersActive}]),title:s.translate("Toggle image filters"),"aria-controls":s.getId("filters"),"aria-expanded":n.filtersVisible?"true":"false",onClick:r[6]||(r[6]=d=>n.filtersVisible=!n.filtersVisible)},[ie(m)],10,Hd),Ve(F("div",{id:s.getId("filters"),class:"tify-scan-filters-popup"},[F("h3",Dd,X(s.translate("Image filters")),1),F("p",null,[F("label",null,[ie(T),Pe(" "+X(s.translate("Brightness"))+" ",1),F("b",null,X(Math.round((n.options.filters.brightness||1)*100))+"Â %",1),F("input",{ref:"firstSlider",class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:n.options.filters.brightness||1,onInput:r[7]||(r[7]=d=>s.setFilter("brightness",d))},null,40,Md)])]),F("p",null,[F("label",null,[ie(b),Pe(" "+X(s.translate("Contrast"))+" ",1),F("b",null,X(Math.round((n.options.filters.contrast||1)*100))+"Â %",1),F("input",{class:"tify-scan-range",max:"2",min:".5",step:".01",type:"range",value:n.options.filters.contrast||1,onInput:r[8]||(r[8]=d=>s.setFilter("contrast",d))},null,40,Od)])]),F("p",null,[F("label",null,[ie(P),Pe(" "+X(s.translate("Saturation"))+" ",1),F("b",null,X(Math.round(s.saturation*100))+"Â %",1),F("input",{class:"tify-scan-range",max:"3",min:"0",step:".01",type:"range",value:s.saturation,onInput:r[9]||(r[9]=d=>s.setFilter("saturate",d))},null,40,kd)])]),F("p",null,[F("button",{type:"button",class:"tify-scan-reset",disabled:!s.filtersActive,onClick:r[10]||(r[10]=(...d)=>s.resetFilters&&s.resetFilters(...d))},[ie(C),Pe(" "+X(s.translate("Reset")),1)],8,Fd)])],8,Ld),[[rt,n.filtersVisible]])],2)),[[k,s.closeFilters]])])):re("",!0),F("div",Ad,null,512)])}const Id=ue(wd,[["render",Bd]]),zd={},Nd={class:"tify-icon",viewBox:"0 0 24 24"},Vd=F("path",{d:"M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z"},null,-1),Ud=[Vd];function Wd(t,r){return D(),O("svg",Nd,Ud)}const jd=ue(zd,[["render",Wd]]),Gd={},qd={class:"tify-icon",viewBox:"0 0 24 24"},Zd=F("path",{d:"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"},null,-1),Kd=[Zd];function Xd(t,r){return D(),O("svg",qd,Kd)}const Yd=ue(Gd,[["render",Xd]]),Jd={},Qd={class:"tify-icon",viewBox:"0 0 24 24"},$d=F("path",{d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"},null,-1),ef=[$d];function tf(t,r){return D(),O("svg",Qd,ef)}const nf=ue(Jd,[["render",tf]]),sf={},rf={class:"tify-icon",viewBox:"0 0 24 24"},of=F("path",{d:"M11 15H17V17H11V15M9 7H7V9H9V7M11 13H17V11H11V13M11 9H17V7H11V9M9 11H7V13H9V11M21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5M19 5H5V19H19V5M9 15H7V17H9V15Z"},null,-1),af=[of];function lf(t,r){return D(),O("svg",rf,af)}const cf=ue(sf,[["render",lf]]),uf={},hf={class:"tify-icon",viewBox:"0 0 24 24"},df=F("path",{d:"M13,5V11H14.17L12,13.17L9.83,11H11V5H13M15,3H9V9H5L12,16L19,9H15V3M19,18H5V20H19V18Z"},null,-1),ff=[df];function pf(t,r){return D(),O("svg",hf,ff)}const gf=ue(uf,[["render",pf]]),mf={},vf={class:"tify-icon",viewBox:"0 0 24 24"},yf=F("path",{d:"M13.5,4A1.5,1.5 0 0,0 12,5.5A1.5,1.5 0 0,0 13.5,7A1.5,1.5 0 0,0 15,5.5A1.5,1.5 0 0,0 13.5,4M13.14,8.77C11.95,8.87 8.7,11.46 8.7,11.46C8.5,11.61 8.56,11.6 8.72,11.88C8.88,12.15 8.86,12.17 9.05,12.04C9.25,11.91 9.58,11.7 10.13,11.36C12.25,10 10.47,13.14 9.56,18.43C9.2,21.05 11.56,19.7 12.17,19.3C12.77,18.91 14.38,17.8 14.54,17.69C14.76,17.54 14.6,17.42 14.43,17.17C14.31,17 14.19,17.12 14.19,17.12C13.54,17.55 12.35,18.45 12.19,17.88C12,17.31 13.22,13.4 13.89,10.71C14,10.07 14.3,8.67 13.14,8.77Z"},null,-1),wf=[yf];function _f(t,r){return D(),O("svg",vf,wf)}const xf=ue(mf,[["render",_f]]),Tf={},bf={class:"tify-icon",viewBox:"0 0 24 24"},Ef=F("path",{d:"M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z"},null,-1),Pf=[Ef];function Sf(t,r){return D(),O("svg",bf,Pf)}const Cf=ue(Tf,[["render",Sf]]),Rf={},Hf={class:"tify-icon",viewBox:"0 0 24 24"},Lf=F("path",{d:"M4,5H20V7H4V5M4,9H20V11H4V9M4,13H20V15H4V13M4,17H14V19H4V17Z"},null,-1),Df=[Lf];function Mf(t,r){return D(),O("svg",Hf,Df)}const Of=ue(Rf,[["render",Mf]]),kf={},Ff={class:"tify-icon",viewBox:"0 0 24 24"},Af=F("path",{d:"M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"},null,-1),Bf=[Af];function If(t,r){return D(),O("svg",Ff,Bf)}const zf=ue(kf,[["render",If]]),Nf={},Vf={class:"tify-icon",viewBox:"0 0 24 24"},Uf=F("path",{d:"M12 16C13.1 16 14 16.9 14 18S13.1 20 12 20 10 19.1 10 18 10.9 16 12 16M12 10C13.1 10 14 10.9 14 12S13.1 14 12 14 10 13.1 10 12 10.9 10 12 10M12 4C13.1 4 14 4.9 14 6S13.1 8 12 8 10 7.1 10 6 10.9 4 12 4M6 16C7.1 16 8 16.9 8 18S7.1 20 6 20 4 19.1 4 18 4.9 16 6 16M6 10C7.1 10 8 10.9 8 12S7.1 14 6 14 4 13.1 4 12 4.9 10 6 10M6 4C7.1 4 8 4.9 8 6S7.1 8 6 8 4 7.1 4 6 4.9 4 6 4M18 16C19.1 16 20 16.9 20 18S19.1 20 18 20 16 19.1 16 18 16.9 16 18 16M18 10C19.1 10 20 10.9 20 12S19.1 14 18 14 16 13.1 16 12 16.9 10 18 10M18 4C19.1 4 20 4.9 20 6S19.1 8 18 8 16 7.1 16 6 16.9 4 18 4Z"},null,-1),Wf=[Uf];function jf(t,r){return D(),O("svg",Vf,Wf)}const Gf=ue(Nf,[["render",jf]]),qf={},Zf={class:"tify-icon",viewBox:"0 0 24 24"},Kf=F("path",{d:"M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M16,6H18V18H16V6Z"},null,-1),Xf=[Kf];function Yf(t,r){return D(),O("svg",Zf,Xf)}const Jf=ue(qf,[["render",Yf]]),Qf={},$f={class:"tify-icon",viewBox:"0 0 24 24"},ep=F("path",{d:"M16,18H18V6H16M6,18L14.5,12L6,6V18Z"},null,-1),tp=[ep];function ip(t,r){return D(),O("svg",$f,tp)}const np=ue(Qf,[["render",ip]]),sp={},rp={class:"tify-icon",viewBox:"0 0 24 24"},op=F("path",{d:"M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"},null,-1),ap=[op];function lp(t,r){return D(),O("svg",rp,ap)}const cp=ue(sp,[["render",lp]]),up={},hp={class:"tify-icon",viewBox:"0 0 24 24"},dp=F("path",{d:"M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z"},null,-1),fp=[dp];function pp(t,r){return D(),O("svg",hp,fp)}const gp=ue(up,[["render",pp]]),mp={},vp={class:"tify-icon",viewBox:"0 0 24 24"},yp=F("path",{d:"M21,5C19.89,4.65 18.67,4.5 17.5,4.5C15.55,4.5 13.45,4.9 12,6C10.55,4.9 8.45,4.5 6.5,4.5C4.55,4.5 2.45,4.9 1,6V20.65C1,20.9 1.25,21.15 1.5,21.15C1.6,21.15 1.65,21.1 1.75,21.1C3.1,20.45 5.05,20 6.5,20C8.45,20 10.55,20.4 12,21.5C13.35,20.65 15.8,20 17.5,20C19.15,20 20.85,20.3 22.25,21.05C22.35,21.1 22.4,21.1 22.5,21.1C22.75,21.1 23,20.85 23,20.6V6C22.4,5.55 21.75,5.25 21,5M21,18.5C19.9,18.15 18.7,18 17.5,18C15.8,18 13.35,18.65 12,19.5V8C13.35,7.15 15.8,6.5 17.5,6.5C18.7,6.5 19.9,6.65 21,7V18.5Z"},null,-1),wp=[yp];function _p(t,r){return D(),O("svg",vp,wp)}const xp=ue(mp,[["render",_p]]),Tp={},bp={class:"tify-icon",viewBox:"0 0 24 24"},Ep=F("path",{d:"M16,5V11H21V5M10,11H15V5H10M16,18H21V12H16M10,18H15V12H10M4,18H9V12H4M4,11H9V5H4V11Z"},null,-1),Pp=[Ep];function Sp(t,r){return D(),O("svg",bp,Pp)}const Cp=ue(Tp,[["render",Sp]]),Rp={data(){return{filter:"",filteredCanvases:[],highlightIndex:0,isOpen:!1,options:U}},computed:{canvases(){return me.sequences[0].canvases||[]},currentPageLabel(){const t=U.pages[0]||1,r=U.pages[0]?U.pages[0]-1:0,e=ke(this.canvases[r].label)[0];return di(t,e)},currentPageTitleAttr(){const{pages:t}=U,r=t[0]===0&&t.length>1?1:t[0],e=He("Physical page"),i=He("Logical page");return`${e}: ${r}
${i}: ${ke(this.canvases[r-1].label)[0]}`}},watch:{filter(){this.updateFilteredCanvases(),this.$nextTick(()=>this.updateScroll())},isOpen(){this.isOpen&&(this.filter="",this.highlightIndex=U.pages[0]-1)}},mounted(){this.updateFilteredCanvases(),U.root.$el.addEventListener("keydown",this.onKeydown)},beforeUnmount(){U.root.$el.removeEventListener("keydown",this.onKeydown)},methods:{closeDropdown(){this.isOpen=!1},convertValueToArray:ke,getId:zt,getPageLabel:di,onKeydown(t){if(!jn(t)){if(t.key==="Escape"){this.closeDropdown();return}t.key==="x"&&(this.toggleDropdown(),t.preventDefault())}},onKeyDownArrow(){this.highlightIndex<this.filteredCanvases.length-1&&(this.highlightIndex+=1,this.updateScroll())},onKeyUpArrow(){this.highlightIndex>0&&(this.highlightIndex-=1,this.updateScroll())},setPage(t){this.closeDropdown(),ut(t),It()&&Ce({view:"scan"})},toggleDropdown(){this.isOpen=!this.isOpen,this.isOpen&&this.$nextTick(()=>{this.$refs.search.focus(),this.updateScroll()})},updateFilteredCanvases(){const t=[],r=this.filter.toLowerCase();let e=-1;this.canvases.forEach((i,n)=>{const l=ke(i.label)[0].toLowerCase().indexOf(r)>-1,a=(n+1).toFixed().indexOf(r)>-1;if(l||a){const o=i;o.page=n+1,o.page===U.pages[0]&&(e=t.length),t.push(o)}}),this.highlightIndex=e<0?0:e,this.filteredCanvases=t},updateScroll(){const{list:t}=this.$refs;if(t&&t.children[this.highlightIndex]){const{offsetTop:r}=t.children[this.highlightIndex];t.scrollTop=r-(t.offsetHeight/2-t.children[0].offsetHeight)}},translate:He}},Hp={class:"tify-page-select"},Lp=["title","aria-label","aria-controls","aria-expanded"],Dp=["id"],Mp={class:"tify-page-select-filter"},Op=["aria-label"],kp={ref:"list",class:"tify-page-select-list"},Fp=["onClick"];function Ap(t,r,e,i,n,s){const l=kn("click-outside");return D(),O("div",Hp,[Ve((D(),O("button",{type:"button",class:"tify-page-select-button",title:s.currentPageTitleAttr,"aria-label":s.translate("Current page"),"aria-controls":s.getId("dropdown"),"aria-expanded":n.isOpen?"true":"false",onClick:r[0]||(r[0]=(...a)=>s.toggleDropdown&&s.toggleDropdown(...a))},[Pe(X(s.currentPageLabel),1)],8,Lp)),[[l,s.closeDropdown]]),Ve(F("div",{id:s.getId("dropdown"),key:"dropdown",class:"tify-page-select-dropdown",onClick:r[6]||(r[6]=Mt(()=>{},["stop"]))},[F("div",Mp,[Ve(F("input",{ref:"search","onUpdate:modelValue":r[1]||(r[1]=a=>n.filter=a),"aria-label":s.translate("Filter pages"),type:"text",class:"tify-page-select-input",onKeyup:r[2]||(r[2]=ni(a=>n.filteredCanvases[n.highlightIndex]&&s.setPage(n.filteredCanvases[n.highlightIndex].page),["enter"])),onKeydown:[r[3]||(r[3]=ni(Mt(a=>n.filter?n.filter="":s.closeDropdown(),["prevent"]),["esc"])),r[4]||(r[4]=ni(Mt(a=>s.onKeyUpArrow(),["prevent"]),["up"])),r[5]||(r[5]=ni(Mt(a=>s.onKeyDownArrow(),["prevent"]),["down"]))]},null,40,Op),[[Cr,n.filter]])]),F("ol",kp,[(D(!0),O(fe,null,Re(n.filteredCanvases,(a,o)=>(D(),O("li",{key:o,class:Ee({"-current":n.options.pages.indexOf(a.page)>-1,"-highlighted":n.highlightIndex===o})},[F("a",{href:"javascript:;",onClick:c=>s.setPage(a.page)},X(s.getPageLabel(a.page,s.convertValueToArray(a.label)[0])),9,Fp)],2))),128))],512)],8,Dp),[[rt,n.isOpen]])])}const Bp=ue(Rp,[["render",Ap]]),Ip={props:{fulltextEnabled:Boolean,tocEnabled:Boolean},data(){return{collection:Ae,controlsVisible:!1,customPageViewActive:kr,fullscreenActive:!1,isFirstPage:Fr,isLastPage:Ar,manifest:me,options:U,screen:U.root.$el.parentNode}},computed:{fullscreenSupported(){return document.fullscreenElement===null||document.webkitFullscreenElement===null},isLastSection(){const{pages:t}=U,r=t.length-1;return(t[r]?t[r]:t[r-1])>=this.sections[this.sections.length-1].firstPage},sections(){const t=[];return this.structures&&this.structures.forEach(r=>{if(!r.canvases){t.push({firstPage:1,lastPage:ct.value});return}const e=r.canvases[0],i=Ge.value.findIndex(l=>l["@id"]===e)+1,n=r.canvases[r.canvases.length-1],s=Ge.value.findIndex(l=>l["@id"]===n)+1;t.push({firstPage:i,lastPage:s})}),t},structures(){return me?me.structures:[]},title(){return ke((me||Ae||{}).label).join(`${String.fromCharCode(160)}Â· `).trim().replace(/(\S{1,10})\s+(\S{1,10})$/,`$1${String.fromCharCode(160)}$2`)}},created(){Ft(this.setView),Ft(this.toggleDoublePage),Ft(this.toggleFullscreen)},mounted(){U.root.$el.addEventListener("keydown",this.onKeyDown),["","moz","webkit"].forEach(r=>{document.addEventListener(`${r}fullscreenchange`,this.toggleFullscreenActive)})},beforeUnmount(){U.root.$el.removeEventListener("keydown",this.onKeyDown)},methods:{closeControlsPopup(){this.controlsVisible=!1},detectFullscreen(){let t;switch(null){case document.fullscreenElement:t=document.fullscreenElement;break;case document.webkitFullscreenElement:t=document.webkitFullscreenElement;break;default:t=!1}return t},getId:zt,goToFirstPage:Hs,goToLastPage:Ls,goToNextPage:vn,goToPreviousPage:yn,goToNextSection(){const{pages:t}=U,r=t.length-1,e=t[r]?t[r]:t[r-1];let i=0;for(;e>=this.sections[i].firstPage||e&&e>=this.sections[i].firstPage;)i+=1;ut(this.sections[i].firstPage)},goToPreviousSection(){const{pages:t}=U,r=t[0]?t[0]:t[1];let e=this.sections.length-1;for(;r<=this.sections[e].firstPage||r&&r<=this.sections[e].firstPage;)e-=1;ut(this.sections[e].firstPage)},onKeyDown(t){if(jn(t))return;if(t.key==="Escape"){this.controlsVisible=!1;return}switch(t.key){case"Backspace":this.$refs.switchViewSmall.offsetParent&&this.toggleView("scan");break;case"1":me&&this.fulltextEnabled&&this.toggleView("fulltext");break;case"2":me&&this.toggleView("thumbnails");break;case"3":me&&this.tocEnabled&&this.toggleView("toc");break;case"4":this.toggleView("info");break;case"5":me&&this.toggleView("export");break;case"6":Ae&&this.toggleView("collection");break;case"7":this.toggleView("help");break;case"b":me&&this.toggleDoublePage();break;case"f":this.toggleFullscreen();break}if(!me||this.customPageViewActive)return;const{pages:r}=U;switch(t.key){case"q":case",":r[0]>1&&yn();break;case"e":case".":this.isLastPage||vn();break;case"Q":r[0]>1&&Hs();break;case"E":this.isLastPage||Ls();break}},setView(t){Ce({view:t})},toggleControlsPopup(){this.controlsVisible=!this.controlsVisible},toggleDoublePage(t){const{pages:r}=U;let e;if(r.length>1&&t!==!0||t===!1)e=[r[0]<1?1:r[0]];else if(r[0]<2)e=[0,1];else if(r[0]%2>0)e=[r[0]-1,r[0]];else{const i=r[0]<ct.value?r[0]+1:0;e=[r[0],i]}return Ce({pages:e}),e},toggleFullscreen(t){return this.fullscreenActive&&t!==!0||t===!1?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),!1):(this.screen.requestFullscreen?this.screen.requestFullscreen():this.screen.mozRequestFullScreen?this.screen.mozRequestFullScreen():this.screen.webkitRequestFullscreen&&this.screen.webkitRequestFullscreen(),!0)},toggleFullscreenActive(){this.fullscreenActive=!this.fullscreenActive},toggleView(t){const r=t===U.view&&me&&!It()?"":t;return Ce({view:r}),r},translate:He}},zp={class:"tify-header"},Np={class:"tify-header-column -title"},Vp=["title"],Up={key:0,class:"tify-header-column -pagination"},Wp={class:"tify-header-button-group -page-select"},jp=["title"],Gp={class:"tify-header-button-group -pagination"},qp=["disabled","title"],Zp=["disabled","title"],Kp=["disabled","title"],Xp=["disabled","title"],Yp=["disabled","title"],Jp=["disabled","title"],Qp={class:"tify-header-column -toggle"},$p={ref:"switchViewSmall",class:"tify-header-button-group -toggle"},eg=["aria-controls","aria-expanded","aria-label","title"],tg=["id"],ig={class:"tify-header-button-group -view"},ng=["aria-controls","aria-expanded"],sg=["aria-controls","aria-expanded"],rg=["aria-controls","aria-expanded"],og=["aria-controls","aria-expanded"],ag=["aria-controls","aria-expanded"],lg=["aria-controls","aria-expanded"],cg=["aria-controls","aria-expanded"],ug={key:0,class:"tify-header-button-group -view"},hg=["aria-controls","aria-expanded","title"],dg=["title"],fg=["title"],pg={key:1,class:"tify-header-button-group -popup"},gg=["disabled","title"],mg=["disabled","title"],vg=["disabled","title"],yg=["disabled","title"],wg=["disabled","title"],_g=["disabled","title"];function xg(t,r,e,i,n,s){const l=Bp,a=Cp,o=xp,c=gp,h=cp,g=zr,m=Ir,T=np,b=Jf,P=Gf,C=zf,k=Of,d=Cf,_=xf,S=gf,M=cf,I=nf,V=Yd,q=jd,K=kn("click-outside");return D(),O("header",zp,[F("div",Np,[F("h1",{class:"tify-header-title",title:s.title},X(s.title),9,Vp)]),n.manifest["@id"]?(D(),O("div",Up,[F("div",Wp,[ie(l),F("button",{type:"button",class:Ee(["tify-header-button",{"-active":n.options.pages.length>1}]),title:s.translate("Toggle double-page"),onClick:r[0]||(r[0]=(...j)=>s.toggleDoublePage&&s.toggleDoublePage(...j))},[n.customPageViewActive?(D(),Ie(a,{key:0})):(D(),Ie(o,{key:1}))],10,jp)]),F("div",Gp,[F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("First page"),onClick:r[1]||(r[1]=(...j)=>s.goToFirstPage&&s.goToFirstPage(...j))},[ie(c)],8,qp),s.structures&&s.structures.length?(D(),O("button",{key:0,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous section"),onClick:r[2]||(r[2]=(...j)=>s.goToPreviousSection&&s.goToPreviousSection(...j))},[ie(h)],8,Zp)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous page"),onClick:r[3]||(r[3]=(...j)=>s.goToPreviousPage&&s.goToPreviousPage(...j))},[ie(g)],8,Kp),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Next page"),onClick:r[4]||(r[4]=(...j)=>s.goToNextPage&&s.goToNextPage(...j))},[ie(m)],8,Xp),s.structures&&s.structures.length?(D(),O("button",{key:1,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||s.isLastSection,title:s.translate("Next section"),onClick:r[5]||(r[5]=(...j)=>s.goToNextSection&&s.goToNextSection(...j))},[ie(T)],8,Yp)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Last page"),onClick:r[6]||(r[6]=(...j)=>s.goToLastPage&&s.goToLastPage(...j))},[ie(b)],8,Jp)])])):re("",!0),F("div",Qp,[F("div",$p,[Ve((D(),O("button",{type:"button","aria-controls":s.getId("controls"),"aria-expanded":n.controlsVisible?"true":"false","aria-label":s.translate("View"),class:"tify-header-button",title:s.translate("View"),onClick:r[7]||(r[7]=(...j)=>s.toggleControlsPopup&&s.toggleControlsPopup(...j))},[ie(P)],8,eg)),[[K,s.closeControlsPopup]])],512)]),F("div",{id:s.getId("controls"),class:Ee(["tify-header-column -controls",{"-visible":n.controlsVisible}])},[F("div",ig,[n.manifest["@id"]?(D(),O("button",{key:0,type:"button",class:Ee(["tify-header-button -scan",{"-active":n.options.view==="scan"}]),"aria-controls":s.getId("scan"),"aria-expanded":n.options.view==="scan"?"true":"false",onClick:r[8]||(r[8]=j=>s.toggleView("scan"))},[ie(C),Pe(" "+X(s.translate("Scan")),1)],10,ng)):re("",!0),e.fulltextEnabled?(D(),O("button",{key:1,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="fulltext"}]),"aria-controls":s.getId("fulltext"),"aria-expanded":n.options.view==="fulltext"?"true":"false",onClick:r[9]||(r[9]=j=>s.toggleView("fulltext"))},[ie(k),Pe(" "+X(s.translate("Fulltext")),1)],10,sg)):re("",!0),n.manifest["@id"]?(D(),O("button",{key:2,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="thumbnails"}]),"aria-controls":s.getId("thumbnails"),"aria-expanded":n.options.view==="thumbnails"?"true":"false",onClick:r[10]||(r[10]=j=>s.toggleView("thumbnails"))},[ie(a),Pe(" "+X(s.translate("Pages")),1)],10,rg)):re("",!0),e.tocEnabled?(D(),O("button",{key:3,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="toc"}]),"aria-controls":s.getId("toc"),"aria-expanded":n.options.view==="toc"?"true":"false",onClick:r[11]||(r[11]=j=>s.toggleView("toc"))},[ie(d),Pe(" "+X(s.translate("Contents")),1)],10,og)):re("",!0),F("button",{type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="info"}]),"aria-controls":s.getId("info"),"aria-expanded":n.options.view==="info"?"true":"false",onClick:r[12]||(r[12]=j=>s.toggleView("info"))},[ie(_),Pe(" "+X(s.translate("Info")),1)],10,ag),n.manifest["@id"]?(D(),O("button",{key:4,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="export"}]),"aria-controls":s.getId("export"),"aria-expanded":n.options.view==="export"?"true":"false",onClick:r[13]||(r[13]=j=>s.toggleView("export"))},[ie(S),Pe(" "+X(s.translate("Export")),1)],10,lg)):re("",!0),n.collection["@id"]?(D(),O("button",{key:5,type:"button",class:Ee(["tify-header-button",{"-active":n.options.view==="collection"}]),"aria-controls":s.getId("collection"),"aria-expanded":n.options==="collection"?"true":"false",onClick:r[14]||(r[14]=j=>s.toggleView("collection"))},[ie(M),Pe(" "+X(s.translate("Collection")),1)],10,cg)):re("",!0)]),s.fullscreenSupported?(D(),O("div",ug,[F("button",{type:"button",class:Ee(["tify-header-button -icon-only",{"-active":n.options.view==="help"}]),"aria-controls":s.getId("help"),"aria-expanded":n.options.view==="help"?"true":"false",title:s.translate("Help"),onClick:r[15]||(r[15]=j=>s.toggleView("help"))},[ie(I),Pe(" "+X(s.translate("Help")),1)],10,hg),n.fullscreenActive?(D(),O("button",{key:1,type:"button",class:"tify-header-button -icon-only",title:s.translate("Exit fullscreen"),onClick:r[17]||(r[17]=(...j)=>s.toggleFullscreen&&s.toggleFullscreen(...j))},[ie(q),Pe(" "+X(s.translate("Exit fullscreen")),1)],8,fg)):(D(),O("button",{key:0,type:"button",class:"tify-header-button -icon-only",title:s.translate("Fullscreen"),onClick:r[16]||(r[16]=(...j)=>s.toggleFullscreen&&s.toggleFullscreen(...j))},[ie(V),Pe(" "+X(s.translate("Fullscreen")),1)],8,dg))])):re("",!0),n.manifest["@id"]?(D(),O("div",pg,[F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("First page"),onClick:r[18]||(r[18]=(...j)=>s.goToFirstPage&&s.goToFirstPage(...j))},[ie(c)],8,gg),s.structures&&s.structures.length?(D(),O("button",{key:0,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous section"),onClick:r[19]||(r[19]=(...j)=>s.goToPreviousSection&&s.goToPreviousSection(...j))},[ie(h)],8,mg)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isFirstPage,title:s.translate("Previous page"),onClick:r[20]||(r[20]=(...j)=>s.goToPreviousPage&&s.goToPreviousPage(...j))},[ie(g)],8,vg),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Next page"),onClick:r[21]||(r[21]=(...j)=>s.goToNextPage&&s.goToNextPage(...j))},[ie(m)],8,yg),s.structures&&s.structures.length?(D(),O("button",{key:1,type:"button",class:"tify-header-button",disabled:n.customPageViewActive||s.isLastSection,title:s.translate("Next section"),onClick:r[22]||(r[22]=(...j)=>s.goToNextSection&&s.goToNextSection(...j))},[ie(T)],8,wg)):re("",!0),F("button",{type:"button",class:"tify-header-button",disabled:n.customPageViewActive||n.isLastPage,title:s.translate("Last page"),onClick:r[23]||(r[23]=(...j)=>s.goToLastPage&&s.goToLastPage(...j))},[ie(b)],8,_g)])):re("",!0)],10,tg)])}const Tg=ue(Ip,[["render",xg]]);const bg={props:{ready:Boolean},data(){return{canvases:Ge,collection:Ae,manifest:me,errorHandler:it,loading:Xe,options:U,translationLoaded:!!fn}},computed:{hasOtherContent(){return Ge.value.some(t=>"otherContent"in t)},hasToc(){return me.structures&&me.structures.length>0}},methods:{getId:zt,translate:He}},Eg={class:"tify",tabindex:"-1"},Pg={key:1,class:"tify-main"},Sg=["aria-label"],Cg={key:3,class:"tify-error"},Rg=["aria-label"],Hg={class:"tify-error-messages"};function Lg(t,r,e,i,n,s){const l=Tg,a=Id,o=rh,c=Ju,h=Uu,g=Au,m=ou,T=fc,b=Al,P=Hr;return D(),O("article",Eg,[e.ready&&(n.collection["@id"]||n.manifest["@id"])?(D(),Ie(l,{key:0,"fulltext-enabled":s.hasOtherContent,"toc-enabled":s.hasToc},null,8,["fulltext-enabled","toc-enabled"])):re("",!0),e.ready?(D(),O("div",Pg,[n.manifest["@id"]?(D(),O(fe,{key:0},[ie(a,{id:s.getId("scan")},null,8,["id"]),s.hasOtherContent?Ve((D(),Ie(o,{key:0,id:s.getId("fulltext")},null,8,["id"])),[[rt,n.options.view==="fulltext"]]):re("",!0),Ve(ie(c,{id:s.getId("thumbnails")},null,8,["id"]),[[rt,n.options.view==="thumbnails"]]),s.hasToc?Ve((D(),Ie(h,{key:1,id:s.getId("toc")},null,8,["id"])),[[rt,n.options.view==="toc"]]):re("",!0),Ve(ie(g,{id:s.getId("export")},null,8,["id"]),[[rt,n.options.view==="export"]])],64)):re("",!0),n.collection["@id"]||n.manifest["@id"]?Ve((D(),Ie(m,{key:1,id:s.getId("info")},null,8,["id"])),[[rt,n.options.view==="info"]]):re("",!0),n.collection["@id"]?Ve((D(),Ie(T,{key:2,id:s.getId("collection")},null,8,["id"])),[[rt,n.options.view==="collection"]]):re("",!0),Ve(ie(b,{id:s.getId("help")},null,8,["id"]),[[rt,n.options.view==="help"]])])):re("",!0),n.loading?(D(),O("div",{key:2,class:"tify-loading","aria-label":n.translationLoaded?s.translate("Loading"):"Loading"},null,8,Sg)):re("",!0),n.errorHandler.messages.length?(D(),O("section",Cg,[F("button",{type:"button",class:"tify-error-close","aria-label":s.translate("Dismiss"),onClick:r[0]||(r[0]=C=>n.errorHandler.clear())},[ie(P)],8,Rg),F("div",Hg,[(D(!0),O(fe,null,Re(n.errorHandler.messages,C=>(D(),O("p",{key:C},X(C),1))),128))])])):re("",!0)])}const Dg=ue(bg,[["render",Lg]]);window.Tify=function(r={}){const e={breakpoints:{tiny:359,small:719,medium:959,large:1199},childManifestAutoloaded:!0,childManifestUrl:null,container:null,filters:{},language:"en",manifestUrl:null,optionsResetOnPageChange:["pan"],pageLabelFormat:"P : L",pages:null,pan:{},rotation:null,translationsDirUrl:null,urlQueryKey:null,urlQueryParams:["childManifestUrl","filters","pages","pan","rotation","view","zoom"],view:"",viewer:{},zoom:null};if(this.options={...e,...r},!this.options.translationsDirUrl){const a=[...document.getElementsByTagName("script")].find(o=>o.src.includes("/tify"));if(a){const{src:o}=a;this.options.translationsDirUrl=`${o.substring(0,o.lastIndexOf("/"))}/translations`}}let i=null;this.ready=new Promise((l,a)=>{i={resolve:l,reject:a}});const n=this;this.app=pl({data(){return{collection:null,error:"",manifest:null,options:n.options,ready:!1,readyPromise:i,translation:null}},created(){this.options.root=this,Object.assign(U,n.options),Ft(Rs),Ft(ut)},mounted(){if(this.updateBreakpoint(),new ResizeObserver(this.updateBreakpoint).observe(this.$el),!this.options.manifestUrl){it.add('Missing option "manifestUrl"');return}Promise.all([Vn(this.options.manifestUrl,{}),Rs(this.options.language)]).then(()=>{this.$nextTick(()=>{this.ready=!0,this.readyPromise.resolve()})},l=>{this.readyPromise.reject(l)})},beforeUnmount(){clearTimeout(dn),window.removeEventListener("popstate",mn)},methods:{updateBreakpoint(){Object.keys(this.options.breakpoints).forEach(l=>{this.$el.clientWidth<=this.options.breakpoints[l]?this.$el.classList.add(`-${l}`):this.$el.classList.remove(`-${l}`)}),this.$el.clientHeight<520?this.$el.classList.add("-short"):this.$el.classList.remove("-short")}},render(){return Ua(Dg,{ready:this.ready})}}),this.app.use(vl);let s=!1;this.mount=l=>{if(s)throw new Error("TIFY is already mounted");const a=typeof l=="string"?document.querySelector(l):l;if(!a)throw new Error("Container element not found");window.getComputedStyle(a).position==="static"&&(a.style.position="relative"),this.app.mount(a),s=!0},this.destroy=()=>{this.app.unmount()},this.options.container&&this.mount(this.options.container)};
